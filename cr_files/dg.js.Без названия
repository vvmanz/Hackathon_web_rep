/* 
This license text has to stay intact at all times:
Author: Emrah BASKAYA @ www.hesido.com

This script is registered for use by:
DG-Soft
Under the following licence agreement:
http://www.hesido.com/licenses.php?page=flexcrollcommercialunlimited

Key for this license: 20120305215741005
MD5 hash for this license: 1d57a3dccd59fb7bcdfc153c4ed59324
End of license text---
*/
function CSBfleXcroll(e){DG.fleXcroll.fleXcrollMain(e)}var OpenLayers={VERSION_NUMBER:"Release 2.11",singleFile:!0,_getScriptLocation:function(){for(var e,t,i=new RegExp("(^|(.*?\\/))(OpenLayers.js)(\\?|$)"),n=document.getElementsByTagName("script"),r="",o=0,s=n.length;o<s;o++)if(e=n[o].getAttribute("src")){var t=e.match(i);if(t){r=t[1];break}}return function(){return r}}()};if(function(){var e="object"==typeof OpenLayers&&OpenLayers.singleFile,t=e?"OpenLayers.js":"lib/OpenLayers.js",i=window.OpenLayers;if(window.OpenLayers={_getScriptLocation:function(){for(var e,i,n=new RegExp("(^|(.*?\\/))("+t+")(\\?|$)"),r=document.getElementsByTagName("script"),o="",s=0,a=r.length;s<a;s++)if(e=r[s].getAttribute("src")){var i=e.match(n);if(i){o=i[1];break}}return function(){return o}}()},!e){i||(i=["OpenLayers/BaseTypes/Class.js","OpenLayers/Util.js","OpenLayers/BaseTypes.js","OpenLayers/BaseTypes/Bounds.js","OpenLayers/BaseTypes/Date.js","OpenLayers/BaseTypes/Element.js","OpenLayers/BaseTypes/LonLat.js","OpenLayers/BaseTypes/Pixel.js","OpenLayers/BaseTypes/Size.js","OpenLayers/Console.js","OpenLayers/Tween.js","OpenLayers/Kinetic.js","Rico/Corner.js","Rico/Color.js","OpenLayers/Ajax.js","OpenLayers/Events.js","OpenLayers/Request.js","OpenLayers/Request/XMLHttpRequest.js","OpenLayers/Projection.js","OpenLayers/Map.js","OpenLayers/Layer.js","OpenLayers/Icon.js","OpenLayers/Marker.js","OpenLayers/Marker/Box.js","OpenLayers/Popup.js","OpenLayers/Tile.js","OpenLayers/Tile/Image.js","OpenLayers/Tile/Image/IFrame.js","OpenLayers/Tile/WFS.js","OpenLayers/Layer/Image.js","OpenLayers/Layer/SphericalMercator.js","OpenLayers/Layer/EventPane.js","OpenLayers/Layer/FixedZoomLevels.js","OpenLayers/Layer/Google.js","OpenLayers/Layer/Google/v3.js","OpenLayers/Layer/VirtualEarth.js","OpenLayers/Layer/Yahoo.js","OpenLayers/Layer/HTTPRequest.js","OpenLayers/Layer/Grid.js","OpenLayers/Layer/MapGuide.js","OpenLayers/Layer/MapServer.js","OpenLayers/Layer/MapServer/Untiled.js","OpenLayers/Layer/KaMap.js","OpenLayers/Layer/KaMapCache.js","OpenLayers/Layer/MultiMap.js","OpenLayers/Layer/Markers.js","OpenLayers/Layer/Text.js","OpenLayers/Layer/WorldWind.js","OpenLayers/Layer/ArcGIS93Rest.js","OpenLayers/Layer/WMS.js","OpenLayers/Layer/WMS/Untiled.js","OpenLayers/Layer/WMS/Post.js","OpenLayers/Layer/WMTS.js","OpenLayers/Layer/ArcIMS.js","OpenLayers/Layer/GeoRSS.js","OpenLayers/Layer/Boxes.js","OpenLayers/Layer/XYZ.js","OpenLayers/Layer/Bing.js","OpenLayers/Layer/TMS.js","OpenLayers/Layer/TileCache.js","OpenLayers/Layer/Zoomify.js","OpenLayers/Layer/ArcGISCache.js","OpenLayers/Popup/Anchored.js","OpenLayers/Popup/AnchoredBubble.js","OpenLayers/Popup/Framed.js","OpenLayers/Popup/FramedCloud.js","OpenLayers/Feature.js","OpenLayers/Feature/Vector.js","OpenLayers/Feature/WFS.js","OpenLayers/Handler.js","OpenLayers/Handler/Click.js","OpenLayers/Handler/Hover.js","OpenLayers/Handler/Point.js","OpenLayers/Handler/Path.js","OpenLayers/Handler/Polygon.js","OpenLayers/Handler/Feature.js","OpenLayers/Handler/Drag.js","OpenLayers/Handler/Pinch.js","OpenLayers/Handler/RegularPolygon.js","OpenLayers/Handler/Box.js","OpenLayers/Handler/MouseWheel.js","OpenLayers/Handler/Keyboard.js","OpenLayers/Control.js","OpenLayers/Control/Attribution.js","OpenLayers/Control/Button.js","OpenLayers/Control/ZoomBox.js","OpenLayers/Control/ZoomToMaxExtent.js","OpenLayers/Control/DragPan.js","OpenLayers/Control/Navigation.js","OpenLayers/Control/PinchZoom.js","OpenLayers/Control/TouchNavigation.js","OpenLayers/Control/MouseDefaults.js","OpenLayers/Control/MousePosition.js","OpenLayers/Control/OverviewMap.js","OpenLayers/Control/KeyboardDefaults.js","OpenLayers/Control/PanZoom.js","OpenLayers/Control/PanZoomBar.js","OpenLayers/Control/ArgParser.js","OpenLayers/Control/Permalink.js","OpenLayers/Control/Scale.js","OpenLayers/Control/ScaleLine.js","OpenLayers/Control/Snapping.js","OpenLayers/Control/Split.js","OpenLayers/Control/LayerSwitcher.js","OpenLayers/Control/DrawFeature.js","OpenLayers/Control/DragFeature.js","OpenLayers/Control/ModifyFeature.js","OpenLayers/Control/Panel.js","OpenLayers/Control/SelectFeature.js","OpenLayers/Control/NavigationHistory.js","OpenLayers/Control/Measure.js","OpenLayers/Control/WMSGetFeatureInfo.js","OpenLayers/Control/WMTSGetFeatureInfo.js","OpenLayers/Control/Graticule.js","OpenLayers/Control/TransformFeature.js","OpenLayers/Control/SLDSelect.js","OpenLayers/Geometry.js","OpenLayers/Geometry/Rectangle.js","OpenLayers/Geometry/Collection.js","OpenLayers/Geometry/Point.js","OpenLayers/Geometry/MultiPoint.js","OpenLayers/Geometry/Curve.js","OpenLayers/Geometry/LineString.js","OpenLayers/Geometry/LinearRing.js","OpenLayers/Geometry/Polygon.js","OpenLayers/Geometry/MultiLineString.js","OpenLayers/Geometry/MultiPolygon.js","OpenLayers/Geometry/Surface.js","OpenLayers/Renderer.js","OpenLayers/Renderer/Elements.js","OpenLayers/Renderer/NG.js","OpenLayers/Renderer/SVG.js","OpenLayers/Renderer/SVG2.js","OpenLayers/Renderer/Canvas.js","OpenLayers/Renderer/VML.js","OpenLayers/Layer/Vector.js","OpenLayers/Layer/PointGrid.js","OpenLayers/Layer/Vector/RootContainer.js","OpenLayers/Strategy.js","OpenLayers/Strategy/Filter.js","OpenLayers/Strategy/Fixed.js","OpenLayers/Strategy/Cluster.js","OpenLayers/Strategy/Paging.js","OpenLayers/Strategy/BBOX.js","OpenLayers/Strategy/Save.js","OpenLayers/Strategy/Refresh.js","OpenLayers/Filter.js","OpenLayers/Filter/FeatureId.js","OpenLayers/Filter/Logical.js","OpenLayers/Filter/Comparison.js","OpenLayers/Filter/Spatial.js","OpenLayers/Filter/Function.js","OpenLayers/Protocol.js","OpenLayers/Protocol/HTTP.js","OpenLayers/Protocol/SQL.js","OpenLayers/Protocol/SQL/Gears.js","OpenLayers/Protocol/WFS.js","OpenLayers/Protocol/WFS/v1.js","OpenLayers/Protocol/WFS/v1_0_0.js","OpenLayers/Protocol/WFS/v1_1_0.js","OpenLayers/Protocol/Script.js","OpenLayers/Protocol/SOS.js","OpenLayers/Protocol/SOS/v1_0_0.js","OpenLayers/Layer/PointTrack.js","OpenLayers/Layer/GML.js","OpenLayers/Style.js","OpenLayers/Style2.js","OpenLayers/StyleMap.js","OpenLayers/Rule.js","OpenLayers/Format.js","OpenLayers/Format/QueryStringFilter.js","OpenLayers/Format/XML.js","OpenLayers/Format/XML/VersionedOGC.js","OpenLayers/Format/Context.js","OpenLayers/Format/ArcXML.js","OpenLayers/Format/ArcXML/Features.js","OpenLayers/Format/GML.js","OpenLayers/Format/GML/Base.js","OpenLayers/Format/GML/v2.js","OpenLayers/Format/GML/v3.js","OpenLayers/Format/Atom.js","OpenLayers/Format/KML.js","OpenLayers/Format/GeoRSS.js","OpenLayers/Format/WFS.js","OpenLayers/Format/WFSCapabilities.js","OpenLayers/Format/WFSCapabilities/v1.js","OpenLayers/Format/WFSCapabilities/v1_0_0.js","OpenLayers/Format/WFSCapabilities/v1_1_0.js","OpenLayers/Format/WFSDescribeFeatureType.js","OpenLayers/Format/WMSDescribeLayer.js","OpenLayers/Format/WMSDescribeLayer/v1_1.js","OpenLayers/Format/WKT.js","OpenLayers/Format/CQL.js","OpenLayers/Format/OSM.js","OpenLayers/Format/GPX.js","OpenLayers/Format/Filter.js","OpenLayers/Format/Filter/v1.js","OpenLayers/Format/Filter/v1_0_0.js","OpenLayers/Format/Filter/v1_1_0.js","OpenLayers/Format/SLD.js","OpenLayers/Format/SLD/v1.js","OpenLayers/Format/SLD/v1_0_0.js","OpenLayers/Format/OWSCommon.js","OpenLayers/Format/OWSCommon/v1.js","OpenLayers/Format/OWSCommon/v1_0_0.js","OpenLayers/Format/OWSCommon/v1_1_0.js","OpenLayers/Format/CSWGetDomain.js","OpenLayers/Format/CSWGetDomain/v2_0_2.js","OpenLayers/Format/CSWGetRecords.js","OpenLayers/Format/CSWGetRecords/v2_0_2.js","OpenLayers/Format/WFST.js","OpenLayers/Format/WFST/v1.js","OpenLayers/Format/WFST/v1_0_0.js","OpenLayers/Format/WFST/v1_1_0.js","OpenLayers/Format/Text.js","OpenLayers/Format/JSON.js","OpenLayers/Format/GeoJSON.js","OpenLayers/Format/WMC.js","OpenLayers/Format/WMC/v1.js","OpenLayers/Format/WMC/v1_0_0.js","OpenLayers/Format/WMC/v1_1_0.js","OpenLayers/Format/WCSGetCoverage.js","OpenLayers/Format/WMSCapabilities.js","OpenLayers/Format/WMSCapabilities/v1.js","OpenLayers/Format/WMSCapabilities/v1_1.js","OpenLayers/Format/WMSCapabilities/v1_1_0.js","OpenLayers/Format/WMSCapabilities/v1_1_1.js","OpenLayers/Format/WMSCapabilities/v1_3.js","OpenLayers/Format/WMSCapabilities/v1_3_0.js","OpenLayers/Format/WMSCapabilities/v1_1_1_WMSC.js","OpenLayers/Format/WMSGetFeatureInfo.js","OpenLayers/Format/SOSCapabilities.js","OpenLayers/Format/SOSCapabilities/v1_0_0.js","OpenLayers/Format/SOSGetFeatureOfInterest.js","OpenLayers/Format/SOSGetObservation.js","OpenLayers/Format/OWSContext.js","OpenLayers/Format/OWSContext/v0_3_1.js","OpenLayers/Format/WMTSCapabilities.js","OpenLayers/Format/WMTSCapabilities/v1_0_0.js","OpenLayers/Format/WPSCapabilities.js","OpenLayers/Format/WPSCapabilities/v1_0_0.js","OpenLayers/Format/WPSDescribeProcess.js","OpenLayers/Format/WPSExecute.js","OpenLayers/Format/XLS.js","OpenLayers/Format/XLS/v1.js","OpenLayers/Format/XLS/v1_1_0.js","OpenLayers/Format/OGCExceptionReport.js","OpenLayers/Layer/WFS.js","OpenLayers/Control/GetFeature.js","OpenLayers/Control/MouseToolbar.js","OpenLayers/Control/NavToolbar.js","OpenLayers/Control/PanPanel.js","OpenLayers/Control/Pan.js","OpenLayers/Control/ZoomIn.js","OpenLayers/Control/ZoomOut.js","OpenLayers/Control/ZoomPanel.js","OpenLayers/Control/EditingToolbar.js","OpenLayers/Control/Geolocate.js","OpenLayers/Symbolizer.js","OpenLayers/Symbolizer/Point.js","OpenLayers/Symbolizer/Line.js","OpenLayers/Symbolizer/Polygon.js","OpenLayers/Symbolizer/Text.js","OpenLayers/Symbolizer/Raster.js","OpenLayers/Lang.js","OpenLayers/Lang/en.js"]);for(var n=new Array(i.length),r=OpenLayers._getScriptLocation()+"lib/",o=0,s=i.length;o<s;o++)n[o]="<script src='"+r+i[o]+"'></script>";n.length>0&&document.write(n.join(""))}}(),OpenLayers.VERSION_NUMBER="Release 2.11",OpenLayers.String={startsWith:function(e,t){return 0==e.indexOf(t)},contains:function(e,t){return e.indexOf(t)!=-1},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(e){for(var t=e.split("-"),i=t[0],n=1,r=t.length;n<r;n++){var o=t[n];i+=o.charAt(0).toUpperCase()+o.substring(1)}return i},format:function(e,t,i){t||(t=window);var n=function(e,n){for(var r,o=n.split(/\.+/),s=0;s<o.length;s++)0==s&&(r=t),r=r[o[s]];return"function"==typeof r&&(r=i?r.apply(null,i):r()),"undefined"==typeof r?"undefined":r};return e.replace(OpenLayers.String.tokenRegEx,n)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(e){return OpenLayers.String.numberRegEx.test(e)},numericIf:function(e){return OpenLayers.String.isNumeric(e)?parseFloat(e):e}},String.prototype.startsWith||(String.prototype.startsWith=function(e){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.startsWith"})),OpenLayers.String.startsWith(this,e)}),String.prototype.contains||(String.prototype.contains=function(e){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.contains"})),OpenLayers.String.contains(this,e)}),String.prototype.trim||(String.prototype.trim=function(){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.trim"})),OpenLayers.String.trim(this)}),String.prototype.camelize||(String.prototype.camelize=function(){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.String.camelize"})),OpenLayers.String.camelize(this)}),OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(e,t){var i=0;return t>0&&(i=parseFloat(e.toPrecision(t))),i},format:function(e,t,i,n){t="undefined"!=typeof t?t:0,i="undefined"!=typeof i?i:OpenLayers.Number.thousandsSeparator,n="undefined"!=typeof n?n:OpenLayers.Number.decimalSeparator,null!=t&&(e=parseFloat(e.toFixed(t)));var r=e.toString().split(".");1==r.length&&null==t&&(t=0);var o=r[0];if(i)for(var s=/(-?[0-9]+)([0-9]{3})/;s.test(o);)o=o.replace(s,"$1"+i+"$2");var a;if(0==t)a=o;else{var l=r.length>1?r[1]:"0";null!=t&&(l+=new Array(t-l.length+1).join("0")),a=o+n+l}return a}},Number.prototype.limitSigDigs||(Number.prototype.limitSigDigs=function(e){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Number.limitSigDigs"})),OpenLayers.Number.limitSigDigs(this,e)}),OpenLayers.Function={bind:function(e,t){var i=Array.prototype.slice.apply(arguments,[2]);return function(){var n=i.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(t,n)}},bindAsEventListener:function(e,t){return function(i){return e.call(t,i||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},Function.prototype.bind||(Function.prototype.bind=function(){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bind"})),Array.prototype.unshift.apply(arguments,[this]),OpenLayers.Function.bind.apply(null,arguments)}),Function.prototype.bindAsEventListener||(Function.prototype.bindAsEventListener=function(e){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Function.bindAsEventListener"})),OpenLayers.Function.bindAsEventListener(this,e)}),OpenLayers.Array={filter:function(e,t,i){var n=[];if(Array.prototype.filter)n=e.filter(t,i);else{var r=e.length;if("function"!=typeof t)throw new TypeError;for(var o=0;o<r;o++)if(o in e){var s=e[o];t.call(i,s,o,e)&&n.push(s)}}return n}},OpenLayers.Class=function(){var e=arguments.length,t=arguments[0],i=arguments[e-1],n="function"==typeof i.initialize?i.initialize:function(){t.prototype.initialize.apply(this,arguments)};if(e>1){var r=[n,t].concat(Array.prototype.slice.call(arguments).slice(1,e-1),i);OpenLayers.inherit.apply(null,r)}else n.prototype=i;return n},OpenLayers.Class.isPrototype=function(){},OpenLayers.Class.create=function(){return function(){arguments&&arguments[0]!=OpenLayers.Class.isPrototype&&this.initialize.apply(this,arguments)}},OpenLayers.Class.inherit=function(e){var t=function(){e.call(this)},i=[t].concat(Array.prototype.slice.call(arguments));return OpenLayers.inherit.apply(null,i),t.prototype},OpenLayers.inherit=function(e,t){var i=function(){};i.prototype=t.prototype,e.prototype=new i;var n,r,o;for(n=2,r=arguments.length;n<r;n++)o=arguments[n],"function"==typeof o&&(o=o.prototype),OpenLayers.Util.extend(e.prototype,o)},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.extend=function(e,t){if(e=e||{},t){for(var i in t){var n=t[i];void 0!==n&&(e[i]=n)}var r="function"==typeof window.Event&&t instanceof window.Event;!r&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&(e.toString=t.toString)}return e},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.getElement=function(){for(var e=[],t=0,i=arguments.length;t<i;t++){var n=arguments[t];if("string"==typeof n&&(n=document.getElementById(n)),1==arguments.length)return n;e.push(n)}return e},OpenLayers.Util.isElement=function(e){return!(!e||1!==e.nodeType)},OpenLayers.Util.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},"undefined"==typeof window.$&&(window.$=OpenLayers.Util.getElement),OpenLayers.Util.removeItem=function(e,t){for(var i=e.length-1;i>=0;i--)e[i]==t&&e.splice(i,1);return e},OpenLayers.Util.clearArray=function(e){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"array = []"})),e.length=0},OpenLayers.Util.indexOf=function(e,t){if("function"==typeof e.indexOf)return e.indexOf(t);for(var i=0,n=e.length;i<n;i++)if(e[i]==t)return i;return-1},OpenLayers.Util.modifyDOMElement=function(e,t,i,n,r,o,s,a){t&&(e.id=t),i&&(e.style.left=i.x+"px",e.style.top=i.y+"px"),n&&(e.style.width=n.w+"px",e.style.height=n.h+"px"),r&&(e.style.position=r),o&&(e.style.border=o),s&&(e.style.overflow=s),parseFloat(a)>=0&&parseFloat(a)<1?(e.style.filter="alpha(opacity="+100*a+")",e.style.opacity=a):1==parseFloat(a)&&(e.style.filter="",e.style.opacity="")},OpenLayers.Util.createDiv=function(e,t,i,n,r,o,s,a){var l=document.createElement("div");return n&&(l.style.backgroundImage="url("+n+")"),e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv")),r||(r="absolute"),OpenLayers.Util.modifyDOMElement(l,e,t,i,r,o,s,a),l},OpenLayers.Util.createImage=function(e,t,i,n,r,o,s,a){var l=document.createElement("img");return e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv")),r||(r="relative"),OpenLayers.Util.modifyDOMElement(l,e,t,i,r,o,null,s),a&&(l.style.display="none",OpenLayers.Event.observe(l,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,l)),OpenLayers.Event.observe(l,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,l))),l.style.alt=e,l.galleryImg="no",n&&(l.src=n),l},OpenLayers.Util.setOpacity=function(e,t){OpenLayers.Util.modifyDOMElement(e,null,null,null,null,null,null,t)},OpenLayers.Util.onImageLoad=function(){(!this.viewRequestID||this.map&&this.viewRequestID==this.map.viewRequestID)&&(this.style.display=""),OpenLayers.Element.removeClass(this,"olImageLoadError")},OpenLayers.IMAGE_RELOAD_ATTEMPTS=0,OpenLayers.Util.onImageLoadError=function(){if(this._attempts=this._attempts?this._attempts+1:1,this._attempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){var e=this.urls;if(e&&OpenLayers.Util.isArray(e)&&e.length>1){var t,i,n=this.src.toString();for(i=0;(t=e[i])&&n.indexOf(t)==-1;i++);var r=Math.floor(e.length*Math.random()),o=e[r];for(i=0;o==t&&i++<4;)r=Math.floor(e.length*Math.random()),o=e[r];this.src=n.replace(t,o)}else this.src=this.src}else OpenLayers.Element.addClass(this,"olImageLoadError");this.style.display=""},OpenLayers.Util.alphaHackNeeded=null,OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var e=navigator.appVersion.split("MSIE"),t=parseFloat(e[1]),i=!1;try{i=!!document.body.filters}catch(n){}OpenLayers.Util.alphaHackNeeded=i&&t>=5.5&&t<7}return OpenLayers.Util.alphaHackNeeded},OpenLayers.Util.modifyAlphaImageDiv=function(e,t,i,n,r,o,s,a,l){OpenLayers.Util.modifyDOMElement(e,t,i,n,o,null,null,l);var h=e.childNodes[0];r&&(h.src=r),OpenLayers.Util.modifyDOMElement(h,e.id+"_innerImage",null,n,"relative",s),OpenLayers.Util.alphaHack()&&("none"!=e.style.display&&(e.style.display="inline-block"),null==a&&(a="scale"),e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+h.src+"', sizingMethod='"+a+"')",parseFloat(e.style.opacity)>=0&&parseFloat(e.style.opacity)<1&&(e.style.filter+=" alpha(opacity="+100*e.style.opacity+")"),h.style.filter="alpha(opacity=0)")},OpenLayers.Util.createAlphaImageDiv=function(e,t,i,n,r,o,s,a,l){var h=OpenLayers.Util.createDiv(),c=OpenLayers.Util.createImage(null,null,null,null,null,null,null,!1);return h.appendChild(c),l&&(c.style.display="none",OpenLayers.Event.observe(c,"load",OpenLayers.Function.bind(OpenLayers.Util.onImageLoad,h)),OpenLayers.Event.observe(c,"error",OpenLayers.Function.bind(OpenLayers.Util.onImageLoadError,h))),OpenLayers.Util.modifyAlphaImageDiv(h,e,t,i,n,r,o,s,a),h},OpenLayers.Util.upperCaseObject=function(e){var t={};for(var i in e)t[i.toUpperCase()]=e[i];return t},OpenLayers.Util.applyDefaults=function(e,t){e=e||{};var i="function"==typeof window.Event&&t instanceof window.Event;for(var n in t)(void 0===e[n]||!i&&t.hasOwnProperty&&t.hasOwnProperty(n)&&!e.hasOwnProperty(n))&&(e[n]=t[n]);return!i&&t&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&!e.hasOwnProperty("toString")&&(e.toString=t.toString),e},OpenLayers.Util.getParameterString=function(e){var t=[];for(var i in e){var n=e[i];if(null!=n&&"function"!=typeof n){var r;if("object"==typeof n&&n.constructor==Array){for(var o,s=[],a=0,l=n.length;a<l;a++)o=n[a],s.push(encodeURIComponent(null===o||void 0===o?"":o));r=s.join(",")}else r=encodeURIComponent(n);t.push(encodeURIComponent(i)+"="+r)}}return t.join("&")},OpenLayers.Util.urlAppend=function(e,t){var i=e;if(t){var n=(e+" ").split(/[?&]/);i+=" "===n.pop()?t:n.length?"&"+t:"?"+t}return i},OpenLayers.ImgPath="",OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"},OpenLayers.Util.Try=function(){for(var e=null,t=0,i=arguments.length;t<i;t++){var n=arguments[t];try{e=n();break}catch(r){}}return e},OpenLayers.Util.getXmlNodeValue=function(e){var t=null;return OpenLayers.Util.Try(function(){t=e.text,t||(t=e.textContent),t||(t=e.firstChild.nodeValue)},function(){t=e.textContent}),t},OpenLayers.Util.mouseLeft=function(e,t){for(var i=e.relatedTarget?e.relatedTarget:e.toElement;i!=t&&null!=i;)i=i.parentNode;return i!=t},OpenLayers.Util.DEFAULT_PRECISION=14,OpenLayers.Util.toFloat=function(e,t){return null==t&&(t=OpenLayers.Util.DEFAULT_PRECISION),"number"!=typeof e&&(e=parseFloat(e)),0===t?e:parseFloat(e.toPrecision(t))},OpenLayers.Util.rad=function(e){return e*Math.PI/180},OpenLayers.Util.deg=function(e){return 180*e/Math.PI},OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563},OpenLayers.Util.distVincenty=function(e,t){for(var i=OpenLayers.Util.VincentyConstants,n=i.a,r=i.b,o=i.f,s=OpenLayers.Util.rad(t.lon-e.lon),a=Math.atan((1-o)*Math.tan(OpenLayers.Util.rad(e.lat))),l=Math.atan((1-o)*Math.tan(OpenLayers.Util.rad(t.lat))),h=Math.sin(a),c=Math.cos(a),u=Math.sin(l),d=Math.cos(l),p=s,g=2*Math.PI,m=20;Math.abs(p-g)>1e-12&&--m>0;){var f=Math.sin(p),y=Math.cos(p),_=Math.sqrt(d*f*(d*f)+(c*u-h*d*y)*(c*u-h*d*y));if(0==_)return 0;var v=h*u+c*d*y,D=Math.atan2(_,v),b=Math.asin(c*d*f/_),L=Math.cos(b)*Math.cos(b),C=v-2*h*u/L,G=o/16*L*(4+o*(4-3*L));g=p,p=s+(1-G)*o*Math.sin(b)*(D+G*_*(C+G*v*(-1+2*C*C)))}if(0==m)return NaN;var M=L*(n*n-r*r)/(r*r),S=1+M/16384*(4096+M*(-768+M*(320-175*M))),w=M/1024*(256+M*(-128+M*(74-47*M))),E=w*_*(C+w/4*(v*(-1+2*C*C)-w/6*C*(-3+4*_*_)*(-3+4*C*C))),O=r*S*(D-E),P=O.toFixed(3)/1e3;return P},OpenLayers.Util.destinationVincenty=function(e,t,i){for(var n=OpenLayers.Util,r=n.VincentyConstants,o=r.a,s=r.b,a=r.f,l=e.lon,h=e.lat,c=i,u=n.rad(t),d=Math.sin(u),p=Math.cos(u),g=(1-a)*Math.tan(n.rad(h)),m=1/Math.sqrt(1+g*g),f=g*m,y=Math.atan2(g,p),_=m*d,v=1-_*_,D=v*(o*o-s*s)/(s*s),b=1+D/16384*(4096+D*(-768+D*(320-175*D))),L=D/1024*(256+D*(-128+D*(74-47*D))),C=c/(s*b),G=2*Math.PI;Math.abs(C-G)>1e-12;){var M=Math.cos(2*y+C),S=Math.sin(C),w=Math.cos(C),E=L*S*(M+L/4*(w*(-1+2*M*M)-L/6*M*(-3+4*S*S)*(-3+4*M*M)));G=C,C=c/(s*b)+E}var O=f*S-m*w*p,P=Math.atan2(f*w+m*S*p,(1-a)*Math.sqrt(_*_+O*O)),T=Math.atan2(S*d,m*w-f*S*p),x=a/16*v*(4+a*(4-3*v)),k=T-(1-x)*a*_*(C+x*S*(M+x*w*(-1+2*M*M)));Math.atan2(_,-O);return new OpenLayers.LonLat(l+n.deg(k),n.deg(P))},OpenLayers.Util.getParameters=function(e){e=null===e||void 0===e?window.location.href:e;var t="";if(OpenLayers.String.contains(e,"?")){var i=e.indexOf("?")+1,n=OpenLayers.String.contains(e,"#")?e.indexOf("#"):e.length;t=e.substring(i,n)}for(var r={},o=t.split(/[&;]/),s=0,a=o.length;s<a;++s){var l=o[s].split("=");if(l[0]){var h=l[0];try{h=decodeURIComponent(h)}catch(c){h=unescape(h)}var u=(l[1]||"").replace(/\+/g," ");try{u=decodeURIComponent(u)}catch(c){u=unescape(u)}u=u.split(","),1==u.length&&(u=u[0]),r[h]=u}}return r},OpenLayers.Util.getArgs=function(e){return OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"OpenLayers.Util.getParameters"})),OpenLayers.Util.getParameters(e)},OpenLayers.Util.lastSeqID=0,OpenLayers.Util.createUniqueID=function(e){return null==e&&(e="id_"),OpenLayers.Util.lastSeqID+=1,e+OpenLayers.Util.lastSeqID},OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36},OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches,OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd,OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m,OpenLayers.METERS_PER_INCH=.0254000508001016,OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH}),OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1e3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH}),OpenLayers.DOTS_PER_INCH=72,OpenLayers.Util.normalizeScale=function(e){var t=e>1?1/e:e;return t},OpenLayers.Util.getResolutionFromScale=function(e,t){var i;if(e){null==t&&(t="degrees");var n=OpenLayers.Util.normalizeScale(e);i=1/(n*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH)}return i},OpenLayers.Util.getScaleFromResolution=function(e,t){null==t&&(t="degrees");var i=e*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH;return i},OpenLayers.Util.safeStopPropagation=function(e){OpenLayers.Event.stop(e,!0)},OpenLayers.Util.pagePosition=function(e){var t=[0,0],i=OpenLayers.Util.getViewportElement();if(!e||e==window||e==i)return t;var n,r=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(e,"position")&&(""==e.style.top||""==e.style.left),o=null;if(e.getBoundingClientRect){n=e.getBoundingClientRect();var s=i.scrollTop,a=i.scrollLeft;t[0]=n.left+a,t[1]=n.top+s}else if(document.getBoxObjectFor&&!r){n=document.getBoxObjectFor(e);var l=document.getBoxObjectFor(i);t[0]=n.screenX-l.screenX,t[1]=n.screenY-l.screenY}else{if(t[0]=e.offsetLeft,t[1]=e.offsetTop,o=e.offsetParent,o!=e)for(;o;)t[0]+=o.offsetLeft,t[1]+=o.offsetTop,o=o.offsetParent;var h=OpenLayers.BROWSER_NAME;for(("opera"==h||"safari"==h&&"absolute"==OpenLayers.Element.getStyle(e,"position"))&&(t[1]-=document.body.offsetTop),o=e.offsetParent;o&&o!=document.body;)t[0]-=o.scrollLeft,"opera"==h&&"TR"==o.tagName||(t[1]-=o.scrollTop),o=o.offsetParent}return t},OpenLayers.Util.getViewportElement=function(){var e=arguments.callee.viewportElement;return void 0==e&&(e="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=e),e},OpenLayers.Util.isEquivalentUrl=function(e,t,i){i=i||{},OpenLayers.Util.applyDefaults(i,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0});var n=OpenLayers.Util.createUrlObject(e,i),r=OpenLayers.Util.createUrlObject(t,i);for(var o in n)if("args"!==o&&n[o]!=r[o])return!1;for(var o in n.args){if(n.args[o]!=r.args[o])return!1;delete r.args[o]}for(var o in r.args)return!1;return!0},OpenLayers.Util.createUrlObject=function(e,t){if(t=t||{},!/^\w+:\/\//.test(e)){var i=window.location,n=i.port?":"+i.port:"",r=i.protocol+"//"+i.host.split(":").shift()+n;if(0===e.indexOf("/"))e=r+e;else{var o=i.pathname.split("/");o.pop(),e=r+o.join("/")+"/"+e}}t.ignoreCase&&(e=e.toLowerCase());var s=document.createElement("a");s.href=e;var a={};a.host=s.host.split(":").shift(),a.protocol=s.protocol,t.ignorePort80?a.port="80"==s.port||"0"==s.port?"":s.port:a.port=""==s.port||"0"==s.port?"80":s.port,a.hash=t.ignoreHash||"#"===s.hash?"":s.hash;var l=s.search;if(!l){var h=e.indexOf("?");l=h!=-1?e.substr(h):""}return a.args=OpenLayers.Util.getParameters(l),a.pathname="/"==s.pathname.charAt(0)?s.pathname:"/"+s.pathname,a},OpenLayers.Util.removeTail=function(e){var t=null,i=e.indexOf("?"),n=e.indexOf("#");return t=i==-1?n!=-1?e.substr(0,n):e:n!=-1?e.substr(0,Math.min(i,n)):e.substr(0,i)},OpenLayers.IS_GECKO=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("webkit")==-1&&e.indexOf("gecko")!=-1}(),OpenLayers.BROWSER_NAME=function(){var e="",t=navigator.userAgent.toLowerCase();return t.indexOf("opera")!=-1?e="opera":t.indexOf("msie")!=-1?e="msie":t.indexOf("safari")!=-1?e="safari":t.indexOf("mozilla")!=-1&&(e=t.indexOf("firefox")!=-1?"firefox":"mozilla"),e}(),OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME},OpenLayers.Util.getRenderedDimensions=function(e,t,i){var n,r,o=document.createElement("div");o.style.visibility="hidden";var s=i&&i.containerElement?i.containerElement:document.body;t&&(t.w?(n=t.w,o.style.width=n+"px"):t.h&&(r=t.h,o.style.height=r+"px")),i&&i.displayClass&&(o.className=i.displayClass);var a=document.createElement("div");if(a.innerHTML=e,a.style.overflow="visible",a.childNodes)for(var l=0,h=a.childNodes.length;l<h;l++)a.childNodes[l].style&&(a.childNodes[l].style.overflow="visible");o.appendChild(a),s.appendChild(o);for(var c=!1,u=o.parentNode;u&&"body"!=u.tagName.toLowerCase();){var d=OpenLayers.Element.getStyle(u,"position");if("absolute"==d){c=!0;break}if(d&&"static"!=d)break;u=u.parentNode}return c||(o.style.position="absolute"),n||(n=parseInt(a.scrollWidth),o.style.width=n+"px"),r||(r=parseInt(a.scrollHeight)),o.removeChild(a),s.removeChild(o),new OpenLayers.Size(n,r)},OpenLayers.Util.getScrollbarWidth=function(){var e=OpenLayers.Util._scrollbarWidth;if(null==e){var t=null,i=null,n=0,r=0;t=document.createElement("div"),t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.width="100px",t.style.height="50px",t.style.overflow="hidden",i=document.createElement("div"),i.style.width="100%",i.style.height="200px",t.appendChild(i),document.body.appendChild(t),n=i.offsetWidth,t.style.overflow="scroll",r=i.offsetWidth,document.body.removeChild(document.body.lastChild),OpenLayers.Util._scrollbarWidth=n-r,e=OpenLayers.Util._scrollbarWidth}return e},OpenLayers.Util.getFormattedLonLat=function(e,t,i){i||(i="dms"),
e=(e+540)%360-180;var n=Math.abs(e),r=Math.floor(n),o=(n-r)/(1/60),s=o;o=Math.floor(o);var a=(s-o)/(1/60);a=Math.round(10*a),a/=10,a>=60&&(a-=60,o+=1,o>=60&&(o-=60,r+=1)),r<10&&(r="0"+r);var l=r+"°";return i.indexOf("dm")>=0&&(o<10&&(o="0"+o),l+=o+"'",i.indexOf("dms")>=0&&(a<10&&(a="0"+a),l+=a+'"')),l+="lon"==t?e<0?OpenLayers.i18n("W"):OpenLayers.i18n("E"):e<0?OpenLayers.i18n("S"):OpenLayers.i18n("N")},OpenLayers.Rico=OpenLayers.Rico||{},OpenLayers.Rico.Corner={round:function(e,t){e=OpenLayers.Util.getElement(e),this._setOptions(t);var i=this.options.color;"fromElement"==this.options.color&&(i=this._background(e));var n=this.options.bgColor;"fromParent"==this.options.bgColor&&(n=this._background(e.offsetParent)),this._roundCornersImpl(e,i,n)},changeColor:function(e,t){e.style.backgroundColor=t;for(var i=e.parentNode.getElementsByTagName("span"),n=0;n<i.length;n++)i[n].style.backgroundColor=t},changeOpacity:function(e,t){var i=t,n="alpha(opacity="+100*t+")";e.style.opacity=i,e.style.filter=n;for(var r=e.parentNode.getElementsByTagName("span"),o=0;o<r.length;o++)r[o].style.opacity=i,r[o].style.filter=n},reRound:function(e,t){var i=e.parentNode.childNodes[0],n=e.parentNode.childNodes[2];e.parentNode.removeChild(i),e.parentNode.removeChild(n),this.round(e.parentNode,t)},_roundCornersImpl:function(e,t,i){this.options.border&&this._renderBorder(e,i),this._isTopRounded()&&this._roundTopCorners(e,t,i),this._isBottomRounded()&&this._roundBottomCorners(e,t,i)},_renderBorder:function(e,t){var i="1px solid "+this._borderColor(t),n="border-left: "+i,r="border-right: "+i,o="style='"+n+";"+r+"'";e.innerHTML="<div "+o+">"+e.innerHTML+"</div>"},_roundTopCorners:function(e,t,i){for(var n=this._createCorner(i),r=0;r<this.options.numSlices;r++)n.appendChild(this._createCornerSlice(t,i,r,"top"));e.style.paddingTop=0,e.insertBefore(n,e.firstChild)},_roundBottomCorners:function(e,t,i){for(var n=this._createCorner(i),r=this.options.numSlices-1;r>=0;r--)n.appendChild(this._createCornerSlice(t,i,r,"bottom"));e.style.paddingBottom=0,e.appendChild(n)},_createCorner:function(e){var t=document.createElement("div");return t.style.backgroundColor=this._isTransparent()?"transparent":e,t},_createCornerSlice:function(e,t,i,n){var r=document.createElement("span"),o=r.style;o.backgroundColor=e,o.display="block",o.height="1px",o.overflow="hidden",o.fontSize="1px";var s=this._borderColor(e,t);return this.options.border&&0==i?(o.borderTopStyle="solid",o.borderTopWidth="1px",o.borderLeftWidth="0px",o.borderRightWidth="0px",o.borderBottomWidth="0px",o.height="0px",o.borderColor=s):s&&(o.borderColor=s,o.borderStyle="solid",o.borderWidth="0px 1px"),this.options.compact||i!=this.options.numSlices-1||(o.height="2px"),this._setMargin(r,i,n),this._setBorder(r,i,n),r},_setOptions:function(e){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:!0,border:!1,compact:!1},OpenLayers.Util.extend(this.options,e||{}),this.options.numSlices=this.options.compact?2:4,this._isTransparent()&&(this.options.blend=!1)},_whichSideTop:function(){return this._hasString(this.options.corners,"all","top")?"":this.options.corners.indexOf("tl")>=0&&this.options.corners.indexOf("tr")>=0?"":this.options.corners.indexOf("tl")>=0?"left":this.options.corners.indexOf("tr")>=0?"right":""},_whichSideBottom:function(){return this._hasString(this.options.corners,"all","bottom")?"":this.options.corners.indexOf("bl")>=0&&this.options.corners.indexOf("br")>=0?"":this.options.corners.indexOf("bl")>=0?"left":this.options.corners.indexOf("br")>=0?"right":""},_borderColor:function(e,t){return"transparent"==e?t:this.options.border?this.options.border:this.options.blend?this._blend(t,e):""},_setMargin:function(e,t,i){var n=this._marginSize(t),r="top"==i?this._whichSideTop():this._whichSideBottom();"left"==r?(e.style.marginLeft=n+"px",e.style.marginRight="0px"):"right"==r?(e.style.marginRight=n+"px",e.style.marginLeft="0px"):(e.style.marginLeft=n+"px",e.style.marginRight=n+"px")},_setBorder:function(e,t,i){var n=this._borderSize(t),r="top"==i?this._whichSideTop():this._whichSideBottom();"left"==r?(e.style.borderLeftWidth=n+"px",e.style.borderRightWidth="0px"):"right"==r?(e.style.borderRightWidth=n+"px",e.style.borderLeftWidth="0px"):(e.style.borderLeftWidth=n+"px",e.style.borderRightWidth=n+"px"),0!=this.options.border&&(e.style.borderLeftWidth=n+"px",e.style.borderRightWidth=n+"px")},_marginSize:function(e){if(this._isTransparent())return 0;var t=[5,3,2,1],i=[3,2,1,0],n=[2,1],r=[1,0];return this.options.compact&&this.options.blend?r[e]:this.options.compact?n[e]:this.options.blend?i[e]:t[e]},_borderSize:function(e){var t=[5,3,2,1],i=[2,1,1,1],n=[1,0],r=[0,2,0,0];return this.options.compact&&(this.options.blend||this._isTransparent())?1:this.options.compact?n[e]:this.options.blend?i[e]:this.options.border?r[e]:this._isTransparent()?t[e]:0},_hasString:function(e){for(var t=1;t<arguments.length;t++)if(e.indexOf(arguments[t])>=0)return!0;return!1},_blend:function(e,t){var i=OpenLayers.Rico.Color.createFromHex(e);return i.blend(OpenLayers.Rico.Color.createFromHex(t)),i},_background:function(e){try{return OpenLayers.Rico.Color.createColorFromBackground(e).asHex()}catch(t){return"#ffffff"}},_isTransparent:function(){return"transparent"==this.options.color},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(e){return 1==e.childNodes.length&&3==e.childNodes[0].nodeType}},OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(e){alert(e)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"},function(){for(var e=document.getElementsByTagName("script"),t=0,i=e.length;t<i;++t)if(e[t].src.indexOf("firebug.js")!=-1&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}(),OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){return OpenLayers.Lang.code||OpenLayers.Lang.setCode(),OpenLayers.Lang.code},setCode:function(e){var t;e||(e="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);var i=e.split("-");if(i[0]=i[0].toLowerCase(),"object"==typeof OpenLayers.Lang[i[0]]&&(t=i[0]),i[1]){var n=i[0]+"-"+i[1].toUpperCase();"object"==typeof OpenLayers.Lang[n]&&(t=n)}t||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+i.join("-")+" dictionary, falling back to default language"),t=OpenLayers.Lang.defaultCode),OpenLayers.Lang.code=t},translate:function(e,t){var i=OpenLayers.Lang[OpenLayers.Lang.getCode()],n=i&&i[e];return n||(n=e),t&&(n=OpenLayers.String.format(n,t)),n}},OpenLayers.i18n=OpenLayers.Lang.translate,OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(e,t,i,n){null!=e&&(this.left=OpenLayers.Util.toFloat(e)),null!=t&&(this.bottom=OpenLayers.Util.toFloat(t)),null!=i&&(this.right=OpenLayers.Util.toFloat(i)),null!=n&&(this.top=OpenLayers.Util.toFloat(n))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(e){var t=!1;return null!=e&&(t=this.left==e.left&&this.right==e.right&&this.top==e.top&&this.bottom==e.bottom),t},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(e){return e===!0?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(e,t){null==e&&(e=6);var i=Math.pow(10,e),n=Math.round(this.left*i)/i,r=Math.round(this.bottom*i)/i,o=Math.round(this.right*i)/i,s=Math.round(this.top*i)/i;return t===!0?r+","+n+","+s+","+o:n+","+r+","+o+","+s},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){return this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat},scale:function(e,t){null==t&&(t=this.getCenterLonLat());var i,n;"OpenLayers.LonLat"==t.CLASS_NAME?(i=t.lon,n=t.lat):(i=t.x,n=t.y);var r=(this.left-i)*e+i,o=(this.bottom-n)*e+n,s=(this.right-i)*e+i,a=(this.top-n)*e+n;return new OpenLayers.Bounds(r,o,s,a)},add:function(e,t){if(null==e||null==t){var i=OpenLayers.i18n("boundsAddError");return OpenLayers.Console.error(i),null}return new OpenLayers.Bounds(this.left+e,this.bottom+t,this.right+e,this.top+t)},extend:function(e){var t=null;if(e){switch(e.CLASS_NAME){case"OpenLayers.LonLat":t=new OpenLayers.Bounds(e.lon,e.lat,e.lon,e.lat);break;case"OpenLayers.Geometry.Point":t=new OpenLayers.Bounds(e.x,e.y,e.x,e.y);break;case"OpenLayers.Bounds":t=e}t&&(this.centerLonLat=null,(null==this.left||t.left<this.left)&&(this.left=t.left),(null==this.bottom||t.bottom<this.bottom)&&(this.bottom=t.bottom),(null==this.right||t.right>this.right)&&(this.right=t.right),(null==this.top||t.top>this.top)&&(this.top=t.top))}},containsLonLat:function(e,t){return this.contains(e.lon,e.lat,t)},containsPixel:function(e,t){return this.contains(e.x,e.y,t)},contains:function(e,t,i){if(null==i&&(i=!0),null==e||null==t)return!1;e=OpenLayers.Util.toFloat(e),t=OpenLayers.Util.toFloat(t);var n=!1;return n=i?e>=this.left&&e<=this.right&&t>=this.bottom&&t<=this.top:e>this.left&&e<this.right&&t>this.bottom&&t<this.top},intersectsBounds:function(e,t){null==t&&(t=!0);var i=!1,n=this.left==e.right||this.right==e.left||this.top==e.bottom||this.bottom==e.top;if(t||!n){var r=e.bottom>=this.bottom&&e.bottom<=this.top||this.bottom>=e.bottom&&this.bottom<=e.top,o=e.top>=this.bottom&&e.top<=this.top||this.top>e.bottom&&this.top<e.top,s=e.left>=this.left&&e.left<=this.right||this.left>=e.left&&this.left<=e.right,a=e.right>=this.left&&e.right<=this.right||this.right>=e.left&&this.right<=e.right;i=(r||o)&&(s||a)}return i},containsBounds:function(e,t,i){null==t&&(t=!1),null==i&&(i=!0);var n=this.contains(e.left,e.bottom,i),r=this.contains(e.right,e.bottom,i),o=this.contains(e.left,e.top,i),s=this.contains(e.right,e.top,i);return t?n||r||o||s:n&&r&&o&&s},determineQuadrant:function(e){var t="",i=this.getCenterLonLat();return t+=e.lat<i.lat?"b":"t",t+=e.lon<i.lon?"l":"r"},transform:function(e,t){this.centerLonLat=null;var i=OpenLayers.Projection.transform({x:this.left,y:this.bottom},e,t),n=OpenLayers.Projection.transform({x:this.right,y:this.bottom},e,t),r=OpenLayers.Projection.transform({x:this.left,y:this.top},e,t),o=OpenLayers.Projection.transform({x:this.right,y:this.top},e,t);return this.left=Math.min(i.x,r.x),this.bottom=Math.min(i.y,n.y),this.right=Math.max(n.x,o.x),this.top=Math.max(r.y,o.y),this},wrapDateLine:function(e,t){t=t||{};var i=t.leftTolerance||0,n=t.rightTolerance||0,r=this.clone();if(e){for(;r.left<e.left&&r.right-n<=e.left;)r=r.add(e.getWidth(),0);for(;r.left+i>=e.right&&r.right>e.right;)r=r.add(-e.getWidth(),0)}return r},CLASS_NAME:"OpenLayers.Bounds"}),OpenLayers.Bounds.fromString=function(e,t){var i=e.split(",");return OpenLayers.Bounds.fromArray(i,t)},OpenLayers.Bounds.fromArray=function(e,t){return t===!0?new OpenLayers.Bounds(parseFloat(e[1]),parseFloat(e[0]),parseFloat(e[3]),parseFloat(e[2])):new OpenLayers.Bounds(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]))},OpenLayers.Bounds.fromSize=function(e){return new OpenLayers.Bounds(0,e.h,e.w,0)},OpenLayers.Bounds.oppositeQuadrant=function(e){var t="";return t+="t"==e.charAt(0)?"b":"t",t+="l"==e.charAt(1)?"r":"l"},OpenLayers.Element={visible:function(e){return"none"!=OpenLayers.Util.getElement(e).style.display},toggle:function(){for(var e=0,t=arguments.length;e<t;e++){var i=OpenLayers.Util.getElement(arguments[e]),n=OpenLayers.Element.visible(i)?"hide":"show";OpenLayers.Element[n](i)}},hide:function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"element.style.display = 'none';"}));for(var e=0,t=arguments.length;e<t;e++){var i=OpenLayers.Util.getElement(arguments[e]);i&&(i.style.display="none")}},show:function(){OpenLayers.Console.warn(OpenLayers.i18n("methodDeprecated",{newMethod:"element.style.display = '';"}));for(var e=0,t=arguments.length;e<t;e++){var i=OpenLayers.Util.getElement(arguments[e]);i&&(i.style.display="")}},remove:function(e){e=OpenLayers.Util.getElement(e),e.parentNode.removeChild(e)},getHeight:function(e){return e=OpenLayers.Util.getElement(e),e.offsetHeight},getDimensions:function(e){if(e=OpenLayers.Util.getElement(e),"none"!=OpenLayers.Element.getStyle(e,"display"))return{width:e.offsetWidth,height:e.offsetHeight};var t=e.style,i=t.visibility,n=t.position,r=t.display;t.visibility="hidden",t.position="absolute",t.display="";var o=e.clientWidth,s=e.clientHeight;return t.display=r,t.position=n,t.visibility=i,{width:o,height:s}},hasClass:function(e,t){var i=e.className;return!!i&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(i)},addClass:function(e,t){return OpenLayers.Element.hasClass(e,t)||(e.className+=(e.className?" ":"")+t),e},removeClass:function(e,t){var i=e.className;return i&&(e.className=OpenLayers.String.trim(i.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," "))),e},toggleClass:function(e,t){return OpenLayers.Element.hasClass(e,t)?OpenLayers.Element.removeClass(e,t):OpenLayers.Element.addClass(e,t),e},getStyle:function(e,t){e=OpenLayers.Util.getElement(e);var i=null;if(e&&e.style){if(i=e.style[OpenLayers.String.camelize(t)],!i)if(document.defaultView&&document.defaultView.getComputedStyle){var n=document.defaultView.getComputedStyle(e,null);i=n?n.getPropertyValue(t):null}else e.currentStyle&&(i=e.currentStyle[OpenLayers.String.camelize(t)]);var r=["left","top","right","bottom"];window.opera&&OpenLayers.Util.indexOf(r,t)!=-1&&"static"==OpenLayers.Element.getStyle(e,"position")&&(i="auto")}return"auto"==i?null:i}},OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(e,t){this.lon=OpenLayers.Util.toFloat(e),this.lat=OpenLayers.Util.toFloat(t)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(e,t){if(null==e||null==t){var i=OpenLayers.i18n("lonlatAddError");return OpenLayers.Console.error(i),null}return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(e),this.lat+OpenLayers.Util.toFloat(t))},equals:function(e){var t=!1;return null!=e&&(t=this.lon==e.lon&&this.lat==e.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(e.lon)&&isNaN(e.lat)),t},transform:function(e,t){var i=OpenLayers.Projection.transform({x:this.lon,y:this.lat},e,t);return this.lon=i.x,this.lat=i.y,this},wrapDateLine:function(e){var t=this.clone();if(e){for(;t.lon<e.left;)t.lon+=e.getWidth();for(;t.lon>e.right;)t.lon-=e.getWidth()}return t},CLASS_NAME:"OpenLayers.LonLat"}),OpenLayers.LonLat.fromString=function(e){var t=e.split(",");return new OpenLayers.LonLat(t[0],t[1])},OpenLayers.LonLat.fromArray=function(e){var t=OpenLayers.Util.isArray(e),i=t&&e[0],n=t&&e[1];return new OpenLayers.LonLat(i,n)},OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(e,t){this.x=parseFloat(e),this.y=parseFloat(t)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(e){var t=!1;return null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},add:function(e,t){if(null==e||null==t){var i=OpenLayers.i18n("pixelAddError");return OpenLayers.Console.error(i),null}return new OpenLayers.Pixel(this.x+e,this.y+t)},offset:function(e){var t=this.clone();return e&&(t=this.add(e.x,e.y)),t},CLASS_NAME:"OpenLayers.Pixel"}),OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(e,t){this.w=parseFloat(e),this.h=parseFloat(t)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(e){var t=!1;return null!=e&&(t=this.w==e.w&&this.h==e.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(e.w)&&isNaN(e.h)),t},CLASS_NAME:"OpenLayers.Size"}),OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(e,t,i){this.layer=e,this.lonlat=t,this.data=null!=i?i:{},this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup),null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker),this.layer=null,this.id=null,this.lonlat=null,this.data=null,null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null),null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var e=!1;if(null!=this.layer&&null!=this.layer.map){var t=this.layer.map.getExtent();e=t.containsLonLat(this.lonlat)}return e},createMarker:function(){return null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)),this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(e){if(null!=this.lonlat){if(!this.popup){var t=this.marker?this.marker.icon:null,i=this.popupClass?this.popupClass:OpenLayers.Popup.AnchoredBubble;this.popup=new i(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,t,e)}null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this}return this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"}),OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"},OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(e,t,i){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,t]),this.lonlat=null,this.geometry=e?e:null,this.state=null,this.attributes={},t&&(this.attributes=OpenLayers.Util.extend(this.attributes,t)),this.style=i?i:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.geometry=null,this.modified=null,OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(e){var t=!1;if(this.layer&&this.layer.map){var i=this.layer.map.getExtent();if(e){var n=this.geometry.getBounds();t=i.intersectsBounds(n)}else{var r=i.toGeometry();t=r.intersects(this.geometry)}}return t},getVisibility:function(){return!(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(e,t,i){var n=!1;return this.geometry&&(n=this.geometry.atPoint(e,t,i)),n},destroyPopup:function(){},move:function(e){if(this.layer&&this.geometry.move){var t;t="OpenLayers.LonLat"==e.CLASS_NAME?this.layer.getViewPortPxFromLonLat(e):e;var i=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),n=this.layer.map.getResolution();return this.geometry.move(n*(t.x-i.x),n*(i.y-t.y)),this.layer.drawFeature(this),i}},toState:function(e){if(e==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=e;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:}else if(e==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=e}else if(e==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=e}else e==OpenLayers.State.UNKNOWN&&(this.state=e)},CLASS_NAME:"OpenLayers.Feature.Vector"}),OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer"},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit"},"delete":{display:"none"}},OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.rules=[],t&&t.rules&&this.addRules(t.rules),this.setDefaultStyle(e||OpenLayers.Feature.Vector.style["default"]),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e=0,t=this.rules.length;e<t;e++)this.rules[e].destroy(),this.rules[e]=null;this.rules=null,this.defaultStyle=null},createSymbolizer:function(e){for(var t,i=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),e),n=this.rules,r=[],o=!1,s=0,a=n.length;s<a;s++){t=n[s];var l=t.evaluate(e);l&&(t instanceof OpenLayers.Rule&&t.elseFilter?r.push(t):(o=!0,this.applySymbolizer(t,i,e)))}if(0==o&&r.length>0){o=!0;for(var s=0,a=r.length;s<a;s++)this.applySymbolizer(r[s],i,e)}return n.length>0&&0==o&&(i.display="none"),i.label&&"string"!=typeof i.label&&(i.label=String(i.label)),i},applySymbolizer:function(e,t,i){var n=i.geometry?this.getSymbolizerPrefix(i.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],r=e.symbolizer[n]||e.symbolizer;if(this.defaultsPerSymbolizer===!0){var o=this.defaultStyle;OpenLayers.Util.applyDefaults(r,{pointRadius:o.pointRadius}),r.stroke!==!0&&r.graphic!==!0||OpenLayers.Util.applyDefaults(r,{strokeWidth:o.strokeWidth,strokeColor:o.strokeColor,strokeOpacity:o.strokeOpacity,strokeDashstyle:o.strokeDashstyle,strokeLinecap:o.strokeLinecap}),r.fill!==!0&&r.graphic!==!0||OpenLayers.Util.applyDefaults(r,{fillColor:o.fillColor,fillOpacity:o.fillOpacity}),r.graphic===!0&&OpenLayers.Util.applyDefaults(r,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}return this.createLiterals(OpenLayers.Util.extend(t,r),i)},createLiterals:function(e,t){var i=OpenLayers.Util.extend({},t.attributes||t.data);OpenLayers.Util.extend(i,this.context);for(var n in this.propertyStyles)e[n]=OpenLayers.Style.createLiteral(e[n],i,t,n);return e},findPropertyStyles:function(){var e={},t=this.defaultStyle;this.addPropertyStyles(e,t);for(var i,n,r=this.rules,o=0,s=r.length;o<s;o++){i=r[o].symbolizer;for(var a in i){if(n=i[a],"object"!=typeof n){this.addPropertyStyles(e,i);break}this.addPropertyStyles(e,n)}}return e},addPropertyStyles:function(e,t){var i;for(var n in t)i=t[n],"string"==typeof i&&i.match(/\$\{\w+\}/)&&(e[n]=!0);return e},addRules:function(e){Array.prototype.push.apply(this.rules,e),this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(e){this.defaultStyle=e,this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(e){for(var t=OpenLayers.Style.SYMBOLIZER_PREFIXES,i=0,n=t.length;i<n;i++)if(e.CLASS_NAME.indexOf(t[i])!=-1)return t[i]},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var t=0,i=this.rules.length;t<i;++t)e.rules.push(this.rules[t].clone())}e.context=this.context&&OpenLayers.Util.extend({},this.context);var n=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(n,e)},CLASS_NAME:"OpenLayers.Style"}),OpenLayers.Style.createLiteral=function(e,t,i,n){return"string"==typeof e&&e.indexOf("${")!=-1&&(e=OpenLayers.String.format(e,t,[i,n]),e=isNaN(e)||!e?e:parseFloat(e)),e},OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"],OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,initialize:function(e,t){this.container=OpenLayers.Util.getElement(e),OpenLayers.Util.extend(this,t)},destroy:function(){this.container=null,this.extent=null,this.size=null,this.resolution=null,this.map=null},supported:function(){return!1},setExtent:function(e,t){this.extent=e.clone(),t&&(this.resolution=null)},setSize:function(e){this.size=e.clone(),this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution(),this.resolution},drawFeature:function(e,t){if(null==t&&(t=e.style),e.geometry){var i=e.geometry.getBounds();if(i){i.intersectsBounds(this.extent)||(t={display:"none"});var n=this.drawGeometry(e.geometry,t,e.id);if("none"!=t.display&&t.label&&n!==!1){var r=e.geometry.getCentroid();if(t.labelXOffset||t.labelYOffset){var o=isNaN(t.labelXOffset)?0:t.labelXOffset,s=isNaN(t.labelYOffset)?0:t.labelYOffset,a=this.getResolution();r.move(o*a,s*a)}this.drawText(e.id,t,r)}else this.removeText(e.id);return n}}},drawGeometry:function(e,t,i){},drawText:function(e,t,i){},removeText:function(e){},clear:function(){},getFeatureIdFromEvent:function(e){},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,i=e.length;t<i;++t){var n=e[t];this.eraseGeometry(n.geometry,n.id),this.removeText(n.id)}},eraseGeometry:function(e,t){},moveRoot:function(e){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(e){var t=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);return e.stroke===!1&&(delete t.strokeWidth,delete t.strokeColor),e.fill===!1&&delete t.fillColor,OpenLayers.Util.extend(t,e),t},CLASS_NAME:"OpenLayers.Renderer"}),OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0},OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(e){this.compare=e?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER,this.clear()},insert:function(e){this.exists(e)&&this.remove(e);var t=e.id;this.determineZIndex(e);for(var i,n=-1,r=this.order.length;r-n>1;){i=parseInt((n+r)/2);var o=this.compare(this,e,OpenLayers.Util.getElement(this.order[i]));o>0?n=i:r=i}return this.order.splice(r,0,t),this.indices[t]=this.getZIndex(e),this.getNextElement(r)},remove:function(e){var t=e.id,i=OpenLayers.Util.indexOf(this.order,t);if(i>=0)if(this.order.splice(i,1),delete this.indices[t],this.order.length>0){var n=this.order[this.order.length-1];this.maxZIndex=this.indices[n]}else this.maxZIndex=0},clear:function(){this.order=[],this.indices={},this.maxZIndex=0},exists:function(e){return null!=this.indices[e.id]},getZIndex:function(e){return e._style.graphicZIndex},determineZIndex:function(e){var t=e._style.graphicZIndex;null==t?(t=this.maxZIndex,e._style.graphicZIndex=t):t>this.maxZIndex&&(this.maxZIndex=t)},getNextElement:function(e){var t=e+1;if(t<this.order.length){var i=OpenLayers.Util.getElement(this.order[t]);return void 0==i&&(i=this.getNextElement(t)),i}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"}),OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(e,t,i){var n=e.getZIndex(t),r=0;if(i){var o=e.getZIndex(i);r=n-o}return r},Z_ORDER_DRAWING_ORDER:function(e,t,i){var n=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i);return i&&0==n&&(n=1),n},Z_ORDER_Y_ORDER:function(e,t,i){var n=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i);if(i&&0===n){var r=i._boundsBottom-t._boundsBottom;n=0===r?1:r}return n}},OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.rendererRoot=this.createRenderRoot(),this.root=this.createRoot("_root"),this.vectorRoot=this.createRoot("_vroot"),this.textRoot=this.createRoot("_troot"),this.root.appendChild(this.vectorRoot),this.root.appendChild(this.textRoot),this.rendererRoot.appendChild(this.root),this.container.appendChild(this.rendererRoot),t&&(t.zIndexing||t.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(t.yOrdering))},destroy:function(){this.clear(),this.rendererRoot=null,this.root=null,this.xmlns=null,OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var e,t=this.vectorRoot;if(t)for(;e=t.firstChild;)t.removeChild(e);if(t=this.textRoot)for(;e=t.firstChild;)t.removeChild(e);this.indexer&&this.indexer.clear()},getNodeType:function(e,t){},drawGeometry:function(e,t,i){var n=e.CLASS_NAME,r=!0;if("OpenLayers.Geometry.Collection"==n||"OpenLayers.Geometry.MultiPoint"==n||"OpenLayers.Geometry.MultiLineString"==n||"OpenLayers.Geometry.MultiPolygon"==n){for(var o=0,s=e.components.length;o<s;o++)r=this.drawGeometry(e.components[o],t,i)&&r;return r}r=!1;var a=!1;if("none"!=t.display&&(t.backgroundGraphic?this.redrawBackgroundNode(e.id,e,t,i):a=!0,r=this.redrawNode(e.id,e,t,i)),0==r){var l=document.getElementById(e.id);l&&(l._style.backgroundGraphic&&(a=!0),l.parentNode.removeChild(l))}if(a){var l=document.getElementById(e.id+this.BACKGROUND_ID_SUFFIX);l&&l.parentNode.removeChild(l)}return r},redrawNode:function(e,t,i,n){i=this.applyDefaultSymbolizer(i);var r=this.nodeFactory(e,this.getNodeType(t,i));r._featureId=n,r._boundsBottom=t.getBounds().bottom,r._geometryClass=t.CLASS_NAME,r._style=i;var o=this.drawGeometryNode(r,t,i);if(o===!1)return!1;if(r=o.node,this.indexer){var s=this.indexer.insert(r);s?this.vectorRoot.insertBefore(r,s):this.vectorRoot.appendChild(r)}else r.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(r);return this.postDraw(r),o.complete},redrawBackgroundNode:function(e,t,i,n){var r=OpenLayers.Util.extend({},i);return r.externalGraphic=r.backgroundGraphic,r.graphicXOffset=r.backgroundXOffset,r.graphicYOffset=r.backgroundYOffset,r.graphicZIndex=r.backgroundGraphicZIndex,r.graphicWidth=r.backgroundWidth||r.graphicWidth,r.graphicHeight=r.backgroundHeight||r.graphicHeight,r.backgroundGraphic=null,r.backgroundXOffset=null,r.backgroundYOffset=null,r.backgroundGraphicZIndex=null,this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,t,r,null)},drawGeometryNode:function(e,t,i){i=i||e._style;var n,r={isFilled:void 0===i.fill||i.fill,isStroked:void 0===i.stroke?!!i.strokeWidth:i.stroke
};switch(t.CLASS_NAME){case"OpenLayers.Geometry.Point":i.graphic===!1&&(r.isFilled=!1,r.isStroked=!1),n=this.drawPoint(e,t);break;case"OpenLayers.Geometry.LineString":r.isFilled=!1,n=this.drawLineString(e,t);break;case"OpenLayers.Geometry.LinearRing":n=this.drawLinearRing(e,t);break;case"OpenLayers.Geometry.Polygon":n=this.drawPolygon(e,t);break;case"OpenLayers.Geometry.Surface":n=this.drawSurface(e,t);break;case"OpenLayers.Geometry.Rectangle":n=this.drawRectangle(e,t)}return e._options=r,0!=n&&{node:this.setStyle(e,i,r,t),complete:n}},postDraw:function(e){},drawPoint:function(e,t){},drawLineString:function(e,t){},drawLinearRing:function(e,t){},drawPolygon:function(e,t){},drawRectangle:function(e,t){},drawCircle:function(e,t){},drawSurface:function(e,t){},removeText:function(e){var t=document.getElementById(e+this.LABEL_ID_SUFFIX);t&&this.textRoot.removeChild(t)},getFeatureIdFromEvent:function(e){var t=e.target,i=t&&t.correspondingUseElement,n=i?i:t||e.srcElement,r=n._featureId;return r},eraseGeometry:function(e,t){if("OpenLayers.Geometry.MultiPoint"==e.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==e.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==e.CLASS_NAME||"OpenLayers.Geometry.Collection"==e.CLASS_NAME)for(var i=0,n=e.components.length;i<n;i++)this.eraseGeometry(e.components[i],t);else{var r=OpenLayers.Util.getElement(e.id);if(r&&r.parentNode&&(r.geometry&&(r.geometry.destroy(),r.geometry=null),r.parentNode.removeChild(r),this.indexer&&this.indexer.remove(r),r._style.backgroundGraphic)){var o=e.id+this.BACKGROUND_ID_SUFFIX,s=OpenLayers.Util.getElement(o);s&&s.parentNode&&s.parentNode.removeChild(s)}}},nodeFactory:function(e,t){var i=OpenLayers.Util.getElement(e);return i?this.nodeTypeCompare(i,t)||(i.parentNode.removeChild(i),i=this.nodeFactory(e,t)):i=this.createNode(t,e),i},nodeTypeCompare:function(e,t){},createNode:function(e,t){},moveRoot:function(e){var t=this.root;e.root.parentNode==this.rendererRoot&&(t=e.root),t.parentNode.removeChild(t),e.rendererRoot.appendChild(t)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(e){return"circle"!=e&&!!e},CLASS_NAME:"OpenLayers.Renderer.Elements"}),OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]},OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(e){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var t=document.createStyleSheet(),i=["shape","rect","oval","fill","stroke","imagedata","group","textbox"],n=0,r=i.length;n<r;n++)t.addRule("olv\\:"+i[n],"behavior: url(#default#VML); position: absolute; display: inline-block;")}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)}},supported:function(){return!!document.namespaces},setExtent:function(e,t){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var i=this.getResolution(),n=e.left/i|0,r=e.top/i-this.size.h|0;t||!this.offset?(this.offset={x:n,y:r},n=0,r=0):(n-=this.offset.x,r-=this.offset.y);var o=n+" "+r;this.root.coordorigin=o;for(var s,a=[this.root,this.vectorRoot,this.textRoot],l=0,h=a.length;l<h;++l){s=a[l];var c=this.size.w+" "+this.size.h;s.coordsize=c}return this.root.style.flip="y",!0},setSize:function(e){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var t,i=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],n=this.size.w+"px",r=this.size.h+"px",o=0,s=i.length;o<s;++o)t=i[o],t.style.width=n,t.style.height=r},getNodeType:function(e,t){var i=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":i=t.externalGraphic?"olv:rect":this.isComplexSymbol(t.graphicName)?"olv:shape":"olv:oval";break;case"OpenLayers.Geometry.Rectangle":i="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":i="olv:shape"}return i},setStyle:function(e,t,i,n){t=t||e._style,i=i||e._options;var r=t.fillColor;if("OpenLayers.Geometry.Point"===e._geometryClass)if(t.externalGraphic){i.isFilled=!0,t.graphicTitle&&(e.title=t.graphicTitle);var o=t.graphicWidth||t.graphicHeight,s=t.graphicHeight||t.graphicWidth;o=o?o:2*t.pointRadius,s=s?s:2*t.pointRadius;var a=this.getResolution(),l=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*o),h=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*s);e.style.left=(n.x/a-this.offset.x+l|0)+"px",e.style.top=(n.y/a-this.offset.y-(h+s)|0)+"px",e.style.width=o+"px",e.style.height=s+"px",e.style.flip="y",r="none",i.isStroked=!1}else if(this.isComplexSymbol(t.graphicName)){var c=this.importSymbol(t.graphicName);e.path=c.path,e.coordorigin=c.left+","+c.bottom;var u=c.size;e.coordsize=u+","+u,this.drawCircle(e,n,t.pointRadius),e.style.flip="y"}else this.drawCircle(e,n,t.pointRadius);i.isFilled?e.fillcolor=r:e.filled="false";var d=e.getElementsByTagName("fill"),p=0==d.length?null:d[0];i.isFilled?(p||(p=this.createNode("olv:fill",e.id+"_fill")),p.opacity=t.fillOpacity,"OpenLayers.Geometry.Point"===e._geometryClass&&t.externalGraphic&&(t.graphicOpacity&&(p.opacity=t.graphicOpacity),p.src=t.externalGraphic,p.type="frame",t.graphicWidth&&t.graphicHeight||(p.aspect="atmost")),p.parentNode!=e&&e.appendChild(p)):p&&e.removeChild(p);var g=t.rotation;void 0===g&&void 0===e._rotation||(e._rotation=g,t.externalGraphic?(this.graphicRotate(e,l,h,t),p.opacity=0):"OpenLayers.Geometry.Point"===e._geometryClass&&(e.style.rotation=g||0));var m=e.getElementsByTagName("stroke"),f=0==m.length?null:m[0];return i.isStroked?(f||(f=this.createNode("olv:stroke",e.id+"_stroke"),e.appendChild(f)),f.on=!0,f.color=t.strokeColor,f.weight=t.strokeWidth+"px",f.opacity=t.strokeOpacity,f.endcap="butt"==t.strokeLinecap?"flat":t.strokeLinecap||"round",t.strokeDashstyle&&(f.dashstyle=this.dashStyle(t))):(e.stroked=!1,f&&(f.on=!1)),"inherit"!=t.cursor&&null!=t.cursor&&(e.style.cursor=t.cursor),e},graphicRotate:function(e,t,i,n){var r,o,n=n||e._style,s=n.rotation||0;if(!n.graphicWidth||!n.graphicHeight){var a=new Image;return a.onreadystatechange=OpenLayers.Function.bind(function(){"complete"!=a.readyState&&"interactive"!=a.readyState||(r=a.width/a.height,o=Math.max(2*n.pointRadius,n.graphicWidth||0,n.graphicHeight||0),t*=r,n.graphicWidth=o*r,n.graphicHeight=o,this.graphicRotate(e,t,i,n))},this),void(a.src=n.externalGraphic)}o=Math.max(n.graphicWidth,n.graphicHeight),r=n.graphicWidth/n.graphicHeight;var l=Math.round(n.graphicWidth||o*r),h=Math.round(n.graphicHeight||o);e.style.width=l+"px",e.style.height=h+"px";var c=document.getElementById(e.id+"_image");c||(c=this.createNode("olv:imagedata",e.id+"_image"),e.appendChild(c)),c.style.width=l+"px",c.style.height=h+"px",c.src=n.externalGraphic,c.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var u=s*Math.PI/180,d=Math.sin(u),p=Math.cos(u),g="progid:DXImageTransform.Microsoft.Matrix(M11="+p+",M12="+-d+",M21="+d+",M22="+p+",SizingMethod='auto expand')\n",m=n.graphicOpacity||n.fillOpacity;m&&1!=m&&(g+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+m+")\n"),e.style.filter=g;var f=new OpenLayers.Geometry.Point((-t),(-i)),y=new OpenLayers.Bounds(0,0,l,h).toGeometry();y.rotate(n.rotation,f);var _=y.getBounds();e.style.left=Math.round(parseInt(e.style.left)+_.left)+"px",e.style.top=Math.round(parseInt(e.style.top)-_.bottom)+"px"},postDraw:function(e){e.style.visibility="visible";var t=e._style.fillColor,i=e._style.strokeColor;"none"==t&&e.fillcolor!=t&&(e.fillcolor=t),"none"==i&&e.strokecolor!=i&&(e.strokecolor=i)},setNodeDimension:function(e,t){var i=t.getBounds();if(i){var n=this.getResolution(),r=new OpenLayers.Bounds(i.left/n-this.offset.x|0,i.bottom/n-this.offset.y|0,i.right/n-this.offset.x|0,i.top/n-this.offset.y|0);e.style.left=r.left+"px",e.style.top=r.top+"px",e.style.width=r.getWidth()+"px",e.style.height=r.getHeight()+"px",e.coordorigin=r.left+" "+r.top,e.coordsize=r.getWidth()+" "+r.getHeight()}},dashStyle:function(e){var t=e.strokeDashstyle;switch(t){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return t;default:var i=t.split(/[ ,]/);return 2==i.length?1*i[0]>=2*i[1]?"longdash":1==i[0]||1==i[1]?"dot":"dash":4==i.length?1*i[0]>=2*i[1]?"longdashdot":"dashdot":"solid"}},createNode:function(e,t){var i=document.createElement(e);return t&&(i.id=t),i.unselectable="on",i.onselectstart=OpenLayers.Function.False,i},nodeTypeCompare:function(e,t){var i=t,n=i.indexOf(":");n!=-1&&(i=i.substr(n+1));var r=e.nodeName;return n=r.indexOf(":"),n!=-1&&(r=r.substr(n+1)),i==r},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(e){return this.nodeFactory(this.container.id+e,"olv:group")},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,i){if(!isNaN(t.x)&&!isNaN(t.y)){var n=this.getResolution();e.style.left=(t.x/n-this.offset.x|0)-i+"px",e.style.top=(t.y/n-this.offset.y|0)-i+"px";var r=2*i;return e.style.width=r+"px",e.style.height=r+"px",e}return!1},drawLineString:function(e,t){return this.drawLine(e,t,!1)},drawLinearRing:function(e,t){return this.drawLine(e,t,!0)},drawLine:function(e,t,i){this.setNodeDimension(e,t);for(var n,r,o,s=this.getResolution(),a=t.components.length,l=new Array(a),h=0;h<a;h++)n=t.components[h],r=n.x/s-this.offset.x|0,o=n.y/s-this.offset.y|0,l[h]=" "+r+","+o+" l ";var c=i?" x e":" e";return e.path="m"+l.join("")+c,e},drawPolygon:function(e,t){this.setNodeDimension(e,t);var i,n,r,o,s,a,l,h,c,u,d,p,g=this.getResolution(),m=[];for(i=0,n=t.components.length;i<n;i++){for(m.push("m"),r=t.components[i].components,o=0===i,s=null,a=null,l=0,h=r.length;l<h;l++)c=r[l],d=c.x/g-this.offset.x|0,p=c.y/g-this.offset.y|0,u=" "+d+","+p,m.push(u),0==l&&m.push(" l"),o||(s?s!=u&&(a?a!=u&&(o=!0):a=u):s=u);m.push(o?" x ":" ")}return m.push("e"),e.path=m.join(""),e},drawRectangle:function(e,t){var i=this.getResolution();return e.style.left=(t.x/i-this.offset.x|0)+"px",e.style.top=(t.y/i-this.offset.y|0)+"px",e.style.width=(t.width/i|0)+"px",e.style.height=(t.height/i|0)+"px",e},drawText:function(e,t,i){var n=this.nodeFactory(e+this.LABEL_ID_SUFFIX,"olv:rect"),r=this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),o=this.getResolution();n.style.left=(i.x/o-this.offset.x|0)+"px",n.style.top=(i.y/o-this.offset.y|0)+"px",n.style.flip="y",r.innerText=t.label,"inherit"!=t.cursor&&null!=t.cursor&&(r.style.cursor=t.cursor),t.fontColor&&(r.style.color=t.fontColor),t.fontOpacity&&(r.style.filter="alpha(opacity="+100*t.fontOpacity+")"),t.fontFamily&&(r.style.fontFamily=t.fontFamily),t.fontSize&&(r.style.fontSize=t.fontSize),t.fontWeight&&(r.style.fontWeight=t.fontWeight),t.fontStyle&&(r.style.fontStyle=t.fontStyle),t.labelSelect===!0&&(n._featureId=e,r._featureId=e,r._geometry=i,r._geometryClass=i.CLASS_NAME),r.style.whiteSpace="nowrap",r.inset="1px,0px,0px,0px",n.parentNode||(n.appendChild(r),this.textRoot.appendChild(n));var s=t.labelAlign||"cm";1==s.length&&(s+="m");var a=r.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[s.substr(0,1)],l=r.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[s.substr(1,1)];n.style.left=parseInt(n.style.left)-a-1+"px",n.style.top=parseInt(n.style.top)+l+"px"},drawSurface:function(e,t){this.setNodeDimension(e,t);for(var i,n,r,o=this.getResolution(),s=[],a=0,l=t.components.length;a<l;a++)i=t.components[a],n=i.x/o-this.offset.x|0,r=i.y/o-this.offset.y|0,a%3==0&&a/3==0?s.push("m"):a%3==1&&s.push(" c"),s.push(" "+n+","+r);return s.push(" x e"),e.path=s.join(""),e},moveRoot:function(e){var t=this.map.getLayer(e.container.id);t instanceof OpenLayers.Layer.Vector.RootContainer&&(t=this.map.getLayer(this.container.id)),t&&t.renderer.clear(),OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments),t&&t.redraw()},importSymbol:function(e){var t=this.container.id+"-"+e,i=this.symbolCache[t];if(i)return i;var n=OpenLayers.Renderer.symbol[e];if(!n)throw new Error(e+" is not a valid symbol name");for(var r=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),o=["m"],s=0;s<n.length;s+=2){var a=n[s],l=n[s+1];r.left=Math.min(r.left,a),r.bottom=Math.min(r.bottom,l),r.right=Math.max(r.right,a),r.top=Math.max(r.top,l),o.push(a),o.push(l),0==s&&o.push("l")}o.push("x e");var h=o.join(" "),c=(r.getWidth()-r.getHeight())/2;return c>0?(r.bottom=r.bottom-c,r.top=r.top+c):(r.left=r.left+c,r.right=r.right-c),i={path:h,size:r.getWidth(),left:r.left,bottom:r.bottom},this.symbolCache[t]=i,i},CLASS_NAME:"OpenLayers.Renderer.VML"}),OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:.5,r:1,t:0,m:.5,b:1},OpenLayers.Tween=OpenLayers.Class({INTERVAL:10,easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,interval:null,playing:!1,initialize:function(e){this.easing=e?e:OpenLayers.Easing.Expo.easeOut},start:function(e,t,i,n){this.playing=!0,this.begin=e,this.finish=t,this.duration=i,this.callbacks=n.callbacks,this.time=0,this.interval&&(window.clearInterval(this.interval),this.interval=null),this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin),this.interval=window.setInterval(OpenLayers.Function.bind(this.play,this),this.INTERVAL)},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),window.clearInterval(this.interval),this.interval=null,this.playing=!1)},play:function(){var e={};for(var t in this.begin){var i=this.begin[t],n=this.finish[t];(null==i||null==n||isNaN(i)||isNaN(n))&&OpenLayers.Console.error("invalid value for Tween");var r=n-i;e[t]=this.easing.apply(this,[this.time,i,r,this.duration])}this.time++,this.callbacks&&this.callbacks.eachStep&&this.callbacks.eachStep.call(this,e),this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"}),OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"},OpenLayers.Easing.Linear={easeIn:function(e,t,i,n){return i*e/n+t},easeOut:function(e,t,i,n){return i*e/n+t},easeInOut:function(e,t,i,n){return i*e/n+t},CLASS_NAME:"OpenLayers.Easing.Linear"},OpenLayers.Easing.Expo={easeIn:function(e,t,i,n){return 0==e?t:i*Math.pow(2,10*(e/n-1))+t},easeOut:function(e,t,i,n){return e==n?t+i:i*(-Math.pow(2,-10*e/n)+1)+t},easeInOut:function(e,t,i,n){return 0==e?t:e==n?t+i:(e/=n/2)<1?i/2*Math.pow(2,10*(e-1))+t:i/2*(-Math.pow(2,-10*--e)+2)+t},CLASS_NAME:"OpenLayers.Easing.Expo"},OpenLayers.Easing.Quad={easeIn:function(e,t,i,n){return i*(e/=n)*e+t},easeOut:function(e,t,i,n){return-i*(e/=n)*(e-2)+t},easeInOut:function(e,t,i,n){return(e/=n/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},CLASS_NAME:"OpenLayers.Easing.Quad"},OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(e){OpenLayers.Util.extend(this,e),this.options=e},destroy:function(){},read:function(e){OpenLayers.Console.userError(OpenLayers.i18n("readNotImplemented"))},write:function(e){OpenLayers.Console.userError(OpenLayers.i18n("writeNotImplemented"))},CLASS_NAME:"OpenLayers.Format"}),OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(e){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},OpenLayers.Format.prototype.initialize.apply(this,[e])},read:function(e){var t,i,n;e=e.replace(/[\n\r]/g," ");var r=this.regExes.typeStr.exec(e);if(r&&(i=r[1].toLowerCase(),n=r[2],this.parse[i]&&(t=this.parse[i].apply(this,[n])),this.internalProjection&&this.externalProjection))if(t&&"OpenLayers.Feature.Vector"==t.CLASS_NAME)t.geometry.transform(this.externalProjection,this.internalProjection);else if(t&&"geometrycollection"!=i&&"object"==typeof t)for(var o=0,s=t.length;o<s;o++){var a=t[o];a.geometry.transform(this.externalProjection,this.internalProjection)}return t},write:function(e){var t,i,n;e.constructor==Array?(t=e,n=!0):(t=[e],n=!1);var r=[];n&&r.push("GEOMETRYCOLLECTION(");for(var o=0,s=t.length;o<s;++o)n&&o>0&&r.push(","),i=t[o].geometry,r.push(this.extractGeometry(i));return n&&r.push(")"),r.join("")},extractGeometry:function(e){var t=e.CLASS_NAME.split(".")[2].toLowerCase();if(!this.extract[t])return null;this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var i="collection"==t?"GEOMETRYCOLLECTION":t.toUpperCase(),n=i+"("+this.extract[t].apply(this,[e])+")";return n},extract:{point:function(e){return e.x+" "+e.y},multipoint:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push("("+this.extract.point.apply(this,[e.components[i]])+")");return t.join(",")},linestring:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t.join(",")},multilinestring:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push("("+this.extract.linestring.apply(this,[e.components[i]])+")");return t.join(",")},polygon:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push("("+this.extract.linestring.apply(this,[e.components[i]])+")");return t.join(",")},multipolygon:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push("("+this.extract.polygon.apply(this,[e.components[i]])+")");return t.join(",")},collection:function(e){for(var t=[],i=0,n=e.components.length;i<n;++i)t.push(this.extractGeometry.apply(this,[e.components[i]]));return t.join(",")}},parse:{point:function(e){var t=OpenLayers.String.trim(e).split(this.regExes.spaces);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t[0],t[1]))},multipoint:function(e){for(var t,i=OpenLayers.String.trim(e).split(","),n=[],r=0,o=i.length;r<o;++r)t=i[r].replace(this.regExes.trimParens,"$1"),n.push(this.parse.point.apply(this,[t]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(n))},linestring:function(e){for(var t=OpenLayers.String.trim(e).split(","),i=[],n=0,r=t.length;n<r;++n)i.push(this.parse.point.apply(this,[t[n]]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(i))},multilinestring:function(e){for(var t,i=OpenLayers.String.trim(e).split(this.regExes.parenComma),n=[],r=0,o=i.length;r<o;++r)t=i[r].replace(this.regExes.trimParens,"$1"),n.push(this.parse.linestring.apply(this,[t]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(n))},polygon:function(e){for(var t,i,n,r=OpenLayers.String.trim(e).split(this.regExes.parenComma),o=[],s=0,a=r.length;s<a;++s)t=r[s].replace(this.regExes.trimParens,"$1"),i=this.parse.linestring.apply(this,[t]).geometry,n=new OpenLayers.Geometry.LinearRing(i.components),o.push(n);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(o))},multipolygon:function(e){for(var t,i=OpenLayers.String.trim(e).split(this.regExes.doubleParenComma),n=[],r=0,o=i.length;r<o;++r)t=i[r].replace(this.regExes.trimParens,"$1"),n.push(this.parse.polygon.apply(this,[t]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(n))},geometrycollection:function(e){e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var t=OpenLayers.String.trim(e).split("|"),i=[],n=0,r=t.length;n<r;++n)i.push(OpenLayers.Format.WKT.prototype.read.apply(this,[t[n]]));return i}},CLASS_NAME:"OpenLayers.Format.WKT"}),OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null,this.bounds=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(e){e&&(this.bounds=e.clone())},clearBounds:function(){this.bounds=null,this.parent&&this.parent.clearBounds()},extendBounds:function(e){var t=this.getBounds();t?this.bounds.extend(e):this.setBounds(e)},getBounds:function(){return null==this.bounds&&this.calculateBounds(),this.bounds},calculateBounds:function(){},distanceTo:function(e,t){},getVertices:function(e){},atPoint:function(e,t,i){var n=!1,r=this.getBounds();if(null!=r&&null!=e){var o=null!=t?t:0,s=null!=i?i:0,a=new OpenLayers.Bounds(this.bounds.left-o,this.bounds.bottom-s,this.bounds.right+o,this.bounds.top+s);n=a.containsLonLat(e)}return n},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this))},CLASS_NAME:"OpenLayers.Geometry"}),OpenLayers.Geometry.fromWKT=function(e){var t=arguments.callee.format;t||(t=new OpenLayers.Format.WKT,arguments.callee.format=t);var i,n=t.read(e);if(n instanceof OpenLayers.Feature.Vector)i=n.geometry;else if(OpenLayers.Util.isArray(n)){for(var r=n.length,o=new Array(r),s=0;s<r;++s)o[s]=n[s].geometry;i=new OpenLayers.Geometry.Collection(o)}return i},OpenLayers.Geometry.segmentsIntersect=function(e,t,i){var n=i&&i.point,r=i&&i.tolerance,o=!1,s=e.x1-t.x1,a=e.y1-t.y1,l=e.x2-e.x1,h=e.y2-e.y1,c=t.y2-t.y1,u=t.x2-t.x1,d=c*l-u*h,p=u*a-c*s,g=l*a-h*s;if(0==d)0==p&&0==g&&(o=!0);else{var m=p/d,f=g/d;if(m>=0&&m<=1&&f>=0&&f<=1)if(n){var y=e.x1+m*l,_=e.y1+m*h;o=new OpenLayers.Geometry.Point(y,_)}else o=!0}if(r){var v;if(o){if(n){var D,y,_,b=[e,t];e:for(var L=0;L<2;++L){D=b[L];for(var C=1;C<3;++C)if(y=D["x"+C],_=D["y"+C],v=Math.sqrt(Math.pow(y-o.x,2)+Math.pow(_-o.y,2)),v<r){o.x=y,o.y=_;break e}}}}else{var G,M,y,_,S,w,b=[e,t];e:for(var L=0;L<2;++L){G=b[L],M=b[(L+1)%2];for(var C=1;C<3;++C)if(S={x:G["x"+C],y:G["y"+C]},w=OpenLayers.Geometry.distanceToSegment(S,M),w.distance<r){o=!n||new OpenLayers.Geometry.Point(S.x,S.y);break e}}}}return o},OpenLayers.Geometry.distanceToSegment=function(e,t){var i,n,r=e.x,o=e.y,s=t.x1,a=t.y1,l=t.x2,h=t.y2,c=l-s,u=h-a,d=(c*(r-s)+u*(o-a))/(Math.pow(c,2)+Math.pow(u,2));return d<=0?(i=s,n=a):d>=1?(i=l,n=h):(i=s+d*c,n=a+d*u),{distance:Math.sqrt(Math.pow(i-r,2)+Math.pow(n-o,2)),x:i,y:n}},OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(e){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.components=[],null!=e&&this.addComponents(e)},destroy:function(){this.components.length=0,this.components=null,OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var geometry=eval("new "+this.CLASS_NAME+"()"),i=0,len=this.components.length;i<len;i++)geometry.addComponent(this.components[i].clone());return OpenLayers.Util.applyDefaults(geometry,this),geometry},getComponentsString:function(){for(var e=[],t=0,i=this.components.length;t<i;t++)e.push(this.components[t].toShortString());return e.join(",")},calculateBounds:function(){this.bounds=null;var e=new OpenLayers.Bounds,t=this.components;if(t)for(var i=0,n=t.length;i<n;i++)e.extend(t[i].getBounds());null!=e.left&&null!=e.bottom&&null!=e.right&&null!=e.top&&this.setBounds(e)},addComponents:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,i=e.length;t<i;t++)this.addComponent(e[t])},addComponent:function(e,t){var i=!1;if(e&&(null==this.componentTypes||OpenLayers.Util.indexOf(this.componentTypes,e.CLASS_NAME)>-1)){if(null!=t&&t<this.components.length){var n=this.components.slice(0,t),r=this.components.slice(t,this.components.length);n.push(e),this.components=n.concat(r)}else this.components.push(e);e.parent=this,this.clearBounds(),i=!0}return i},removeComponents:function(e){var t=!1;OpenLayers.Util.isArray(e)||(e=[e]);for(var i=e.length-1;i>=0;--i)t=this.removeComponent(e[i])||t;return t},removeComponent:function(e){return OpenLayers.Util.removeItem(this.components,e),this.clearBounds(),!0},getLength:function(){for(var e=0,t=0,i=this.components.length;t<i;t++)e+=this.components[t].getLength();return e},getArea:function(){for(var e=0,t=0,i=this.components.length;t<i;t++)e+=this.components[t].getArea();return e},getGeodesicArea:function(e){for(var t=0,i=0,n=this.components.length;i<n;i++)t+=this.components[i].getGeodesicArea(e);return t},getCentroid:function(e){if(!e)return this.components.length&&this.components[0].getCentroid();var t=this.components.length;if(!t)return!1;for(var i,n=[],r=[],o=0,s=Number.MAX_VALUE,a=0;a<t;++a){i=this.components[a];var l=i.getArea(),h=i.getCentroid(!0);isNaN(l)||isNaN(h.x)||isNaN(h.y)||(n.push(l),o+=l,s=l<s&&l>0?l:s,r.push(h))}if(t=n.length,0===o){for(var a=0;a<t;++a)n[a]=1;o=n.length}else{for(var a=0;a<t;++a)n[a]/=s;o/=s}for(var h,l,c=0,u=0,a=0;a<t;++a)h=r[a],l=n[a],c+=h.x*l,u+=h.y*l;return new OpenLayers.Geometry.Point(c/o,u/o)},getGeodesicLength:function(e){for(var t=0,i=0,n=this.components.length;i<n;i++)t+=this.components[i].getGeodesicLength(e);return t},move:function(e,t){for(var i=0,n=this.components.length;i<n;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,n=this.components.length;i<n;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var n=0;n<this.components.length;++n)this.components[n].resize(e,t,i);return this},distanceTo:function(e,t){for(var i,n,r,o=!(t&&t.edge===!1),s=o&&t&&t.details,a=Number.POSITIVE_INFINITY,l=0,h=this.components.length;l<h&&(i=this.components[l].distanceTo(e,t),r=s?i.distance:i,!(r<a&&(a=r,n=i,0==a)));++l);return n},equals:function(e){var t=!0;if(e&&e.CLASS_NAME&&this.CLASS_NAME==e.CLASS_NAME)if(OpenLayers.Util.isArray(e.components)&&e.components.length==this.components.length){for(var i=0,n=this.components.length;i<n;++i)if(!this.components[i].equals(e.components[i])){t=!1;break}}else t=!1;else t=!1;return t},transform:function(e,t){if(e&&t){for(var i=0,n=this.components.length;i<n;i++){var r=this.components[i];r.transform(e,t)}this.bounds=null}return this},intersects:function(e){for(var t=!1,i=0,n=this.components.length;i<n&&!(t=e.intersects(this.components[i]));++i);return t},getVertices:function(e){for(var t=[],i=0,n=this.components.length;i<n;++i)Array.prototype.push.apply(t,this.components[i].getVertices(e));return t},CLASS_NAME:"OpenLayers.Geometry.Collection"}),OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(e,t){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.x=parseFloat(e),this.y=parseFloat(t)},clone:function(e){return null==e&&(e=new OpenLayers.Geometry.Point(this.x,this.y)),OpenLayers.Util.applyDefaults(e,this),e},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(e,t){var i,n,r,o,s,a,l=!(t&&t.edge===!1),h=l&&t&&t.details;return e instanceof OpenLayers.Geometry.Point?(n=this.x,r=this.y,o=e.x,s=e.y,i=Math.sqrt(Math.pow(n-o,2)+Math.pow(r-s,2)),a=h?{x0:n,y0:r,x1:o,y1:s,distance:i}:i):(a=e.distanceTo(this,t),h&&(a={x0:a.x1,y0:a.y1,x1:a.x0,y1:a.y0,distance:a.distance})),a},equals:function(e){var t=!1;return null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},toShortString:function(){return this.x+", "+this.y},move:function(e,t){this.x=this.x+e,this.y=this.y+t,this.clearBounds()},rotate:function(e,t){e*=Math.PI/180;var i=this.distanceTo(t),n=e+Math.atan2(this.y-t.y,this.x-t.x);this.x=t.x+i*Math.cos(n),this.y=t.y+i*Math.sin(n),this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(e,t,i){return i=void 0==i?1:i,this.x=t.x+e*i*(this.x-t.x),this.y=t.y+e*(this.y-t.y),this.clearBounds(),this},intersects:function(e){var t=!1;return t="OpenLayers.Geometry.Point"==e.CLASS_NAME?this.equals(e):e.intersects(this)},transform:function(e,t){return e&&t&&(OpenLayers.Projection.transform(this,e,t),this.bounds=null),this},getVertices:function(e){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"}),OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(e){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},addPoint:function(e,t){this.addComponent(e,t)},removePoint:function(e){this.removeComponent(e)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"}),OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(e){OpenLayers.Geometry.MultiPoint.prototype.initialize.apply(this,arguments)},getLength:function(){var e=0;if(this.components&&this.components.length>1)for(var t=1,i=this.components.length;t<i;t++)e+=this.components[t-1].distanceTo(this.components[t]);return e},getGeodesicLength:function(e){var t=this;if(e){var i=new OpenLayers.Projection("EPSG:4326");i.equals(e)||(t=this.clone().transform(e,i))}var n=0;if(t.components&&t.components.length>1)for(var r,o,s=1,a=t.components.length;s<a;s++)r=t.components[s-1],o=t.components[s],n+=OpenLayers.Util.distVincenty({lon:r.x,lat:r.y},{lon:o.x,lat:o.y});return 1e3*n},CLASS_NAME:"OpenLayers.Geometry.Curve"}),OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{initialize:function(e){OpenLayers.Geometry.Curve.prototype.initialize.apply(this,arguments)},removeComponent:function(e){var t=this.components&&this.components.length>2;return t&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),t},intersects:function(e){var t=!1,i=e.CLASS_NAME;if("OpenLayers.Geometry.LineString"==i||"OpenLayers.Geometry.LinearRing"==i||"OpenLayers.Geometry.Point"==i){var n,r=this.getSortedSegments();n="OpenLayers.Geometry.Point"==i?[{x1:e.x,y1:e.y,x2:e.x,y2:e.y}]:e.getSortedSegments();var o,s,a,l,h,c,u,d;e:for(var p=0,g=r.length;p<g;++p){o=r[p],s=o.x1,a=o.x2,l=o.y1,h=o.y2;for(var m=0,f=n.length;m<f&&(c=n[m],!(c.x1>a));++m)if(!(c.x2<s)&&(u=c.y1,d=c.y2,!(Math.min(u,d)>Math.max(l,h))&&!(Math.max(u,d)<Math.min(l,h))&&OpenLayers.Geometry.segmentsIntersect(o,c))){t=!0;break e}}}else t=e.intersects(this);return t},getSortedSegments:function(){function e(e,t){return e.x1-t.x1}for(var t,i,n=this.components.length-1,r=new Array(n),o=0;o<n;++o)t=this.components[o],i=this.components[o+1],t.x<i.x?r[o]={x1:t.x,y1:t.y,x2:i.x,y2:i.y}:r[o]={x1:i.x,y1:i.y,x2:t.x,y2:t.y};return r.sort(e)},splitWithSegment:function(e,t){for(var i,n,r,o,s,a=!(t&&t.edge===!1),l=t&&t.tolerance,h=[],c=this.getVertices(),u=[],d=[],p=!1,g={point:!0,tolerance:l},m=null,f=0,y=c.length-2;f<=y;++f)if(i=c[f],u.push(i.clone()),n=c[f+1],s={x1:i.x,y1:i.y,x2:n.x,y2:n.y},r=OpenLayers.Geometry.segmentsIntersect(e,s,g),r instanceof OpenLayers.Geometry.Point&&(o=!!(r.x===e.x1&&r.y===e.y1||r.x===e.x2&&r.y===e.y2||r.equals(i)||r.equals(n)),o||a)){if(r.equals(d[d.length-1])||d.push(r.clone()),0===f&&r.equals(i))continue;if(r.equals(n))continue;p=!0,r.equals(i)||u.push(r),h.push(new OpenLayers.Geometry.LineString(u)),u=[r.clone()]}if(p&&(u.push(n.clone()),h.push(new OpenLayers.Geometry.LineString(u))),d.length>0){var _=e.x1<e.x2?1:-1,v=e.y1<e.y2?1:-1;m={lines:h,points:d.sort(function(e,t){return _*e.x-_*t.x||v*e.y-v*t.y})}}return m},split:function(e,t){var i,n,r,o,s=null,a=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){var l,h,c,u,d,p,g=this.getVertices(),m=[];r=[];for(var f=0,y=g.length-2;f<=y;++f){l=g[f],h=g[f+1],c={x1:l.x,y1:l.y,x2:h.x,y2:h.y},o=o||[e],a&&m.push(l.clone());for(var _=0;_<o.length;++_)if(u=o[_].splitWithSegment(c,t),u&&(d=u.lines,d.length>0&&(d.unshift(_,1),Array.prototype.splice.apply(o,d),_+=d.length-2),a))for(var v=0,D=u.points.length;v<D;++v)p=u.points[v],p.equals(l)||(m.push(p),r.push(new OpenLayers.Geometry.LineString(m)),m=p.equals(h)?[]:[p.clone()])}a&&r.length>0&&m.length>0&&(m.push(h.clone()),r.push(new OpenLayers.Geometry.LineString(m)))}else s=e.splitWith(this,t);return o&&o.length>1?n=!0:o=[],r&&r.length>1?i=!0:r=[],(n||i)&&(s=a?[r,o]:o),s},splitWith:function(e,t){return e.split(this,t)},getVertices:function(e){var t;return t=e===!0?[this.components[0],this.components[this.components.length-1]]:e===!1?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(e,t){
var i,n=!(t&&t.edge===!1),r=n&&t&&t.details,o={},s=Number.POSITIVE_INFINITY;if(e instanceof OpenLayers.Geometry.Point){for(var a,l=this.getSortedSegments(),h=e.x,c=e.y,u=0,d=l.length;u<d;++u)if(a=l[u],i=OpenLayers.Geometry.distanceToSegment(e,a),i.distance<s){if(s=i.distance,o=i,0===s)break}else if(a.x2>h&&(c>a.y1&&c<a.y2||c<a.y1&&c>a.y2))break;o=r?{distance:o.distance,x0:o.x,y0:o.y,x1:h,y1:c}:o.distance}else if(e instanceof OpenLayers.Geometry.LineString){var p,g,m,f,y,_=this.getSortedSegments(),v=e.getSortedSegments(),D=v.length,b={point:!0};e:for(var u=0,d=_.length;u<d;++u){p=_[u],f=p.x1,y=p.y1;for(var L=0;L<D;++L){if(g=v[L],m=OpenLayers.Geometry.segmentsIntersect(p,g,b)){s=0,o={distance:0,x0:m.x,y0:m.y,x1:m.x,y1:m.y};break e}i=OpenLayers.Geometry.distanceToSegment({x:f,y:y},g),i.distance<s&&(s=i.distance,o={distance:s,x0:f,y0:y,x1:i.x,y1:i.y})}}if(r||(o=o.distance),0!==s&&p){i=e.distanceTo(new OpenLayers.Geometry.Point(p.x2,p.y2),t);var C=r?i.distance:i;C<s&&(o=r?{distance:s,x0:i.x1,y0:i.y1,x1:i.x0,y1:i.y0}:C)}}else o=e.distanceTo(this,t),r&&(o={distance:o.distance,x0:o.x1,y0:o.y1,x1:o.x0,y1:o.y0});return o},simplify:function(e){if(this&&null!==this){var t=this.getVertices();if(t.length<3)return this;var i=function(e,t){return e-t},n=function(e,t,i,o){for(var s,l=0,h=0,c=t;c<i;c++)s=r(e[t],e[i],e[c]),s>l&&(l=s,h=c);l>o&&h!=t&&(a.push(h),n(e,t,h,o),n(e,h,i,o))},r=function(e,t,i){var n=Math.abs(.5*(e.x*t.y+t.x*i.y+i.x*e.y-t.x*e.y-i.x*t.y-e.x*i.y)),r=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),o=n/r*2;return o},o=0,s=t.length-1,a=[];for(a.push(o),a.push(s);t[o].equals(t[s]);)s--,a.push(s);n(t,o,s,e);var l=[];a.sort(i);for(var h=0;h<a.length;h++)l.push(t[a[h]]);return new OpenLayers.Geometry.LineString(l)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"}),OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],initialize:function(e){OpenLayers.Geometry.LineString.prototype.initialize.apply(this,arguments)},addComponent:function(e,t){var i=!1,n=this.components.pop();null==t&&e.equals(n)||(i=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments));var r=this.components[0];return OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[r]),i},removeComponent:function(e){var t=this.components&&this.components.length>3;if(t){this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var i=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[i])}return t},move:function(e,t){for(var i=0,n=this.components.length;i<n-1;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,n=this.components.length;i<n-1;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var n=0,r=this.components.length;n<r-1;++n)this.components[n].resize(e,t,i);return this},transform:function(e,t){if(e&&t){for(var i=0,n=this.components.length;i<n-1;i++){var r=this.components[i];r.transform(e,t)}this.bounds=null}return this},getCentroid:function(){if(this.components&&this.components.length>2){for(var e=0,t=0,i=0;i<this.components.length-1;i++){var n=this.components[i],r=this.components[i+1];e+=(n.x+r.x)*(n.x*r.y-r.x*n.y),t+=(n.y+r.y)*(n.x*r.y-r.x*n.y)}var o=-1*this.getArea(),s=e/(6*o),a=t/(6*o);return new OpenLayers.Geometry.Point(s,a)}return null},getArea:function(){var e=0;if(this.components&&this.components.length>2){for(var t=0,i=0,n=this.components.length;i<n-1;i++){var r=this.components[i],o=this.components[i+1];t+=(r.x+o.x)*(o.y-r.y)}e=-t/2}return e},getGeodesicArea:function(e){var t=this;if(e){var i=new OpenLayers.Projection("EPSG:4326");i.equals(e)||(t=this.clone().transform(e,i))}var n=0,r=t.components&&t.components.length;if(r>2){for(var o,s,a=0;a<r-1;a++)o=t.components[a],s=t.components[a+1],n+=OpenLayers.Util.rad(s.x-o.x)*(2+Math.sin(OpenLayers.Util.rad(o.y))+Math.sin(OpenLayers.Util.rad(s.y)));n=6378137*n*6378137/2}return n},containsPoint:function(e){function t(e,t,i,n,r){return((t-n)*e+(n*i-t*r))/(i-r)}for(var i,n,r,o,s,a,l,h=OpenLayers.Number.limitSigDigs,c=14,u=h(e.x,c),d=h(e.y,c),p=this.components.length-1,g=0,m=0;m<p;++m)if(i=this.components[m],r=h(i.x,c),o=h(i.y,c),n=this.components[m+1],s=h(n.x,c),a=h(n.y,c),o!=a){if(l=h(t(d,r,o,s,a),c),l==u&&(o<a&&d>=o&&d<=a||o>a&&d<=o&&d>=a)){g=-1;break}l<=u||r!=s&&(l<Math.min(r,s)||l>Math.max(r,s))||(o<a&&d>=o&&d<a||o>a&&d<o&&d>=a)&&++g}else if(d==o&&(r<=s&&u>=r&&u<=s||r>=s&&u<=r&&u>=s)){g=-1;break}var f=g==-1?1:!!(1&g);return f},intersects:function(e){var t=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)t=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME)t=e.intersects(this);else if("OpenLayers.Geometry.LinearRing"==e.CLASS_NAME)t=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[e]);else for(var i=0,n=e.components.length;i<n&&!(t=e.components[i].intersects(this));++i);return t},getVertices:function(e){return e===!0?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"}),OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],initialize:function(e){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},getArea:function(){var e=0;if(this.components&&this.components.length>0){e+=Math.abs(this.components[0].getArea());for(var t=1,i=this.components.length;t<i;t++)e-=Math.abs(this.components[t].getArea())}return e},getGeodesicArea:function(e){var t=0;if(this.components&&this.components.length>0){t+=Math.abs(this.components[0].getGeodesicArea(e));for(var i=1,n=this.components.length;i<n;i++)t-=Math.abs(this.components[i].getGeodesicArea(e))}return t},containsPoint:function(e){var t=this.components.length,i=!1;if(t>0&&(i=this.components[0].containsPoint(e),1!==i&&i&&t>1))for(var n,r=1;r<t;++r)if(n=this.components[r].containsPoint(e)){i=1===n&&1;break}return i},intersects:function(e){var t,i,n=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)n=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==e.CLASS_NAME){for(t=0,i=this.components.length;t<i&&!(n=e.intersects(this.components[t]));++t);if(!n)for(t=0,i=e.components.length;t<i&&!(n=this.containsPoint(e.components[t]));++t);}else for(t=0,i=e.components.length;t<i&&!(n=this.intersects(e.components[t]));++t);if(!n&&"OpenLayers.Geometry.Polygon"==e.CLASS_NAME){var r=this.components[0];for(t=0,i=r.components.length;t<i&&!(n=e.containsPoint(r.components[t]));++t);}return n},distanceTo:function(e,t){var i,n=!(t&&t.edge===!1);return i=!n&&this.intersects(e)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[e,t])},CLASS_NAME:"OpenLayers.Geometry.Polygon"}),OpenLayers.Geometry.Polygon.createRegularPolygon=function(e,t,i,n){var r=Math.PI*(1/i-.5);n&&(r+=n/180*Math.PI);for(var o,s,a,l=[],h=0;h<i;++h)o=r+2*h*Math.PI/i,s=e.x+t*Math.cos(o),a=e.y+t*Math.sin(o),l.push(new OpenLayers.Geometry.Point(s,a));var c=new OpenLayers.Geometry.LinearRing(l);return new OpenLayers.Geometry.Polygon([c])},OpenLayers.Event={observers:!1,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(e){return e.target||e.srcElement},isSingleTouch:function(e){return e.touches&&1==e.touches.length},isMultiTouch:function(e){return e.touches&&e.touches.length>1},isLeftClick:function(e){return e.which&&1==e.which||e.button&&1==e.button},isRightClick:function(e){return e.which&&3==e.which||e.button&&2==e.button},stop:function(e,t){t||(e.preventDefault?e.preventDefault():e.returnValue=!1),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},findElement:function(e,t){for(var i=OpenLayers.Event.element(e);i.parentNode&&(!i.tagName||i.tagName.toUpperCase()!=t.toUpperCase());)i=i.parentNode;return i},observe:function(e,t,i,n){var r=OpenLayers.Util.getElement(e);if(n=n||!1,"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||r.attachEvent)&&(t="keydown"),this.observers||(this.observers={}),!r._eventCacheID){var o="eventCacheID_";r.id&&(o=r.id+"_"+o),r._eventCacheID=OpenLayers.Util.createUniqueID(o)}var s=r._eventCacheID;this.observers[s]||(this.observers[s]=[]),this.observers[s].push({element:r,name:t,observer:i,useCapture:n}),r.addEventListener?r.addEventListener(t,i,n):r.attachEvent&&r.attachEvent("on"+t,i)},stopObservingElement:function(e){var t=OpenLayers.Util.getElement(e),i=t._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[i])},_removeElementObservers:function(e){if(e)for(var t=e.length-1;t>=0;t--){var i=e[t],n=new Array(i.element,i.name,i.observer,i.useCapture);OpenLayers.Event.stopObserving.apply(this,n)}},stopObserving:function(e,t,i,n){n=n||!1;var r=OpenLayers.Util.getElement(e),o=r._eventCacheID;"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||r.detachEvent)&&(t="keydown");var s=!1,a=OpenLayers.Event.observers[o];if(a)for(var l=0;!s&&l<a.length;){var h=a[l];if(h.name==t&&h.observer==i&&h.useCapture==n){a.splice(l,1),0==a.length&&delete OpenLayers.Event.observers[o],s=!0;break}l++}return s&&(r.removeEventListener?r.removeEventListener(t,i,n):r&&r.detachEvent&&r.detachEvent("on"+t,i)),s},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var e in OpenLayers.Event.observers){var t=OpenLayers.Event.observers[e];OpenLayers.Event._removeElementObservers.apply(this,[t])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"},OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1),window.Event)OpenLayers.Util.applyDefaults(window.Event,OpenLayers.Event);else var Event=OpenLayers.Event;OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend"],listeners:null,object:null,element:null,eventTypes:null,eventHandler:null,fallThrough:null,includeXY:!1,clearMouseListener:null,initialize:function(e,t,i,n,r){if(OpenLayers.Util.extend(this,r),this.object=e,this.fallThrough=n,this.listeners={},this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this),this.eventTypes=[],null!=i)for(var o=0,s=i.length;o<s;o++)this.addEventType(i[o]);null!=t&&this.attachToElement(t)},destroy:function(){this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)),this.element=null,this.listeners=null,this.object=null,this.eventTypes=null,this.fallThrough=null,this.eventHandler=null},addEventType:function(e){this.listeners[e]||(this.eventTypes.push(e),this.listeners[e]=[])},attachToElement:function(e){this.element&&OpenLayers.Event.stopObservingElement(this.element),this.element=e;for(var t=0,i=this.BROWSER_EVENTS.length;t<i;t++){var n=this.BROWSER_EVENTS[t];this.addEventType(n),OpenLayers.Event.observe(e,n,this.eventHandler)}OpenLayers.Event.observe(e,"dragstart",OpenLayers.Event.stop)},on:function(e){for(var t in e)"scope"!=t&&this.register(t,e.scope,e[t])},register:function(e,t,i){if(null!=i&&OpenLayers.Util.indexOf(this.eventTypes,e)!=-1){null==t&&(t=this.object);var n=this.listeners[e];n.push({obj:t,func:i})}},registerPriority:function(e,t,i){if(null!=i){null==t&&(t=this.object);var n=this.listeners[e];null!=n&&n.unshift({obj:t,func:i})}},un:function(e){for(var t in e)"scope"!=t&&this.unregister(t,e.scope,e[t])},unregister:function(e,t,i){null==t&&(t=this.object);var n=this.listeners[e];if(null!=n)for(var r=0,o=n.length;r<o;r++)if(n[r].obj==t&&n[r].func==i){n.splice(r,1);break}},remove:function(e){null!=this.listeners[e]&&(this.listeners[e]=[])},triggerEvent:function(e,t){var i=this.listeners[e];if(i&&0!=i.length){null==t&&(t={}),t.object=this.object,t.element=this.element,t.type||(t.type=e),i=i.slice();for(var n,r=0,o=i.length;r<o;r++){var s=i[r];if(n=s.func.apply(s.obj,[t]),void 0!=n&&0==n)break}return this.fallThrough||OpenLayers.Event.stop(t,!0),n}},handleBrowserEvent:function(e){var t=e.type,i=this.listeners[t];if(i&&0!=i.length){var n=e.touches;if(n&&n[0]){for(var r,o=0,s=0,a=n.length,l=0;l<a;++l)r=n[l],o+=r.clientX,s+=r.clientY;e.clientX=o/a,e.clientY=s/a}this.includeXY&&(e.xy=this.getMousePosition(e)),this.triggerEvent(t,e)}},clearMouseCache:function(){this.element.scrolls=null,this.element.lefttop=null;var e=document.body;e&&(0==e.scrollTop&&0==e.scrollLeft||!navigator.userAgent.match(/iPhone/i))&&(this.element.offsets=null)},getMousePosition:function(e){if(this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var t=OpenLayers.Util.getViewportElement();this.element.scrolls=[t.scrollLeft,t.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element)),new OpenLayers.Pixel(e.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],e.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},CLASS_NAME:"OpenLayers.Events"}),OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},EVENT_TYPES:["preaddlayer","addlayer","preremovelayer","removelayer","changelayer","movestart","move","moveend","zoomend","popupopen","popupclose","addmarker","removemarker","clearmarkers","mouseover","mouseout","mousemove","dragstart","drag","dragend","changebaselayer"],id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,viewRequestID:0,tileSize:null,projection:"EPSG:4326",units:"degrees",resolutions:null,maxResolution:1.40625,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!0,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,minPx:null,maxPx:null,initialize:function(e,t){1===arguments.length&&"object"==typeof e&&(t=e,e=t&&t.div),this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT),this.maxExtent=new OpenLayers.Bounds((-180),(-90),180,90),this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15),this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css",OpenLayers.Util.extend(this,t),this.layers=[],this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_"),this.div=OpenLayers.Util.getElement(e),this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px"),OpenLayers.Element.addClass(this.div,"olMap");var i=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(i,null,null,null,"relative",null,"hidden"),this.viewPortDiv.style.width="100%",this.viewPortDiv.style.height="100%",this.viewPortDiv.className="olMapViewport",this.div.appendChild(this.viewPortDiv);var n=document.createElement("div");if(n.id=this.id+"_events",n.style.position="absolute",n.style.width="100%",n.style.height="100%",n.style.zIndex=this.Z_INDEX_BASE.Control-1,this.viewPortDiv.appendChild(n),this.eventsDiv=n,this.events=new OpenLayers.Events(this,this.eventsDiv,this.EVENT_TYPES,this.fallThrough,{includeXY:!0}),i=this.id+"_OpenLayers_Container",this.layerContainerDiv=OpenLayers.Util.createDiv(i),this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1,this.eventsDiv.appendChild(this.layerContainerDiv),this.updateSize(),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),this.events.register("movestart",this,this.updateSize),OpenLayers.String.contains(navigator.appName,"Microsoft")?this.events.register("resize",this,this.updateSize):(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)),this.theme){for(var r=!0,o=document.getElementsByTagName("link"),s=0,a=o.length;s<a;++s)if(OpenLayers.Util.isEquivalentUrl(o.item(s).href,this.theme)){r=!1;break}if(r){var l=document.createElement("link");l.setAttribute("rel","stylesheet"),l.setAttribute("type","text/css"),l.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(l)}}null==this.controls&&(null!=OpenLayers.Control?this.controls=[new OpenLayers.Control.Navigation,new OpenLayers.Control.PanZoom,new OpenLayers.Control.ArgParser,new OpenLayers.Control.Attribution]:this.controls=[]);for(var s=0,a=this.controls.length;s<a;s++)this.addControlToMap(this.controls[s]);this.popups=[],this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this),OpenLayers.Event.observe(window,"unload",this.unloadDestroy),t&&t.layers&&(delete this.center,this.addLayers(t.layers),t.center&&this.setCenter(t.center,t.zoom))},render:function(e){this.div=OpenLayers.Util.getElement(e),OpenLayers.Element.addClass(this.div,"olMap"),this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.div.appendChild(this.viewPortDiv),this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;if(this.panTween&&(this.panTween.stop(),this.panTween=null),OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy),this.unloadDestroy=null,this.updateSizeDestroy?OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy):this.events.unregister("resize",this,this.updateSize),this.paddingForPopups=null,null!=this.controls){for(var e=this.controls.length-1;e>=0;--e)this.controls[e].destroy();this.controls=null}if(null!=this.layers){for(var e=this.layers.length-1;e>=0;--e)this.layers[e].destroy(!1);this.layers=null}this.viewPortDiv&&this.div.removeChild(this.viewPortDiv),this.viewPortDiv=null,this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null),this.events.destroy(),this.events=null},setOptions:function(e){var t=this.minPx&&e.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,e),t&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(e,t,i){var n="function"==typeof i.test,r=OpenLayers.Array.filter(this[e],function(e){return e[t]==i||n&&i.test(e[t])});return r},getLayersBy:function(e,t){return this.getBy("layers",e,t)},getLayersByName:function(e){return this.getLayersBy("name",e)},getLayersByClass:function(e){return this.getLayersBy("CLASS_NAME",e)},getControlsBy:function(e,t){return this.getBy("controls",e,t)},getControlsByClass:function(e){return this.getControlsBy("CLASS_NAME",e)},getLayer:function(e){for(var t=null,i=0,n=this.layers.length;i<n;i++){var r=this.layers[i];if(r.id==e){t=r;break}}return t},setLayerZIndex:function(e,t){e.setZIndex(this.Z_INDEX_BASE[e.isBaseLayer?"BaseLayer":"Overlay"]+5*t)},resetLayersZIndex:function(){for(var e=0,t=this.layers.length;e<t;e++){var i=this.layers[e];this.setLayerZIndex(i,e)}},addLayer:function(e){for(var t=0,i=this.layers.length;t<i;t++)if(this.layers[t]==e){var n=OpenLayers.i18n("layerAlreadyAdded",{layerName:e.name});return OpenLayers.Console.warn(n),!1}this.events.triggerEvent("preaddlayer",{layer:e})!==!1&&(this.allOverlays&&(e.isBaseLayer=!1),e.div.className="olLayerDiv",e.div.style.overflow="",this.setLayerZIndex(e,this.layers.length),e.isFixed?this.viewPortDiv.appendChild(e.div):this.layerContainerDiv.appendChild(e.div),this.layers.push(e),e.setMap(this),e.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(e):e.setVisibility(!1):e.redraw(),this.events.triggerEvent("addlayer",{layer:e}),e.events.triggerEvent("added",{map:this,layer:e}),e.afterAdd())},addLayers:function(e){for(var t=0,i=e.length;t<i;t++)this.addLayer(e[t])},removeLayer:function(e,t){if(this.events.triggerEvent("preremovelayer",{layer:e})!==!1){if(null==t&&(t=!0),e.isFixed?this.viewPortDiv.removeChild(e.div):this.layerContainerDiv.removeChild(e.div),OpenLayers.Util.removeItem(this.layers,e),e.removeMap(this),e.map=null,this.baseLayer==e&&(this.baseLayer=null,t))for(var i=0,n=this.layers.length;i<n;i++){var r=this.layers[i];if(r.isBaseLayer||this.allOverlays){this.setBaseLayer(r);break}}this.resetLayersZIndex(),this.events.triggerEvent("removelayer",{layer:e}),e.events.triggerEvent("removed",{map:this,layer:e})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(e){return OpenLayers.Util.indexOf(this.layers,e)},setLayerIndex:function(e,t){var i=this.getLayerIndex(e);if(t<0?t=0:t>this.layers.length&&(t=this.layers.length),i!=t){this.layers.splice(i,1),this.layers.splice(t,0,e);for(var n=0,r=this.layers.length;n<r;n++)this.setLayerZIndex(this.layers[n],n);this.events.triggerEvent("changelayer",{layer:e,property:"order"}),this.allOverlays&&(0===t?this.setBaseLayer(e):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(e,t){var i=this.getLayerIndex(e)+t;this.setLayerIndex(e,i)},setBaseLayer:function(e){if(e!=this.baseLayer&&OpenLayers.Util.indexOf(this.layers,e)!=-1){var t=this.getCachedCenter(),i=OpenLayers.Util.getResolutionFromScale(this.getScale(),e.units);if(null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1),this.baseLayer=e,this.viewRequestID++,this.allOverlays&&!this.baseLayer.visibility||this.baseLayer.setVisibility(!0),null!=t){var n=this.getZoomForResolution(i||this.resolution,!0);this.setCenter(t,n,!1,!0)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(e,t){this.controls.push(e),this.addControlToMap(e,t)},addControls:function(e,t){for(var i=1===arguments.length?[]:t,n=0,r=e.length;n<r;n++){var o=e[n],s=i[n]?i[n]:null;this.addControl(o,s)}},addControlToMap:function(e,t){e.outsideViewport=null!=e.div,this.displayProjection&&!e.displayProjection&&(e.displayProjection=this.displayProjection),e.setMap(this);var i=e.draw(t);i&&(e.outsideViewport||(i.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(i))),e.autoActivate&&e.activate()},getControl:function(e){for(var t=null,i=0,n=this.controls.length;i<n;i++){var r=this.controls[i];if(r.id==e){t=r;break}}return t},removeControl:function(e){e&&e==this.getControl(e.id)&&(e.div&&e.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(e.div),OpenLayers.Util.removeItem(this.controls,e))},addPopup:function(e,t){if(t)for(var i=this.popups.length-1;i>=0;--i)this.removePopup(this.popups[i]);e.map=this,this.popups.push(e);var n=e.draw();n&&(n.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(n))},removePopup:function(e){if(OpenLayers.Util.removeItem(this.popups,e),e.div)try{this.layerContainerDiv.removeChild(e.div)}catch(t){}e.map=null},getSize:function(){var e=null;return null!=this.size&&(e=this.size.clone()),e},updateSize:function(){var e=this.getCurrentSize();if(e&&!isNaN(e.h)&&!isNaN(e.w)){this.events.clearMouseCache();var t=this.getSize();if(null==t&&(this.size=t=e),!e.equals(t)){this.size=e;for(var i=0,n=this.layers.length;i<n;i++)this.layers[i].onMapResize();var r=this.getCachedCenter();if(null!=this.baseLayer&&null!=r){var o=this.getZoom();this.zoom=null,this.setCenter(r,o)}}}},getCurrentSize:function(){var e=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);return(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h))&&(e.w=this.div.offsetWidth,e.h=this.div.offsetHeight),(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h))&&(e.w=parseInt(this.div.style.width),e.h=parseInt(this.div.style.height)),e},calculateBounds:function(e,t){var i=null;if(null==e&&(e=this.getCachedCenter()),null==t&&(t=this.getResolution()),null!=e&&null!=t){var n=this.getSize(),r=n.w*t,o=n.h*t;i=new OpenLayers.Bounds(e.lon-r/2,e.lat-o/2,e.lon+r/2,e.lat+o/2)}return i},getCenter:function(){var e=null,t=this.getCachedCenter();return t&&(e=t.clone()),e},getCachedCenter:function(){return!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx(new OpenLayers.Pixel(this.size.w/2,this.size.h/2))),this.center},getZoom:function(){return this.zoom},pan:function(e,t,i){if(i=OpenLayers.Util.applyDefaults(i,{animate:!0,dragging:!1}),i.dragging)0==e&&0==t||this.moveByPx(e,t);else{var n=this.getViewPortPxFromLonLat(this.getCachedCenter()),r=n.add(e,t);if(this.dragging||!r.equals(n)){var o=this.getLonLatFromViewPortPx(r);i.animate?this.panTo(o):(this.moveTo(o),this.dragging=!1,this.events.triggerEvent("moveend"))}}},panTo:function(e){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(e)){this.panTween||(this.panTween=new OpenLayers.Tween(this.panMethod));var t=this.getCachedCenter();if(e.equals(t))return;var i=this.getPixelFromLonLat(t),n=this.getPixelFromLonLat(e),r={x:n.x-i.x,y:n.y-i.y},o={x:0,y:0};this.panTween.start({x:0,y:0},r,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(e){var t=e.x-o.x,i=e.y-o.y;this.moveByPx(t,i),o.x=Math.round(e.x),o.y=Math.round(e.y)},this),done:OpenLayers.Function.bind(function(t){this.moveTo(e),this.dragging=!1,this.events.triggerEvent("moveend")},this)}})}else this.setCenter(e)},setCenter:function(e,t,i,n){this.panTween&&this.panTween.stop(),this.moveTo(e,t,{dragging:i,forceZoomChange:n})},moveByPx:function(e,t){var i=this.size.w/2,n=this.size.h/2,r=i+e,o=n+t,s=this.baseLayer.wrapDateLine,a=0,l=0;this.restrictedExtent&&(a=i,l=n,s=!1),e=s||r<=this.maxPx.x-a&&r>=this.minPx.x+a?Math.round(e):0,t=o<=this.maxPx.y-l&&o>=this.minPx.y+l?Math.round(t):0;var h=this.minPx.x,c=this.maxPx.x;if(e||t){this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart")),this.center=null,e&&(this.layerContainerDiv.style.left=parseInt(this.layerContainerDiv.style.left)-e+"px",this.minPx.x-=e,this.maxPx.x-=e,s&&(this.maxPx.x>c&&(this.maxPx.x-=c-h),this.minPx.x<h&&(this.minPx.x+=c-h))),t&&(this.layerContainerDiv.style.top=parseInt(this.layerContainerDiv.style.top)-t+"px",this.minPx.y-=t,this.maxPx.y-=t);var u,d,p;for(d=0,p=this.layers.length;d<p;++d)u=this.layers[d],u.visibility&&(u===this.baseLayer||u.inRange)&&(u.moveByPx(e,t),u.events.triggerEvent("move"));this.events.triggerEvent("move")}},moveTo:function(e,t,i){i||(i={}),null!=t&&(t=parseFloat(t),this.fractionalZoom||(t=Math.round(t)));var n=i.dragging||this.dragging,r=i.forceZoomChange;if(this.getCachedCenter()||this.isValidLonLat(e)||(e=this.maxExtent.getCenterLonLat(),this.center=e.clone()),null!=this.restrictedExtent){null==e&&(e=this.center),null==t&&(t=this.getZoom());var o=this.getResolutionForZoom(t),s=this.calculateBounds(e,o);if(!this.restrictedExtent.containsBounds(s)){var a=this.restrictedExtent.getCenterLonLat();s.getWidth()>this.restrictedExtent.getWidth()?e=new OpenLayers.LonLat(a.lon,e.lat):s.left<this.restrictedExtent.left?e=e.add(this.restrictedExtent.left-s.left,0):s.right>this.restrictedExtent.right&&(e=e.add(this.restrictedExtent.right-s.right,0)),s.getHeight()>this.restrictedExtent.getHeight()?e=new OpenLayers.LonLat(e.lon,a.lat):s.bottom<this.restrictedExtent.bottom?e=e.add(0,this.restrictedExtent.bottom-s.bottom):s.top>this.restrictedExtent.top&&(e=e.add(0,this.restrictedExtent.top-s.top))}}var l=r||this.isValidZoomLevel(t)&&t!=this.getZoom(),h=this.isValidLonLat(e)&&!e.equals(this.center);if(l||h||n){n||this.events.triggerEvent("movestart"),h&&(!l&&this.center&&this.centerLayerContainer(e),this.center=e.clone());var c=l?this.getResolutionForZoom(t):this.getResolution();if(l||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter(),this.layerContainerDiv.style.left="0px",this.layerContainerDiv.style.top="0px";var u=this.getMaxExtent({restricted:!0}),d=u.getCenterLonLat(),p=this.center.lon-d.lon,g=d.lat-this.center.lat,m=Math.round(u.getWidth()/c),f=Math.round(u.getHeight()/c),y=(this.size.w-m)/2-p/c,_=(this.size.h-f)/2-g/c;this.minPx=new OpenLayers.Pixel(y,_),this.maxPx=new OpenLayers.Pixel(y+m,_+f)}l&&(this.zoom=t,this.resolution=c,this.viewRequestID++);var v=this.getExtent();this.baseLayer.visibility&&(this.baseLayer.moveTo(v,l,i.dragging),i.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:l})),v=this.baseLayer.getExtent();for(var D=this.layers.length-1;D>=0;--D){var b=this.layers[D];if(b!==this.baseLayer&&!b.isBaseLayer){var L=b.calculateInRange();b.inRange!=L&&(b.inRange=L,L||b.display(!1),this.events.triggerEvent("changelayer",{layer:b,property:"visibility"})),L&&b.visibility&&(b.moveTo(v,l,i.dragging),i.dragging||b.events.triggerEvent("moveend",{zoomChanged:l}))}}if(this.events.triggerEvent("move"),n||this.events.triggerEvent("moveend"),l){for(var D=0,C=this.popups.length;D<C;D++)this.popups[D].updatePosition();this.events.triggerEvent("zoomend")}}this._trackGroupGeomLoad()},_trackGroupGeomLoad:function(){if(window.TilesLoadActivated){var e=this.getExtent(),t=OpenLayers.Projection.transform({x:e.left,y:e.top},new OpenLayers.Projection("EPSG:900913"),new OpenLayers.Projection("EPSG:4326")),i=OpenLayers.Projection.transform({x:e.right,y:e.bottom},new OpenLayers.Projection("EPSG:900913"),new OpenLayers.Projection("EPSG:4326")),n=.3,r=(i.x-t.x)*n,o=(t.y-i.y)*n,s={},a={};s.x=t.x,s.y=t.y,a.x=i.x,a.y=i.y,t.x=t.x-r,t.y=t.y+o,i.x=i.x+r,i.y=i.y-o;var l=i.x-t.x,h=t.y-i.y;t.x=Math.floor(t.x/l)*l,t.y=Math.ceil(t.y/h)*h,i.x=Math.ceil(i.x/l)*l,i.y=Math.floor(i.y/h)*h,DG.UIStats.tilesLoadedCache||(DG.UIStats.tilesLoadedCache={});var c=t.x+","+t.y+","+i.x+","+i.y;if(!(DG.UIStats.tilesLoadedCache[c]||!this.zoom||this.zoom<16||DG.UIStats.loadingTiles)){DG.UIStats.loadingTiles||(DG.UIStats.loadingTiles=!0);for(var u in DG.UIStats.tilesLoadedCache)if(u=u.split(","),u[0]<=s.x&&u[1]>=s.y&&u[2]>=a.x&&u[3]<=a.y)return void(DG.UIStats.loadingTiles=!1);if(DG.Map.HIGHLIGHT_CACHED_AREAS_SIZE&&DG.Utils.getObjectSize(DG.UIStats.tilesLoadedCache)>DG.Map.HIGHLIGHT_CACHED_AREAS_SIZE)for(var d=DG.Utils.getObjectSize(DG.UIStats.tilesLoadedCache)-DG.Map.HIGHLIGHT_CACHED_AREAS_SIZE,p=0;p<d;p++)for(var p in DG.UIStats.tilesLoadedCache)if(DG.UIStats.tilesLoadedCache.hasOwnProperty(p)&&"function"!=typeof p){delete DG.UIStats.tilesLoadedCache[p];break}DG.UIStats.tilesLoadedCache[c]=!0;var g=this;setTimeout(function(){var e=g.zoom?"_"+g.zoom.toString():"",t="TilesLoad_"+n.toString()+e;window._gaq&&window._gaq.push(["dg_ui._trackEvent",t,t,"count",1]),DG.UIStats.loadingTiles=!1},300)}}},centerLayerContainer:function(e){var t=this.getViewPortPxFromLonLat(this.layerContainerOrigin),i=this.getViewPortPxFromLonLat(e);if(null!=t&&null!=i){var n=parseInt(this.layerContainerDiv.style.left),r=parseInt(this.layerContainerDiv.style.top),o=Math.round(t.x-i.x),s=Math.round(t.y-i.y);this.layerContainerDiv.style.left=o+"px",this.layerContainerDiv.style.top=s+"px";var a=n-o,l=r-s;this.minPx.x-=a,this.maxPx.x-=a,this.minPx.y-=l,this.maxPx.y-=l}},isValidZoomLevel:function(e){return null!=e&&e>=0&&e<this.getNumZoomLevels()},isValidLonLat:function(e){var t=!1;if(null!=e){var i=this.getMaxExtent();t=i.containsLonLat(e)}return t},getProjection:function(){var e=this.getProjectionObject();return e?e.getCode():null},getProjectionObject:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.projection),e},getMaxResolution:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.maxResolution),e},getMaxExtent:function(e){var t=null;return e&&e.restricted&&this.restrictedExtent?t=this.restrictedExtent:null!=this.baseLayer&&(t=this.baseLayer.maxExtent),t},getNumZoomLevels:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.numZoomLevels),e},getExtent:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.getExtent()),e},getResolution:function(){var e=null;return null!=this.baseLayer?e=this.baseLayer.getResolution():this.allOverlays===!0&&this.layers.length>0&&(e=this.layers[0].getResolution()),
e},getUnits:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.units),e},getScale:function(){var e=null;if(null!=this.baseLayer){var t=this.getResolution(),i=this.baseLayer.units;e=OpenLayers.Util.getScaleFromResolution(t,i)}return e},getZoomForExtent:function(e,t){var i=null;return null!=this.baseLayer&&(i=this.baseLayer.getZoomForExtent(e,t)),i},getResolutionForZoom:function(e){var t=null;return this.baseLayer&&(t=this.baseLayer.getResolutionForZoom(e)),t},getZoomForResolution:function(e,t){var i=null;return null!=this.baseLayer&&(i=this.baseLayer.getZoomForResolution(e,t)),i},zoomTo:function(e){this.isValidZoomLevel(e)&&this.setCenter(null,e)},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(e,t){var i=e.getCenterLonLat();if(this.baseLayer.wrapDateLine){var n=this.getMaxExtent();for(e=e.clone();e.right<e.left;)e.right+=n.getWidth();i=e.getCenterLonLat().wrapDateLine(n)}this.setCenter(i,this.getZoomForExtent(e,t))},zoomToMaxExtent:function(e){var t=!e||e.restricted,i=this.getMaxExtent({restricted:t});this.zoomToExtent(i)},zoomToScale:function(e,t){var i=OpenLayers.Util.getResolutionFromScale(e,this.baseLayer.units),n=this.getSize(),r=n.w*i,o=n.h*i,s=this.getCachedCenter(),a=new OpenLayers.Bounds(s.lon-r/2,s.lat-o/2,s.lon+r/2,s.lat+o/2);this.zoomToExtent(a,t)},getLonLatFromViewPortPx:function(e){var t=null;return null!=this.baseLayer&&(t=this.baseLayer.getLonLatFromViewPortPx(e)),t},getViewPortPxFromLonLat:function(e){var t=null;return null!=this.baseLayer&&(t=this.baseLayer.getViewPortPxFromLonLat(e)),t},getLonLatFromPixel:function(e){return this.getLonLatFromViewPortPx(e)},getPixelFromLonLat:function(e){var t=this.getViewPortPxFromLonLat(e);return t.x=Math.round(t.x),t.y=Math.round(t.y),t},getGeodesicPixelSize:function(e){var t=e?this.getLonLatFromPixel(e):this.getCachedCenter()||new OpenLayers.LonLat(0,0),i=this.getResolution(),n=t.add(-i/2,0),r=t.add(i/2,0),o=t.add(0,-i/2),s=t.add(0,i/2),a=new OpenLayers.Projection("EPSG:4326"),l=this.getProjectionObject()||a;return l.equals(a)||(n.transform(l,a),r.transform(l,a),o.transform(l,a),s.transform(l,a)),new OpenLayers.Size(OpenLayers.Util.distVincenty(n,r),OpenLayers.Util.distVincenty(o,s))},getViewPortPxFromLayerPx:function(e){var t=null;if(null!=e){var i=parseInt(this.layerContainerDiv.style.left),n=parseInt(this.layerContainerDiv.style.top);t=e.add(i,n)}return t},getLayerPxFromViewPortPx:function(e){var t=null;if(null!=e){var i=-parseInt(this.layerContainerDiv.style.left),n=-parseInt(this.layerContainerDiv.style.top);t=e.add(i,n),(isNaN(t.x)||isNaN(t.y))&&(t=null)}return t},getLonLatFromLayerPx:function(e){return e=this.getViewPortPxFromLayerPx(e),this.getLonLatFromViewPortPx(e)},getLayerPxFromLonLat:function(e){var t=this.getPixelFromLonLat(e);return this.getLayerPxFromViewPortPx(t)},CLASS_NAME:"OpenLayers.Map"}),OpenLayers.Map.TILE_WIDTH=256,OpenLayers.Map.TILE_HEIGHT=256,OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.projCode=e,window.Proj4js&&(this.proj=new Proj4js.Proj(e))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(e){var t=e,i=!1;if(t)if(window.Proj4js&&this.proj.defData&&t.proj.defData)i=this.proj.defData.replace(this.titleRegEx,"")==t.proj.defData.replace(this.titleRegEx,"");else if(t.getCode){var n=this.getCode(),r=t.getCode();i=n==r||!!OpenLayers.Projection.transforms[n]&&OpenLayers.Projection.transforms[n][r]===OpenLayers.Projection.nullTransform}return i},destroy:function(){delete this.proj,delete this.projCode},CLASS_NAME:"OpenLayers.Projection"}),OpenLayers.Projection.transforms={},OpenLayers.Projection.addTransform=function(e,t,i){OpenLayers.Projection.transforms[e]||(OpenLayers.Projection.transforms[e]={}),OpenLayers.Projection.transforms[e][t]=i},OpenLayers.Projection.transform=function(e,t,i){return t.proj&&i.proj?e=Proj4js.transform(t.proj,i.proj,e):t&&i&&OpenLayers.Projection.transforms[t.getCode()]&&OpenLayers.Projection.transforms[t.getCode()][i.getCode()]&&OpenLayers.Projection.transforms[t.getCode()][i.getCode()](e),e},OpenLayers.Projection.nullTransform=function(e){return e},OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:null,alwaysInRange:null,EVENT_TYPES:["loadstart","loadend","loadcancel","visibilitychanged","move","moveend","added","removed"],RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,imageOffset:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,transitionEffect:null,SUPPORTED_TRANSITIONS:["resize"],metadata:{},initialize:function(e,t){this.addOptions(t),this.name=e,null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES),this.eventListeners instanceof Object&&this.events.on(this.eventListeners)),this.wrapDateLine&&(this.displayOutsideMaxExtent=!0)},destroy:function(e){null==e&&(e=!0),null!=this.map&&this.map.removeLayer(this,e),this.projection=null,this.map=null,this.name=null,this.div=null,this.options=null,this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy()),this.eventListeners=null,this.events=null},clone:function(e){return null==e&&(e=new OpenLayers.Layer(this.name,this.getOptions())),OpenLayers.Util.applyDefaults(e,this),e.map=null,e},getOptions:function(){var e={};for(var t in this.options)e[t]=this[t];return e},setName:function(e){e!=this.name&&(this.name=e,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(e,t){if(null==this.options&&(this.options={}),OpenLayers.Util.extend(this.options,e),OpenLayers.Util.extend(this,e),"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits()),this.map){var i=this.map.getResolution(),n=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var r in e)if(e.hasOwnProperty(r)&&OpenLayers.Util.indexOf(n,r)>=0){this.initResolutions(),t&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(i),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}},onMapResize:function(){},redraw:function(){var e=!1;if(this.map){this.inRange=this.calculateInRange();var t=this.getExtent();if(t&&this.inRange&&this.visibility){var i=!0;this.moveTo(t,i,!1),this.events.triggerEvent("moveend",{zoomChanged:i}),e=!0}}return e},moveTo:function(e,t,i){var n=this.visibility;this.isBaseLayer||(n=n&&this.inRange),this.display(n)},moveByPx:function(e,t){},setMap:function(e){if(null==this.map){if(this.map=e,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),!this.isBaseLayer){this.inRange=this.calculateInRange();var t=this.visibility&&this.inRange;this.div.style.display=t?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(e){},getImageSize:function(e){return this.imageSize||this.tileSize},setTileSize:function(e){var t=e?e:this.tileSize?this.tileSize:this.map.getTileSize();this.tileSize=t,this.gutter&&(this.imageOffset=new OpenLayers.Pixel((-this.gutter),(-this.gutter)),this.imageSize=new OpenLayers.Size(t.w+2*this.gutter,t.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(e){e!=this.visibility&&(this.visibility=e,this.display(e),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(e){e!=("none"!=this.div.style.display)&&(this.div.style.display=e&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var e=!1;if(this.alwaysInRange)e=!0;else if(this.map){var t=this.map.getResolution();e=t>=this.minResolution&&t<=this.maxResolution}return e},setIsBaseLayer:function(e){e!=this.isBaseLayer&&(this.isBaseLayer=e,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var e,t,i,n={},r=!0;for(e=0,t=this.RESOLUTION_PROPERTIES.length;e<t;e++)i=this.RESOLUTION_PROPERTIES[e],n[i]=this.options[i],r&&this.options[i]&&(r=!1);if(null==this.alwaysInRange&&(this.alwaysInRange=r),null==n.resolutions&&(n.resolutions=this.resolutionsFromScales(n.scales)),null==n.resolutions&&(n.resolutions=this.calculateResolutions(n)),null==n.resolutions){for(e=0,t=this.RESOLUTION_PROPERTIES.length;e<t;e++)i=this.RESOLUTION_PROPERTIES[e],n[i]=null!=this.options[i]?this.options[i]:this.map[i];null==n.resolutions&&(n.resolutions=this.resolutionsFromScales(n.scales)),null==n.resolutions&&(n.resolutions=this.calculateResolutions(n))}var o;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(o=this.options.maxResolution),this.options.minScale&&(o=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var s;if(this.options.minResolution&&"auto"!==this.options.minResolution&&(s=this.options.minResolution),this.options.maxScale&&(s=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)),n.resolutions&&(n.resolutions.sort(function(e,t){return t-e}),o||(o=n.resolutions[0]),!s)){var a=n.resolutions.length-1;s=n.resolutions[a]}if(this.resolutions=n.resolutions,this.resolutions){for(t=this.resolutions.length,this.scales=new Array(t),e=0;e<t;e++)this.scales[e]=OpenLayers.Util.getScaleFromResolution(this.resolutions[e],this.units);this.numZoomLevels=t}this.minResolution=s,s&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(s,this.units)),this.maxResolution=o,o&&(this.minScale=OpenLayers.Util.getScaleFromResolution(o,this.units))},resolutionsFromScales:function(e){if(null!=e){var t,i,n;for(n=e.length,t=new Array(n),i=0;i<n;i++)t[i]=OpenLayers.Util.getResolutionFromScale(e[i],this.units);return t}},calculateResolutions:function(e){var t,i,n,r=e.maxResolution;null!=e.minScale?r=OpenLayers.Util.getResolutionFromScale(e.minScale,this.units):"auto"==r&&null!=this.maxExtent&&(t=this.map.getSize(),i=this.maxExtent.getWidth()/t.w,n=this.maxExtent.getHeight()/t.h,r=Math.max(i,n));var o=e.minResolution;null!=e.maxScale?o=OpenLayers.Util.getResolutionFromScale(e.maxScale,this.units):"auto"==e.minResolution&&null!=this.minExtent&&(t=this.map.getSize(),i=this.minExtent.getWidth()/t.w,n=this.minExtent.getHeight()/t.h,o=Math.max(i,n));var s=e.maxZoomLevel,a=e.numZoomLevels;if("number"==typeof o&&"number"==typeof r&&void 0===a){var l=r/o;a=Math.floor(Math.log(l)/Math.log(2))+1}else void 0===a&&null!=s&&(a=s+1);if(!("number"!=typeof a||a<=0||"number"!=typeof r&&"number"!=typeof o)){var h=new Array(a),c=2;"number"==typeof o&&"number"==typeof r&&(c=Math.pow(r/o,1/(a-1)));var u;if("number"==typeof r)for(u=0;u<a;u++)h[u]=r/Math.pow(c,u);else for(u=0;u<a;u++)h[a-1-u]=o*Math.pow(c,u);return h}},getResolution:function(){var e=this.map.getZoom();return this.getResolutionForZoom(e)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(e,t){var i=this.map.getSize(),n=Math.max(e.getWidth()/i.w,e.getHeight()/i.h);return this.getZoomForResolution(n,t)},getDataExtent:function(){},getResolutionForZoom:function(e){e=Math.max(0,Math.min(e,this.resolutions.length-1));var t;if(this.map.fractionalZoom){var i=Math.floor(e),n=Math.ceil(e);t=this.resolutions[i]-(e-i)*(this.resolutions[i]-this.resolutions[n])}else t=this.resolutions[Math.round(e)];return t},getZoomForResolution:function(e,t){var i,n,r;if(this.map.fractionalZoom){var o,s=0,a=this.resolutions.length-1,l=this.resolutions[s],h=this.resolutions[a];for(n=0,r=this.resolutions.length;n<r;++n)if(o=this.resolutions[n],o>=e&&(l=o,s=n),o<=e){h=o,a=n;break}var c=l-h;i=c>0?s+(l-e)/c:s}else{var u,d=Number.POSITIVE_INFINITY;for(n=0,r=this.resolutions.length;n<r;n++)if(t){if(u=Math.abs(this.resolutions[n]-e),u>d)break;d=u}else if(this.resolutions[n]<e)break;i=Math.max(0,n-1)}return i},getLonLatFromViewPortPx:function(e){var t=null,i=this.map;if(null!=e&&i.minPx){var n=i.getResolution(),r=i.getMaxExtent({restricted:!0}),o=(e.x-i.minPx.x)*n+r.left,s=(i.minPx.y-e.y)*n+r.top;t=new OpenLayers.LonLat(o,s),this.wrapDateLine&&(t=t.wrapDateLine(this.maxExtent))}return t},getViewPortPxFromLonLat:function(e){var t=null;if(null!=e){var i=this.map.getResolution(),n=this.map.getExtent();t=new OpenLayers.Pixel(1/i*(e.lon-n.left),1/i*(n.top-e.lat))}return t},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=0,i=this.div.childNodes.length;t<i;++t){var n=this.div.childNodes[t].firstChild;OpenLayers.Util.modifyDOMElement(n,null,null,null,null,null,null,e)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(e){this.div.style.zIndex=e},adjustBounds:function(e){if(this.gutter){var t=this.gutter*this.map.getResolution();e=new OpenLayers.Bounds(e.left-t,e.bottom-t,e.right+t,e.top+t)}if(this.wrapDateLine){var i={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};e=e.wrapDateLine(this.maxExtent,i)}return e},CLASS_NAME:"OpenLayers.Layer"}),OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(e,t,i,n){OpenLayers.Layer.prototype.initialize.apply(this,[e,n]),this.url=t,this.params=OpenLayers.Util.extend({},i)},destroy:function(){this.url=null,this.params=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e])},setUrl:function(e){this.url=e},mergeNewParams:function(e){this.params=OpenLayers.Util.extend(this.params,e);var t=this.redraw();return null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"}),t},redraw:function(e){return e?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(e,t){for(var i=1,n=0,r=e.length;n<r;n++)i*=e.charCodeAt(n)*this.URL_HASH_FACTOR,i-=Math.floor(i);return t[Math.floor(i*t.length)]},getFullRequestString:function(e,t){var i=t||this.url,n=OpenLayers.Util.extend({},this.params);n=OpenLayers.Util.extend(n,e);var r=OpenLayers.Util.getParameterString(n);OpenLayers.Util.isArray(i)&&(i=this.selectUrl(r,i));var o=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(i));for(var s in n)s.toUpperCase()in o&&delete n[s];return r=OpenLayers.Util.getParameterString(n),OpenLayers.Util.urlAppend(i,r)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"}),OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,grid:null,singleTile:!1,ratio:1.5,buffer:0,numLoadingTiles:0,tileLoadingDelay:100,timerId:null,initialize:function(e,t,i,n){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments),this.events.addEventType("tileloaded"),this.grid=[],this._moveGriddedTiles=OpenLayers.Function.bind(this.moveGriddedTiles,this)},removeMap:function(e){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)},destroy:function(){this.clearGrid(),this.grid=null,this.tileSize=null,OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var e=0,t=this.grid.length;e<t;e++)for(var i=this.grid[e],n=0,r=i.length;n<r;n++){var o=i[n];this.removeTileMonitoringHooks(o),o.destroy()}this.grid=[]}},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[e]),null!=this.tileSize&&(e.tileSize=this.tileSize.clone()),e.grid=[],e},moveTo:function(e,t,i){if(OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments),e=e||this.map.getExtent(),null!=e){var n=!this.grid.length||t,r=this.getTilesBounds();this.singleTile?(n||!i&&!r.containsBounds(e))&&this.initSingleTile(e):n||!r.containsBounds(e,!0)?this.initGriddedTiles(e):this.scheduleMoveGriddedTiles()}},moveByPx:function(e,t){this.singleTile||this.scheduleMoveGriddedTiles()},scheduleMoveGriddedTiles:function(){null!=this.timerId&&window.clearTimeout(this.timerId),this.timerId=window.setTimeout(this._moveGriddedTiles,this.tileLoadingDelay)},setTileSize:function(e){this.singleTile&&(e=this.map.getSize(),e.h=parseInt(e.h*this.ratio),e.w=parseInt(e.w*this.ratio)),OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[e])},getGridBounds:function(){var e="The getGridBounds() function is deprecated. It will be removed in 3.0. Please use getTilesBounds() instead.";return OpenLayers.Console.warn(e),this.getTilesBounds()},getTilesBounds:function(){var e=null;if(this.grid.length){var t=this.grid.length-1,i=this.grid[t][0],n=this.grid[0].length-1,r=this.grid[0][n];e=new OpenLayers.Bounds(i.bounds.left,i.bounds.bottom,r.bounds.right,r.bounds.top)}return e},initSingleTile:function(e){var t=e.getCenterLonLat(),i=e.getWidth()*this.ratio,n=e.getHeight()*this.ratio,r=new OpenLayers.Bounds(t.lon-i/2,t.lat-n/2,t.lon+i/2,t.lat+n/2),o=new OpenLayers.LonLat(r.left,r.top),s=this.map.getLayerPxFromLonLat(o);this.grid.length||(this.grid[0]=[]);var a=this.grid[0][0];a?a.moveTo(r,s):(a=this.addTile(r,s),this.addTileMonitoringHooks(a),a.draw(),this.grid[0][0]=a),this.removeExcessTiles(1,1)},calculateGridLayout:function(e,t,i){var n=i*this.tileSize.w,r=i*this.tileSize.h,o=e.left-t.lon,s=Math.floor(o/n)-this.buffer,a=o/n-s,l=-a*this.tileSize.w,h=t.lon+s*n,c=e.top-(t.lat+r),u=Math.ceil(c/r)+this.buffer,d=u-c/r,p=-d*this.tileSize.h,g=t.lat+u*r;return{tilelon:n,tilelat:r,tileoffsetlon:h,tileoffsetlat:g,tileoffsetx:l,tileoffsety:p}},getTileOrigin:function(){var e=this.tileOrigin;if(!e){var t=this.getMaxExtent(),i={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner];e=new OpenLayers.LonLat(t[i[0]],t[i[1]])}return e},initGriddedTiles:function(e){var t=this.map.getSize(),i=Math.ceil(t.h/this.tileSize.h)+Math.max(1,2*this.buffer),n=Math.ceil(t.w/this.tileSize.w)+Math.max(1,2*this.buffer),r=this.getTileOrigin(),o=this.map.getResolution(),s=this.calculateGridLayout(e,r,o),a=Math.round(s.tileoffsetx),l=Math.round(s.tileoffsety),h=s.tileoffsetlon,c=s.tileoffsetlat,u=s.tilelon,d=s.tilelat;this.origin=new OpenLayers.Pixel(a,l);var p=a,g=h,m=0,f=parseInt(this.map.layerContainerDiv.style.left),y=parseInt(this.map.layerContainerDiv.style.top);do{var _=this.grid[m++];_||(_=[],this.grid.push(_)),h=g,a=p;var v=0;do{var D=new OpenLayers.Bounds(h,c,h+u,c+d),b=a;b-=f;var L=l;L-=y;var C=new OpenLayers.Pixel(b,L),G=_[v++];G?G.moveTo(D,C,!1):(G=this.addTile(D,C),this.addTileMonitoringHooks(G),_.push(G)),h+=u,a+=this.tileSize.w}while(h<=e.right+u*this.buffer||v<n);c-=d,l+=this.tileSize.h}while(c>=e.bottom-d*this.buffer||m<i);this.removeExcessTiles(m,v),this.spiralTileLoad()},getMaxExtent:function(){return this.maxExtent},spiralTileLoad:function(){for(var e=[],t=["right","down","left","up"],i=0,n=-1,r=OpenLayers.Util.indexOf(t,"right"),o=0;o<t.length;){var s=i,a=n;switch(t[r]){case"right":a++;break;case"down":s++;break;case"left":a--;break;case"up":s--}var l=null;s<this.grid.length&&s>=0&&a<this.grid[0].length&&a>=0&&(l=this.grid[s][a]),null==l||l.queued?(r=(r+1)%4,o++):(e.unshift(l),l.queued=!0,o=0,i=s,n=a)}for(var h=0,c=e.length;h<c;h++){var l=e[h];l.draw(),l.queued=!1}},addTile:function(e,t){return new OpenLayers.Tile.Image(this,t,e,null,this.tileSize,this.tileOptions)},addTileMonitoringHooks:function(e){e.onLoadStart=function(){0==this.numLoadingTiles&&this.events.triggerEvent("loadstart"),this.numLoadingTiles++},e.events.register("loadstart",this,e.onLoadStart),e.onLoadEnd=function(){this.numLoadingTiles--,this.events.triggerEvent("tileloaded"),0==this.numLoadingTiles&&this.events.triggerEvent("loadend")},e.events.register("loadend",this,e.onLoadEnd),e.events.register("unload",this,e.onLoadEnd)},removeTileMonitoringHooks:function(e){e.unload(),e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,scope:this})},moveGriddedTiles:function(){var e=!0,t=this.buffer||1,i=this.grid[0][0].position,n=parseInt(this.map.layerContainerDiv.style.left),r=parseInt(this.map.layerContainerDiv.style.top),o=i.add(n,r);o.x>-this.tileSize.w*(t-1)?this.shiftColumn(!0):o.x<-this.tileSize.w*t?this.shiftColumn(!1):o.y>-this.tileSize.h*(t-1)?this.shiftRow(!0):o.y<-this.tileSize.h*t?this.shiftRow(!1):e=!1,e&&(this.timerId=window.setTimeout(this._moveGriddedTiles,0))},shiftRow:function(e){for(var t=e?0:this.grid.length-1,i=this.grid,n=i[t],r=this.map.getResolution(),o=e?-this.tileSize.h:this.tileSize.h,s=r*-o,a=e?i.pop():i.shift(),l=0,h=n.length;l<h;l++){var c=n[l],u=c.bounds.clone(),d=c.position.clone();u.bottom=u.bottom+s,u.top=u.top+s,d.y=d.y+o,a[l].moveTo(u,d)}e?i.unshift(a):i.push(a)},shiftColumn:function(e){for(var t=e?-this.tileSize.w:this.tileSize.w,i=this.map.getResolution(),n=i*t,r=0,o=this.grid.length;r<o;r++){var s=this.grid[r],a=e?0:s.length-1,l=s[a],h=l.bounds.clone(),c=l.position.clone();h.left=h.left+n,h.right=h.right+n,c.x=c.x+t;var u=e?this.grid[r].pop():this.grid[r].shift();u.moveTo(h,c),e?s.unshift(u):s.push(u)}},removeExcessTiles:function(e,t){for(;this.grid.length>e;)for(var i=this.grid.pop(),n=0,r=i.length;n<r;n++){var o=i[n];this.removeTileMonitoringHooks(o),o.destroy()}for(;this.grid[0].length>t;)for(var n=0,r=this.grid.length;n<r;n++){var i=this.grid[n],o=i.pop();this.removeTileMonitoringHooks(o),o.destroy()}},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(e){var t=this.maxExtent,i=this.getResolution(),n=i*this.tileSize.w,r=i*this.tileSize.h,o=this.getLonLatFromViewPortPx(e),s=t.left+n*Math.floor((o.lon-t.left)/n),a=t.bottom+r*Math.floor((o.lat-t.bottom)/r);return new OpenLayers.Bounds(s,a,s+n,a+r)},CLASS_NAME:"OpenLayers.Layer.Grid"}),OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],initialize:function(e){OpenLayers.Geometry.Collection.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"}),OpenLayers.Rico=OpenLayers.Rico||{},OpenLayers.Rico.Color=OpenLayers.Class({initialize:function(e,t,i){this.rgb={r:e,g:t,b:i}},setRed:function(e){this.rgb.r=e},setGreen:function(e){this.rgb.g=e},setBlue:function(e){this.rgb.b=e},setHue:function(e){var t=this.asHSB();t.h=e,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,t.b)},setSaturation:function(e){var t=this.asHSB();t.s=e,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,t.b)},setBrightness:function(e){var t=this.asHSB();t.b=e,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,t.b)},darken:function(e){var t=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,Math.max(t.b-e,0))},brighten:function(e){var t=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(t.h,t.s,Math.min(t.b+e,1))},blend:function(e){this.rgb.r=Math.floor((this.rgb.r+e.rgb.r)/2),this.rgb.g=Math.floor((this.rgb.g+e.rgb.g)/2),this.rgb.b=Math.floor((this.rgb.b+e.rgb.b)/2)},isBright:function(){this.asHSB();return this.asHSB().b>.5},isDark:function(){return!this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}}),OpenLayers.Rico.Color.createFromHex=function(e){if(4==e.length)for(var t=e,e="#",i=1;i<4;i++)e+=t.charAt(i)+t.charAt(i);0==e.indexOf("#")&&(e=e.substring(1));var n=e.substring(0,2),r=e.substring(2,4),o=e.substring(4,6);return new OpenLayers.Rico.Color(parseInt(n,16),parseInt(r,16),parseInt(o,16))},OpenLayers.Rico.Color.createColorFromBackground=function(e){var t=OpenLayers.Element.getStyle(OpenLayers.Util.getElement(e),"backgroundColor");if("transparent"==t&&e.parentNode)return OpenLayers.Rico.Color.createColorFromBackground(e.parentNode);if(null==t)return new OpenLayers.Rico.Color(255,255,255);if(0==t.indexOf("rgb(")){var i=t.substring(4,t.length-1),n=i.split(",");return new OpenLayers.Rico.Color(parseInt(n[0]),parseInt(n[1]),parseInt(n[2]))}return 0==t.indexOf("#")?OpenLayers.Rico.Color.createFromHex(t):new OpenLayers.Rico.Color(255,255,255)},OpenLayers.Rico.Color.HSBtoRGB=function(e,t,i){var n=0,r=0,o=0;if(0==t)n=parseInt(255*i+.5),r=n,o=n;else{var s=6*(e-Math.floor(e)),a=s-Math.floor(s),l=i*(1-t),h=i*(1-t*a),c=i*(1-t*(1-a));switch(parseInt(s)){case 0:n=255*i+.5,r=255*c+.5,o=255*l+.5;break;case 1:n=255*h+.5,r=255*i+.5,o=255*l+.5;break;case 2:n=255*l+.5,r=255*i+.5,o=255*c+.5;break;case 3:n=255*l+.5,r=255*h+.5,o=255*i+.5;break;case 4:n=255*c+.5,r=255*l+.5,o=255*i+.5;break;case 5:n=255*i+.5,r=255*l+.5,o=255*h+.5}}return{r:parseInt(n),g:parseInt(r),b:parseInt(o)}},OpenLayers.Rico.Color.RGBtoHSB=function(e,t,i){var n,r,o,s=e>t?e:t;i>s&&(s=i);var a=e<t?e:t;if(i<a&&(a=i),o=s/255,r=0!=s?(s-a)/s:0,0==r)n=0;else{var l=(s-e)/(s-a),h=(s-t)/(s-a),c=(s-i)/(s-a);n=e==s?c-h:t==s?2+l-c:4+h-l,n/=6,n<0&&(n+=1)}return{h:n,s:r,b:o}},OpenLayers.Tile=OpenLayers.Class({EVENT_TYPES:["loadstart","loadend","reload","unload"],events:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(e,t,i,n,r,o){this.layer=e,this.position=t.clone(),this.bounds=i.clone(),this.url=n,r&&(this.size=r.clone()),this.id=OpenLayers.Util.createUniqueID("Tile_"),this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES),OpenLayers.Util.extend(this,o)},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.layer=null,this.bounds=null,this.size=null,this.position=null,this.events.destroy(),this.events=null},clone:function(e){return null==e&&(e=new OpenLayers.Tile(this.layer,this.position,this.bounds,this.url,this.size)),OpenLayers.Util.applyDefaults(e,this),e},draw:function(){var e=this.layer.maxExtent,t=e&&this.bounds.intersectsBounds(e,!1);return this.shouldDraw=t||this.layer.displayOutsideMaxExtent,this.clear(),this.shouldDraw},moveTo:function(e,t,i){null==i&&(i=!0),this.bounds=e.clone(),this.position=t.clone(),i&&this.draw()},clear:function(){},getBoundsFromBaseLayer:function(e){var t=OpenLayers.i18n("reprojectDeprecated",{layerName:this.layer.name});OpenLayers.Console.warn(t);var i=this.layer.map.getLonLatFromLayerPx(e),n=e.clone();n.x+=this.size.w,n.y+=this.size.h;var r=this.layer.map.getLonLatFromLayerPx(n);i.lon>r.lon&&(i.lon<0?i.lon=-180-(i.lon+180):r.lon=180+r.lon+180);var o=new OpenLayers.Bounds(i.lon,r.lat,r.lon,i.lat);return o},showTile:function(){this.shouldDraw&&this.show()},show:function(){},hide:function(){},CLASS_NAME:"OpenLayers.Tile"}),OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,layerAlphaHack:null,isBackBuffer:!1,isFirstDraw:!0,backBufferTile:null,maxGetUrlLength:null,initialize:function(e,t,i,n,r,o){OpenLayers.Tile.prototype.initialize.apply(this,arguments),null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame),this.url=n,this.frame=document.createElement("div"),this.frame.style.overflow="hidden",this.frame.style.position="absolute",this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack()},destroy:function(){null!=this.imgDiv&&this.removeImgDiv(),this.imgDiv=null,null!=this.frame&&this.frame.parentNode==this.layer.div&&this.layer.div.removeChild(this.frame),this.frame=null,this.backBufferTile&&(this.backBufferTile.destroy(),this.backBufferTile=null),this.layer.events.unregister("loadend",this,this.resetBackBuffer),OpenLayers.Tile.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Tile.Image(this.layer,this.position,this.bounds,this.url,this.size)),e=OpenLayers.Tile.prototype.clone.apply(this,[e]),e.imgDiv=null,e},draw:function(){this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position));var e=OpenLayers.Tile.prototype.draw.apply(this,arguments);return OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1||this.layer.singleTile?e?(this.backBufferTile||(this.backBufferTile=this.clone(),this.backBufferTile.hide(),this.backBufferTile.isBackBuffer=!0,this.events.register("loadend",this,this.resetBackBuffer),this.layer.events.register("loadend",this,this.resetBackBuffer)),this.startTransition()):this.backBufferTile&&this.backBufferTile.clear():e&&this.isFirstDraw&&(this.events.register("loadend",this,this.showTile),this.isFirstDraw=!1),!!e&&(this.isLoading?this.events.triggerEvent("reload"):(this.isLoading=!0,this.events.triggerEvent("loadstart")),this.renderTile())},resetBackBuffer:function(){if(this.showTile(),this.backBufferTile&&(this.isFirstDraw||!this.layer.numLoadingTiles)){this.isFirstDraw=!1;var e=this.layer.maxExtent,t=e&&this.bounds.intersectsBounds(e,!1);t&&(this.backBufferTile.position=this.position,this.backBufferTile.bounds=this.bounds,this.backBufferTile.size=this.size,this.backBufferTile.imageSize=this.layer.getImageSize(this.bounds)||this.size,this.backBufferTile.imageOffset=this.layer.imageOffset,this.backBufferTile.resolution=this.layer.getResolution(),this.backBufferTile.renderTile()),this.backBufferTile.hide()}},renderTile:function(){return this.layer.async?(this.initImgDiv(),this.layer.getURLasync(this.bounds,this,"url",this.positionImage)):(this.url=this.layer.getURL(this.bounds),this.initImgDiv(),this.positionImage()),!0},positionImage:function(){if(null!==this.layer){OpenLayers.Util.modifyDOMElement(this.frame,null,this.position,this.size);var e=this.layer.getImageSize(this.bounds);this.layerAlphaHack?OpenLayers.Util.modifyAlphaImageDiv(this.imgDiv,null,null,e,this.url):(OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,e),this.imgDiv.src=this.url)}},clear:function(){this.imgDiv&&(this.hide(),OpenLayers.Tile.Image.useBlankTile&&(this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif"))},initImgDiv:function(){if(null==this.imgDiv){var e=this.layer.imageOffset,t=this.layer.getImageSize(this.bounds);this.layerAlphaHack?this.imgDiv=OpenLayers.Util.createAlphaImageDiv(null,e,t,null,"relative",null,null,null,!0):this.imgDiv=OpenLayers.Util.createImage(null,e,t,null,"relative",null,null,!0),OpenLayers.Util.isArray(this.layer.url)&&(this.imgDiv.urls=this.layer.url.slice()),this.imgDiv.className="olTileImage",this.imgDiv.onselectstart=function(){return!1},this.imgDiv.setAttribute("unselectable","on",0),this.frame.style.zIndex=this.isBackBuffer?0:1,this.frame.appendChild(this.imgDiv),this.layer.div.appendChild(this.frame),null!=this.layer.opacity&&OpenLayers.Util.modifyDOMElement(this.imgDiv,null,null,null,null,null,null,this.layer.opacity),this.imgDiv.map=this.layer.map;var i=function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("loadend"))};this.layerAlphaHack?OpenLayers.Event.observe(this.imgDiv.childNodes[0],"load",OpenLayers.Function.bind(i,this)):OpenLayers.Event.observe(this.imgDiv,"load",OpenLayers.Function.bind(i,this));
var n=function(){this.imgDiv._attempts>OpenLayers.IMAGE_RELOAD_ATTEMPTS&&i.call(this)};OpenLayers.Event.observe(this.imgDiv,"error",OpenLayers.Function.bind(n,this))}this.imgDiv.viewRequestID=this.layer.map.viewRequestID},removeImgDiv:function(){OpenLayers.Event.stopObservingElement(this.imgDiv),this.imgDiv.parentNode==this.frame&&(this.frame.removeChild(this.imgDiv),this.imgDiv.map=null),this.imgDiv.urls=null;var e=this.imgDiv.firstChild;e?(OpenLayers.Event.stopObservingElement(e),this.imgDiv.removeChild(e),delete e):this.imgDiv.src=OpenLayers.Util.getImagesLocation()+"blank.gif"},checkImgURL:function(){if(this.layer){var e=this.layerAlphaHack?this.imgDiv.firstChild.src:this.imgDiv.src;OpenLayers.Util.isEquivalentUrl(e,this.url)||this.hide()}},startTransition:function(){if(this.backBufferTile&&this.backBufferTile.imgDiv){var e=1;if(this.backBufferTile.resolution&&(e=this.backBufferTile.resolution/this.layer.getResolution()),1!=e){if("resize"==this.layer.transitionEffect){var t=new OpenLayers.LonLat(this.backBufferTile.bounds.left,this.backBufferTile.bounds.top),i=new OpenLayers.Size(this.backBufferTile.size.w*e,this.backBufferTile.size.h*e),n=this.layer.map.getLayerPxFromLonLat(t);OpenLayers.Util.modifyDOMElement(this.backBufferTile.frame,null,n,i);var r=this.backBufferTile.imageSize;r=new OpenLayers.Size(r.w*e,r.h*e);var o=this.backBufferTile.imageOffset;o&&(o=new OpenLayers.Pixel(o.x*e,o.y*e)),OpenLayers.Util.modifyDOMElement(this.backBufferTile.imgDiv,null,o,r),this.backBufferTile.show()}}else this.layer.singleTile?this.backBufferTile.show():this.backBufferTile.hide()}},show:function(){this.frame.style.display="",OpenLayers.Util.indexOf(this.layer.SUPPORTED_TRANSITIONS,this.layer.transitionEffect)!=-1&&OpenLayers.IS_GECKO===!0&&(this.frame.scrollLeft=this.frame.scrollLeft)},hide:function(){this.frame.style.display="none"},CLASS_NAME:"OpenLayers.Tile.Image"}),OpenLayers.Tile.Image.useBlankTile="safari"==OpenLayers.BROWSER_NAME||"opera"==OpenLayers.BROWSER_NAME,OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(e,t){if(this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])},e instanceof OpenLayers.Style)this.styles["default"]=e,this.styles.select=e,this.styles.temporary=e,this.styles["delete"]=e;else if("object"==typeof e)for(var i in e)if(e[i]instanceof OpenLayers.Style)this.styles[i]=e[i];else{if("object"!=typeof e[i]){this.styles["default"]=new OpenLayers.Style(e),this.styles.select=new OpenLayers.Style(e),this.styles.temporary=new OpenLayers.Style(e),this.styles["delete"]=new OpenLayers.Style(e);break}this.styles[i]=new OpenLayers.Style(e[i])}OpenLayers.Util.extend(this,t)},destroy:function(){for(var e in this.styles)this.styles[e].destroy();this.styles=null},createSymbolizer:function(e,t){e||(e=new OpenLayers.Feature.Vector),this.styles[t]||(t="default"),e.renderIntent=t;var i={};return this.extendDefault&&"default"!=t&&(i=this.styles["default"].createSymbolizer(e)),OpenLayers.Util.extend(i,this.styles[t].createSymbolizer(e))},addUniqueValueRules:function(e,t,i,n){var r=[];for(var o in i)r.push(new OpenLayers.Rule({symbolizer:i[o],context:n,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:t,value:o})}));this.styles[e].addRules(r)},CLASS_NAME:"OpenLayers.StyleMap"}),OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{EVENT_TYPES:["beforefeatureadded","beforefeaturesadded","featureadded","featuresadded","beforefeatureremoved","beforefeaturesremoved","featureremoved","featuresremoved","beforefeatureselected","featureselected","featureunselected","beforefeaturemodified","featuremodified","afterfeaturemodified","vertexmodified","vertexremoved","sketchstarted","sketchmodified","sketchcomplete","refresh"],isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,initialize:function(e,t){if(this.EVENT_TYPES=OpenLayers.Layer.Vector.prototype.EVENT_TYPES.concat(OpenLayers.Layer.prototype.EVENT_TYPES),OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.renderer&&this.renderer.supported()||this.assignRenderer(),this.renderer&&this.renderer.supported()||(this.renderer=null,this.displayError()),this.styleMap||(this.styleMap=new OpenLayers.StyleMap),this.features=[],this.selectedFeatures=[],this.unrenderedFeatures={},this.strategies)for(var i=0,n=this.strategies.length;i<n;i++)this.strategies[i].setLayer(this)},destroy:function(){if(this.strategies){var e,t,i;for(t=0,i=this.strategies.length;t<i;t++)e=this.strategies[t],e.autoDestroy&&e.destroy();this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null),this.destroyFeatures(),this.features=null,this.selectedFeatures=null,this.unrenderedFeatures=null,this.renderer&&this.renderer.destroy(),this.renderer=null,this.geometryType=null,this.drawn=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){null==e&&(e=new OpenLayers.Layer.Vector(this.name,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e]);for(var t=this.features,i=t.length,n=new Array(i),r=0;r<i;++r)n[r]=t[r].clone();return e.features=n,e},refresh:function(e){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",e)},assignRenderer:function(){for(var e=0,t=this.renderers.length;e<t;e++){var i=this.renderers[e],n="function"==typeof i?i:OpenLayers.Renderer[i];if(n&&n.prototype.supported()){this.renderer=new n(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(e){OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.renderer?(this.renderer.map=this.map,this.renderer.setSize(this.map.getSize())):this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var e,t,i;for(t=0,i=this.strategies.length;t<i;t++)e=this.strategies[t],e.autoActivate&&e.activate()}},removeMap:function(e){if(this.drawn=!1,this.strategies){var t,i,n;for(i=0,n=this.strategies.length;i<n;i++)t=this.strategies[i],t.autoActivate&&t.deactivate()}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments),this.renderer.setSize(this.map.getSize())},moveTo:function(e,t,i){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var n=OpenLayers.Renderer.NG&&this.renderer instanceof OpenLayers.Renderer.NG;if(n)i||this.renderer.updateDimensions(t);else{var r=!0;if(!i){this.renderer.root.style.visibility="hidden",this.div.style.left=-parseInt(this.map.layerContainerDiv.style.left)+"px",this.div.style.top=-parseInt(this.map.layerContainerDiv.style.top)+"px";var o=this.map.getExtent();if(r=this.renderer.setExtent(o,t),this.renderer.root.style.visibility="visible",OpenLayers.IS_GECKO===!0&&(this.div.scrollLeft=this.div.scrollLeft),!t&&r)for(var s in this.unrenderedFeatures){var a=this.unrenderedFeatures[s];this.drawFeature(a)}}}if(!this.drawn||!n&&(t||!r)){this.drawn=!0;for(var a,s=0,l=this.features.length;s<l;s++)this.renderer.locked=s!==l-1,a=this.features[s],this.drawFeature(a)}},redraw:function(){return OpenLayers.Renderer.NG&&this.renderer instanceof OpenLayers.Renderer.NG&&(this.drawn=!1),OpenLayers.Layer.prototype.redraw.apply(this,arguments)},display:function(e){OpenLayers.Layer.prototype.display.apply(this,arguments);var t=this.div.style.display;t!=this.renderer.root.style.display&&(this.renderer.root.style.display=t)},addFeatures:function(e,t){OpenLayers.Util.isArray(e)||(e=[e]);var i=!t||!t.silent;if(i){var n={features:e},r=this.events.triggerEvent("beforefeaturesadded",n);if(r===!1)return;e=n.features}for(var o=[],s=0,a=e.length;s<a;s++){s!=e.length-1?this.renderer.locked=!0:this.renderer.locked=!1;var l=e[s];if(this.geometryType&&!(l.geometry instanceof this.geometryType)){var h=OpenLayers.i18n("componentShouldBe",{geomType:this.geometryType.prototype.CLASS_NAME});throw h}if(l.layer=this,!l.style&&this.style&&(l.style=OpenLayers.Util.extend({},this.style)),i){if(this.events.triggerEvent("beforefeatureadded",{feature:l})===!1)continue;this.preFeatureInsert(l)}o.push(l),this.features.push(l),this.drawFeature(l),i&&(this.events.triggerEvent("featureadded",{feature:l}),this.onFeatureInsert(l))}i&&this.events.triggerEvent("featuresadded",{features:o})},removeFeatures:function(e,t){if(e&&0!==e.length){if(e===this.features)return this.removeAllFeatures(t);OpenLayers.Util.isArray(e)||(e=[e]),e===this.selectedFeatures&&(e=e.slice());var i=!t||!t.silent;i&&this.events.triggerEvent("beforefeaturesremoved",{features:e});for(var n=e.length-1;n>=0;n--){0!=n&&e[n-1].geometry?this.renderer.locked=!0:this.renderer.locked=!1;var r=e[n];delete this.unrenderedFeatures[r.id],i&&this.events.triggerEvent("beforefeatureremoved",{feature:r}),this.features=OpenLayers.Util.removeItem(this.features,r),r.layer=null,r.geometry&&this.renderer.eraseFeatures(r),OpenLayers.Util.indexOf(this.selectedFeatures,r)!=-1&&OpenLayers.Util.removeItem(this.selectedFeatures,r),i&&this.events.triggerEvent("featureremoved",{feature:r})}i&&this.events.triggerEvent("featuresremoved",{features:e})}},removeAllFeatures:function(e){var t=!e||!e.silent,i=this.features;t&&this.events.triggerEvent("beforefeaturesremoved",{features:i});for(var n,r=i.length-1;r>=0;r--)n=i[r],t&&this.events.triggerEvent("beforefeatureremoved",{feature:n}),n.layer=null,t&&this.events.triggerEvent("featureremoved",{feature:n});this.renderer.clear(),this.features=[],this.unrenderedFeatures={},this.selectedFeatures=[],t&&this.events.triggerEvent("featuresremoved",{features:i})},destroyFeatures:function(e,t){var i=void 0==e;if(i&&(e=this.features),e){this.removeFeatures(e,t);for(var n=e.length-1;n>=0;n--)e[n].destroy()}},drawFeature:function(e,t){if(this.drawn){if("object"!=typeof t){t||e.state!==OpenLayers.State.DELETE||(t="delete");var i=t||e.renderIntent;t=e.style||this.style,t||(t=this.styleMap.createSymbolizer(e,i))}var n=this.renderer.drawFeature(e,t);n===!1||null===n?this.unrenderedFeatures[e.id]=e:delete this.unrenderedFeatures[e.id]}},eraseFeatures:function(e){this.renderer.eraseFeatures(e)},getFeatureFromEvent:function(e){if(!this.renderer)return OpenLayers.Console.error(OpenLayers.i18n("getFeatureError")),null;var t=null,i=this.renderer.getFeatureIdFromEvent(e);return i&&(t="string"==typeof i?this.getFeatureById(i):i),t},getFeatureBy:function(e,t){for(var i=null,n=0,r=this.features.length;n<r;++n)if(this.features[n][e]==t){i=this.features[n];break}return i},getFeatureById:function(e){return this.getFeatureBy("id",e)},getFeatureByFid:function(e){return this.getFeatureBy("fid",e)},getFeaturesByAttribute:function(e,t){var i,n,r=this.features.length,o=[];for(i=0;i<r;i++)n=this.features[i],n&&n.attributes&&n.attributes[e]===t&&o.push(n);return o},onFeatureInsert:function(e){},preFeatureInsert:function(e){},getDataExtent:function(){var e=null,t=this.features;if(t&&t.length>0)for(var i=null,n=0,r=t.length;n<r;n++)i=t[n].geometry,i&&(null===e&&(e=new OpenLayers.Bounds),e.extend(i.getBounds()));return e},CLASS_NAME:"OpenLayers.Layer.Vector"}),OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(e,t,i){(i&&i.sphericalMercator||this.sphericalMercator)&&(i=OpenLayers.Util.extend({maxExtent:new OpenLayers.Bounds((-20037508.34),(-20037508.34),20037508.34,20037508.34),maxResolution:156543.03390625,numZoomLevels:19,units:"m",projection:"EPSG:900913"},i)),t=t||this.url,e=e||this.name;var n=[e,t,{},i];OpenLayers.Layer.Grid.prototype.initialize.apply(this,n)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){var t=this.getXYZ(e),i=this.url;if(OpenLayers.Util.isArray(i)){var n=""+t.x+t.y+t.z;i=this.selectUrl(n,i)}return OpenLayers.String.format(i,t)},getXYZ:function(e){var t=this.map.getResolution(),i=Math.round((e.left-this.maxExtent.left)/(t*this.tileSize.w)),n=Math.round((this.maxExtent.top-e.top)/(t*this.tileSize.h)),r=null!=this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,t):this.map.getZoom()+this.zoomOffset,o=Math.pow(2,r);return this.wrapDateLine&&(i=(i%o+o)%o),{x:i,y:n,z:r}},setMap:function(e){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"}),OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",attribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>",sphericalMercator:!0,url:"http://tile.openstreetmap.org/${z}/${x}/${y}.png",clone:function(e){return null==e&&(e=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e])},wrapDateLine:!0,CLASS_NAME:"OpenLayers.Layer.OSM"}),OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(e){OpenLayers.Util.extend(this,e),this.options=e,this.active=!1},destroy:function(){this.deactivate(),this.layer=null,this.options=null},setLayer:function(e){this.layer=e},activate:function(){return!this.active&&(this.active=!0,!0)},deactivate:function(){return!!this.active&&(this.active=!1,!0)},CLASS_NAME:"OpenLayers.Strategy"}),OpenLayers.Strategy.Refresh=OpenLayers.Class(OpenLayers.Strategy,{force:!1,interval:0,timer:null,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);return e&&(this.layer.visibility===!0&&this.start(),this.layer.events.on({visibilitychanged:this.reset,scope:this})),e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&this.stop(),e},reset:function(){this.layer.visibility===!0?this.start():this.stop()},start:function(){this.interval&&"number"==typeof this.interval&&this.interval>0&&(this.timer=window.setInterval(OpenLayers.Function.bind(this.refresh,this),this.interval))},refresh:function(){this.layer&&this.layer.refresh&&"function"==typeof this.layer.refresh&&this.layer.refresh({force:this.force})},stop:function(){null!==this.timer&&(window.clearInterval(this.timer),this.timer=null)},CLASS_NAME:"OpenLayers.Strategy.Refresh"}),OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.root=document.createElement("canvas"),this.container.appendChild(this.root),this.canvas=this.root.getContext("2d"),this.features={},this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},eraseGeometry:function(e,t){this.eraseFeatures(this.features[t][0])},supported:function(){var e=document.createElement("canvas");return!!e.getContext},setSize:function(e){this.size=e.clone();var t=this.root;if(t.style.width=e.w+"px",t.style.height=e.h+"px",t.width=e.w,t.height=e.h,this.resolution=null,this.hitDetection){var i=this.hitCanvas;i.style.width=e.w+"px",i.style.height=e.h+"px",i.width=e.w,i.height=e.h}},drawFeature:function(e,t){var i;if(e.geometry){t=this.applyDefaultSymbolizer(t||e.style);var n=e.geometry.getBounds();i="none"!==t.display&&!!n&&n.intersectsBounds(this.extent),i?this.features[e.id]=[e,t]:delete this.features[e.id],this.pendingRedraw=!0}return this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1),i},drawGeometry:function(e,t,i){var n=e.CLASS_NAME;if("OpenLayers.Geometry.Collection"!=n&&"OpenLayers.Geometry.MultiPoint"!=n&&"OpenLayers.Geometry.MultiLineString"!=n&&"OpenLayers.Geometry.MultiPolygon"!=n)switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(e,t,i);break;case"OpenLayers.Geometry.LineString":this.drawLineString(e,t,i);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(e,t,i);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(e,t,i)}else for(var r=0;r<e.components.length;r++)this.drawGeometry(e.components[r],t,i)},drawExternalGraphic:function(e,t,i){var n=new Image;t.graphicTitle&&(n.title=t.graphicTitle);var r=t.graphicWidth||t.graphicHeight,o=t.graphicHeight||t.graphicWidth;r=r?r:2*t.pointRadius,o=o?o:2*t.pointRadius;var s=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*r),a=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*o),l=t.graphicOpacity||t.fillOpacity,h=function(){if(this.features[i]){var t=this.getLocalXY(e),h=t[0],c=t[1];if(!isNaN(h)&&!isNaN(c)){var u=h+s|0,d=c+a|0,p=this.canvas;p.globalAlpha=l;var g=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);p.drawImage(n,u*g,d*g,r*g,o*g),this.hitDetection&&(this.setHitContextStyle("fill",i),this.hitContext.fillRect(u,d,r,o))}}};n.onload=OpenLayers.Function.bind(h,this),n.src=t.externalGraphic},setCanvasStyle:function(e,t){"fill"===e?(this.canvas.globalAlpha=t.fillOpacity,this.canvas.fillStyle=t.fillColor):"stroke"===e?(this.canvas.globalAlpha=t.strokeOpacity,this.canvas.strokeStyle=t.strokeColor,this.canvas.lineWidth=t.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(e){var t=Number(e.split("_").pop())+1;t>=16777216&&(this.hitOverflow=t-16777215,t=t%16777216+1);var i="000000"+t.toString(16),n=i.length;return i="#"+i.substring(n-6,n)},setHitContextStyle:function(e,t,i){var n=this.featureIdToHex(t);"fill"==e?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=n):"stroke"==e?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=n,this.hitContext.lineWidth=i.strokeWidth+2):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(e,t,i){if(t.graphic!==!1)if(t.externalGraphic)this.drawExternalGraphic(e,t,i);else{var n=this.getLocalXY(e),r=n[0],o=n[1];if(!isNaN(r)&&!isNaN(o)){var s=2*Math.PI,a=t.pointRadius;t.fill!==!1&&(this.setCanvasStyle("fill",t),this.canvas.beginPath(),this.canvas.arc(r,o,a,0,s,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",i,t),this.hitContext.beginPath(),this.hitContext.arc(r,o,a,0,s,!0),this.hitContext.fill())),t.stroke!==!1&&(this.setCanvasStyle("stroke",t),this.canvas.beginPath(),this.canvas.arc(r,o,a,0,s,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",i,t),this.hitContext.beginPath(),this.hitContext.arc(r,o,a,0,s,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}},drawLineString:function(e,t,i){t=OpenLayers.Util.applyDefaults({fill:!1},t),this.drawLinearRing(e,t,i)},drawLinearRing:function(e,t,i){t.fill!==!1&&(this.setCanvasStyle("fill",t),this.renderPath(this.canvas,e,t,i,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",i,t),this.renderPath(this.hitContext,e,t,i,"fill"))),t.stroke!==!1&&(this.setCanvasStyle("stroke",t),this.renderPath(this.canvas,e,t,i,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",i,t),this.renderPath(this.hitContext,e,t,i,"stroke"))),this.setCanvasStyle("reset")},renderPath:function(e,t,i,n,r){var o=t.components,s=o.length;e.beginPath();var a=this.getLocalXY(o[0]),l=a[0],h=a[1];if(!isNaN(l)&&!isNaN(h)){e.moveTo(a[0],a[1]);for(var c=1;c<s;++c){var u=this.getLocalXY(o[c]);e.lineTo(u[0],u[1])}"fill"===r?e.fill():e.stroke()}},drawPolygon:function(e,t,i){var n=e.components,r=n.length;this.drawLinearRing(n[0],t,i);for(var o=1;o<r;++o)this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(n[o],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},t),i),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(n[o],OpenLayers.Util.applyDefaults({fill:!1},t),i)},drawText:function(e,t){t=OpenLayers.Util.extend({fontColor:"#000000",labelAlign:"cm"},t);var i=this.getLocalXY(e);this.setCanvasStyle("reset"),this.canvas.fillStyle=t.fontColor,this.canvas.globalAlpha=t.fontOpacity||1;var n=[t.fontStyle?t.fontStyle:"normal","normal",t.fontWeight?t.fontWeight:"normal",t.fontSize?t.fontSize:"1em",t.fontFamily?t.fontFamily:"sans-serif"].join(" "),r=t.label.split("\n"),o=r.length;if(this.canvas.fillText){this.canvas.font=n,this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[0]]||"center",this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[1]]||"middle";var s=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];null==s&&(s=-.5);var a=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;i[1]+=a*s*(o-1);for(var l=0;l<o;l++)this.canvas.fillText(r[l],i[0],i[1]+a*l)}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=n;var h=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[0]];null==h&&(h=-.5);var s=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];null==s&&(s=-.5);var a=this.canvas.mozMeasureText("xx");i[1]+=a*(1+s*o);for(var l=0;l<o;l++){var c=i[0]+h*this.canvas.mozMeasureText(r[l]),u=i[1]+l*a;this.canvas.translate(c,u),this.canvas.mozDrawText(r[l]),this.canvas.translate(-c,-u)}}this.setCanvasStyle("reset")},getLocalXY:function(e){var t=this.getResolution(),i=this.extent,n=e.x/t+-i.left/t,r=i.top/t-e.y/t;return[n,r]},clear:function(){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e),this.features={},this.hitDetection&&this.hitContext.clearRect(0,0,t,e)},getFeatureIdFromEvent:function(e){var t=null;if(this.hitDetection&&!this.map.dragging){var i=e.xy,n=0|i.x,r=0|i.y,o=this.hitContext.getImageData(n,r,1,1).data;if(255===o[3]){var s=o[2]+256*(o[1]+256*o[0]);s&&(t=this.features["OpenLayers.Feature.Vector_"+(s-1+this.hitOverflow)][0])}}return t},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0;t<e.length;++t)delete this.features[e[t].id];this.redraw()},redraw:function(){if(!this.locked){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e),this.hitDetection&&this.hitContext.clearRect(0,0,t,e);var i,n,r=[];for(var o in this.features)this.features.hasOwnProperty(o)&&(i=this.features[o][0],n=this.features[o][1],this.drawGeometry(i.geometry,n,i.id),n.label&&r.push([i,n]));for(var s,a=0,l=r.length;a<l;++a)s=r[a],this.drawText(s[0].geometry.getCentroid(),s[1])}},CLASS_NAME:"OpenLayers.Renderer.Canvas"}),OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"},OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1},OpenLayers.Renderer.Canvas.drawImageScaleFactor=null,OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,initialize:function(e){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){var e="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(e+"SVG","1.1")||document.implementation.hasFeature(e+"BasicStructure","1.1"))},inValidRange:function(e,t,i){var n=e+(i?0:this.translationParameters.x),r=t+(i?0:this.translationParameters.y);return n>=-this.MAX_PIXEL&&n<=this.MAX_PIXEL&&r>=-this.MAX_PIXEL&&r<=this.MAX_PIXEL},setExtent:function(e,t){OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments);var i=this.getResolution(),n=-e.left/i,r=e.top/i;if(t){this.left=n,this.top=r;var o="0 0 "+this.size.w+" "+this.size.h;return this.rendererRoot.setAttributeNS(null,"viewBox",o),this.translate(0,0),!0}var s=this.translate(n-this.left,r-this.top);return s||this.setExtent(e,!0),s},translate:function(e,t){if(this.inValidRange(e,t,!0)){var i="";return(e||t)&&(i="translate("+e+","+t+")"),this.root.setAttributeNS(null,"transform",i),this.translationParameters={x:e,y:t},!0}return!1},setSize:function(e){OpenLayers.Renderer.prototype.setSize.apply(this,arguments),this.rendererRoot.setAttributeNS(null,"width",this.size.w),this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(e,t){var i=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":i=t.externalGraphic?"image":this.isComplexSymbol(t.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":i="rect";break;case"OpenLayers.Geometry.LineString":i="polyline";break;case"OpenLayers.Geometry.LinearRing":i="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":case"OpenLayers.Geometry.Surface":i="path"}return i},setStyle:function(e,t,i){t=t||e._style,i=i||e._options;var n,r=parseFloat(e.getAttributeNS(null,"r")),o=1;if("OpenLayers.Geometry.Point"==e._geometryClass&&r){if(e.style.visibility="",t.graphic===!1)e.style.visibility="hidden";else if(t.externalGraphic){if(n=this.getPosition(e),t.graphicTitle){e.setAttributeNS(null,"title",t.graphicTitle);var s=this.nodeFactory(null,"title");s.textContent=t.graphicTitle,e.appendChild(s)}t.graphicWidth&&t.graphicHeight&&e.setAttributeNS(null,"preserveAspectRatio","none");var a=t.graphicWidth||t.graphicHeight,l=t.graphicHeight||t.graphicWidth;a=a?a:2*t.pointRadius,l=l?l:2*t.pointRadius;var h=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*a),c=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*l),u=t.graphicOpacity||t.fillOpacity;e.setAttributeNS(null,"x",(n.x+h).toFixed()),e.setAttributeNS(null,"y",(n.y+c).toFixed()),e.setAttributeNS(null,"width",a),e.setAttributeNS(null,"height",l),e.setAttributeNS(this.xlinkns,"href",t.externalGraphic),e.setAttributeNS(null,"style","opacity: "+u),e.onclick=OpenLayers.Renderer.SVG.preventDefault}else if(this.isComplexSymbol(t.graphicName)){var d=3*t.pointRadius,p=2*d,g=this.importSymbol(t.graphicName);n=this.getPosition(e),o=3*this.symbolMetrics[g.id][0]/p;var m=e.parentNode,f=e.nextSibling;m&&m.removeChild(e),e.firstChild&&e.removeChild(e.firstChild),e.appendChild(g.firstChild.cloneNode(!0)),e.setAttributeNS(null,"viewBox",g.getAttributeNS(null,"viewBox")),e.setAttributeNS(null,"width",p),e.setAttributeNS(null,"height",p),e.setAttributeNS(null,"x",n.x-d),e.setAttributeNS(null,"y",n.y-d),f?m.insertBefore(e,f):m&&m.appendChild(e)}else e.setAttributeNS(null,"r",t.pointRadius);var y=t.rotation;if((void 0!==y||void 0!==e._rotation)&&n)if(e._rotation=y,y|=0,"svg"!==e.nodeName)e.setAttributeNS(null,"transform","rotate("+y+" "+n.x+" "+n.y+")");else{var _=this.symbolMetrics[g.id];e.firstChild.setAttributeNS(null,"transform","rotate("+y+" "+_[1]+" "+_[2]+")")}}return i.isFilled?(e.setAttributeNS(null,"fill",t.fillColor),e.setAttributeNS(null,"fill-opacity",t.fillOpacity)):e.setAttributeNS(null,"fill","none"),i.isStroked?(e.setAttributeNS(null,"stroke",t.strokeColor),e.setAttributeNS(null,"stroke-opacity",t.strokeOpacity),e.setAttributeNS(null,"stroke-width",t.strokeWidth*o),e.setAttributeNS(null,"stroke-linecap",t.strokeLinecap||"round"),e.setAttributeNS(null,"stroke-linejoin","round"),t.strokeDashstyle&&e.setAttributeNS(null,"stroke-dasharray",this.dashStyle(t,o))):e.setAttributeNS(null,"stroke","none"),t.pointerEvents&&e.setAttributeNS(null,"pointer-events",t.pointerEvents),null!=t.cursor&&e.setAttributeNS(null,"cursor",t.cursor),e},dashStyle:function(e,t){var i=e.strokeWidth*t,n=e.strokeDashstyle;switch(n){case"solid":return"none";case"dot":return[1,4*i].join();case"dash":return[4*i,4*i].join();case"dashdot":return[4*i,4*i,1,4*i].join();case"longdash":return[8*i,4*i].join();case"longdashdot":return[8*i,4*i,1,4*i].join();default:return OpenLayers.String.trim(n).replace(/\s+/g,",")}},createNode:function(e,t){var i=document.createElementNS(this.xmlns,e);return t&&i.setAttributeNS(null,"id",t),i},nodeTypeCompare:function(e,t){return t==e.nodeName},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_svgRoot","svg")},createRoot:function(e){return this.nodeFactory(this.container.id+e,"g")},createDefs:function(){var e=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(e),e},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,i){var n=this.getResolution(),r=t.x/n+this.left,o=this.top-t.y/n;return!!this.inValidRange(r,o)&&(e.setAttributeNS(null,"cx",r),e.setAttributeNS(null,"cy",o),e.setAttributeNS(null,"r",i),e)},drawLineString:function(e,t){var i=this.getComponentsString(t.components);return!!i.path&&(e.setAttributeNS(null,"points",i.path),i.complete?e:null)},drawLinearRing:function(e,t){var i=this.getComponentsString(t.components);return!!i.path&&(e.setAttributeNS(null,"points",i.path),i.complete?e:null)},drawPolygon:function(e,t){for(var i,n,r="",o=!0,s=!0,a=0,l=t.components.length;a<l;a++)r+=" M",i=this.getComponentsString(t.components[a].components," "),n=i.path,n?(r+=" "+n,s=i.complete&&s):o=!1;return r+=" z",!!o&&(e.setAttributeNS(null,"d",r),e.setAttributeNS(null,"fill-rule","evenodd"),s?e:null)},drawRectangle:function(e,t){var i=this.getResolution(),n=t.x/i+this.left,r=this.top-t.y/i;return!!this.inValidRange(n,r)&&(e.setAttributeNS(null,"x",n),e.setAttributeNS(null,"y",r),e.setAttributeNS(null,"width",t.width/i),e.setAttributeNS(null,"height",t.height/i),e)},drawSurface:function(e,t){for(var i=null,n=!0,r=0,o=t.components.length;r<o;r++)if(r%3==0&&r/3==0){var s=this.getShortString(t.components[r]);s||(n=!1),i="M "+s}else if(r%3==1){var s=this.getShortString(t.components[r]);s||(n=!1),i+=" C "+s}else{var s=this.getShortString(t.components[r]);s||(n=!1),i+=" "+s}return i+=" Z",!!n&&(e.setAttributeNS(null,"d",i),e)},drawText:function(e,t,i){var n=this.getResolution(),r=i.x/n+this.left,o=i.y/n-this.top,s=this.nodeFactory(e+this.LABEL_ID_SUFFIX,"text");s.setAttributeNS(null,"x",r),s.setAttributeNS(null,"y",-o),t.fontColor&&s.setAttributeNS(null,"fill",t.fontColor),t.fontOpacity&&s.setAttributeNS(null,"opacity",t.fontOpacity),t.fontFamily&&s.setAttributeNS(null,"font-family",t.fontFamily),t.fontSize&&s.setAttributeNS(null,"font-size",t.fontSize),t.fontWeight&&s.setAttributeNS(null,"font-weight",t.fontWeight),t.fontStyle&&s.setAttributeNS(null,"font-style",t.fontStyle),t.labelSelect===!0?(s.setAttributeNS(null,"pointer-events","visible"),s._featureId=e):s.setAttributeNS(null,"pointer-events","none");var a=t.labelAlign||"cm";s.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[a[0]]||"middle"),OpenLayers.IS_GECKO===!0&&s.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[a[1]]||"central");for(var l=t.label.split("\n"),h=l.length;s.childNodes.length>h;)s.removeChild(s.lastChild);for(var c=0;c<h;c++){var u=this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_tspan_"+c,"tspan");if(t.labelSelect===!0&&(u._featureId=e,u._geometry=i,u._geometryClass=i.CLASS_NAME),OpenLayers.IS_GECKO===!1&&u.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[a[1]]||"-35%"),u.setAttribute("x",r),0==c){var d=OpenLayers.Renderer.SVG.LABEL_VFACTOR[a[1]];null==d&&(d=-.5),u.setAttribute("dy",d*(h-1)+"em")}else u.setAttribute("dy","1em");u.textContent=""===l[c]?" ":l[c],u.parentNode||s.appendChild(u)}s.parentNode||this.textRoot.appendChild(s)},getComponentsString:function(e,t){for(var i,n,r=[],o=!0,s=e.length,a=[],l=0;l<s;l++)n=e[l],r.push(n),i=this.getShortString(n),i?a.push(i):(l>0&&this.getShortString(e[l-1])&&a.push(this.clipLine(e[l],e[l-1])),l<s-1&&this.getShortString(e[l+1])&&a.push(this.clipLine(e[l],e[l+1])),o=!1);return{path:a.join(t||","),complete:o}},clipLine:function(e,t){if(t.equals(e))return"";var i,n=this.getResolution(),r=this.MAX_PIXEL-this.translationParameters.x,o=this.MAX_PIXEL-this.translationParameters.y,s=t.x/n+this.left,a=this.top-t.y/n,l=e.x/n+this.left,h=this.top-e.y/n;
return(l<-r||l>r)&&(i=(h-a)/(l-s),l=l<0?-r:r,h=a+(l-s)*i),(h<-o||h>o)&&(i=(l-s)/(h-a),h=h<0?-o:o,l=s+(h-a)*i),l+","+h},getShortString:function(e){var t=this.getResolution(),i=e.x/t+this.left,n=this.top-e.y/t;return!!this.inValidRange(i,n)&&i+","+n},getPosition:function(e){return{x:parseFloat(e.getAttributeNS(null,"cx")),y:parseFloat(e.getAttributeNS(null,"cy"))}},importSymbol:function(e){this.defs||(this.defs=this.createDefs());var t=this.container.id+"-"+e,i=document.getElementById(t);if(null!=i)return i;var n=OpenLayers.Renderer.symbol[e];if(!n)throw new Error(e+" is not a valid symbol name");var r=this.nodeFactory(t,"symbol"),o=this.nodeFactory(null,"polygon");r.appendChild(o);for(var s,a,l=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),h=[],c=0;c<n.length;c+=2)s=n[c],a=n[c+1],l.left=Math.min(l.left,s),l.bottom=Math.min(l.bottom,a),l.right=Math.max(l.right,s),l.top=Math.max(l.top,a),h.push(s,",",a);o.setAttributeNS(null,"points",h.join(" "));var u=l.getWidth(),d=l.getHeight(),p=[l.left-u,l.bottom-d,3*u,3*d];return r.setAttributeNS(null,"viewBox",p.join(" ")),this.symbolMetrics[t]=[Math.max(u,d),l.getCenterLonLat().lon,l.getCenterLonLat().lat],this.defs.appendChild(r),r},getFeatureIdFromEvent:function(e){var t=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!t){var i=e.target;t=i.parentNode&&i!=this.rendererRoot&&i.parentNode._featureId}return t},CLASS_NAME:"OpenLayers.Renderer.SVG"}),OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"},OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1},OpenLayers.Renderer.SVG.preventDefault=function(e){e.preventDefault&&e.preventDefault()},OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(e,t,i,n){this.url=e,this.size=t?t:new OpenLayers.Size(20,20),this.offset=i?i:new OpenLayers.Pixel((-(this.size.w/2)),(-(this.size.h/2))),this.calculateOffset=n;var r=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(r)},destroy:function(){this.erase(),OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild),this.imageDiv.innerHTML="",this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(e){null!=e&&(this.size=e),this.draw()},setUrl:function(e){null!=e&&(this.url=e),this.draw()},draw:function(e){return OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute"),this.moveTo(e),this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(e){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,e)},moveTo:function(e){if(null!=e&&(this.px=e),null!=this.imageDiv)if(null==this.px)this.display(!1);else{this.calculateOffset&&(this.offset=this.calculateOffset(this.size));var t=this.px.offset(this.offset);OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,t)}},display:function(e){this.imageDiv.style.display=e?"":"none"},isDrawn:function(){var e=this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType;return e},CLASS_NAME:"OpenLayers.Icon"}),OpenLayers.Lang.en={unhandledRequest:"Unhandled request return ${statusText}",Permalink:"Permalink",Overlays:"Overlays","Base Layer":"Base Layer",readNotImplemented:"Read not implemented.",writeNotImplemented:"Write not implemented.",noFID:"Can't update a feature for which there is no FID.",errorLoadingGML:"Error in loading GML file ${url}",browserNotSupported:"Your browser does not support vector rendering. Currently supported renderers are:\n${renderers}",componentShouldBe:"addFeatures : component should be an ${geomType}",getFeatureError:"getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.",minZoomLevelError:"The minZoomLevel property is only intended for use with the FixedZoomLevels-descendent layers. That this wfs layer checks for minZoomLevel is a relic of thepast. We cannot, however, remove it without possibly breaking OL based applications that may depend on it. Therefore we are deprecating it -- the minZoomLevel check below will be removed at 3.0. Please instead use min/max resolution setting as described here: http://trac.openlayers.org/wiki/SettingZoomLevels",commitSuccess:"WFS Transaction: SUCCESS ${response}",commitFailed:"WFS Transaction: FAILED ${response}",googleWarning:"The Google Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the Google Maps library script was either not included, or does not contain the correct API key for your site.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/Google' target='_blank'>click here</a>",getLayerWarning:"The ${layerType} Layer was unable to load correctly.<br><br>To get rid of this message, select a new BaseLayer in the layer switcher in the upper-right corner.<br><br>Most likely, this is because the ${layerLib} library script was not correctly included.<br><br>Developers: For help getting this working correctly, <a href='http://trac.openlayers.org/wiki/${layerLib}' target='_blank'>click here</a>","Scale = 1 : ${scaleDenom}":"Scale = 1 : ${scaleDenom}",W:"W",E:"E",N:"N",S:"S",Graticule:"Graticule",layerAlreadyAdded:"You tried to add the layer: ${layerName} to the map, but it has already been added",reprojectDeprecated:"You are using the 'reproject' option on the ${layerName} layer. This option is deprecated: its use was designed to support displaying data over commercial basemaps, but that functionality should now be achieved by using Spherical Mercator support. More information is available from http://trac.openlayers.org/wiki/SphericalMercator.",methodDeprecated:"This method has been deprecated and will be removed in 3.0. Please use ${newMethod} instead.",boundsAddError:"You must pass both x and y values to the add function.",lonlatAddError:"You must pass both lon and lat values to the add function.",pixelAddError:"You must pass both x and y values to the add function.",unsupportedGeometryType:"Unsupported geometry type: ${geomType}",filterEvaluateNotImplemented:"evaluate is not implemented for this filter type.",proxyNeeded:"You probably need to set OpenLayers.ProxyHost to access ${url}.See http://trac.osgeo.org/openlayers/wiki/FrequentlyAskedQuestions#ProxyHost",end:""},OpenLayers.Layer.SphericalMercator={getExtent:function(){var e=null;return e=this.sphericalMercator?this.map.calculateBounds():OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)},getLonLatFromViewPortPx:function(e){return OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)},getViewPortPxFromLonLat:function(e){return OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)},initMercatorParameters:function(){this.RESOLUTIONS=[];for(var e=156543.03390625,t=0;t<=this.MAX_ZOOM_LEVEL;++t)this.RESOLUTIONS[t]=e/Math.pow(2,t);this.units="m",this.projection=this.projection||"EPSG:900913"},forwardMercator:function(e,t){var i=20037508.34*e/180,n=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return n=20037508.34*n/180,new OpenLayers.LonLat(i,n)},inverseMercator:function(e,t){var i=e/20037508.34*180,n=t/20037508.34*180;return n=180/Math.PI*(2*Math.atan(Math.exp(n*Math.PI/180))-Math.PI/2),new OpenLayers.LonLat(i,n)},projectForward:function(e){var t=OpenLayers.Layer.SphericalMercator.forwardMercator(e.x,e.y);return e.x=t.lon,e.y=t.lat,e},projectInverse:function(e){var t=OpenLayers.Layer.SphericalMercator.inverseMercator(e.x,e.y);return e.x=t.lon,e.y=t.lat,e}},function(){var e,t,i,n,r,o=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],s=OpenLayers.Projection.addTransform,a=OpenLayers.Layer.SphericalMercator,l=OpenLayers.Projection.nullTransform;for(e=0,t=o.length;e<t;++e)for(i=o[e],s("EPSG:4326",i,a.projectForward),s(i,"EPSG:4326",a.projectInverse),r=e+1;r<t;++r)n=o[r],s(i,n,l),s(n,i,l)}(),OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(e,t){OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.markers=[]},destroy:function(){this.clearMarkers(),this.markers=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=0,i=this.markers.length;t<i;t++)this.markers[t].setOpacity(this.opacity)}},moveTo:function(e,t,i){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),t||!this.drawn){for(var n=0,r=this.markers.length;n<r;n++)this.drawMarker(this.markers[n]);this.drawn=!0}},addMarker:function(e){this.markers.push(e),null!=this.opacity&&e.setOpacity(this.opacity),this.map&&this.map.getExtent()&&(e.map=this.map,this.drawMarker(e))},removeMarker:function(e){this.markers&&this.markers.length&&(OpenLayers.Util.removeItem(this.markers,e),e.erase())},clearMarkers:function(){if(null!=this.markers)for(;this.markers.length>0;)this.removeMarker(this.markers[0])},drawMarker:function(e){var t=this.map.getLayerPxFromLonLat(e.lonlat);if(null==t)e.display(!1);else if(e.isDrawn())e.icon&&e.icon.moveTo(t);else{var i=e.draw(t);this.div.appendChild(i)}},getDataExtent:function(){var e=null;if(this.markers&&this.markers.length>0)for(var e=new OpenLayers.Bounds,t=0,i=this.markers.length;t<i;t++){var n=this.markers[t];e.extend(n.lonlat)}return e},CLASS_NAME:"OpenLayers.Layer.Markers"}),DG.Class=function(){return OpenLayers.Class.apply(arguments[0],arguments)},DG.IOverlay=DG.Class({onAddToMap:function(){throw ReferenceError("You must implement method 'onAddToMap'")},onMapUpdate:function(){throw ReferenceError("You must implement method 'onMapUpdate'")},onRemoveFromMap:function(){throw ReferenceError("You must implement method 'onRemoveFromMap'")},hide:function(){throw ReferenceError("You must implement method 'hide'")},enableDraggable:function(){throw ReferenceError("You must implement method 'enabableDraggable'")},disableDraggable:function(){throw ReferenceError("You must implement method 'disableDraggable'")},CLASS_NAME:"DG.IOverlay"}),DG.IManager=DG.Class({add:function(e,t){throw ReferenceError("You must implement method 'add'")},createGroup:function(e){throw ReferenceError("You must implement method 'createGroup'")},remove:function(e){throw ReferenceError("You must implement method 'remove'")},removeAll:function(){throw ReferenceError("You must implement method 'removeAll'")},removeGroup:function(e){throw ReferenceError("You must implement method 'removeGroup'")},get:function(e){throw ReferenceError("You must implement method 'get'")},getAll:function(){throw ReferenceError("You must implement method 'getAll'")},getAllGroupsNames:function(){throw ReferenceError("You must implement method 'getAllGroupsNames'")},getGroup:function(e){throw ReferenceError("You must implement method 'getGroup'")},getDefaultGroupName:function(){throw ReferenceError("You must implement method 'getDefaultGroupName'")},getDefaultGroup:function(){throw ReferenceError("You must implement method 'getDefaultGroup'")},CLASS_NAME:"DG.IManager"}),DG.IOverlayGroup=DG.Class({add:function(e,t){throw ReferenceError("You must implement method 'add'")},forEach:function(e,t){throw ReferenceError("You must implement method 'forEach'")},get:function(e){throw ReferenceError("You must implement method 'get'")},getAll:function(){throw ReferenceError("You must implement method 'getAll'")},getName:function(){throw ReferenceError("You must implement method 'getName'")},indexOf:function(e){throw ReferenceError("You must implement method 'indexOf'")},length:function(){throw ReferenceError("You must implement method 'length'")},remove:function(e){throw ReferenceError("You must implement method 'remove'")},removeAll:function(){throw ReferenceError("You must implement method 'removeAll'")},show:function(){throw ReferenceError("You must implement method 'show'")},hide:function(){throw ReferenceError("You must implement method 'hide'")},contains:function(e){throw ReferenceError("You must implement method 'contains'")},CLASS_NAME:"DG.IOverlayGroup"}),DG.IObservable=DG.Class({getContainerId:function(){throw ReferenceError("You must implement method 'getContainerId'")},CLASS_NAME:"DG.IObservable"}),DG.ILayerDataLoader=DG.Class({getData:function(e,t,i){throw"You must implement getData() method"},CLASS_NAME:"DG.ILayerDataLoader"}),DG.OverlayGroup=new DG.Class(DG.IOverlayGroup,{_name:null,_dgMap:null,_items:[],_manager:null,_isVisible:!0,_observers:[],initialize:function(e,t,i){this._name=e,this._dgMap=t,this._manager=i,this._items=[],this._observers=[]},destroy:function(){},add:function(e,t,i){this._checkItem(e),this._manager.isItemIdAlreadyBusy(e.getId())||(t=this._prepareIndex(t),e.setDgMap(this._dgMap),this._makeSpecialAdd(e,i),this._items.splice(t,0,e),e.onAddToMap(this._dgMap),this._checkItemVisibility(e))},_makeSpecialAdd:function(e){throw"The method _provideSpecAddAct should be implemented!"},_checkItemVisibility:function(e){this._isVisible||e.hide()},_checkItem:function(e){if(1==this.contains(e)||this._manager.isItemAlreadyInSomeGroup(e))throw new Error("One object can't be added in anywhere twice")},_checkIndex:function(e){if("undefined"!=typeof this._items[e])for(var t=this._items.length;t>e;t--)this._items[t+1]=this._items[t]},_prepareIndex:function(e){if(DG.Utils.iNU(e))e=this._items.length;else{var t=+e;e=parseInt(e);var i=t==e;if(isNaN(e)||e<0||!i)throw"Index must be not negative integer";if(e>this._items.length)throw"Index can't be larger than the current number of items. Needs for a continuous numbering."}return e},forEach:function(e,t){t=t||window;var i,n;for(i=0,n=this._items.length;i<n;i++)e.call(t,this._items[i],i,this)},get:function(e){return this._items[e]?this._items[e]:null},getAll:function(){return this._items},getName:function(){return this._name},indexOf:function(e){if(void 0==e)throw ReferenceError("Wrong parameter to method indexOf");var t,i;for(t=0,i=this._items.length;t<i;t++)if(this._items[t]==e||this._items[t].getId()==e)return t;return null},length:function(){return this._items.length},remove:function(e){if(!DG.Utils.inArray(e,this._items))throw"Given item not found in group '"+this.getName()+"'";this._makeSpecialRemove(e),e.onRemoveFromMap(),DG.Utils.removeItem(this._items,e)},_makeSpecialRemove:function(e){throw"The method _provideSpecificRemoveAct should be implemented!"},removeAll:function(){for(;this._items.length;)this.remove(this._items[0])},show:function(){this._isVisible=!0;var e,t,i;for(e=0,t=this._items.length;e<t;e++)i=this._items[e],i.show()},hide:function(){this._isVisible=!1;var e,t,i;for(e=0,t=this._items.length;e<t;e++)i=this._items[e],i.hide()},contains:function(e){if(void 0==e)throw ReferenceError("Wrong parameter to method contains");if("string"!=typeof e)return DG.Utils.inArray(e,this._items);for(var t=0,i=this._items.length;t<i;t++)if(this._items[t].getId()==e)return!0;return!1},_registerHandler:function(e,t,i){this._observers.push(this._dgMap.addEventListener(e,t,i))},_removeHandlers:function(){for(;this._observers.length;)this._observers.pop().cleanup()},CLASS_NAME:"DG.OverlayGroup"}),DG.OverlayManager=new DG.Class(DG.IManager,{_groups:{},_dgMap:null,_observers:[],initialize:function(e){this._dgMap=e,this._groups={},this._observers=[],this.createGroup(this.getDefaultGroupName())},add:function(e,t){var i=this._getItemBaseClass();if(!(e instanceof i))throw TypeError("Types mismatch");t=t||this.getDefaultGroupName(),this.createGroup(t),this._groups[t].add(e)},createGroup:function(e){var t;return e=e||this.getDefaultGroupName(),DG.Utils.inArray(e,DG.Utils.arrayKeys(this._groups))||(t=this._getGroupClass(),this._groups[e]=new t(e,this._dgMap,this)),this._groups[e]},remove:function(e){var t=this._getItemBaseClass();return e instanceof t||(e=this.get(e)),this._removeItemAnywhere(e)},isItemAlreadyInSomeGroup:function(e){return DG.Utils.inArray(e,this.getAll())},isItemIdAlreadyBusy:function(e){var t,i,n;for(t=this.getAll(),i=0,n=t.length;i<n;i++)if(t[i].getId()==e)return!0;return!1},_removeItemAnywhere:function(e){var t,i;for(i in this._groups)if(t=this._groups[i],e&&t.contains(e.getId()))return void t.remove(e);throw"Given item not found in any groups"},removeAll:function(){var e,t;for(t in this._groups)e=this._groups[t],e.removeAll()},removeGroup:function(e){var t;if(e===this.getDefaultGroupName())throw Error("Default group could'n be removed. Please try use method 'removeAll' for removing all objects");if(this._groups[e]){if(this._groups[e].destroy(),t=this._groups[e],!t)return!1;t.removeAll(),delete this._groups[e]}return!0},get:function(e){var t,i,n;for(n=this.getAll(),t=0,i=n.length;t<i;t++)if(n[t].getId()===e)return n[t];return null},getAll:function(){var e,t=[],i=[];for(groupName in this._groups)e=this._groups[groupName],i=e.getAll(),i.length>0&&(t=t.concat(i));return t},getAllGroupsNames:function(){return DG.Utils.arrayKeys(this._groups)},getGroup:function(e){return this._groups[e]?this._groups[e]:null},getDefaultGroupName:function(){return"default"},getDefaultGroup:function(){return this.getGroup(this.getDefaultGroupName())},_getGroupClass:function(){throw"You must implement method '_getGroupClass'"},_getItemBaseClass:function(){throw"You must implement method '_getBaseItemClassName'"},destroy:function(){this.removeAll();for(var e in this._groups)e!=this.getDefaultGroupName()&&this.removeGroup(e);DG.Utils.iNU(this._groups[this.getDefaultGroupName()])||(this._groups[this.getDefaultGroupName()].destroy(),delete this._groups[this.getDefaultGroupName()]),this._removeHandlers(),this._dgMap=null},_removeHandlers:function(){for(;this._observers.length;)this._observers.pop().cleanup()},CLASS_NAME:"DG.OverlayManager"}),DG.Size=DG.Class(OpenLayers.Size,{width:0,height:0,initialize:function(e,t){if("undefined"==typeof e&&"undefined"==typeof t)throw TypeError("No arguments for constructor");if(e<0||t<0)throw TypeError("Wrong negavive arguments for constructor");OpenLayers.Size.prototype.initialize.apply(this,arguments),this.width=this.w,this.height=this.h},apply:function(e){e.style.width="*"==this.width?"100%":this.width+"px",e.style.height="*"==this.height?"100%":this.height+"px"},clone:function(){return new DG.Size(this.width,this.height)},CLASS_NAME:"DG.Size"}),DG.Point=DG.Class(OpenLayers.Pixel,{x:0,y:0,initialize:function(e,t){if("number"!=typeof e&&(e=parseFloat(e)),"number"!=typeof this.y&&(t=parseFloat(t)),isNaN(e)===!0||isNaN(t)===!0)throw new TypeError("Incorrect x or y");this.x=e,this.y=t},clone:function(){return new DG.Point(this.x,this.y)},CLASS_NAME:"DG.Point"}),DG.Controls=DG.Class(DG.OverlayManager,{_groups:{},_observers:[],initialize:function(e){this._dgMap=e,this._groups={},this._observers=[]},_getGroupClass:function(){return DG.ControlGroup},_getItemBaseClass:function(){return DG.Controls.Base},add:function(e,t,i){DG.Utils.iNU(i)||e.setPosition(i),t=t||this.getDefaultGroupName(),this.createGroup(t),this._groups[t].add(e,null,i)},CLASS_NAME:"DG.Controls"}),DG.Controls.Base=DG.Class(DG.IObservable,DG.IOverlay,{_DOMContainer:null,_controlId:null,_dgMap:null,_zIndex:null,_observers:[],_state:null,_position:null,initialize:function(e){this._observers=[],this._dgMap=null,this._DOMContainer=null,this._controlId=null,this._zIndex=null,this._state=null,this._generateId(e)},destroy:function(){},clearBeforeRemoveFromMap:function(){this.removeHandlers(),this._dgMap&&this.getContainer()&&this.getContainer().parentNode==this._dgMap.getViewPortContainer()&&this._dgMap.getViewPortContainer().removeChild(this._DOMContainer),this._DOMContainer=null,this._dgMap=null},getId:function(){return this._controlId},getContainerId:function(){return this.getContainer().id},getContainer:function(){if(DG.Utils.iNU(this._DOMContainer)){var e=DG.Utils.createUniqueID(this.CLASS_NAME+"_"+this._controlId);this._DOMContainer=DG.Utils.createDiv(e),this._DOMContainer.style.zIndex=this._zIndex}return this._DOMContainer&&this._dgMap.getViewPortContainer().appendChild(this._DOMContainer),this._DOMContainer},getDgMap:function(){return this._dgMap},show:function(){this.getContainer().style.display="block"},hide:function(){this.getContainer().style.display="none"},isVisible:function(){return"none"!==this.getContainer().style.display},setZIndex:function(e){this._zIndex=e,this.getContainer()&&(this.getContainer().style.zIndex=e)},getZIndex:function(){return this._zIndex},setDgMap:function(e){this._dgMap=e},setPosition:function(e){if(!(e instanceof DG.ControlPosition))throw TypeError("Param position should be an instance of DG.ControlPosition");this._position=e},getPosition:function(){return this._position},_generateId:function(e){if(DG.Utils.empty(e)){if(null!==e&&void 0!==e)throw"Given control ID is invalid";this._controlId=DG.Utils.createUniqueID(this.CLASS_NAME)}else this._controlId=e},registerHandler:function(e,t,i){var n;n=this._dgMap.addEventListener(e,t,i),this._observers.push(n)},removeHandlers:function(){for(var e,e=0;e<this._observers.length;e++)this._observers[e].cleanup()},getStates:function(){throw"You should redefine getStates method!"},getState:function(){return this._state},setState:function(e){if(!DG.Utils.inArray(e,this.getStates()))throw"The control has no such state!";this._state=e;var t="on"+e.charAt(0).toUpperCase()+e.substr(1);try{var i=DG.Utils.findObjMetodByName(t,this);0!=i&&OpenLayers.Function.bind(i,this)()}catch(n){}if(!DG.Utils.iNU(this._dgMap)){var r=new DG.Events.Control(this);DG.EventManager.caller(r,this._dgMap.getMapContainerId(),"DGControlStateChange")}},getPointBounds:function(){return DG.Utils.iNU(this._DOMContainer)?null:DG.Utils.getPointBounds(this._DOMContainer,this.getDgMap().getContainerId())},isInState:function(e){return this._state===e},onAddToMap:function(){},onMapUpdate:function(){},onRemoveFromMap:function(){},enableDraggable:function(){},disableDraggable:function(){},CLASS_NAME:"DG.Controls.Base"}),DG.EventManager={touchable:!1,lastTouch:null,lastPinch:null,startPinchDistance:null,startPinchPoint:null,lastPinchPoint:null,pinching:!1,eventLog:"",mouseRightClickTime:null,mouseWheelTime:null,mouseRightClickPos:null,mouseDragPoint:null,mouseDragStartPoint:null,mouseDragMapId:null,mouseDragObject:null,mouseDragButton:null,firstMouseClick:!1,firstTouchPos:null,mouseDownAndMove:!1,ignoreElements:[],browserAllowElements:[],Debug:!1,Events:new Array,EnableEvents:!0,_browserEventListeners:{window:{},document:{}},addEventListener:function(e,t,i,n,r,o){DG.Utils.iNU(this.Events[e])&&(this.Events[e]=new Array);var s=this.Events[e];if("DgClick"==t&&DG.Utils.iNU(s.DgDoubleClick)&&(t="DgFastClick"),"DgDoubleClick"==t&&!DG.Utils.iNU(s.DgFastClick)){DG.Utils.iNU(this.Events[e].DgClick)&&(this.Events[e].DgClick=new Array);for(var a=s.DgFastClick.length,l=0;l<a;l++){var h=s.DgFastClick.pop();h.EventType="DgClick",this.Events[e].DgClick.push(h)}s.DgFastClick=null,this.unRegister(e,"DgFastClick"),delete this.Events[e].DgFastClick}DG.Utils.iNU(s[t])&&(s[t]=new Array);var c=s[t];c.push({ControlID:e,EventType:t,EventCallBack:i,TotalInstance:n,Wait:r,UserObject:o,event:null}),this.register(e,t)},removeEventListner:function(e,t,i){if(!DG.Utils.iNU(this.Events)){var n=this.Events[e];if(!DG.Utils.iNU(n)){var r=n[t];if(DG.Utils.iNU(r)&&"DgClick"===t&&(t="DgFastClick",r=n[t]),!DG.Utils.iNU(r)){if(DG.Utils.iNU(i))r=[];else for(var o=0,s=r.length;o<s;o++)i==r[o].EventCallBack&&(r[o]=null,r.sort(),r.pop(),s=r.length);0==r.length&&(r=null,n[t]=null,delete n[t],this.unRegister(e,t))}}}},unRegister:function(e,t){switch(e){case"window":for(var i=0;i<this._browserEventListeners.window[t].length;i++)this._removeEventListener(window,t,this._browserEventListeners.window[t][i]);this._browserEventListeners.window[t]=[];break;case"document":for(var i=0;i<this._browserEventListeners.document[t].length;i++)this._removeEventListener(document,t,this._browserEventListeners.document[t][i]);this._browserEventListeners.document[t]=[];break;default:var n=DG.Utils.obj(e);if(DG.Utils.iNU(n))return;n["on"+t]=null}},register:function(e,t){var i;switch(i=function(i){DG.EventManager.caller(i,e,t)},e){case"window":this._addEventListener(window,t,i),void 0===this._browserEventListeners.window[t]&&(this._browserEventListeners.window[t]=[]),this._browserEventListeners.window[t].push(i);break;case"document":this._addEventListener(document,t,i),void 0===this._browserEventListeners.document[t]&&(this._browserEventListeners.document[t]=[]),this._browserEventListeners.document[t].push(i);break;default:var n=DG.Utils.obj(e);if(DG.Utils.iNU(n))return;n["on"+t]=i}},_addEventListener:function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)},_removeEventListener:function(e,t,i){e.removeEventListener?e.removeEventListener(t,i,!1):e.detachEvent&&e.detachEvent(t,i)},caller:function(e,t,i){if(!e)if("click"===i){e={};for(p in window.event)e[p]=window.event[p]}else e=window.event;if(!e.dgEventStop&&this.EnableEvents){var n=this.Events[t];if(!DG.Utils.iNU(n)){if(("DgClick"==i||"DgDoubleClick"==i)&&n.DgFastClick&&n.DgFastClick.length)return void this.stopEventBuble(e);var r=n[i];if(!DG.Utils.iNU(r)&&("DgDrag"!=i&&"DgRightDrag"!=i||DG.Utils.iNU(this.mouseDragObject)||t==this.mouseDragObject))for(var o=!1,s=0;s<r.length;s++){if(o)return;var a=r[s];a.event=e,DG.Utils.iNU(a.TotalInstance)||a.TotalInstance>0&&(a.TotalInstance-=1);var l={ControlID:r[s].ControlID,EventType:r[s].EventType,TotalInstance:r[s].TotalInstance,Wait:r[s].Wait,UserObject:r[s].UserObject,event:e};if(DG.Utils.iNU(a.Wait)){if(a.EventCallBack.run(l)){!DG.Utils.iNU(this.mouseDragObject)||"DgDrag"!=i&&"DgRightDrag"!=i||(this.mouseDragObject=t,this._fireDragStart(l));var h=!1;if(this.checkBrowserAllow(e)&&(h=!0),"click"==i){var c=navigator.userAgent.split(" ").pop().split(".").shift();"Firefox/10"!=c&&"Firefox/9"!=c||(h=!0)}DG.EventManager.stopEventBuble(e,h),"DgDrag"!==i&&"DgRightDrag"!==i&&(o=!0)}}else setTimeout(function(){a.EventCallBack.run(l)&&(!DG.Utils.iNU(this.mouseDragObject)||"DgDrag"!=i&&"DgRightDrag"!=i||(this.mouseDragObject=t,this._fireDragStart(l)),DG.EventManager.stopEventBuble(e),o=!0)},a.Wait);0==a.TotalInstance&&this.removeEventListner(t,i,a.EventCallBack)}}}},stopEventBuble:function(e,t){t!==!0&&(e.preventDefault?e.preventDefault():e.returnValue=!1),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.dgEventStop=!0},_fireDragStart:function(e){var t=new DG.Events.Mouse(e.event._dgMap,e.event.windowEvent,e.event.point);this.caller(t,this.mouseDragObject,"DgDragStart")},addIgnorElementDomID:function(e){this.ignoreElements.push(e)},removeIgnorElementDomID:function(e){var t=this.ignoreElements.indexOf(e);this.ignoreElements.splice(t,1)},checkInIgnorElements:function(e,t){for(var i=!1,n=null,r=null,o=0,s=this.ignoreElements.length;o<s;o++)for(n=this.ignoreElements[o],r=e;null!=r;){if(r.id==n)return!0;r=r.parentNode}for(r=e;null!=r;)r.id==t&&(i=!0),r=r.parentNode;return!i},addBrowserAllowElementDomID:function(e){this.browserAllowElements.push(e)},checkBrowserAllow:function(e){var t,i=DG.Utils.detectBrowser();if(t="IE"!=i[0]||6!=i[1]&&7!=i[1]?e.originalTarget:e.srcElement,DG.Utils.iNU(t))return!1;for(var n=0,r=this.browserAllowElements.length;n<r;n++)if(t&&t.id==this.browserAllowElements[n])return!0}},DG.Events={},DG.Events.EVENT_TYPES=["DgDrag","DgRightDrag","DgDragStop","DgDragStart","DgInertiaDragStop","DgMouseMove","DgMouseOver","DgMouseOut","DgClick","DgRightClick","DgDoubleClick","DgDoubleRightClick","DgMouseDown","DgMouseUp","DgMouseRightDown","DgMouseRightUp","DgMouseWheel","DgMapMove","DgMapLoaded","DgMapRedraw","DgSettingsChange","DgZoomChange","DgViewResize","DgBalloonMoveEnd","DgMarkerUpdate","DgLayerVisibilityChange","DgGeometryChange","DGControlStateChange","DgImageLoadError","DgProjectChange","DgBalloonHide","DgBalloonShow","DgPinchZoomStart","DgPinchZoomChange","DgPinchZoomStop","DgLanguageChange","DgWindowUnload","DgMarkerBalloonShow","DgKeyDown","DgKeyUp","DgBalloonScroll","DgRulerOff","DgRulerOn","DgGeoclickerEnable","DgGeoclickerDisable"],DG.Events.Base=DG.Class({mapID:null,dgEventStop:!1,initialize:function(e){this.mapID=e},CLASS_NAME:"DG.Events.Base"}),DG.Handlers={},DG.Handlers.Base=DG.Class({controlId:null,eventType:null,isEnable:null,event:null,_dgMap:null,parseEvent:function(e){this.event=e.event,this.controlId=e.ControlID,this.eventType=e.EventType},mainMethod:function(){},initialize:function(e){this._dgMap=e,this.isEnable=!0},run:function(e){return!!this.isEnable&&(this.parseEvent(e),this.mainMethod(this.event))},register:function(e,t,i,n,r){return DG.EventManager.addEventListener(e,t,this,i,n,r),new DG.Observer(this,e,t)},unregister:function(e,t){DG.EventManager.removeEventListner(e,t,this)},raiseEvent:function(e,t,i){for(var n=this._dgMap.getMapContainer(),r=e;null!=r;){if(this.fireEvent(r,t,i),r==n)return!0;r=r.parentNode}return!1},fireEvent:function(e,t,i){var n=e;"object"==typeof e&&(n=e.id),DG.EventManager.caller(t,n,i)},CLASS_NAME:"DG.Handlers.Base"}),DG.Layers=DG.Class(DG.OverlayManager,{_groups:{},_observers:[],_dgMap:null,_noImageSrc:"http://maps.api.2gis.ru/images/blanktile.png",_baseLayer:null,initialize:function(e){this._dgMap=e,this._groups={},this._observers=[],this.createGroup(this.getDefaultGroupName()),this._initBaseLayer(),this._observers.push(this._dgMap.addEventListener(this._dgMap.getMapContainerId(),"DgMapMove",DG.Utils.bind(this.onMapMove,this)))},_initBaseLayer:function(){this._baseLayer=new DG.Layers.TileMap,this._baseLayer.setDgMap(this._dgMap),this._baseLayer.initializeBeforeAddOnMap(),this._dgMap.getOlMap().addLayer(this._baseLayer.getOlLayer());var e=OpenLayers.Function.bind(this._baseLayer.onImageError,this._baseLayer);this._observers.push(this._dgMap.addEventListener(this._baseLayer.getContainerId(),"DgImageLoadError",e)),this._dgMap.getOlMap().setBaseLayer(this._baseLayer.getOlLayer())},_getItemBaseClass:function(){return DG.Layers.Base},createGroup:function(e){return e=e||this.getDefaultGroupName(),DG.Utils.inArray(e,DG.Utils.arrayKeys(this._groups))||(this._groups[e]=new DG.LayerGroup(e,this._dgMap,this)),this._groups[e]},onMapMove:function(e){for(var t=this.getAll(),i=0,n=t.length;i<n;i++)t[i].onMapUpdate(e)},destroy:function(){this._baseLayer.destroy(),DG.OverlayManager.prototype.destroy.apply(this)},CLASS_NAME:"DG.Layers"}),DG.Layers.Base=DG.Class(DG.IObservable,DG.IOverlay,{_dgMap:null,_olLayer:null,_layerId:null,_isVisible:!0,_noImageCSSClass:"olImageNoMap",initialize:function(e,t){null!==this._layerId&&this._generateId(e),this._olLayer=t},_generateId:function(e){if(DG.Utils.empty(e)){if(null!==e&&void 0!==e)throw"Given layer ID is invalid";this._layerId=DG.Utils.createUniqueID(this.CLASS_NAME)}else this._layerId=e},setDgMap:function(e){this._dgMap=e},getDgMap:function(){return this._dgMap},getId:function(){return this._layerId},getContainerId:function(){return this._olLayer.div.id},destroy:function(){},clearBeforeRemoveFromMap:function(){this._olLayer.destroy(),this._dgMap=null},getOlLayer:function(){return this._olLayer},display:function(e){this._isVisible=e,this._olLayer.setVisibility(e),this._fireChangeVisibleEvent()},show:function(){this.display(!0)},hide:function(){this.display(!1)},setUrl:function(e){return this.getOlLayer().setUrl(e)},redraw:function(){return this.getOlLayer().redraw()},isVisible:function(){return this._isVisible},eventProcessing:function(e,t){return!1},_fireChangeVisibleEvent:function(){DG.EventManager.caller(new DG.Events.Layers(this),this._dgMap.getMapContainerId(),"DgLayerVisibilityChange")},setURLErrorImage:function(e){this._noImageSrc=e},getURLErrorImage:function(){return this._noImageSrc},onImageError:function(e){e.getImage().src==this._noImageSrc?(e.getImage().src="",OpenLayers.Element.addClass(e.getImage(),this._noImageCSSClass)):e.getImage().src=this._noImageSrc;
},onAddToMap:function(){},onMapUpdate:function(){},onRemoveFromMap:function(){},enableDraggable:function(){},disableDraggable:function(){},CLASS_NAME:"DG.Layers.Base"}),DG.Balloons=DG.Class(DG.OverlayManager,{_groups:{},_observers:[],_getGroupClass:function(){return DG.BalloonGroup},_getItemBaseClass:function(){return DG.Balloons.Base},getBounds:function(e){var t,i=[];if(DG.Utils.empty(e))i=this.getAll();else{var n=this.getGroup(e);null!=n&&(i=n.getAll())}var r=[];for(t=0;t<i.length;t++)r.push(i[t].getPosition());return r.length?new DG.CollectionBounds(r):null},CLASS_NAME:"DG.Balloons"}),DG.Balloons.Base=DG.Class(DG.IOverlay,DG.IObservable,{CLASS_NAME:"DG.Balloons.Base"}),DG.Handlers.Mouse=DG.Class(DG.Handlers.Base,{getPosition:function(){var e=this.event,t=this._dgMap.getMapContainer(),i=document.documentElement,n=document.body;t.scrolls=[i.scrollLeft||n.scrollLeft,i.scrollTop||n.scrollTop],t.lefttop=[i.clientLeft||0,i.clientTop||0],t.offsets=DG.Utils.pagePosition(t);var r=t.style.paddingLeft?parseInt(t.style.paddingLeft):0,o=t.style.paddingLeft?parseInt(t.style.paddingTop):0,s=e.clientX+t.scrolls[0]-t.offsets[0]-t.lefttop[0]-r,a=e.clientY+t.scrolls[1]-t.offsets[1]-t.lefttop[1]-o;return new DG.Point(s,a)},isMapEvent:function(){var e=(this.getPosition(),this._dgMap.getContainerSize(),this._dgMap.getMapContainerId()),t=this._dgMap.getMapContainer(),i=this.event.target||this.event.srcElement;return!!DG.Utils.DOM.isChildElement(t,i)&&!DG.EventManager.checkInIgnorElements(i,e)},isInsideIgnored:function(){var e=this.event.target||this.event.srcElement,t=this._dgMap.getMapContainer();return!!DG.Utils.DOM.isChildElement(t,e)&&DG.EventManager.checkInIgnorElements(e,t)},CLASS_NAME:"DG.Handlers.Mouse"}),DG.Handlers.Touch=DG.Class(DG.Handlers.Mouse,{getPosition:function(){var e=this.event.touches[0],t=this._dgMap.getMapContainer();t.scrolls=[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop],t.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0],t.offsets=DG.Utils.pagePosition(t);var i=e.clientX+t.scrolls[0]-t.offsets[0]-t.lefttop[0],n=e.clientY+t.scrolls[1]-t.offsets[1]-t.lefttop[1];return new DG.Point(i,n)},getMiddlePosition:function(){for(var e,t=this.event.touches.length,i={clientX:this.event.touches[0].clientX,clientY:this.event.touches[0].clientY},n=1;n<t;n++)e=this.event.touches[n],i.clientX+=e.clientX,i.clientY+=e.clientY;i.clientX=i.clientX/t,i.clientY=i.clientY/t;var r=this._dgMap.getMapContainer();r.scrolls=[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop],r.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0],r.offsets=DG.Utils.pagePosition(r);var o=i.clientX+r.scrolls[0]-r.offsets[0]-r.lefttop[0],s=i.clientY+r.scrolls[1]-r.offsets[1]-r.lefttop[1];return new DG.Point(o,s)},isMultiTouch:function(){return this.event.touches&&this.event.touches.length>1},getDistance:function(e){for(var t=e[0].clientX,i=e[0].clientY,n=t,r=i,o=1;o<e.length;o++)t=e[o].clientX<t?e[o].clientX:t,n=e[o].clientX>n?e[o].clientX:n,i=e[o].clientY<i?e[o].clientY:i,r=e[o].clientY>r?e[o].clientY:r;return Math.sqrt((r-i)*(r-i)+(n-t)*(n-t))},getPinchData:function(e){var t=this.getDistance(e.touches),i=t/DG.EventManager.startPinchDistance,n=new DG.Events.PinchZoom(this._dgMap,e,this.getPosition(),t,this.getMiddlePosition(),i);return n},CLASS_NAME:"DG.Handlers.Touch"}),DG.Events.Mouse=DG.Class(DG.Events.Base,{windowEvent:null,point:new DG.Point(0,0),_dgMap:null,initialize:function(e,t,i){this._dgMap=e,this.windowEvent=t,this.point=i},getGeoPoint:function(){var e=this._dgMap.getGeoPointFromPixel(this.point.x,this.point.y,!0);return e.toLonLat()},getPoint:function(){return this.point.clone()},getMap:function(){return this._dgMap},getButton:function(){return this._isTouchEvent()?1:this._isButtonEvent()?this.isLeftButton()?1:this.isRightButton()?3:this.isMiddleButton()?2:void 0:0},isLeftButton:function(){return this.windowEvent.which&&1==this.windowEvent.which||"IE"==DG.Utils.detectBrowser()[0]&&!DG.Utils.iNU(this.windowEvent.button)&&1==this.windowEvent.button||"IE"==DG.Utils.detectBrowser()[0]&&("click"==this.windowEvent.type||"dblclick"==this.windowEvent.type)},isRightButton:function(){return this.windowEvent.which&&3==this.windowEvent.which||"IE"==DG.Utils.detectBrowser()[0]&&this.windowEvent.button&&2==this.windowEvent.button||"IE"==DG.Utils.detectBrowser()[0]&&"contextmenu"==this.windowEvent.type&&this.windowEvent.button&&0==this.windowEvent.button},isMiddleButton:function(){return this.windowEvent.which&&2==this.windowEvent.which||"IE"==DG.Utils.detectBrowser()[0]&&this.windowEvent.button&&4==this.windowEvent.button},getId:function(){var e=this.windowEvent.target||this.windowEvent.srcElement;return e.id},_isButtonEvent:function(){var e=this.windowEvent.type;return"click"==e||"dblclick"==e||"contextmenu"==e||"mousedown"==e||"mouseup"==e},_isTouchEvent:function(){var e=this.windowEvent.type;return"touchstart"==e||"touchend"==e||"touchmove"==e},getDelta:function(){var e=this.windowEvent,t=0;return e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),this._isButtonEvent()&&(t=-t),t=t<0?-1:1},CLASS_NAME:"DG.Events.Mouse"}),DG.Style=DG.Class({style:null,initialize:function(e,t){t?(DG.Utils.extend(t,e),this.style=t):this.style=e},getStyle:function(){return DG.Utils.extend({},this.style)},CLASS_NAME:"DG.Style"}),DG.Configs={},DG.Configs.MIN_ZOOM=1,DG.Configs.MAX_ZOOM=19,DG.Configs.MAX_ZOOM_OUT_PROJECT=13,DG.Utils={dpi:null,IMAGE_ERROR_TIMEOUT:0,iNU:function(e){return void 0==e||null==e||"string"==typeof e&&""==e},obj:function(e){return document.getElementById(e)},getObjectSize:function(e){var t,i=0;for(t in e)e.hasOwnProperty(t)&&i++;return i},findFuncByName:function(e){return this.findObjMetodByName(e,window||this)},findObjMetodByName:function(e,t){if("string"!=typeof e)return!1;if("object"!=typeof t)return!1;for(var i=t,n=e.split("."),r=0,o=n.length;r<o;r++)i=i[n[r]];if("function"!=typeof i)throw new Error("Function not found");return i},detectBrowser:function(){var e,t,i,n=[],r=navigator.userAgent,o=navigator.appName,s=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10);return(t=r.indexOf("Opera"))!=-1?(o="Opera",s=r.substring(t+6),(t=r.indexOf("Version"))!=-1&&(s=r.substring(t+8))):(t=r.indexOf("MSIE"))!=-1?(o="IE",s=r.substring(t+5)):(t=r.indexOf("Chrome"))!=-1?(o="Chrome",s=r.substring(t+7)):(t=r.indexOf("Safari"))!=-1?(o="Safari",s=r.substring(t+7),(t=r.indexOf("Version"))!=-1&&(s=r.substring(t+8))):(t=r.indexOf("Firefox"))!=-1?(o="Firefox",s=r.substring(t+8)):(e=r.lastIndexOf(" ")+1)<(t=r.lastIndexOf("/"))&&(o=r.substring(e,t),s=r.substring(t+1),o.toLowerCase()==o.toUpperCase()&&(o=navigator.appName)),(i=s.indexOf(";"))!=-1&&(s=s.substring(0,i)),(i=s.indexOf(" "))!=-1&&(s=s.substring(0,i)),a=parseInt(""+s,10),isNaN(a)&&(s=""+parseFloat(navigator.appVersion),a=parseInt(navigator.appVersion,10)),n[0]=o,n[1]=a,n[2]=s,n},isTouchDevice:function(){var e=navigator.userAgent.indexOf(/Windows Phone/i)!==-1;return(e||"ontouchstart"in document.documentElement)&&this.detectMobileDevice()},detectMobileDevice:function(){return typeof orientation!=void 0+""},isIFrame:function(){return window!=window.top},createDiv:function(e,t,i,n,r,o,s,a){var l=document.createElement("div");return n&&(l.style.backgroundImage="url("+n+")"),e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv")),r||(r="absolute"),e&&(l.id=e),t&&(l.style.left=t.x+"px",l.style.top=t.y+"px"),i&&(l.style.width="*"==i.w?"100%":i.w+"px",l.style.height="*"==i.h?"100%":i.h+"px"),r&&(l.style.position=r),o&&(l.style.border=o),s&&(l.style.overflow=s),parseFloat(a)>=0&&parseFloat(a)<1?(l.style.filter="alpha(opacity="+100*a+")",l.style.opacity=a):1==parseFloat(a)&&(l.style.filter="",l.style.opacity=""),l},getPositionInElement:function(e,t){var i=e;i.scrolls=[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop],i.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0],i.offsets=DG.Utils.pagePosition(i),i.offsets[0]+=i.scrolls[0],i.offsets[1]+=i.scrolls[1];var n=[t.x+i.scrolls[0]-i.offsets[0]-i.lefttop[0],t.y+i.scrolls[1]-i.offsets[1]-i.lefttop[1]];return n},inArray:function(e,t){for(var i=0;i<t.length;i++)if(t[i]===e)return!0;return!1},inHash:function(e,t){for(var i in t)if(t[i]===e)return!0;return!1},arrayKeys:function(e){var t,i;i=[];for(t in e)e.hasOwnProperty(t)&&i.push(t);return i},encode:function(e){return escape(this._utf8_encode(e))},decode:function(e){return this._utf8_decode(unescape(e))},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",i=0;i<e.length;i++){var n=e.charCodeAt(i);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},_utf8_decode:function(e){for(var t="",i=0,n=c1=c2=0;i<e.length;)n=e.charCodeAt(i),n<128?(t+=String.fromCharCode(n),i++):n>191&&n<224?(c2=e.charCodeAt(i+1),t+=String.fromCharCode((31&n)<<6|63&c2),i+=2):(c2=e.charCodeAt(i+1),c3=e.charCodeAt(i+2),t+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),i+=3);return t},empty:function(e){return void 0===e||""===e||0===e||"0"===e||null===e||e===Number.NaN||e===!1||"false"===e||this.isArray(e)&&0===e.length},serializeArray:function(e,t){t=t||", ";for(var i="",n=0;n<e.length;n++)i+=e+t;return i},isArray:function(e){return e instanceof Array},removeItem:function(e,t){return OpenLayers.Util.removeItem(e,t)},extend:function(e,t){return OpenLayers.Util.extend(e,t)},createUniqueID:function(e){return null==e&&(e="id_"),DG.Utils.lastSeqID+=1,e+DG.Utils.lastSeqID+(new Date).getTime()},getImagesLocation:function(){return OpenLayers.Util.getImagesLocation()},pagePosition:function(e){var t=[0,0],i=OpenLayers.Util.getViewportElement();if(!e||e==window||e==i)return t;var n;n=e.getBoundingClientRect();var r=document.documentElement.scrollTop||document.body.scrollTop,o=document.documentElement.scrollLeft||document.body.scrollLeft;return t[0]=n.left+o,t[1]=n.top+r,t},extendOptionsProtected:function(e,t,i){this._extendOptions(e,t,i,"_")},extendOptions:function(e,t,i){this._extendOptions(e,t,i)},_extendOptions:function(e,t,i,n){var r,o,s,a,l;if(n=n?n:"",!(i instanceof Array))throw"Param neededProperties must be an array";t=t||{};for(optionName in t)if(s=t[optionName],void 0!==s)for(r=0,o=i.length;r<o;r++)a=i[r],l=n+a,void 0!==e[l]&&optionName===a&&(e[l]=t[optionName])},pushIntoSpecifiedPosition:function(e,t,i){if(!DG.Utils.iNU(i)&&i<=e.length){var n=e.slice(0,i),r=e.slice(i,e.length);return n.push(t),e=n.concat(r)}return!1},getResolutionFromScale:function(e,t){return OpenLayers.Util.getResolutionFromScale(e,t)},onImageLoadError:function(){if(this._attempts=this._attempts?this._attempts+1:1,this._attempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){var e=this.urls;if(e&&e instanceof Array&&e.length>1){var t,i,n=this.src.toString();for(i=0;(t=e[i])&&n.indexOf(t)==-1;i++);var r=Math.floor(e.length*Math.random()),o=e[r];for(i=0;o==t&&i++<4;)r=Math.floor(e.length*Math.random()),o=e[r];this.src=n.replace(t,o)}else this.src=this.src}else DG.Utils.IMAGE_ERROR_TIMEOUT>0?(this._isLoadSuccess=!1,this.onload=DG.Utils.bind(function(){this._isLoadSuccess=!0},this),setTimeout(DG.Utils.bind(function(){this._isLoadSuccess||DG.EventManager.caller(new DG.Events.ImageError(this),this.parentNode.parentNode.id,"DgImageLoadError")},this),DG.Utils.IMAGE_ERROR_TIMEOUT)):DG.EventManager.caller(new DG.Events.ImageError(this),this.parentNode.parentNode.id,"DgImageLoadError");this.style.display=""},stringFormat:function(e,t,i){t||(t=window);var n=function(e,n){for(var r,o=n.split(/\.+/),s=0;s<o.length;s++)0==s&&(r=t),r=r[o[s]];return"function"==typeof r&&(r=i?r.apply(null,i):r()),"undefined"==typeof r?"undefined":r},r=/\$\[([\w.]+?)\]/g;return e.replace(r,n)},getDomainName:function(e){var t;return t=DG.Utils.isIFrame()&&document.referrer?document.referrer.match("([a-zа-яё0-9]+).([a-zа-яё0-9-]+).[a-zа-яё]+")[0]:DG.Utils.isIFrame()&&window.parent.location.href?window.parent.location.href.match("([a-zа-яё0-9]+).([a-zа-яё0-9-]+).[a-zа-яё]+")[0]:document.location.hostname},bind:function(e,t){return OpenLayers.Function.bind(e,t)},getRenderedDimensions:function(e,t,i,n){var r,o,s,a,l,h=document.createElement("div");h.style.visibility="hidden";var c=n&&n.containerElement?n.containerElement:document.body;!t.w&&i.minWidth&&(s=i.minWidth),!t.w&&i.maxWidth&&(s=i.maxWidth),t&&(t.w?(s=t.w,i.minWidth&&s<i.minWidth&&(s=i.minWidth),i.maxWidth&&s>i.maxWidth&&(s=i.maxWidth)):t.h&&(a=t.h,h.style.height=a+"px")),n&&n.displayClass&&(h.className=n.displayClass);var u=document.createElement("div");if(DG.Utils.iNU(s))u.innerHTML=e;else{var d=document.createElement("div");d.style.cssFloat="left",u.appendChild(d),d.innerHTML=e}if(u.style.overflow="visible",u.childNodes)for(var p=0,g=u.childNodes.length;p<g;p++)u.childNodes[p].style&&(u.childNodes[p].style.overflow="visible");h.appendChild(u),c.appendChild(h);for(var m=!1,f=h.parentNode;f&&"body"!=f.tagName.toLowerCase();){var y=OpenLayers.Element.getStyle(f,"position");if("absolute"==y){m=!0;break}if(y&&"static"!=y)break;f=f.parentNode}return m||(h.style.position="absolute"),l=parseInt(u.scrollWidth),i.minWidth&&l<i.minWidth&&(l=i.minWidth),i.maxWidth&&l>i.maxWidth&&(l=i.maxWidth),r=DG.Utils.iNU(s)?l:l<s?l:s,h.style.width=r+"px",o=parseInt(h.scrollHeight),h.removeChild(u),c.removeChild(h),new DG.Size(r,o)},isDoctypeExist:function(){var e=navigator.userAgent.toLowerCase().indexOf("msie")>0;if(e){var t=document.all[0].text,i=void 0===t||t.toLowerCase().indexOf("doctype")<0;if(i)return!1}else if(null===document.doctype)return!1;return!0},getPointBounds:function(e,t){var i,n,r,o;for(i=e.offsetTop,n=e.offsetTop+e.offsetHeight,r=e.offsetLeft,o=e.offsetLeft+e.offsetWidth;e.parentNode.id!=t;)e=e.parentNode,i+=e.offsetTop,n+=e.offsetTop,r+=e.offsetLeft,o+=e.offsetLeft;return new DG.PixelBounds(new DG.Point(r,n),new DG.Point(o,i))},getScreenDensity:function(){var e=window.devicePixelRatio;if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent))return"desktop";if(e)switch(e){case.75:return"ldpi";case 1:return"mdpi";case 1.5:return"hdpi";case 2:return"xhdpi"}else if(window.matchMedia){if(window.matchMedia("only screen and (-webkit-max-device-pixel-ratio: 1) and (max-device-width : 320px), (max-resolution: 130dpi) and (max-device-width : 320px)").matches)return"ldpi";if(window.matchMedia("only screen and (-webkit-max-device-pixel-ratio: 1), (max--moz-device-pixel-ratio: 1)").matches)return"mdpi";if(window.matchMedia("only screen and (-webkit-max-device-pixel-ratio: 1.5), (max--moz-device-pixel-ratio: 1.5)").matches)return"hdpi";if(window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 2), (min--moz-device-pixel-ratio: 2)").matches)return"xhdpi"}return"desktop"},isInt:function(e){return"number"==typeof e&&e%1==0},getAdaptiveIcon:function(e){var t,i,n,r=DG.Utils.getScreenDensity();switch("desktop"==r?(i=e.desktop,t=i[0]):(i=e.mobile,t=i[0].replace("{density}",r)),r){case"ldpi":n=.75;break;case"mdpi":n=1;break;case"hdpi":n=1.5;break;case"xhdpi":n=1;break;default:n=1}if(!DG.Utils.isInt(i[1])||!DG.Utils.isInt(i[2]))throw TypeError('Wrong attribute type for constructor "getAdaptiveIcon"');w=i[1],h=i[2];var o=void 0;"undefined"!=typeof i[3]&&"function"==typeof i[3]&&(o=i[3]);var s=new DG.Size(Math.round(w*n),Math.round(h*n));return new DG.Icon(t,s,o)},toJSON:function(e){if(window.JSON)return JSON.stringify(e);switch(typeof e){case"object":if(e){var t=[];if(e instanceof Array){for(var i=0;i<e.length;i++)t.push(this.toJSON(e[i]));return"["+t.join(",")+"]"}for(var n in e)t.push('"'+n+'":'+this.toJSON(e[n]));return"{"+t.join(",")+"}"}return"null";case"string":return'"'+e.replace(/(["'])/g,"\\$1")+'"';case"number":case"boolean":return new String(e)}},getProjectTime:function(e,t){var i,n,r,o=e.getCurrentProject();return n=t?new Date(t):new Date,o&&o.tzoffset?(i=o.tzoffset,r=n.getTime()+6e4*n.getTimezoneOffset(),new Date(r+6e4*i)):n},getDistance:function(e,t){if(!(e instanceof DG.GeoPoint&&t instanceof DG.GeoPoint))throw TypeError("Wrong arguments for calculate distance");var i=6378137,n=e.clone().toLonLat(),r=t.clone().toLonLat(),o=(r.lat-n.lat)*Math.PI/180,s=(r.lon-n.lon)*Math.PI/180,a=n.lat*Math.PI/180,l=r.lat*Math.PI/180,h=Math.sin(o/2)*Math.sin(o/2)+Math.sin(s/2)*Math.sin(s/2)*Math.cos(a)*Math.cos(l),c=2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h));return i*c},generateRandom:function(e){return Math.floor(Math.random()*(e+1))},getNearestPointInLine:function(e,t,i,n,r,o){if("number"!=typeof e||"number"!=typeof t||"number"!=typeof i||"number"!=typeof n||"number"!=typeof r||"number"!=typeof o)throw TypeError("Wrong arguments for calculate nearest point in line to the given point");var s,a,l,h;return n==o?(h=n,l=e):i==r?(h=t,l=i):(s=(n-o)/(i-r),a=n-i*s,l=(e/s+t-a)/(s+1/s),h=s*l+a),new DG.GeoPoint(l,h)}},DG.Utils.lastSeqID=0,DG.Utils.Profiler={},DG.Utils.WKT={},DG.Utils.DOM={},DG.ControlPosition=DG.Class({_position:null,_offsets:null,initialize:function(e,t){if(DG.Utils.iNU(e))throw TypeError("No value position");if(e!==DG.ControlPosition.BOTTOM_LEFT&&e!==DG.ControlPosition.BOTTOM_RIGHT&&e!==DG.ControlPosition.TOP_LEFT&&e!==DG.ControlPosition.TOP_RIGHT)throw TypeError("Incorrect value of the position");if(DG.Utils.iNU(t))throw TypeError("No value offset");if(!(t instanceof DG.Point))throw TypeError("The offset is not an instance of DG.Point");this._position=e,this._offsets=t},apply:function(e){var t=DG.Utils.iNU(this._offsets)?0:this._offsets.x,i=DG.Utils.iNU(this._offsets)?0:this._offsets.y;switch(this._position){case DG.ControlPosition.BOTTOM_LEFT:e.style.bottom=0+i+"px",e.style.left=0+t+"px";break;case DG.ControlPosition.BOTTOM_RIGHT:e.style.bottom=0+i+"px",e.style.right=0+t+"px";break;case DG.ControlPosition.TOP_LEFT:e.style.top=0+i+"px",e.style.left=0+t+"px";break;case DG.ControlPosition.TOP_RIGHT:e.style.top=0+i+"px",e.style.right=0+t+"px"}},getOffset:function(){return this._offsets.clone()},CLASS_NAME:"DG.ControlPosition"}),DG.ControlPosition.BOTTOM_LEFT=1,DG.ControlPosition.BOTTOM_RIGHT=2,DG.ControlPosition.TOP_LEFT=3,DG.ControlPosition.TOP_RIGHT=4,DG.Bounds=DG.Class(OpenLayers.Bounds,{_leftBottom:null,_rightTop:null,_centerGeoPoint:null,initialize:function(e,t){if(!(e instanceof DG.GeoPoint&&e instanceof DG.GeoPoint))throw TypeError("Wrong arguments for constructor");if(e.getLon()>t.getLon()||e.getLat()>t.getLat())throw Error("Invalid bounds");this._leftBottom=e.clone().toLonLat(),this._rightTop=t.clone().toLonLat(),e=e.toMercator(),t=t.toMercator();var i=[e.lon,e.lat,t.lon,t.lat];OpenLayers.Bounds.prototype.initialize.apply(this,i)},contains:function(e){if(e instanceof DG.GeoPoint){var t=this._leftBottom,i=this._rightTop;return i.getLat()>=e.getLat()&&t.getLat()<=e.getLat()&&t.getLon()<=e.getLon()&&i.getLon()>=e.getLon()}return OpenLayers.Bounds.prototype.contains.call(this,e)},getBottom:function(){if(!this._leftBottom)throw new Error("Bound is empty");return this._leftBottom.getLat()},getLeft:function(){if(!this._leftBottom)throw new Error("Bound is empty");return this._leftBottom.getLon()},getTop:function(){if(!this._rightTop)throw new Error("Bound is empty");return this._rightTop.getLat()},getRight:function(){if(!this._rightTop)throw new Error("Bound is empty");return this._rightTop.getLon()},getLeftBottom:function(){if(!this._leftBottom)throw new Error("Bound is empty");return this._leftBottom.clone()},getLeftTop:function(){if(!this._rightTop||!this._leftBottom)throw new Error("Bound is empty");return new DG.GeoPoint(this._leftBottom.getLon(),this._rightTop.getLat())},getRightBottom:function(){if(!this._rightTop||!this._leftBottom)throw new Error("Bound is empty");return new DG.GeoPoint(this._rightTop.getLon(),this._leftBottom.getLat())},getRightTop:function(){if(!this._rightTop)throw new Error("Bound is empty");return this._rightTop.clone()},getCenterGeoPoint:function(){return this._centerGeoPoint||(this._centerGeoPoint=new DG.GeoPoint(this.getCenterLonLat().lon,this.getCenterLonLat().lat,DG.GeoPoint.EPSG_900913)),this._centerGeoPoint},getCenter:function(){return this._centerGeoPoint||(this._centerGeoPoint=new DG.GeoPoint(this.getCenterLonLat().lon,this.getCenterLonLat().lat,DG.GeoPoint.EPSG_900913)),this._centerGeoPoint},intersects:function(e){return OpenLayers.Bounds.prototype.intersectsBounds.apply(this,[e,!0])},clone:function(){return new DG.Bounds(this._leftBottom,this._rightTop)},destroy:function(){delete this._leftBottom,delete this._rightTop,delete this._centerGeoPoint},clear:function(){this._leftBottom=null,this._rightTop=null,this._centerGeoPoint=!1},containsBounds:function(e,t,i){e instanceof OpenLayers.Bounds&&(e=new DG.Bounds(new DG.GeoPoint(e.left,e.bottom,DG.GeoPoint.EPSG_900913),new DG.GeoPoint(e.right,e.top,DG.GeoPoint.EPSG_900913))),null==t&&(t=!1),null==i&&(i=!0);var n=this.contains(e.getLeftBottom()),r=this.contains(e.getRightBottom()),o=this.contains(e.getLeftTop()),s=this.contains(e.getRightTop());return t?n||r||o||s:n&&r&&o&&s},equals:function(e){return e instanceof OpenLayers.Bounds&&(e=new DG.Bounds(new DG.GeoPoint(e.left,e.bottom,DG.GeoPoint.EPSG_900913),new DG.GeoPoint(e.right,e.top,DG.GeoPoint.EPSG_900913))),this.getLeftBottom().equals(e.getLeftBottom())&&this.getRightTop().equals(e.getRightTop())},CLASS_NAME:"DG.Bounds"}),DG.Overlays={},DG.Balloons.Common=DG.Class(DG.Balloons.Base,{_id:null,_dgMap:null,_observers:[],_catchObserversIndexes:[],_div:null,_isDebug:!1,_adjustMapCenterToBalloon:!0,_isClosed:!0,_contentSize:null,_contentHtml:null,_headerContentHtml:null,_footerContentHtml:null,_killWhenClose:!1,_closeCallback:null,_geoPoint:null,_draggable:!1,_dragStartCallback:null,_dragStopCallback:null,_fixedRelativePosition:!1,_maxContentHeight:null,_maxContentWidth:null,_maxHeaderHeight:null,_maxFooterHeight:null,_view:null,_eventBehavior:null,_helper:null,_debugger:null,_shape:null,_drawer:null,initialize:function(e){this._shape=new DG.Balloons.Common.Shape(this),this._initializeOptions(e),this._initializeDiv(),this._generateRandomId(),this._div.id=this.getId(),this._observers=[]},_initializeOptions:function(e){this._initializeGeoPoint(e.geoPoint),this._initializeContentHtml(e.contentHtml),this._initializeHeaderContentHtml(e.headerContentHtml),this._initializeFooterContentHtml(e.footerContentHtml),this._initializeKillWhenClose(e.killWhenClose),this._initializeCloseCallback(e.closeCallback),this._initializeIsClosed(e.isClosed),this._initializeContentSize(e.contentSize),this._initializeAdjustMapCenterToBalloon(e.adjustMapCenterToBalloon),this._initializeDraggable(e.draggable),this._initializeDragStartCallback(e.dragStartCallback),this._initializeDragStopCallback(e.dragStopCallback),this._initializeMaxContentHeight(e.maxContentHeight),this._initializeMaxContentWidth(e.maxContentWidth),this._initializeMaxHeaderHeight(e.maxHeaderHeight),this._initializeMaxFooterHeight(e.maxFooterHeight),this._initializeFixedRelativePosition(e.fixedRelativePosition)},_initializeContentHtml:function(e){if(null==e)throw new ReferenceError('Option "contentHtml" is required');if("[object String]"!==Object.prototype.toString.call(e))throw new TypeError('Option "contentHtml" should be String');this._contentHtml=e},_initializeHeaderContentHtml:function(e){if(!DG.Utils.empty(e)&&"[object String]"!==Object.prototype.toString.call(e))throw new TypeError('Option "headerContentHtml" should be String');this._headerContentHtml=e},_initializeFooterContentHtml:function(e){if(!DG.Utils.empty(e)&&"[object String]"!==Object.prototype.toString.call(e))throw new TypeError('Option "headerContentHtml" should be String');this._footerContentHtml=e},_initializeGeoPoint:function(e){if(DG.Utils.empty(e))throw new ReferenceError("Balloon must have geo point");if(!(e instanceof DG.GeoPoint))throw new ReferenceError('Option "geoPoint" is required and should be instance of "DG.GeoPoint"');this._geoPoint=e.clone(),this._geoPoint.toMercator()},_initializeKillWhenClose:function(e){if(void 0!==e){if("[object Boolean]"!==Object.prototype.toString.call(e))throw new TypeError('Option "killWhenClose" should be Boolean');this._killWhenClose=e}},_initializeCloseCallback:function(e){if(void 0!==e){if("[object Function]"!==Object.prototype.toString.call(e))throw new TypeError('Option "closeCallback" should be Function');this._closeCallback=e}},_initializeIsClosed:function(e){if(void 0!==e){if("[object Boolean]"!==Object.prototype.toString.call(e))throw new TypeError('Option "isClosed" should be Boolean');this._isClosed=e}},_initializeContentSize:function(e){if(void 0!==e){if(!(e instanceof DG.Size))throw new TypeError('Option "contentSize" should be instance of "DG.Size"');if(e.width<this._shape.minWidth)throw new ReferenceError("Minimal acceptable balloon width is "+this._shape.minWidth+"px");this._contentSize=e}},_initializeAdjustMapCenterToBalloon:function(e){if(void 0!==e){if("[object Boolean]"!==Object.prototype.toString.call(e))throw new TypeError('Option "adjustMapCenterToBalloon" should be Boolean');this._adjustMapCenterToBalloon=e}},_initializeDraggable:function(e){if(void 0!==e){if("[object Boolean]"!==Object.prototype.toString.call(e))throw new TypeError('Option "draggable" should be Boolean');this._draggable=e}},_initializeDragStartCallback:function(e){if(void 0!==e){if("[object Function]"!==Object.prototype.toString.call(e))throw new TypeError('Option "dragStartCallback" should be Function');this._dragStartCallback=e}},_initializeDragStopCallback:function(e){if(void 0!==e){if("[object Function]"!==Object.prototype.toString.call(e))throw new TypeError('Option "dragStopCallback" should be Function');this._dragStopCallback=e}},_initializeMaxContentHeight:function(e){if(void 0!==e){if("[object Number]"!==Object.prototype.toString.call(e))throw new TypeError('Option "maxContentHeight" should be Number');this._maxContentHeight=e}},_initializeMaxContentWidth:function(e){if(void 0!==e){if("[object Number]"!==Object.prototype.toString.call(e))throw new TypeError('Option "maxContentWidth" should be Number');if(e>this._shape.maxWidth)throw new ReferenceError("Maximum acceptable balloon maxContentWidth is "+this._shape.maxWidth+"px");if(e<this._shape.minWidth)throw new ReferenceError("Minimal acceptable balloon maxContentWidth is "+this._shape.minWidth+"px");this._maxContentWidth=e}},_initializeMaxHeaderHeight:function(e){if(void 0!==e){if("[object Number]"!==Object.prototype.toString.call(e))throw new TypeError('Option "maxHeaderHeight" should be a Number');this._maxHeaderHeight=e}},_initializeMaxFooterHeight:function(e){if(void 0!==e){if("[object Number]"!==Object.prototype.toString.call(e))throw new TypeError('Option "maxFooterHeight" should be a Number');this._maxFooterHeight=e}},_initializeFixedRelativePosition:function(e){if(void 0!==e){if("[object Boolean]"!==Object.prototype.toString.call(e))throw new TypeError('Option "fixedRelativePosition" should be Boolean');this._fixedRelativePosition=e}},_initializeDiv:function(){this._div=DG.Utils.createDiv(this._id)},_generateRandomId:function(){this._id=DG.Utils.createUniqueID(this.CLASS_NAME+"_")},initializeBeforeAddOnMap:function(){this._helper=new DG.Balloons.Common.GeneralHelper(this),this._view=new DG.Balloons.Common.View(this),this._eventBehavior=new DG.Balloons.Common.EventBehavior(this),this._drawer=new DG.Balloons.Common.Drawer(this),this._debugger=new DG.Balloons.Common.Debugger(this),this._eventBehavior.registerEvents()},prepareDivBeforeFirstDraw:function(){this._drawer.prepareDivBeforeFirstDraw()},setLayerContainerDiv:function(e){this._drawer.setLayerContainerDiv(e)},setZIndex:function(e){this._div.style.zIndex=e},onAddToMap:function(){this._drawer.onAddToMap(),DG.EventManager.caller(new DG.Events.Overlay(this),this.getContainerId(),"DgBalloonShow")},onMapUpdate:function(){},getContainerId:function(){return this._id},enableDraggable:function(){this._draggable=!0,this._dgMap&&(this._drawer.fullRedraw(),this._eventBehavior.registerCatchEventsIfNecessary())},disableDraggable:function(){this._draggable=!1,this._dgMap&&(this._drawer.fullRedraw(),this._eventBehavior.unregisterCatchEvents())},clearBeforeRemoveFromMap:function(){},setDgMap:function(e){this._dgMap=e},moveToGeoPoint:function(e,t){this.setPosition(e),t&&this.setContent(t)},getPosition:function(){var e=this._geoPoint.clone();return e.toLonLat()},setPosition:function(e){if(!(e instanceof DG.GeoPoint))throw new ReferenceError('Param "geoPoint" is required and should be instance of "DG.GeoPoint"');this._drawer&&this._drawer.moveTo(e)},getContent:function(){return this._contentHtml},setContent:function(e,t){if("[object String]"!==Object.prototype.toString.call(e))throw new TypeError("Parameter content should be a String");this._contentHtml=e,this._drawer.fullRedraw(!0,!1,!1,!t),this.isVisible()&&this._drawer.panIntoViewIfNecessary()},getHeaderContent:function(){return this._headerContentHtml},setHeaderContent:function(e){if("[object String]"!==Object.prototype.toString.call(e))throw new TypeError("Parameter content should be a String");this._headerContentHtml=e,DG.Utils.iNU(this._drawer)||this._drawer.fullRedraw(!1,!0,!1,!1)},getFooterContent:function(){return this._footerContentHtml},setFooterContent:function(e){if("[object String]"!==Object.prototype.toString.call(e))throw new TypeError("Parameter content should be a String");this._footerContentHtml=e,DG.Utils.iNU(this._drawer)||this._drawer.fullRedraw(!1,!1,!0,!1)},show:function(){this._div.style.display="",this.redraw(),this._drawer.panIntoViewIfNecessary(),DG.EventManager.caller(new DG.Events.Overlay(this),this.getContainerId(),"DgBalloonShow")},hide:function(){this.isRelativePositionFixed()&&this._drawer&&(this._drawer._currentCorner=null),this._div.style.display="none",DG.EventManager.caller(new DG.Events.Overlay(this),this.getContainerId(),"DgBalloonHide")},getId:function(){return this._id},hideCloseButton:function(){this._isClosed=!1,this._drawer.hideCloseButton()},showCloseButton:function(){this._isClosed=!0,this._drawer.showCloseButton()},onRemoveFromMap:function(){this.destroy()},destroy:function(){for(;this._observers.length;)this._observers.pop().cleanup();this._catchObserversIndexes=[],this._contentSize=null,this._geoPoint=null,this._closeCallback=null,this._drawer.destroy(),this._div=null,this._dragStartCallback=null,this._dragStopCallback=null,this._drawer.destroy(),this._eventBehavior.destroy(),this._helper=null,this._shape=null,this._view=null,this._eventBehavior=null,this._drawer=null,this._debugger=null,this._dgMap=null},setSize:function(e){if(!(e instanceof DG.Size))throw new TypeError('Option size should be an instance of "DG.Size"');this._initializeContentSize(e),this._drawer.fullRedraw(),this.isVisible()&&this._drawer.panIntoViewIfNecessary()},getSize:function(){return null!==this._contentSize?this._contentSize.clone():new DG.Size(this._drawer.getAutoSizeContentWidth(),this._drawer.getAutoSizeContentHeight())},flushSize:function(){this._contentSize=null,this._drawer.fullRedraw()},enableAdjustMapCenterToBalloon:function(){this._adjustMapCenterToBalloon=!0},disableAdjustMapCenterToBalloon:function(){this._adjustMapCenterToBalloon=!1},redraw:function(){var e=this._helper.getContentIdInsideScroll();this._contentHtml=DG.Utils.obj(e).innerHTML,this._drawer.fullRedraw()},isAutoSize:function(){return!this._contentSize},getDiv:function(){return this._div},getView:function(){return this._view},getEventBehavior:function(){return this._eventBehavior},getHelper:function(){return this._helper},getDebugger:function(){return this._debugger},getShape:function(){return this._shape},getDrawer:function(){return this._drawer},getDgMap:function(){return this._dgMap},getObservers:function(){return this._observers},getCatchObserversIndexes:function(){return this._catchObserversIndexes;
},resetCatchObserversIndexes:function(){this._catchObserversIndexes=[]},isDebug:function(){return this._isDebug},getAdjustMapCenterToBalloon:function(){return this._adjustMapCenterToBalloon},getIsClosed:function(){return this._isClosed},getContentSize:function(){return this._contentSize},getKillWhenClose:function(){return this._killWhenClose},getGeoPoint:function(){return this._geoPoint},setGeoPoint:function(e){this._geoPoint=e},getDraggable:function(){return this._draggable},getDragStartCallback:function(){return this._dragStartCallback},getDragStopCallback:function(){return this._dragStopCallback},isVisible:function(){return!!this._dgMap&&"none"!==this._div.style.display},isRelativePositionFixed:function(){return this._fixedRelativePosition},getMaxContentHeight:function(){return this._maxContentHeight},getMaxContentWidth:function(){return this._maxContentWidth},getMaxHeaderHeight:function(){return this._maxHeaderHeight},getMaxFooterHeight:function(){return this._maxFooterHeight},panToViewport:function(){this._drawer.panIntoViewIfNecessary()},isHorizontalScrollEnabled:function(){var e=this._drawer.scrollPosition[0];return e[0]!==!1||e[1]!==!1},isVerticalScrollEnabled:function(){var e=this._drawer.scrollPosition[1];return e[0]!==!1||e[1]!==!1},getHorizontalScrollPosition:function(){return this._drawer.scrollPosition[0][0]},getMaxHorizontalScrollPosition:function(){return this._drawer.scrollPosition[0][1]},getVerticalScrollPosition:function(){return this._drawer.scrollPosition[1][0]},getMaxVerticalScrollPosition:function(){return this._drawer.scrollPosition[1][1]},scrollContent:function(e,t){this._drawer.scrollContent(e,t)},CLASS_NAME:"DG.Balloons.Common"}),DG.Balloons.Common.Debugger=DG.Class({_balloon:null,initialize:function(e){this._balloon=e},debug:function(e){if(this._balloon.isDebug()){var t,i;t=new DG.Style.Geometry,t.fillColor="#ff00ff",t.fillOpacity=.5,t.strokeColor="blue",t.strokeOpacity=1,t.strokeWidth=1,i=new DG.Geometries.Circle(e,5,t),this._balloon.getDgMap().geometries.add(i)}},CLASS_NAME:"DG.Balloons.Common.Debugger"}),DG.Balloons.Common.Drawer=DG.Class({_balloon:null,_corners:["tl","tr","bl","br"],_currentCorner:null,_previousCorner:null,_currentContainerVisibleClass:"",_layerContainerDiv:null,_scrollDiv:null,_contentDiv:null,_scrollMContentDiv:null,_contentDimensions:null,scrollPosition:null,initialize:function(e){this._balloon=e},setLayerContainerDiv:function(e){this._layerContainerDiv=e},prepareDivBeforeFirstDraw:function(){this.calculateCurrentCornerIfNecessary(),this._calculateAndSetNewDivWidth(),this.fillDivFromTemplate(),this.calculateAndSetNewDivPosition()},_calculatePoint:function(){var e,t,i,n;return e=this._balloon.getGeoPoint().clone(),t=this._balloon.getDgMap().converter.coordinatesToMapPixels(e),i=parseInt(this._layerContainerDiv.style.left),n=parseInt(this._layerContainerDiv.style.top),new DG.Point(t.x-i,t.y-n)},calculateCurrentCornerIfNecessary:function(){var e,t;if(!this._balloon.getEventBehavior().isDraggingNow()&&(DG.Utils.iNU(this._currentCorner)||!this._balloon.isRelativePositionFixed())){if(this._previousCorner=this._currentCorner,e=this._balloon.getDgMap().getCenter(),t="",t+=this._balloon.getDraggable()?"b":this._balloon.getGeoPoint().getLat()<e.getLat()?"b":"t",t+=this._balloon.getGeoPoint().getLon()<e.getLon()?"l":"r",!DG.Utils.inArray(t,this._corners))throw"Invalid position param";this._currentCorner=t}},_calculateAndSetNewDivWidth:function(){var e,t;e=this._getContentAndAreaSize(),t=this._balloon.getDiv().style.width!=e.width,e.width&&t&&(this._balloon.getDiv().style.width=e.width+"px")},_getContentAndAreaSize:function(){var e,t;return this._balloon.isAutoSize()?(e=this._getNormalContentHeight(),t=this._getNormalContentWidth()):(e=this._balloon.getContentSize().height+this._balloon.getShape().areaHeight+15,t=this._getContainerWidth()+this._balloon.getShape().areaWidth),new DG.Size(t+this._balloon.getShape().scrollThickness,e)},_getHeaderAndFooterHeight:function(){var e,t,i=0,n=0;return e=DG.Utils.obj("content_"+this._balloon.getDiv().id+"_header"),t=DG.Utils.obj("content_"+this._balloon.getDiv().id+"_footer"),DG.Utils.iNU(e)||(i=e.clientHeight),DG.Utils.iNU(t)||(n=t.clientHeight),i+n},_getNormalContentHeight:function(){return this.getAutoSizeContentHeight()+this._balloon.getShape().areaHeight},_getNormalContentWidth:function(){var e,t=this._getContentDimensions(),i=t.width;return e=this._isTooSmallWidth(i)?this._balloon.getShape().minWidth:this._isTooBigWidth(i)?this._balloon.getShape().maxWidth:i,e+=this._balloon.getShape().areaWidth},getAutoSizeContentHeight:function(){return this.isExceededMaxContentHeight()?this._balloon.getMaxContentHeight():this._getContentDimensions().height},getAutoSizeContentWidth:function(){return this.isExceededMaxContentWidth()?this._balloon.getMaxContentWidth():this._getContentDimensions().width},_getContentDimensions:function(){if(null===this._contentDimensions){var e={},t={};e.minWidth=this._balloon.getShape().minWidth,e.maxWidth=this._balloon.getShape().maxWidth,t.w=this._balloon.getMaxContentWidth(),this._contentDimensions=DG.Utils.getRenderedDimensions(this._balloon.getContent(),t,e,{displayClass:"dg-tmp-callout-content",containerElement:this._balloon.getDgMap().getOlMap().layerContainerDiv}),"Opera"===DG.Utils.detectBrowser()[0]&&(this._contentDimensions.height+=this._balloon.getShape().areaHeight/2)}return this._contentDimensions},_getContentWidthArea:function(){var e=this._getContentDimensions(),t=e.width;return t+this._balloon.getShape().areaWidth},_isTooSmallWidth:function(e){return e<this._balloon.getShape().minWidth},_isTooBigWidth:function(e){return e>this._balloon.getShape().maxWidth},_getContainerWidth:function(){if(!this._balloon.getContentSize())return this._balloon.getShape().minWidth;var e=this._balloon.getContentSize().width;return this._isTooSmallWidth(e)?this._balloon.getShape().minWidth:this._isTooBigWidth(e)?this._balloon.getShape().maxWidth:e},calculateAndSetNewDivPosition:function(){var e,t,i,n,r=10;n=this._calculatePoint(),e=n.x,t=n.y,i=this._getOffsetForCornerTargeting(),e+=i.x,t+=i.y,this._balloon.getDraggable()&&(t-=r),this._balloon.getDiv().style.left=e+"px",this._balloon.getDiv().style.top=t+"px"},_getOffsetForCornerTargeting:function(){var e,t,i,n,r,o;return i=this._getContentAndAreaSize(),n=this._getHeaderAndFooterHeight(),e=this._balloon.getIsClosed()?-this._balloon.getShape().closeButtonHeight:0,r=this._balloon.getDraggable()?-this._balloon.getShape().dragCatchHeight:0,o=this._balloon.getIsClosed()?e:r,t={tl:{x:this._balloon.getShape().staticShifts.tl.x,y:this._balloon.getShape().staticShifts.tl.y},tr:{x:this._balloon.getShape().staticShifts.tr.x-i.width,y:this._balloon.getShape().staticShifts.tr.y},bl:{x:this._balloon.getShape().staticShifts.bl.x,y:this._balloon.getShape().staticShifts.bl.y-i.height+o-n},br:{x:this._balloon.getShape().staticShifts.br.x-i.width,y:this._balloon.getShape().staticShifts.br.y-i.height+o-n}},t[this._currentCorner]},fullRedraw:function(e,t,i,n){this._contentDimensions=null,this.calculateCurrentCornerIfNecessary(),this._calculateAndSetNewDivWidth(),this.fillDivDOMSafely(e,t,i),this.calculateAndSetNewDivPosition(),this.activateScroll(n)},activateScroll:function(e){var t,i=this;e=e||!1,DG.fleXcroll.fleXcrollMain(this._balloon.getHelper().getContentId()),t=document.getElementById(this._balloon.getHelper().getContentId()),e===!0&&t.fleXcroll.setScrollPos(0,0),this.updateScrollWidthAndHeight(),this.updateScrollFades(t,!0),this.scrollPosition=t.fleXdata.scrollPosition,t.onfleXcroll=function(){i.scrollPosition=this.fleXdata.scrollPosition,i.updateScrollFades(this),i._fireBalloonScrollEvent()}},_fireBalloonScrollEvent:function(){DG.EventManager.caller(new DG.Events.Overlay(this._balloon),this._balloon.getDgMap().getMapContainerId(),"DgBalloonScroll")},updateScrollBars:function(){this._contentDiv=this._contentDiv||DG.Utils.obj(this._balloon.getHelper().getContentId()),this._contentDiv.fleXcroll.updateScrollBars()},scrollContent:function(e,t){this._contentDiv=this._contentDiv||DG.Utils.obj(this._balloon.getHelper().getContentId()),this._contentDiv.fleXcroll.scrollContent(e,t)},updateScrollFades:function(e,t){var i=e.fleXdata.scrollPosition,n=e.parentNode,r=DG.Utils.DOM.getElementsByClassName(this._balloon.getHelper().getScrollTopFadeClass(),n)[0],o=DG.Utils.DOM.getElementsByClassName(this._balloon.getHelper().getScrollBottomFadeClass(),n)[0],s=DG.Utils.DOM.getElementsByClassName(this._balloon.getHelper().getScrollLeftFadeClass(),n)[0],a=DG.Utils.DOM.getElementsByClassName(this._balloon.getHelper().getScrollRightFadeClass(),n)[0];DG.Utils.DOM.addClass(r,this._balloon.getHelper().getHiddenClass()),DG.Utils.DOM.addClass(a,this._balloon.getHelper().getHiddenClass()),DG.Utils.DOM.addClass(o,this._balloon.getHelper().getHiddenClass()),DG.Utils.DOM.addClass(s,this._balloon.getHelper().getHiddenClass()),i[1][0]!==!1&&(t&&(DG.Utils.DOM.addClass(n,this._balloon.getHelper().getVScrollActiveClass()),this.updateScrollBars()),i[1][0]?DG.Utils.DOM.removeClass(r,this._balloon.getHelper().getHiddenClass()):DG.Utils.DOM.addClass(r,this._balloon.getHelper().getHiddenClass()),i[1][0]==i[1][1]?DG.Utils.DOM.addClass(o,this._balloon.getHelper().getHiddenClass()):DG.Utils.DOM.removeClass(o,this._balloon.getHelper().getHiddenClass())),i[0][0]!==!1&&(t&&(DG.Utils.DOM.addClass(n,this._balloon.getHelper().getHScrollActiveClass()),this.updateScrollBars()),i[0][0]?DG.Utils.DOM.removeClass(s,this._balloon.getHelper().getHiddenClass()):DG.Utils.DOM.addClass(s,this._balloon.getHelper().getHiddenClass()),i[0][0]==i[0][1]?DG.Utils.DOM.addClass(a,this._balloon.getHelper().getHiddenClass()):DG.Utils.DOM.removeClass(a,this._balloon.getHelper().getHiddenClass()))},updateScrollWidthAndHeight:function(){this._scrollDiv=this._scrollDiv||DG.Utils.obj(this._balloon.getHelper().getScrollWrapperId()),this._contentDiv=this._contentDiv||DG.Utils.obj(this._balloon.getHelper().getContentId()),this._scrollMContentDiv=this._scrollMContentDiv||DG.Utils.obj(this._balloon.getHelper().getMContentIdInsideScroll());var e=this.getContentSizeHeight();e<0&&(e=0),e+="px",this._contentDiv.style.height=e,this._scrollMContentDiv.style.height=e,this._scrollDiv.style.height=e;var t=this.getContentSizeWidth();t<0&&(t=0),t+="px",this._contentDiv.style.width=t,this._scrollMContentDiv.style.width=t,this._scrollDiv.style.width=t,this.updateScrollBars()},getContentSizeHeight:function(){var e;return e=this._balloon.isAutoSize()?this.getAutoSizeContentHeight()-this._balloon.getShape().areaHeight+this._balloon.getShape().scrollThickness:this._balloon.getContentSize().height},getContentSizeWidth:function(){var e;return e=this._balloon.isAutoSize()?this.getAutoSizeContentWidth():this._balloon.getContentSize().width,e+this._balloon.getShape().scrollThickness},hasScroll:function(){return!this._balloon.isAutoSize()||!!this.isExceededMaxContentHeight()},panIntoViewIfNecessary:function(){if(this._balloon.getAdjustMapCenterToBalloon()&&!this._balloon.getEventBehavior().isDraggingNow()){var e=this._balloon.getShape().paddingInPanIntoView,t=this._balloon.getDgMap().getOlMap().getSize(),i=this._getContentAndAreaSize();i.h+=this._getHeaderAndFooterHeight(),i.height+=this._getHeaderAndFooterHeight();var n=this._balloon.getDgMap().getViewPortPxFromLayerPx(new DG.Point(parseInt(this._balloon.getDiv().style.left),parseInt(this._balloon.getDiv().style.top))),r=n.clone();n.x<e.left?r.x=e.left:n.x+i.w>t.w-e.right&&(r.x=t.w-e.right-i.w),n.y<e.top?r.y=e.top:n.y+i.h>t.h-e.bottom&&(r.y=t.h-e.bottom-i.h);var o=n.x-r.x,s=n.y-r.y;if(t.w<i.w+e.left){var a,l,h=i.w/2,c=t.w/2;n.x<0&&(a=n.x+h,a<0&&(l=-(Math.abs(a)+c)),a>=0&&(l=-(c-a))),n.x>=0&&(a=n.x+h,l=a-c)}s&&(this._isCurrentTop()&&(s-=this._balloon.getShape().topShiftInPanIntoView),this._isCurrentBottom()&&(s+=this._balloon.getShape().bottomShiftForCopyrightsInPanIntoView));var u=this.getPointBounds();u._leftBottom.x-=o,u._leftBottom.y-=s,u._rightTop.x-=o,u._rightTop.y-=s;var d=this._getIntersectedBounds(u);if(!DG.Utils.iNU(d)){var p=0,g=0,m="",f=new DG.Point(u.getLeft(),u.getTop());switch(d.contains(f)&&(m="tl"),f=new DG.Point(u.getRight(),u.getTop()),d.contains(f)&&(m="tr"),f=new DG.Point(u.getLeft(),u.getBottom()),d.contains(f)&&(m="bl"),f=new DG.Point(u.getRight(),u.getBottom()),d.contains(f)&&(m="br"),m){case"tr":p=u.getRight()-d.getLeft(),g=u.getTop()-d.getBottom();break;case"tl":p=u.getLeft()-d.getRight(),g=u.getTop()-d.getBottom();break;case"br":p=u.getRight()-d.getLeft(),g=u.getBottom()-d.getTop();break;case"bl":p=u.getLeft()-d.getRight(),g=u.getBottom()-d.getTop()}o+=p>50?0:p,s+=g>50?0:g}l&&(o=l),(o||s)&&this._balloon.getDgMap().getOlMap().pan(o,s)}},_isCurrentTop:function(){return"tr"===this._currentCorner||"tl"===this._currentCorner},_isCurrentBottom:function(){return"br"===this._currentCorner||"bl"===this._currentCorner},moveTo:function(e){if(!(e instanceof DG.GeoPoint))throw new ReferenceError('Param "geoPoint" is required and should be instance of "DG.GeoPoint"');this._balloon.setGeoPoint(e),this.calculateCurrentCornerIfNecessary(),this.isChangeCurrentPosition()&&(this.fillDivDOMSafely(),this.activateScroll()),this.calculateAndSetNewDivPosition(),this.panIntoViewIfNecessary(),DG.EventManager.caller({geoPoint:this._balloon.getGeoPoint()},this._balloon.getDgMap().getMapContainerId(),"DgBalloonMoveEnd")},isChangeCurrentPosition:function(){return this._currentCorner!==this._previousCorner},onAddToMap:function(){this.activateScroll(),this.panIntoViewIfNecessary(),this.calculateAndSetNewDivPosition()},onMapUpdate:function(){this.calculateCurrentCornerIfNecessary(),this.isChangeCurrentPosition()&&(this.fillDivDOMSafely(),this.activateScroll()),this.calculateAndSetNewDivPosition()},hideCloseButton:function(){this._balloon.getDiv().className=this._currentContainerVisibleClass+" "+this._balloon.getHelper().getClassToHideTheCloseButton()},showCloseButton:function(){this._balloon.getDiv().className=this._currentContainerVisibleClass},destroy:function(){},getCurrentCorner:function(){return this._currentCorner},setCurrentContainerVisibleClass:function(e){this._currentContainerVisibleClass=e},fillDivFromTemplate:function(){var e=this._balloon.getView().getCompletedTemplate();this._balloon.getDiv().className=e.containerClass,this._balloon.getDiv().innerHTML=e.internalHtml},fillDivDOMSafely:function(e,t,i){var n,r,o,s,a,l,h,c,u,d,p;if(h=this._balloon.getHelper().getContentIdInsideScroll(),n=DG.Utils.obj(h),e&&!DG.Utils.iNU(n)&&(n.innerHTML=this._balloon.getContent()),r=DG.Utils.obj(this._balloon.getHelper().getHeaderContentId()),t&&!DG.Utils.iNU(r)){r.innerHTML=this._balloon.getHeaderContent();var g="";DG.Utils.iNU(this._balloon.getHeaderContent())?g="0px":DG.Utils.iNU(this._balloon.getMaxHeaderHeight())||(g=this._balloon.getMaxHeaderHeight()+"px"),r.style.maxHeight=g}if(o=DG.Utils.obj(this._balloon.getHelper().getFooterContentId()),i&&!DG.Utils.iNU(o)){o.innerHTML=this._balloon.getFooterContent();var g="";DG.Utils.iNU(this._balloon.getFooterContent())?g="0px":DG.Utils.iNU(this._balloon.getMaxFooterHeight())||(g=this._balloon.getMaxFooterHeight()+"px"),o.style.maxHeight=g}this.updateScrollWidthAndHeight(),s=this._balloon.getView().getCatchBlock(),a=DG.Utils.obj(this._balloon.getHelper().getCatchId()),!s&&a&&a.parentNode.removeChild(a),s&&!a&&(l=this._balloon.getView().getCatchBlockDomElement(),this._balloon.getDiv().insertBefore(l,DG.Utils.obj(this._balloon.getHelper().getTailId()))),c=this._balloon.getView().getTargetBlock(),u=DG.Utils.obj(this._balloon.getHelper().getTailTargetId()),d=DG.Utils.obj(this._balloon.getHelper().getTailClearId()),!c&&u&&u.parentNode.removeChild(u),!c&&d&&d.parentNode.removeChild(d),c&&!u&&(p=this._balloon.getView().getTargetBlockElement(),this._balloon.getDiv().appendChild(p[0]),this._balloon.getDiv().appendChild(p[1])),this._balloon.getDiv().className=this._balloon.getView().getContainerClass()},getPointBounds:function(){var e=this._balloon.getDiv();return DG.Utils.iNU(e)?null:DG.Utils.getPointBounds(e,this._balloon.getDgMap().getContainerId())},_getIntersectedBounds:function(e){for(var t=this._balloon.getDgMap(),i=t.getControlsPointBounds(),n=null,r=0;r<i.length;r++)if(n=e.getIntersectionsWithBounds(i[r]),!DG.Utils.iNU(n))return i[r];return null},isExceededMaxContentHeight:function(){var e,t=this._getContentDimensions().height;return e=!!this._balloon.getMaxContentHeight()&&t>this._balloon.getMaxContentHeight()},isExceededMaxContentWidth:function(){var e,t=this._getContentDimensions().width;return e=!!this._balloon.getMaxContentWidth()&&t>this._balloon.getMaxContentWidth()},CLASS_NAME:"DG.Balloons.Common.Drawer"}),DG.Balloons.Common.EventBehavior=DG.Class({_balloon:null,_draggingNow:!1,_draggingStopped:!1,_isCatchEventsListenNow:!1,_touchClosePoint:null,initialize:function(e){this._balloon=e},registerEvents:function(){var e=this,t=this._balloon.getDgMap();this._balloon.getObservers().push(t.addEventListener("DgMapMove",function(t){if(e._balloon.isVisible())return e._handleDragMap(t)}),t.addEventListener("DgZoomChange",function(){if(e._balloon.isVisible())return e._handleZoomChange()}),t.addEventListener("DgMapRedraw",function(){if(e._balloon.isVisible())return e._balloon.redraw()}),t.addEventListener(this._balloon.getHelper().getCloseId(),"DgClick",function(t){return e._handleClose(t)}),t.addEventListener(this._balloon.getHelper().getCloseId(),"DgMouseDown",function(t){e._touchClosePoint=t.point}),t.addEventListener(this._balloon.getHelper().getCloseId(),"DgMouseUp",function(t){return e._handleCloseTouch(t)}),t.addEventListener(this._balloon.getId(),"DgDrag",function(e){return!0}),t.addEventListener(this._balloon.getId(),"DgClick",function(e){return!0}),t.addEventListener(this._balloon.getId(),"DgDoubleClick",function(e){return!0})),DG.Utils.isTouchDevice()&&this._balloon.getObservers().push(t.addEventListener(this._balloon.getHelper().getCloseId(),"DgMouseDown",function(t){e._handlePressedTouchClose(t)}),t.addEventListener(this._balloon.getHelper().getCloseId(),"DgMouseOut",function(t){e._handleOutTouchClose(t)}),t.addEventListener(this._balloon.getHelper().getCloseId(),"DgMouseUp",function(t){e._handleOutTouchClose(t)})),this.registerCatchEventsIfNecessary(),DG.EventManager.addIgnorElementDomID(this._balloon.getHelper().getContentId()),DG.EventManager.addIgnorElementDomID(this._balloon.getHelper().getHeaderContentId()),DG.EventManager.addIgnorElementDomID(this._balloon.getHelper().getFooterContentId())},registerCatchEventsIfNecessary:function(){var e,t,i,n,r,o;if(this._balloon.getDraggable()&&!this._isCatchEventsListenNow){e=this,t=this._balloon.getDgMap(),i=this._balloon.getHelper().getCatchId(),n={DgMouseDown:function(t){return e._handleDragStart(t)},DgDrag:function(t){return e._handleDrag(t)},DgDragStop:function(t){return e._handleDragStop(t)},DgMouseUp:function(t){return e._handleDragStop(t)},DgMouseOver:function(t){return e._handleMouseOver(t)},DgMouseOut:function(t){return e._handleMouseOut(t)},DgClick:function(e){return!0}},o=this._balloon.getObservers();for(var s in n)n.hasOwnProperty(s)&&(r=o.push(t.addEventListener(i,s,n[s]))-1,this._balloon.getCatchObserversIndexes().push(r));this._isCatchEventsListenNow=!0}},unregisterCatchEvents:function(){for(var e=this._balloon.getCatchObserversIndexes(),t=this._balloon.getObservers(),i=0,n=e.length;i<n;i++)e[i]in t&&t[e[i]].cleanup();t.splice(e[0],e.length),this._balloon.resetCatchObserversIndexes(),this._isCatchEventsListenNow=!1},_handleDrag:function(e){var t,i,n,r,o;return this._draggingNow=!0,t=this._balloon.getDgMap().converter.coordinatesToMapPixels(this._balloon.getGeoPoint()),i=e.delta[0],n=e.delta[1],r=new DG.Point(t.x-i,t.y-n),o=this._balloon.getDgMap().converter.mapPixelsToCoordinates(r),this._balloon.getDrawer().moveTo(o),!0},_handleDragStart:function(e){var t;if(this._draggingNow=!0,this._draggingStopped=!1,this._balloon.getDgMap().setCursor(DG.Cursor.MOVE),this._balloon.getDiv().className=this._balloon.getView().getContainerClass(),t=this._balloon.getDragStartCallback()){var i=DG.Utils.bind(t,this._balloon);i(this._balloon)}return!0},_handleDragStop:function(e){var t;if(0==this._draggingNow)return!0;if(this._draggingNow=!1,this._draggingStopped=!0,this._balloon.getDgMap().setCursor(DG.Cursor.ARROW),this._balloon.getDiv().className=this._balloon.getView().getContainerClass(),this._balloon.getDrawer().calculateCurrentCornerIfNecessary(),this._balloon.getDrawer().isChangeCurrentPosition()&&(this._balloon.getDrawer().fillDivDOMSafely(),this._balloon.getDrawer().activateScroll()),this._balloon.getDrawer().calculateAndSetNewDivPosition(),this._balloon.getDrawer().panIntoViewIfNecessary(),t=this._balloon.getDragStopCallback()){var i=DG.Utils.bind(t,this._balloon);i(this._balloon)}return!0},_handleDragMap:function(){DG.Utils.iNU(this._currentCorner)&&!this._balloon.isRelativePositionFixed()&&(this._balloon.getDrawer().calculateCurrentCornerIfNecessary(),this._balloon.getDrawer().isChangeCurrentPosition()&&(this._balloon.getDrawer().fillDivDOMSafely(),this._balloon.getDrawer().activateScroll())),this._balloon.getDrawer().calculateAndSetNewDivPosition()},_handleZoomChange:function(){this._balloon.getDrawer().onMapUpdate()},_handleMouseOver:function(e){0==this._draggingNow&&this._balloon.getDgMap().setCursor(DG.Cursor.POINTER)},_handleMouseOut:function(e){0==this._draggingNow&&this._balloon.getDgMap().setCursor(DG.Cursor.ARROW)},_handleCloseTouch:function(e){if(DG.Utils.isTouchDevice()){var t=this._balloon.getShape().closeTouchButtonDelta;if(Math.abs(e.point.x-this._touchClosePoint.x)<t&&Math.abs(e.point.y-this._touchClosePoint.y)<t)return this._handleClose()}},_handleClose:function(){var e;DG.Utils.isTouchDevice()&&(DG.Utils.obj(this._balloon.getHelper().getCloseId()).className=this._balloon.getHelper().getClassTouchCloseButton()),e=this._balloon._closeCallback?this._balloon._closeCallback:this._balloon.getKillWhenClose()?function(){this._balloon.getDgMap().balloons.remove(this._balloon)}:function(){this._balloon.hide()},e.call(this)},_handlePressedTouchClose:function(e){DG.Utils.obj(this._balloon.getHelper().getCloseId()).className+=" on-pressed"},_handleOutTouchClose:function(e){DG.Utils.obj(this._balloon.getHelper().getCloseId()).className=this._balloon.getHelper().getClassTouchCloseButton()},isDraggingNow:function(){return this._draggingNow},isDraggingStopped:function(){return this._draggingStopped},destroy:function(){DG.EventManager.removeIgnorElementDomID(this._balloon.getHelper().getContentId()),DG.EventManager.removeIgnorElementDomID(this._balloon.getHelper().getHeaderContentId()),DG.EventManager.removeIgnorElementDomID(this._balloon.getHelper().getFooterContentId())},CLASS_NAME:"DG.Balloons.Common.EventBehavior"}),DG.Balloons.Common.GeneralHelper=DG.Class({_balloon:null,initialize:function(e){this._balloon=e},getCloseId:function(){return"close_"+this._balloon.getId()},getContentId:function(){return"content_"+this._balloon.getId()},getContentIdInsideScroll:function(){return this.getContentId()+"_dgcontent"},getScrollWrapperId:function(){return this.getContentId()+"_scrollwrapper"},getMContentIdInsideScroll:function(){return this.getContentId()+"_mcontentwrapper"},getVScrollActiveClass:function(){return"dg-vscroll-active"},getHScrollActiveClass:function(){return"dg-hscroll-active"},getHiddenClass:function(){return"dg-hidden"},getHeaderContentId:function(){return this.getContentId()+"_header"},getFooterContentId:function(){return this.getContentId()+"_footer"},getScrollTopFadeClass:function(){return"dg-callout-scroll-fade-top"},getScrollBottomFadeClass:function(){return"dg-callout-scroll-fade-bottom"},getScrollLeftFadeClass:function(){return"dg-callout-scroll-fade-left"},getScrollRightFadeClass:function(){return"dg-callout-scroll-fade-right"},getClassToHideTheCloseButton:function(){return"dg-close-hidden"},getClassCloseButton:function(){return"dg-callout-close"},getClassTouchCloseButton:function(){return"dg-callout-close-touch"},getClassToDraggable:function(){return"dg-callout-draggable"},getClassToDragStoped:function(){return"dg-callout-dragging-stop"},getClassToDragging:function(){return"dg-callout-dragging"},getCatchId:function(){return"catch_"+this._balloon.getId()},getTailId:function(){return"tail_"+this._balloon.getId()},getTailClearId:function(){return this.getTailId()+"_clear"},getTailTargetId:function(){return this.getTailId()+"_target"},CLASS_NAME:"DG.Balloons.Common.GeneralHelper"}),DG.Balloons.Common.Shape=DG.Class({_balloon:null,minWidth:87,maxWidth:850,areaWidth:32,areaHeight:22,closeButtonHeight:5,dragCatchHeight:5,closeTouchButtonDelta:20,scrollThickness:6,staticShifts:{tl:{x:-46,y:27},tr:{x:46,y:27},bl:{x:-45,y:-17},br:{x:49,y:-17}},paddingInPanIntoView:{top:45,right:15,bottom:28,left:40},topShiftInPanIntoView:20,bottomShiftForCopyrightsInPanIntoView:40,initialize:function(e){this._balloon=e},CLASS_NAME:"DG.Balloons.Common.Shape"}),DG.Balloons.Common.View=DG.Class({_balloon:null,initialize:function(e){this._balloon=e},getCompletedTemplate:function(){var e,t,i,n,r,o,s,a,l,h,c;return e=this._getCurrentPositionTemplate(),e.inner=e.inner.replace("{%content%}",this._balloon.getContent()),a=this._balloon.getHeaderContent(),h=void 0!==a?a:"",e.inner=e.inner.replace("{%header_content%}",h),l=this._balloon.getFooterContent(),c=void 0!==l?l:"",e.inner=e.inner.replace("{%footer_content%}",c),t="",s=this._balloon.getDrawer().getContentSizeHeight(),void 0!==s&&(t="style='height: "+s+"px'"),i="",DG.Utils.iNU(this._balloon.getHeaderContent())?i="style='max-height: 0px;'":(r=this._balloon.getMaxHeaderHeight(),DG.Utils.iNU(r)||(i="style='max-height: "+r+"px'")),n="",DG.Utils.iNU(this._balloon.getFooterContent())?n="style='max-height: 0px;'":(o=this._balloon.getMaxFooterHeight(),DG.Utils.iNU(o)||(n="style='max-height: "+o+"px'")),e.inner=e.inner.replace("{%inner_style%}",t),e.inner=e.inner.replace("{%header_style%}",i),e.inner=e.inner.replace("{%footer_style%}",n),e.inner=e.inner.replace("{%close_id%}",this._balloon.getHelper().getCloseId()),e.inner=e.inner.replace("{%content_id%}",this._balloon.getHelper().getContentId()),e.inner=e.inner.replace("{%header_content_id%}",this._balloon.getHelper().getHeaderContentId()),e.inner=e.inner.replace("{%footer_content_id%}",this._balloon.getHelper().getFooterContentId()),e.inner=e.inner.replace("{%catch_block%}",this.getCatchBlock()),e.inner=e.inner.replace("{%target_block%}",this.getTargetBlock()),e.inner=e.inner.replace("{%tail_id%}",this._balloon.getHelper().getTailId()),e.inner=e.inner.replace("{%tail_clear_id%}",this._balloon.getHelper().getTailClearId()),e.inner=e.inner.replace("{%tail_target_id%}",this._balloon.getHelper().getTailTargetId()),e.inner=e.inner.replace("{%scroll_left_fade_class%}",this._balloon.getHelper().getScrollLeftFadeClass()),e.inner=e.inner.replace("{%scroll_right_fade_class%}",this._balloon.getHelper().getScrollRightFadeClass()),e.inner=e.inner.replace("{%scroll_top_fade_class%}",this._balloon.getHelper().getScrollTopFadeClass()),e.inner=e.inner.replace("{%scroll_bottom_fade_class%}",this._balloon.getHelper().getScrollBottomFadeClass()),e.inner=e.inner.replace("{%close_button_class%}",this.getCloseButtonBlock()),e.inner=e.inner.replace("{%close_button_view%}",this.getCloseButtonView()),e.inner=e.inner.replace(/{%hidden_class%}/g,this._balloon.getHelper().getHiddenClass()),{containerClass:this.getContainerClass(),internalHtml:e.inner}},getContainerClass:function(){var e,t;return e=this._getCurrentPositionTemplate(),t=e.container["class"],this._balloon.getDrawer().setCurrentContainerVisibleClass(t),this._balloon.getIsClosed()||(t+=" "+this._balloon.getHelper().getClassToHideTheCloseButton()),this._balloon.getDraggable()&&(t+=" "+this._balloon.getHelper().getClassToDraggable()),this._balloon.getEventBehavior().isDraggingNow()&&(t+=" "+this._balloon.getHelper().getClassToDragging()),this._balloon.getEventBehavior().isDraggingStopped()&&(t+=" "+this._balloon.getHelper().getClassToDragStoped()),t},getCatchBlock:function(){return this._balloon.getDraggable()?this.getCatchBlockHtml():""},getTargetBlock:function(){return this._balloon.getDraggable()?this.getTargetBlockHtml():""},_getCurrentPositionTemplate:function(){var e=this._getTemplates();return e[this._balloon.getDrawer().getCurrentCorner()]},getCloseButtonBlock:function(){return DG.Utils.isTouchDevice()?this._balloon.getHelper().getClassTouchCloseButton():this._balloon.getHelper().getClassCloseButton()},getCloseButtonView:function(){return'<div class="dg-callout-sprite"></div>'},getCatchBlockHtml:function(){return'<div class="dg-callout-catch" id="'+this._balloon.getHelper().getCatchId()+'"><div class="dg-callout-sprite"></div></div>'},getTargetBlockHtml:function(){return'<div class="dg-callout-tail-clear" id="{%tail_clear_id%}"><div class="dg-callout-sprite"></div></div><div class="dg-callout-target" id="{%tail_target_id%}"><div class="dg-callout-sprite"></div></div>'},getCatchBlockDomElement:function(){var e;return e=document.createElement("div"),e.id=this._balloon.getHelper().getCatchId(),e.className="dg-callout-catch",e.innerHTML='<div class="dg-callout-sprite"></div>',e},getTargetBlockElement:function(){var e=[];return e[0]=document.createElement("div"),e[0].id=this._balloon.getHelper().getTailClearId(),e[0].className="dg-callout-tail-clear",e[0].innerHTML='<div class="dg-callout-sprite"></div>',e[1]=document.createElement("div"),e[1].id=this._balloon.getHelper().getTailTargetId(),e[1].className="dg-callout-target",e[1].innerHTML='<div class="dg-callout-sprite"></div>',e},_getTemplates:function(){var e="",t="",i="",n="",r=DG.Utils.isTouchDevice()?" dg-callout-touch":"";return e+='<div class="dg-callout-top">',e+='     <div class="dg-callout-round-tr"><div class="dg-callout-sprite"></div></div>',e+='     <div class="dg-callout-round-tl"><div class="dg-callout-sprite"></div></div>',e+="</div>",e+='<div class="dg-callout-content">',e+='     <div {%header_style%} id="{%header_content_id%}" class="dg-callout-content-header">{%header_content%}</div>',e+='     <div class="dg-callout-scroll-fade {%scroll_left_fade_class%} {%hidden_class%}"></div>',e+='     <div class="dg-callout-scroll-fade {%scroll_right_fade_class%} {%hidden_class%}"></div>',e+='     <div class="dg-callout-scroll-fade {%scroll_top_fade_class%} {%hidden_class%}"></div>',e+='     <div class="dg-callout-inner" {%inner_style%} id="{%content_id%}">{%content%}</div>',e+='     <div class="dg-callout-scroll-fade {%scroll_bottom_fade_class%} {%hidden_class%}"></div>',e+='     <div {%footer_style%} id="{%footer_content_id%}" class="dg-callout-content-footer">{%footer_content%}</div>',e+="</div>",e+='<div class="dg-callout-bottom">',e+='     <div class="dg-callout-round-br"><div class="dg-callout-sprite"></div></div>',e+='     <div class="dg-callout-round-bl"><div class="dg-callout-sprite"></div></div>',e+="</div>",e+='<div class="{%close_button_class%}" id="{%close_id%}">{%close_button_view%}</div>',e+='<div class="dg-callout-tail" id="{%tail_id%}"><div class="dg-callout-sprite"></div></div>',t+='<div class="dg-callout-top">',t+='     <div class="dg-callout-round-tr"><div class="dg-callout-sprite"></div></div>',t+='     <div class="dg-callout-round-tl"><div class="dg-callout-sprite"></div></div>',t+="</div>",t+='<div class="dg-callout-content">',t+='     <div {%header_style%} id="{%header_content_id%}" class="dg-callout-content-header">{%header_content%}</div>',t+='     <div class="dg-callout-scroll-fade {%scroll_left_fade_class%} {%hidden_class%}"></div>',t+='     <div class="dg-callout-scroll-fade {%scroll_right_fade_class%} {%hidden_class%}"></div>',t+='     <div class="dg-callout-scroll-fade {%scroll_top_fade_class%} {%hidden_class%}"></div>',t+='     <div class="dg-callout-inner" {%inner_style%} id="{%content_id%}">{%content%}</div>',t+='     <div class="dg-callout-scroll-fade {%scroll_bottom_fade_class%} {%hidden_class%}"></div>',t+='     <div {%footer_style%} id="{%footer_content_id%}" class="dg-callout-content-footer">{%footer_content%}</div>',
t+="</div>",t+='<div class="dg-callout-bottom">',t+='     <div class="dg-callout-round-br"><div class="dg-callout-sprite"></div></div>',t+='     <div class="dg-callout-round-bl"><div class="dg-callout-sprite"></div></div>',t+="</div>",t+='<div class="{%close_button_class%}" id="{%close_id%}">{%close_button_view%}</div>',t+='<div class="dg-callout-tail" id="{%tail_id%}"><div class="dg-callout-sprite"></div></div>',i+='<div class="dg-callout-top">',i+='     <div class="dg-callout-round-tr"><div class="dg-callout-sprite"></div></div>',i+='     <div class="dg-callout-round-tl"><div class="dg-callout-sprite"></div></div>',i+="</div>",i+='<div class="dg-callout-content">',i+='     <div {%header_style%} id="{%header_content_id%}" class="dg-callout-content-header">{%header_content%}</div>',i+='     <div class="dg-callout-scroll-fade {%scroll_left_fade_class%} {%hidden_class%}"></div>',i+='     <div class="dg-callout-scroll-fade {%scroll_right_fade_class%} {%hidden_class%}"></div>',i+='     <div class="dg-callout-scroll-fade {%scroll_top_fade_class%} {%hidden_class%}"></div>',i+='     <div class="dg-callout-inner" {%inner_style%} id="{%content_id%}">{%content%}</div>',i+='     <div class="dg-callout-scroll-fade {%scroll_bottom_fade_class%} {%hidden_class%}"></div>',i+='     <div {%footer_style%} id="{%footer_content_id%}" class="dg-callout-content-footer">{%footer_content%}</div>',i+="</div>",i+='<div class="dg-callout-bottom">',i+='     <div class="dg-callout-round-br"><div class="dg-callout-sprite"></div></div>',i+='     <div class="dg-callout-round-bl"><div class="dg-callout-sprite"></div></div>',i+="</div>",i+='<div class="{%close_button_class%}" id="{%close_id%}">{%close_button_view%}</div>',i+="{%catch_block%}",i+='<div class="dg-callout-tail" id="{%tail_id%}"><div class="dg-callout-sprite"></div></div>',i+="{%target_block%}",n+='<div class="dg-callout-top">',n+='     <div class="dg-callout-round-tr"><div class="dg-callout-sprite"></div></div>',n+='     <div class="dg-callout-round-tl"><div class="dg-callout-sprite"></div></div>',n+="</div>",n+='<div class="dg-callout-content">',n+='     <div {%header_style%} id="{%header_content_id%}" class="dg-callout-content-header">{%header_content%}</div>',n+='     <div class="dg-callout-scroll-fade {%scroll_left_fade_class%} {%hidden_class%}"></div>',n+='     <div class="dg-callout-scroll-fade {%scroll_right_fade_class%} {%hidden_class%}"></div>',n+='     <div class="dg-callout-scroll-fade {%scroll_top_fade_class%} {%hidden_class%}"></div>',n+='     <div class="dg-callout-inner" {%inner_style%} id="{%content_id%}">{%content%}</div>',n+='     <div class="dg-callout-scroll-fade {%scroll_bottom_fade_class%} {%hidden_class%}"></div>',n+='     <div {%footer_style%} id="{%footer_content_id%}" class="dg-callout-content-footer">{%footer_content%}</div>',n+="</div>",n+='<div class="dg-callout-bottom">',n+='     <div class="dg-callout-round-br"><div class="dg-callout-sprite"></div></div>',n+='     <div class="dg-callout-round-bl"><div class="dg-callout-sprite"></div></div>',n+="</div>",n+='<div class="{%close_button_class%}" id="{%close_id%}">{%close_button_view%}</div>',n+="{%catch_block%}",n+='<div class="dg-callout-tail" id="{%tail_id%}"><div class="dg-callout-sprite"></div></div>',n+="{%target_block%}",{tl:{container:{"class":"dg-callout dg-callout-position-tl"+r},inner:e},tr:{container:{"class":"dg-callout dg-callout-position-tr"+r},inner:t},bl:{container:{"class":"dg-callout dg-callout-position-bl"+r},inner:i},br:{container:{"class":"dg-callout dg-callout-position-br"+r},inner:n}}},CLASS_NAME:"DG.Balloons.Common.View"}),DG.Configs.ProjectsList={cities:[{prj:"abakan",bd:{l:90.653667,r:91.964488,t:54.137078,b:52.712096},trfc:!0,tzoffset:420,zoom:11,maxzoom:18},{prj:"aktau",bd:{l:49.788226,r:56.733281,t:46.493817,b:41.24347},trfc:!0,tzoffset:300,zoom:11,maxzoom:18},{prj:"aktobe",bd:{l:56.871263,r:57.768141,t:50.586536,b:50.116983},trfc:!0,tzoffset:300,zoom:11,maxzoom:18},{prj:"almaty",bd:{l:73.727969,r:82.604762,t:47.310843,b:42.20462},trfc:!0,tzoffset:360,zoom:12,maxzoom:18},{prj:"almetevsk",bd:{l:52.225895,r:52.47886,t:54.977188,b:54.805248},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"anadyr",bd:{l:177.442943,r:177.549031,t:64.745211,b:64.708906},trfc:!1,tzoffset:720,zoom:12,maxzoom:18},{prj:"armawir",bd:{l:40.819447,r:41.348375,t:45.244908,b:44.675376},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"arkhangelsk",bd:{l:39.462631,r:41.325378,t:64.831625,b:64.288318},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"asir",bd:{l:41.371371,r:44.521943,t:20.971495,b:17.432249},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"astrakhan",bd:{l:47.62652,r:48.408414,t:46.778043,b:46.016789},trfc:!0,tzoffset:240,zoom:11,maxzoom:18},{prj:"atyrau",bd:{l:51.788954,r:52.064917,t:47.201584,b:47.013758},trfc:!0,tzoffset:300,zoom:11,maxzoom:18},{prj:"baku",bd:{l:49.512264,r:50.432139,t:40.705231,b:40.197746},trfc:!0,tzoffset:240,zoom:12,maxzoom:18},{prj:"balakovo",bd:{l:47.718508,r:47.902483,t:52.052369,b:51.953267},trfc:!1,tzoffset:240,zoom:12,maxzoom:18},{prj:"barnaul",bd:{l:83.386655,r:84.237539,t:53.49901,b:53.100449},trfc:!0,tzoffset:420,zoom:11,maxzoom:18},{prj:"bahrain",bd:{l:50.248164,r:50.93807,t:26.710589,b:25.533689},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"belgorod",bd:{l:36.358053,r:36.932975,t:50.717761,b:50.484218},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"biysk",bd:{l:84.467508,r:86.238267,t:52.67028,b:51.839739},trfc:!0,tzoffset:420,zoom:11,maxzoom:18},{prj:"birobidzhan",bd:{l:132.806932,r:133.105891,t:48.892497,b:48.710729},trfc:!1,tzoffset:600,zoom:12,maxzoom:18},{prj:"bishkek",bd:{l:74.394879,r:78.6493,t:43.084221,b:41.914363},trfc:!0,tzoffset:360,zoom:11,maxzoom:18},{prj:"blagoveshensk",bd:{l:127.264686,r:128.667495,t:51.526057,b:50.205378},trfc:!0,tzoffset:540,zoom:11,maxzoom:18},{prj:"bratsk",bd:{l:101.071249,r:102.060115,t:56.50455,b:55.929128},trfc:!0,tzoffset:480,zoom:11,maxzoom:18},{prj:"bryansk",bd:{l:34.10436,r:34.610291,t:53.485328,b:53.128056},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"v_novgorod",bd:{l:31.068773,r:31.620698,t:58.709025,b:58.421182},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"vladivostok",bd:{l:131.381126,r:132.369991,t:43.669252,b:42.781152},trfc:!0,tzoffset:600,zoom:11,maxzoom:18},{prj:"vladikavkaz",bd:{l:44.54494,r:44.751911,t:43.117804,b:42.730495},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"vladimir",bd:{l:40.152537,r:40.727459,t:56.466457,b:56.019206},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"volgograd",bd:{l:43.87803,r:45.073868,t:48.968039,b:48.253426},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"volgodonsk",bd:{l:42.015284,r:42.383234,t:47.683735,b:47.466537},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"vologda",bd:{l:37.668875,r:40.313515,t:59.394928,b:59.006352},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"voronezh",bd:{l:38.9567,r:39.669603,t:51.939092,b:51.454462},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"grozny",bd:{l:45.34983,r:46.407686,t:43.452614,b:42.949708},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"jizan",bd:{l:40.750456,r:43.349102,t:18.329566,b:16.265761},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"dimitrovgrad",bd:{l:49.09832,r:49.903211,t:54.35208,b:54.083152},trfc:!0,tzoffset:240,zoom:12,maxzoom:18},{prj:"dnepropetrovsk",bd:{l:34.725276,r:35.369188,t:48.680371,b:48.314638},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"ekaterinburg",bd:{l:59.699878,r:61.010699,t:57.058866,b:56.390156},trfc:!0,tzoffset:300,zoom:11,maxzoom:18},{prj:"elets",bd:{l:38.427772,r:38.611747,t:52.67028,b:52.572554},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"ivanovo",bd:{l:40.79645,r:41.210393,t:57.096363,b:56.870815},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"izhevsk",bd:{l:52.915801,r:54.732554,t:57.058866,b:56.032057},trfc:!0,tzoffset:240,zoom:11,maxzoom:18},{prj:"irkutsk",bd:{l:103.554911,r:108.085295,t:53.662845,b:51.425793},trfc:!0,tzoffset:480,zoom:11,maxzoom:18},{prj:"ishim",bd:{l:69.427554,r:69.565536,t:56.147525,b:56.070585},trfc:!1,tzoffset:300,zoom:11,maxzoom:18},{prj:"yoshkarola",bd:{l:47.580527,r:48.155448,t:56.757527,b:56.50455},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"minvody",bd:{l:42.567209,r:43.602068,t:44.31449,b:43.768976},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"kazan",bd:{l:48.224439,r:49.604251,t:56.019206,b:55.540699},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"kaliningrad",bd:{l:19.524344,r:21.180118,t:55.384244,b:54.499245},trfc:!0,tzoffset:120,zoom:11,maxzoom:18},{prj:"kaluga",bd:{l:35.898116,r:36.68001,t:55.161535,b:54.311852},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"k_uralskiy",bd:{l:61.539628,r:62.252531,t:56.580621,b:56.275417},trfc:!1,tzoffset:300,zoom:11,maxzoom:18},{prj:"kamyshin",bd:{l:45.303836,r:45.487811,t:50.146466,b:50.013649},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"karaganda",bd:{l:72.670113,r:73.406013,t:50.190657,b:49.64278},trfc:!0,tzoffset:360,zoom:11,maxzoom:18},{prj:"qatar",bd:{l:50.57012,r:52.662835,t:26.402031,b:24.470776},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"kemerovo",bd:{l:85.893314,r:86.330255,t:55.540699,b:55.214049},trfc:!0,tzoffset:420,zoom:11,maxzoom:18},{prj:"kiev",bd:{l:30.171895,r:31.045776,t:50.644903,b:50.146466},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"cyprus",bd:{l:31.988648,r:34.886254,t:35.926845,b:34.347212},trfc:!1,tzoffset:180,zoom:10,maxzoom:19},{prj:"kirov",bd:{l:49.02933,r:49.949204,t:58.792534,b:58.385035},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"kovrov",bd:{l:41.256387,r:41.394368,t:56.402883,b:56.300945},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"kogalym",bd:{l:74.371882,r:74.854816,t:62.411741,b:62.165783},trfc:!1,tzoffset:300,zoom:11,maxzoom:18},{prj:"kokshetau",bd:{l:67.955755,r:72.302163,t:53.430558,b:51.725925},trfc:!0,tzoffset:360,zoom:11,maxzoom:18},{prj:"komsomolsk",bd:{l:136.670406,r:137.314318,t:50.717761,b:50.161201},trfc:!0,tzoffset:600,zoom:11,maxzoom:18},{prj:"kostanay",bd:{l:63.471365,r:63.793321,t:53.307066,b:53.08664},trfc:!1,tzoffset:360,zoom:11,maxzoom:18},{prj:"kostroma",bd:{l:40.681465,r:41.60134,t:57.936166,b:57.45688},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"krasnodar",bd:{l:38.565753,r:40.12954,t:45.455009,b:44.396706},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"krasnoyarsk",bd:{l:90.170732,r:93.804238,t:56.415607,b:54.805248},trfc:!0,tzoffset:420,zoom:11,maxzoom:18},{prj:"crimea",bd:{l:32.172623,r:36.68001,t:46.208098,b:44.166212},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"kumertau",bd:{l:55.675425,r:55.951388,t:52.892836,b:52.67028},trfc:!1,tzoffset:300,zoom:11,maxzoom:18},{prj:"kurgan",bd:{l:65.035152,r:65.633071,t:55.527685,b:55.24028},trfc:!0,tzoffset:300,zoom:11,maxzoom:18},{prj:"kursk",bd:{l:35.852122,r:36.450041,t:51.853946,b:51.554663},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"kyzyl",bd:{l:94.287172,r:94.724113,t:51.768639,b:51.56896},trfc:!1,tzoffset:420,zoom:12,maxzoom:18},{prj:"lenkuz",bd:{l:85.732336,r:86.491233,t:54.77873,b:54.177476},trfc:!0,tzoffset:420,zoom:11,maxzoom:18},{prj:"lipetsk",bd:{l:39.370644,r:39.876575,t:52.739951,b:52.474609},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"magadan",bd:{l:150.491526,r:151.043451,t:59.732766,b:59.418336},trfc:!1,tzoffset:660,zoom:12,maxzoom:18},{prj:"magnitogorsk",bd:{l:58.481044,r:59.492906,t:53.920953,b:53.224539},trfc:!0,tzoffset:300,zoom:11,maxzoom:18},{prj:"maikop",bd:{l:39.922569,r:40.175534,t:44.757084,b:44.560791},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"makhachkala",bd:{l:46.660652,r:48.638383,t:44.034095,b:41.948579},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"medina",bd:{l:36.749,r:42.130268,t:27.508922,b:22.488189},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"mekka",bd:{l:38.2208,r:43.648062,t:23.967432,b:17.695347},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"miass",bd:{l:58.527037,r:60.550762,t:55.670605,b:54.432417},trfc:!1,tzoffset:300,zoom:10,maxzoom:18},{prj:"minsk",bd:{l:27.067317,r:28.07918,t:54.069659,b:53.690089},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"moscow",bd:{l:36.726003,r:39.163672,t:56.313702,b:54.963988},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"murmansk",bd:{l:28.424133,r:42.498218,t:70.158924,b:65.697568},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"murom",bd:{l:41.946293,r:42.084274,t:55.631679,b:55.501644},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"nabchelny",bd:{l:51.650973,r:52.616841,t:55.877561,b:55.540699},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"najran",bd:{l:43.602068,r:47.741505,t:19.5043,b:16.926922},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"nazran",bd:{l:44.705918,r:44.820902,t:43.268696,b:43.151368},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"nalchik",bd:{l:43.487084,r:43.717052,t:43.536028,b:43.40251},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"naryanmar",bd:{l:52.915801,r:53.191763,t:67.697748,b:67.601554},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"nahodka",bd:{l:132.553966,r:133.243872,t:42.966538,b:42.662889},trfc:!0,tzoffset:600,zoom:11,maxzoom:18},{prj:"nevinnomyssk",bd:{l:41.877303,r:42.038281,t:44.708073,b:44.577174},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"nizhnevartovsk",bd:{l:75.912672,r:77.016522,t:61.19493,b:60.81593},trfc:!0,tzoffset:300,zoom:11,maxzoom:18},{prj:"n_novgorod",bd:{l:43.234118,r:44.337968,t:56.567953,b:55.305783},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"ntagil",bd:{l:58.642022,r:60.619753,t:58.094522,b:57.419749},trfc:!0,tzoffset:300,zoom:11,maxzoom:18},{prj:"novokuznetsk",bd:{l:86.468236,r:87.480098,t:54.123603,b:53.49901},trfc:!0,tzoffset:420,zoom:11,maxzoom:18},{prj:"novorossiysk",bd:{l:36.840988,r:38.680737,t:45.244908,b:44.149714},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"novosibirsk",bd:{l:80.948987,r:85.111421,t:56.542605,b:53.49901},trfc:!0,tzoffset:420,zoom:11,maxzoom:18},{prj:"novocherkassk",bd:{l:40.014556,r:40.267522,t:47.559732,b:47.326433},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"novoshakhtinsk",bd:{l:39.784587,r:40.014556,t:47.884613,b:47.71469},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"new_cairo",bd:{l:31.569682,r:31.902893,t:30.112815,b:29.790826},trfc:!1,tzoffset:120,zoom:11,maxzoom:18},{prj:"n_urengoy",bd:{l:76.372609,r:78.488322,t:66.185062,b:65.640719},trfc:!1,tzoffset:300,zoom:11,maxzoom:18},{prj:"norilsk",bd:{l:85.985302,r:88.560951,t:69.565161,b:69.241568},trfc:!1,tzoffset:420,zoom:11,maxzoom:18},{prj:"noyabrsk",bd:{l:74.302891,r:77.1775,t:63.876216,b:62.960451},trfc:!1,tzoffset:300,zoom:11,maxzoom:18},{prj:"nur_sultan",bd:{l:71.129323,r:71.88822,t:51.354041,b:50.921162},trfc:!0,tzoffset:360,zoom:11,maxzoom:18},{prj:"nyagan",bd:{l:65.150136,r:65.886036,t:62.294359,b:61.971888},trfc:!1,tzoffset:300,zoom:11,maxzoom:18},{prj:"dubai",bd:{l:51.444001,r:56.618297,t:26.154588,b:22.636846},trfc:!0,tzoffset:240,zoom:11,maxzoom:18},{prj:"odessa",bd:{l:30.493851,r:30.907795,t:46.667688,b:46.255822},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"oman",bd:{l:51.995926,r:60.067828,t:26.73113,b:16.464348},trfc:!1,tzoffset:240,zoom:11,maxzoom:18},{prj:"omsk",bd:{l:72.854088,r:73.773963,t:55.423416,b:54.752195},trfc:!0,tzoffset:360,zoom:11,maxzoom:18},{prj:"orenburg",bd:{l:54.824541,r:55.606435,t:51.953267,b:51.109241},trfc:!0,tzoffset:300,zoom:11,maxzoom:18},{prj:"orsk",bd:{l:58.343062,r:59.078962,t:51.325308,b:51.008062},trfc:!1,tzoffset:300,zoom:12,maxzoom:18},{prj:"orel",bd:{l:35.852122,r:36.335057,t:53.100449,b:52.837304},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"osh",bd:{l:72.69311,r:72.900082,t:40.635461,b:40.390692},trfc:!1,tzoffset:360,zoom:11,maxzoom:18},{prj:"pavlodar",bd:{l:76.625575,r:77.246491,t:52.474609,b:51.995766},trfc:!0,tzoffset:300,zoom:11,maxzoom:18},{prj:"padova",bd:{l:11.360454,r:12.602285,t:45.728579,b:45.066521},trfc:!1,tzoffset:120,zoom:11,maxzoom:18},{prj:"penza",bd:{l:44.774908,r:45.395824,t:53.375717,b:53.017524},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"perm",bd:{l:55.537444,r:57.285206,t:59.616653,b:57.666579},trfc:!0,tzoffset:300,zoom:11,maxzoom:18},{prj:"petrozavodsk",bd:{l:34.035369,r:35.461176,t:62.155043,b:61.689626},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"petropavlovsk",bd:{l:68.967617,r:69.335567,t:54.977188,b:54.738921},trfc:!0,tzoffset:360,zoom:11,maxzoom:18},{prj:"p_kamchatskiy",bd:{l:158.034499,r:159.27633,t:53.375717,b:52.712096},trfc:!0,tzoffset:720,zoom:11,maxzoom:18},{prj:"pikalevo",bd:{l:34.012373,r:34.242341,t:59.581741,b:59.476786},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"praha",bd:{l:14.212066,r:14.717998,t:50.175931,b:49.939703},trfc:!1,tzoffset:120,zoom:13,maxzoom:18},{prj:"pskov",bd:{l:27.550252,r:28.493124,t:57.911742,b:57.70346},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"gornoaltaysk",bd:{l:83.93858,r:89.848776,t:52.656332,b:49.058539},trfc:!1,tzoffset:420,zoom:9,maxzoom:18},{prj:"rostov",bd:{l:39.347647,r:40.037553,t:47.513155,b:47.045108},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"rubtsovsk",bd:{l:81.155959,r:81.316937,t:51.56896,b:51.46879},trfc:!1,tzoffset:420,zoom:12,maxzoom:18},{prj:"rybinsk",bd:{l:38.680737,r:38.979697,t:58.118823,b:57.997155},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"ryazan",bd:{l:39.347647,r:40.083547,t:54.897922,b:54.485888},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"salekhard",bd:{l:66.460958,r:66.805911,t:66.635991,b:66.452919},trfc:!1,tzoffset:300,zoom:12,maxzoom:18},{prj:"samara",bd:{l:49.673242,r:50.800089,t:53.785305,b:53.003687},trfc:!0,tzoffset:240,zoom:12,maxzoom:18},{prj:"spb",bd:{l:28.309149,r:31.229751,t:60.81593,b:59.465104},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"santiago",bd:{l:-70.85336,r:-70.48541,t:-33.296456,b:-33.660903},trfc:!1,tzoffset:-240,zoom:15,maxzoom:19},{prj:"saransk",bd:{l:44.843899,r:45.809768,t:54.311852,b:53.94803},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"saratov",bd:{l:45.303836,r:46.568664,t:51.839739,b:51.19579},trfc:!0,tzoffset:240,zoom:11,maxzoom:18},{prj:"semey",bd:{l:80.029112,r:80.512046,t:50.528096,b:50.29361},trfc:!1,tzoffset:360,zoom:11,maxzoom:18},{prj:"s_posad",bd:{l:37.944838,r:38.473766,t:56.402883,b:56.224312},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"serpuhov",bd:{l:37.300925,r:37.553891,t:54.990384,b:54.871465},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"slantsy",bd:{l:28.033186,r:28.240158,t:59.148164,b:59.053688},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"smolensk",bd:{l:31.758679,r:32.26461,t:54.937574,b:54.685782},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"sochi",bd:{l:38.496763,r:40.658468,t:44.511614,b:43.21844},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"stavropol",bd:{l:41.670331,r:42.360237,t:45.277282,b:44.903867},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"staroskol",bd:{l:37.714869,r:38.059822,t:51.425793,b:51.109241},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"sterlitamak",bd:{l:55.721419,r:56.15836,t:53.758122,b:53.307066},trfc:!0,tzoffset:300,zoom:11,maxzoom:18},{prj:"surgut",bd:{l:72.394151,r:73.79696,t:61.415764,b:60.983694},trfc:!0,tzoffset:300,zoom:11,maxzoom:18},{prj:"syktyvkar",bd:{l:50.156176,r:51.444001,t:62.00429,b:61.514633},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"syasstroy",bd:{l:32.471582,r:32.609563,t:60.170339,b:60.12455},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"tabuk",bd:{l:34.426316,r:40.014556,t:30.008481,b:24.198378},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"taganrog",bd:{l:38.795722,r:38.979697,t:47.279649,b:47.185957},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"tambov",bd:{l:41.256387,r:41.647334,t:52.878959,b:52.558575},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"taraz",bd:{l:71.244307,r:71.497273,t:42.966538,b:42.781152},trfc:!1,tzoffset:360,zoom:11,maxzoom:18},{prj:"tashkent",bd:{l:69.151592,r:70.78437,t:42.085263,b:41.174266},trfc:!0,tzoffset:300,zoom:11,maxzoom:18},{prj:"tver",bd:{l:35.530166,r:36.358053,t:57.046359,b:56.669178},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"tobolsk",bd:{l:68.024745,r:68.622664,t:58.348851,b:58.045872},trfc:!1,tzoffset:300,zoom:11,maxzoom:18},{prj:"togliatti",bd:{l:48.109455,r:49.811223,t:53.866747,b:52.892836},trfc:!0,tzoffset:240,zoom:11,maxzoom:18},{prj:"tomsk",bd:{l:84.697477,r:85.387383,t:56.681812,b:56.326455},trfc:!0,tzoffset:420,zoom:11,maxzoom:18},{prj:"tula",bd:{l:37.392913,r:38.611747,t:54.36548,b:53.826046},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"turkestan",bd:{l:68.13973,r:68.57667,t:43.435917,b:43.21844},trfc:!1,tzoffset:360,zoom:11,maxzoom:18},{prj:"tyumen",bd:{l:65.035152,r:66.713924,t:57.320548,b:56.402883},trfc:!0,tzoffset:300,zoom:11,maxzoom:18},{prj:"ulanude",bd:{l:100.634309,r:110.224004,t:54.271585,b:50.220095},trfc:!0,tzoffset:480,zoom:11,maxzoom:18},{prj:"ulyanovsk",bd:{l:47.99447,r:49.259298,t:54.472527,b:54.069659},trfc:!0,tzoffset:240,zoom:11,maxzoom:18},{prj:"uralsk",bd:{l:50.984064,r:53.122773,t:51.511747,b:50.175931},trfc:!0,tzoffset:300,zoom:11,maxzoom:18},{prj:"ussuriysk",bd:{l:131.726079,r:132.140022,t:43.967926,b:43.702512},trfc:!0,tzoffset:600,zoom:11,maxzoom:18},{prj:"ustkam",bd:{l:82.420787,r:83.064699,t:50.072725,b:49.74691},trfc:!0,tzoffset:360,zoom:11,maxzoom:18},{prj:"ufa",bd:{l:53.375738,r:56.503313,t:55.122103,b:54.378876},trfc:!0,tzoffset:300,zoom:11,maxzoom:18},{prj:"ukhta",bd:{l:53.191763,r:54.226622,t:63.69336,b:63.355033},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"khabarovsk",bd:{l:134.87665,r:135.267597,t:48.634798,b:48.268736},trfc:!0,tzoffset:600,zoom:11,maxzoom:18},{prj:"hail",bd:{l:39.370644,r:43.924024,t:28.887067,b:25.305213},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"kh_mansiysk",bd:{l:68.875629,r:69.427554,t:61.11727,b:60.916694},trfc:!1,tzoffset:300,zoom:12,maxzoom:18},{prj:"kharkov",bd:{l:36.0131,r:36.519032,t:50.146466,b:49.821152},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"khasavyurt",bd:{l:46.535458,r:46.648661,t:43.290895,b:43.198957},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"cheboksary",bd:{l:46.936614,r:47.603524,t:56.326455,b:55.967759},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"chelyabinsk",bd:{l:61.056693,r:61.769596,t:55.371178,b:54.911144},trfc:!0,tzoffset:300,zoom:11,maxzoom:18},{prj:"cherkessk",bd:{l:42.015284,r:42.107271,t:44.265106,b:44.166212},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"chita",bd:{l:112.316719,r:113.811516,t:52.460599,b:51.740167},trfc:!0,tzoffset:540,zoom:11,maxzoom:18},{prj:"shakhty",bd:{l:40.083547,r:40.359509,t:47.807444,b:47.62177},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"sheregesh",bd:{l:86.928173,r:88.124011,t:53.49901,b:52.726026},trfc:!1,tzoffset:420,zoom:11,maxzoom:18},{prj:"shymkent",bd:{l:69.404558,r:69.795504,t:42.442659,b:42.238681},trfc:!0,tzoffset:360,zoom:11,maxzoom:18},{prj:"dammam",bd:{l:45.004877,r:55.698422,t:29.128411,b:17.168772},trfc:!0,tzoffset:180,zoom:11,maxzoom:18},{prj:"elista",bd:{l:44.153993,r:44.383962,t:46.382882,b:46.255822},trfc:!1,tzoffset:180,zoom:12,maxzoom:18},{prj:"el_baha",bd:{l:40.819447,r:42.038281,t:20.756606,b:19.374185},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"el_jouf",bd:{l:37.024963,r:41.946293,t:31.764827,b:28.544201},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"qasim",bd:{l:41.279384,r:44.889893,t:28.098832,b:24.449843},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"hudud_al_shamaliya",bd:{l:37.921841,r:46.039736,t:32.174513,b:27.529317},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"riyadh",bd:{l:41.96929,r:48.316427,t:27.671976,b:19.243965},trfc:!1,tzoffset:180,zoom:11,maxzoom:18},{prj:"yuzhnosakhalinsk",bd:{l:141.499749,r:145.064264,t:50.057963,b:45.632177},trfc:!0,tzoffset:660,zoom:11,maxzoom:18},{prj:"yakutsk",bd:{l:126.620773,r:132.875922,t:63.075225,b:60.624729},trfc:!0,tzoffset:540,zoom:11,maxzoom:18},{prj:"yaroslavl",bd:{l:39.669603,r:40.198531,t:57.777108,b:57.50633},trfc:!0,tzoffset:180,zoom:11,maxzoom:18}],world:2},DG.Configs.FullScreen=DG.Class({controlId:"dgFullScreen",position:new DG.ControlPosition(DG.ControlPosition.TOP_RIGHT,new DG.Point(10,10)),size:new DG.Size(30,30),cssClass:"dg-map-btn dg-map-btn-fullscreen",initialize:function(){},CLASS_NAME:"DG.Configs.FullScreen"}),DG.Configs.Geoclicker={transportImagesUrl:"/images/transport/",routePathLoaderImg:"/images/transport-loader.gif",stationLoaderImg:"/images/station-info-loader.gif"},DG.Configs.Stats=DG.Class({cookieName:"__2gis_js_api",cookieExpireDays:365,pageReloadTime:15,sessionLengthTime:30,jsapiApplicationDomain:"maps.api.2gis.ru",statsServerUrl:"http://stats.maps.api.2gis.ru/?callback=$[callback]",apiVersion:"1.0",initialize:function(){},CLASS_NAME:"DG.Configs.Stats"}),DG.Configs.TileMarkers={desktopMarkerRadius:8,ldpiMarkerRadius:14,mdpiMarkerRadius:20,hdpiMarkerRadius:30,xhdpiMarkerRadius:36},DG.Configs.Traffic=DG.Class({pluginName:"traffic",layerName:"trafficInteractiveLayer",tileUrl:"http://maps.2gis.com/${project}/traffic/${z}/${x}/${y}/speed/${interval}/",graphSpeedUrl:"http://meta${metaPrefix}.maps.2gis.com/${project}/meta/${z}/${x}/${y}/graph_speed/${interval}/callback/$[callback]",timeUrl:"http://traffic1.maps.2gis.com/${project}/meta/speed/time/callback/$[callback]",scoreUrl:"http://traffic0.maps.2gis.com/${project}/meta/score/${interval}/callback/$[callback]",strategy:"mouseTile",displayHint:!0,hintSpeedText:"&nbsp;км/ч",tileServersPrefix:"traffic",tileServersCount:10,metaServersCount:10,minZoomLevel:10,checkActualTimeInterval:180,uiUpdateTimeout:500,zoomChangeTimeout:300,isDebugMode:!1,controlConfig:{controlId:"dgTraffic",position:DG.Utils.isTouchDevice()?new DG.ControlPosition(DG.ControlPosition.TOP_RIGHT,new DG.Point(58,10)):new DG.ControlPosition(DG.ControlPosition.TOP_RIGHT,new DG.Point(50,10)),title:"",isShowScore:!0,controlExpandAnimationTimeout:300,controlTrackerContainerTimeout:400,tendencyIconClass:"dg-tendency-icon"},initialize:function(){},CLASS_NAME:"DG.Configs.Traffic"}),DG.Configs.Transport={server:"http://catalog.api.2gis.ru",key:"rubnkm7490",version:"2.0",routeListUrl:"/transport/route/list",stationInfoUrl:"/transport/station/get",routeInfoUrl:"/transport/route/get"},DG.Configs.Zoom={enableControl:!0,controlId:"dgZoom",position:new DG.ControlPosition(DG.ControlPosition.TOP_LEFT,new DG.Point(10,10)),sizeNormal:new DG.Size(20,220),sizeTouch:new DG.Size(44,98),plusClassNormal:"dgZoomPlus",plusClassTouch:"dgBtn dgBtnPlus",minusClassNormal:"dgZoomMinus",minusClassTouch:"dgBtn dgBtnMinus",title:""},DG.Controllers={},DG.Controllers.RightButtonMagnifier=DG.Class({_isEnabled:!0,_dgMap:null,_startPoint:null,_rectangle:null,_observers:[],initialize:function(e){this._observers=[],this._dgMap=e,this._observers.push(this._dgMap.addEventListener("DgMouseRightDown",DG.Utils.bind(this.initHandler,this))),this._observers.push(this._dgMap.addEventListener("DgMouseRightUp",DG.Utils.bind(this.stopHandler,this))),this._observers.push(this._dgMap.addEventListener("DgRightDrag",DG.Utils.bind(this.dragHandler,this))),this.disable()},destroy:function(){this._removeHandlers(),this._clear()},initHandler:function(e){this._startPoint=e.getGeoPoint().clone()},dragHandler:function(e){var t;if(t=this._dgMap.converter.mapPixelsToCoordinates(e.getPoint()),DG.Utils.iNU(this._rectangle)&&Math.abs(this._startPoint.getLon()-t.getLon())<2&&Math.abs(this._startPoint.getLat()-t.getLat())<2&&(this._rectangle=new DG.Geometries.Polygon([this._startPoint,this._startPoint,this._startPoint,this._startPoint]),this._dgMap.geometries.add(this._rectangle)),!DG.Utils.iNU(this._rectangle)){var i,n,r;n=t,r=new DG.GeoPoint(n.getLon(),this._startPoint.getLat()),i=new DG.GeoPoint(this._startPoint.getLon(),n.getLat()),this._rectangle.splicePoints(1,1,[i]),this._rectangle.splicePoints(2,1,[n]),this._rectangle.splicePoints(3,1,[r])}},stopHandler:function(e){if(!DG.Utils.iNU(this._rectangle)){var t=new DG.CollectionBounds([this._startPoint,e.getGeoPoint()]);this._dgMap.setBounds(t)}this._clear()},_clear:function(){this._startPoint=null,DG.Utils.iNU(this._rectangle)||(this._dgMap.geometries.remove(this._rectangle),this._rectangle.destroy(),this._rectangle=null)},enable:function(){if(this._checkOpera())return!1;for(var e=0;e<this._observers.length;e++)this._observers[e].enable();this._isEnabled=!0},disable:function(){for(var e=0;e<this._observers.length;e++)this._observers[e].disable();this._isEnabled=!1},isEnabled:function(){return this._isEnabled},_removeHandlers:function(){for(var e=0;e<this._observers.length;e++)this._observers[e].cleanup(),this._observers[e]=null},_checkOpera:function(){return!DG.Utils.iNU(window.opera)},CLASS_NAME:"DG.Controllers.RightButtonMagnifier"}),DG.Controls.Abstract=DG.Class(DG.Controls.Base,{_position:null,CLASS_NAME:"DG.Controls.Common"}),DG.Controls.Abstract.extend=function(e){return DG.Class(DG.Controls.Abstract,e)},DG.Controls.FullScreen=DG.Class(DG.Controls.Base,{_dgMap:null,_button:null,_isMaximized:!1,_cssClass:null,_initialMapParams:{size:null,scrollZoomEnabled:!1,zIndex:null,position:null,left:null,top:null,border:null,marginTop:null,marginRight:null,marginBottom:null,marginLeft:null,paddingTop:null,paddingRight:null,paddingBottom:null,paddingLeft:null,parentNode:null,previousSibling:null,nextSibling:null,width:null,height:null},_initialDocumentParams:{marginTop:null,marginRight:null,marginBottom:null,marginLeft:null,paddingTop:null,paddingRight:null,paddingBottom:null,paddingLeft:null,overflow:null,scrollTop:null},_initialDocumentElementParams:{scrollTop:null},initialize:function(e){var t;t=DG.Utils.extend(new DG.Configs.FullScreen,t),DG.Controls.Base.prototype.initialize.call(this),DG.Utils.extendOptionsProtected(this,t,["controlId","position","size","cssClass"]),this._dgMap=e},onAddToMap:function(){this._draw(),DG.Utils.isIFrame()&&this.disable(),this._registerHandlers()},onRemoveFromMap:function(){this.destroy(),this._dgMap&&this.getContainer()&&this.getContainer().parentNode==this.getDgMap().getViewPortContainer()&&this.getDgMap().getViewPortContainer().removeChild(this.getContainer())},enable:function(){DG.Utils.isIFrame()||(this._dgMap.controls.getGroup("fullscreen")?this.show():this._dgMap.controls.add(this,"fullscreen"))},disable:function(){this._dgMap.controls.get("dgFullScreen")&&this._dgMap.controls.get("dgFullScreen").hide()},destroy:function(){this._button=null,this._initialMapParams=null,this._initialDocumentParams=null},getStates:function(){return["default","maximized"]},getState:function(){return this._isMaximized?"maximized":"default"},_draw:function(){var e=document.createElement("div");e.className="dg-map-btn-fullscreen__icon",this._button=document.createElement("div"),this._button.id=DG.Utils.createUniqueID("dgFullScreenControlBtn"),DG.Utils.isTouchDevice()===!0&&(this._cssClass="dgBtn dgBtnFullScreen"),this._button.className=this._cssClass+" dg-map-btn-fullscreen__mini",this._button.title=this._dgMap.locale.t("Expand"),this._button.appendChild(e),this.getContainer().appendChild(this._button),this._position.apply(this.getContainer())},_registerHandlers:function(){this.registerHandler(this._button.id,"DgClick",DG.Utils.bind(this.clickHandler,this)),this.registerHandler(this.getDgMap().getContainerId(),"DgKeyUp",DG.Utils.bind(this.keyUpHandler,this)),this.registerHandler(this._button.id,"DgMouseMove",function(){return!0}),this.registerHandler(this._button.id,"DgDrag",function(){return!0}),this.registerHandler(this._button.id,"DgMouseOut",DG.Utils.bind(this._mouseOutHandler,this)),this.registerHandler(this._button.id,"DgMouseUp",DG.Utils.bind(this._mouseOutHandler,this)),this.registerHandler(this._button.id,"DgMouseDown",DG.Utils.bind(this._mouseDownHandler,this)),this.registerHandler(this._dgMap,"DgLanguageChange",DG.Utils.bind(this.languageChangeHandler,this))},keyUpHandler:function(e){this._isMaximized&&27==e.getKeyCode()&&this.clickHandler()},clickHandler:function(){this._isMaximized?(this._minimizeMap(),this._isMaximized=!1,this._button.title=this._dgMap.locale.t("Expand")):(this._maximizeMap(),this._isMaximized=!0,this._button.title=this._dgMap.locale.t("Recover")),this._button.className=this._cssClass+(this._isMaximized?" dg-map-btn-fullscreen__maxi":" dg-map-btn-fullscreen__mini")},_mouseDownHandler:function(){this._button.className=this._cssClass+(this._isMaximized?" dg-map-btn-fullscreen__maxi":" dg-map-btn-fullscreen__mini")+" dg-map-btn-pressed"},_mouseOutHandler:function(){this._button.className=this._cssClass+(this._isMaximized?" dg-map-btn-fullscreen__maxi":" dg-map-btn-fullscreen__mini");
},_maximizeMap:function(){var e=this.getDgMap(),t=e.getContainer(),i=document.getElementsByTagName("body")[0],n=t;this._initialMapParams.size=e.getContainerSize(),this._initialMapParams.scrollZoomEnabled=e.scrollZoomEnabled(),this._initialMapParams.zIndex=t.style.zIndex,this._initialMapParams.position=t.style.position,this._initialMapParams.left=t.style.left,this._initialMapParams.top=t.style.top,this._initialMapParams.border=t.style.border,this._initialMapParams.marginTop=t.style.marginTop,this._initialMapParams.marginRight=t.style.marginRight,this._initialMapParams.marginBottom=t.style.marginBottom,this._initialMapParams.marginLeft=t.style.marginLeft,this._initialMapParams.paddingTop=t.style.paddingTop,this._initialMapParams.paddingRight=t.style.paddingRight,this._initialMapParams.paddingBottom=t.style.paddingBottom,this._initialMapParams.paddingLeft=t.style.paddingLeft,this._initialMapParams.parentNode=t.parentNode,this._initialMapParams.previousSibling=t.previousSibling,this._initialMapParams.nextSibling=t.nextSibling,this._initialMapParams.width=t.style.width,this._initialMapParams.height=t.style.height,this._initialDocumentParams.marginTop=document.body.style.marginTop,this._initialDocumentParams.marginRight=document.body.style.marginRight,this._initialDocumentParams.marginBottom=document.body.style.marginBottom,this._initialDocumentParams.marginLeft=document.body.style.marginLeft,this._initialDocumentParams.paddingTop=document.body.style.paddingTop,this._initialDocumentParams.paddingRight=document.body.style.paddingRight,this._initialDocumentParams.paddingBottom=document.body.style.paddingBottom,this._initialDocumentParams.paddingLeft=document.body.style.paddingLeft,this._initialDocumentParams.overflow=document.body.style.overflow,this._initialDocumentParams.scrollTop=document.body.scrollTop,this._initialDocumentElementParams.scrollTop=document.documentElement.scrollTop,n.style.position="fixed",n.style.margin="0px",n.style.padding="0px",n.style.border="medium none",n.style.left="0px",n.style.top="0px",document.body.style.overflow="hidden",n.style.width="100%",n.style.height="100%",n.style.zIndex="9999",i.insertBefore(n,i.firstChild),document.documentElement.scrollTop="0px",document.body.scrollTop="0px",document.body.style.margin="0px",document.body.style.padding="0px",e.enableScrollZoom(),e.redraw()},_minimizeMap:function(){var e=this.getDgMap(),t=e.getContainer();this._initialMapParams.scrollZoomEnabled||e.disableScrollZoom(),t.style.position=this._initialMapParams.position,t.style.zIndex=this._initialMapParams.zIndex,t.style.left=this._initialMapParams.left,t.style.top=this._initialMapParams.top,t.style.border=this._initialMapParams.border,t.style.marginTop=this._initialMapParams.marginTop,t.style.marginRight=this._initialMapParams.marginRight,t.style.marginBottom=this._initialMapParams.marginBottom,t.style.marginLeft=this._initialMapParams.marginLeft,t.style.paddingTop=this._initialMapParams.paddingTop,t.style.paddingRight=this._initialMapParams.paddingRight,t.style.paddingBottom=this._initialMapParams.paddingBottom,t.style.paddingLeft=this._initialMapParams.paddingLeft,t.style.width=this._initialMapParams.width,t.style.height=this._initialMapParams.height,document.body.style.overflow=this._initialDocumentParams.overflow,document.body.style.marginTop=this._initialDocumentParams.marginTop,document.body.style.marginRight=this._initialDocumentParams.marginRight,document.body.style.marginBottom=this._initialDocumentParams.marginBottom,document.body.style.marginLeft=this._initialDocumentParams.marginLeft,document.body.style.paddingTop=this._initialDocumentParams.paddingTop,document.body.style.paddingRight=this._initialDocumentParams.paddingRight,document.body.style.paddingBottom=this._initialDocumentParams.paddingBottom,document.body.style.paddingLeft=this._initialDocumentParams.paddingLeft,document.body.scrollTop=this._initialDocumentParams.scrollTop,document.documentElement.scrollTop=this._initialDocumentElementParams.scrollTop;var i=this._initialMapParams.parentNode,n=this._initialMapParams.previousSibling,r=this._initialMapParams.nextSibling;if(n){var i=n.parentNode,o=n.nextSibling;o?i.insertBefore(t,o):i.appendChild(t)}else r?i.insertBefore(t,r):i.appendChild(t);e.redraw()},languageChangeHandler:function(){this._button.title=this._dgMap.locale.t("Expand")},CLASS_NAME:"DG.Controls.FullScreen"}),DG.Controls.Ruler=DG.Class(DG.Controls.Base,{rulerEnabled:!1,controlElement:null,RULER_MARKERS_GROUP:"markersg_ruler",RULER_GEOMETRY_GROUP:"ruler_geometries",RULER_SELECTION_STYLE:{strokeColor:"#867be8",strokeOpacity:1,strokeWidth:5,graphicZIndex:1e3},RULER_EDGE_POINT_ICON:{url:"http://maps.api.2gis.ru/images/markers/ruler-edge-point.png",size:{w:20,h:20},offset:{x:-10,y:-10}},RULER_BETWEEN_POINT_ICON:{url:"http://maps.api.2gis.ru/images/markers/ruler-between-point.png",size:{w:13,h:13},offset:{x:-7.5,y:-7.5}},_controlId:"dgRuler",_wasHidden:!1,_currentProject:null,_buttonClass:"dg-button",_escObserver:null,useCustomGeoclicker:!1,_wasControlActive:!1,initialize:function(){this.observers=[]},initHandlers:function(){var e=this,t=this.getDgMap();t.activeHint||(t.activeHint=new DG.Overlays.ActiveHint(t,{hintClass:"dg-ruler-hint",closeButtonTitle:t.locale.t("remove point")})),t.activeStaticHint||(t.activeStaticHint=new DG.Overlays.ActiveHint(t,{"static":!0,hintClass:"dg-ruler-hint",closeButtonTitle:t.locale.t("remove point")})),this.observers.push(t.addEventListener(t.activeHint.getCloseButtonId(),"DgClick",function(i){e.rulerPoints.removeRulerPoint(t.activeHint.owner())}),t.addEventListener(t.activeStaticHint.getCloseButtonId(),"DgClick",function(i){e.rulerPoints.removeRulerPoint(t.activeStaticHint.owner())}),t.addEventListener(t.getContainerId(),"DgZoomChange",function(){e._onDgZoomChange(e)}),t.addEventListener(t.getContainerId(),"DgProjectChange",function(i){if(t.getPlugin("ruler").TEST_PROJECT_CHANGE){var n=null===i.getProject()?null:i.getProject().prj;console.log("CURRENT_PROJECT: ",e._currentProject.prj," | ","NEW_PROJECT: ",n)}e._currentProject!=i.getProject()&&(e._currentProject=i.getProject(),e.rulerPoints.removeRuler())}))},_onDgZoomChange:function(e){var t=e.rulerPoints.getGeometryGroup(),i=e.rulerPoints.getMarkerGroup(),n=e.getDgMap(),r=n.activeStaticHint,o=n.activeHint;n.getZoom()<10?(r.hide(),o.hide(),t&&t.hide(),i.hide(),e._wasHidden||(e.toggleRuler({hide:!0}),e._wasHidden=!0)):e._wasHidden&&(e.toggleRuler(),t&&t.show(),i.show(),t&&t.length()&&e.rulerPoints.redraw(),e.rulerPoints.hideBetweenMarker(),e._wasHidden=!1)},onAddToMap:function(e){var t=this,i=this.getContainer(),e=this.getDgMap(),n=this.controlElement=document.createElement("div"),r=document.createElement("span");this._currentProject=e.getCurrentProject(),r.className="dg-button-icon dg-icon-ruler",n.appendChild(r),n.id=i.id+"_rulerControl",n.className="dg-ruler-control "+this._buttonClass,n.title=e.locale.t("Ruler"),i.appendChild(n),this.observers.push(e.addEventListener(n.id,"DgClick",function(){t.toggleRuler()}),e.addEventListener(n.id,"DgDrag",function(){return!0}),e.addEventListener(e.getContainerId(),"DgClick",function(e){if(!t.rulerEnabled)return!1;var i=DG.Utils.detectBrowser(),n="IE"==i[0]&&8==i[1];return t.rulerPoints.insertingMarkersLayer&&!n&&t.rulerPoints.insertingMarkersLayer===e.windowEvent.srcElement.id||t.rulerPoints.add(e),!0}))},onRemoveFromMap:function(){for(var e=0;e<this.observers.length;e++)this.observers[e].cleanup();this.observers=null},getStates:function(){return["enable","disable"]},onEnable:function(){this.getContainer().className="rulerControlEnabled";var e;for(e in this.observers)this.observers.hasOwnProperty(e)&&this.observers[e].enable()},onDisable:function(){this.getContainer().className="rulerControlDisabled";var e;for(e in this.observers)this.observers.hasOwnProperty(e)&&this.observers[e].disable()},rulerPoints:null,setRulerPoints:function(e){this.rulerPoints=e},_hasClass:function(e,t){return new RegExp("(\\s|^)"+t+"(\\s|$)").test(e.className)},_enableRuler:function(){var e=this.getDgMap();this.rulerEnabled=!0,this.controlElement.className="dg-ruler-control "+this._buttonClass+" dg-active",this._bindEscKey(),DG.EventManager.caller(new DG.Events.Map(e),e.getContainerId(),"DgRulerOn"),this.useCustomGeoclicker||e.geoclicker.disable(),this._wasControlActive=!0},_disableRuler:function(e){var t=this.getDgMap(),i=e.hide||!1,n="undefined"!=typeof e.cls?e.cls:" dg-disabled";this.rulerEnabled=!1,this.controlElement.className="dg-ruler-control "+this._buttonClass+n,this._unbindEscKey(),DG.EventManager.caller(new DG.Events.Map(t),t.getContainerId(),"DgRulerOff"),this.useCustomGeoclicker||t.geoclicker.enable(),i||this.rulerPoints.removeRuler()},toggleRuler:function(e){e=e||{};var t=e.hide||!1,i=this.getDgMap().getZoom(),n=this.controlElement,r=this._buttonClass,o=this._hasClass(n,"dg-active"),s=this._hasClass(n,"dg-disabled"),a=!o&&!s,l=i>9;this.rulerEnabled?o?l?this._disableRuler({cls:""}):(this._disableRuler({hide:t}),this._wasControlActive=!0):l&&this._enableRuler():a?l?this._enableRuler():(n.className="dg-ruler-control "+r+" dg-disabled",this._wasControlActive=!1):(n.className="dg-ruler-control "+r,this._wasControlActive&&this._enableRuler())},_bindEscKey:function(){var e=this,t=e.getDgMap();e._escObserver=t.addEventListener(t.getContainerId(),"DgKeyDown",function(t){t._event&&27==t._event.keyCode&&e.toggleRuler()}),this.observers.push(e._escObserver)},_unbindEscKey:function(){var e=this.observers.indexOf(this._escObserver);e!==-1&&this.observers.splice(e,1),this._escObserver.cleanup()}}),DG.Controls.Traffic=DG.Class(DG.Controls.Base,{_uiElements:null,_title:"",_position:null,_lastShowState:null,_intevalDays:null,_intervalHours:null,_intervalMinutes:null,_actualTime:"Сегодня",_isShowScore:!1,_timeoutIdStep1:null,_timeoutIdStep2:null,_controlExpandAnimationTimeout:0,_controlTrackerContainerTimeout:0,_isInitScoreSetted:!0,_tendencyIconClass:null,initialize:function(){var e,t=new DG.Configs.Traffic;if(e=DG.Utils.extend(t.controlConfig,e),DG.Controls.Base.prototype.initialize.call(this),!(e.position instanceof DG.ControlPosition))throw"The position is not an instance of DG.ControlPosition";DG.Utils.extendOptionsProtected(this,e,["controlId","position","title","isShowScore","controlExpandAnimationTimeout","controlTrackerContainerTimeout","tendencyIconClass"]),this._intevalDays=null,this._intervalHours=null,this._intervalMinutes=null,this._actualTime="Сегодня",this._timeoutIdStep1=null,this._timeoutIdStep2=null,this._uiElements={}},getContainer:function(){if(DG.Utils.iNU(this._DOMContainer)){var e=DG.Utils.createUniqueID(this._controlId);this._DOMContainer=DG.Utils.createDiv(e),this._DOMContainer.title=this._title,this._DOMContainer.style.zIndex=this._zIndex}return this._DOMContainer&&this._dgMap.getViewPortContainer().appendChild(this._DOMContainer),this._DOMContainer},setZIndex:function(e){this._zIndex=e,this.getContainer()&&(this.getContainer().style.zIndex=e)},onAddToMap:function(e,t){this._draw(),this.setState("trafficHide"),this._initAvgSettings()},onMapUpdate:function(e){},onRemoveFromMap:function(){this._dgMap&&this.getContainer()&&this.getContainer().parentNode==this._dgMap.getViewPortContainer()&&this._dgMap.getViewPortContainer().removeChild(this.getContainer())},getTimeInterval:function(){var e=0;return"avg"===this._lastShowState&&(e=60*this._intervalHours+this._intervalMinutes,e=Math.floor(e/15),e+=100*this._intevalDays),e},setTimeInterval:function(e){if(0!==e){var t=e,i=Math.floor(t/100);t-=100*i,t=15*t;var n=Math.floor(t/60),r=t-60*n;this._setAvgDay(i),this._setAvgTime(n,r)}},setScore:function(e){var t,i,n=this._uiElements.mainButtonHeader,r=this._uiElements.situation,o=[this._dgMap.locale.t("Traffic state 1"),this._dgMap.locale.t("Traffic state 2"),this._dgMap.locale.t("Traffic state 3"),this._dgMap.locale.t("Traffic state 4"),this._dgMap.locale.t("Traffic state 5"),this._dgMap.locale.t("Traffic state 6"),this._dgMap.locale.t("Traffic state 7"),this._dgMap.locale.t("Traffic state 8"),this._dgMap.locale.t("Traffic state 9"),this._dgMap.locale.t("Traffic state 10")],s=this,a=this._isInitScoreSetted?600:0,l=s._uiElements.scoresListItems[0],h=e-1;this._isShowScore&&e>0&&(t=window.getComputedStyle?getComputedStyle(l,null):l.currentStyle,i=+t.height.slice(0,2),i*=h,n.innerHTML=s._dgMap.locale.t("%d points",e),s._uiElements.scoresList[0].style.top=-i+"px",this._isInitScoreSetted?(r.innerHTML=o[h],this._isInitScoreSetted=!1):setTimeout(function(){r.innerHTML=o[h]},a))},getIsInitScoreSetted:function(){return this._isInitScoreSetted},setTendency:function(e){var t=this._uiElements.tendencyIcon;"+"==e?t.className=this._tendencyIconClass+" dg-tendency-icon-increase":"-"==e?t.className=this._tendencyIconClass+" dg-tendency-icon-decrease":t.className=this._tendencyIconClass},setActualTime:function(e){var t=this._uiElements.status,i=DG.Utils.getProjectTime(this._dgMap,1e3*e),n=i.getMinutes(),r=i.getHours();n<10&&(n="0"+n),r<10&&(r="0"+r),this._actualTime="Сегодня в "+r+":"+n,t.innerHTML=this._actualTime},refreshTime:function(){"avg"===this._lastShowState?this._initAvgSettings():this.setActualTime()},getStates:function(){return["trafficShowNow","trafficShowAvg","trafficHide","trafficUnavailable","trafficShowNowMin","trafficShowAvgMin"]},onTrafficShowNow:function(){this._visualizeControlState(),this._lastShowState="now",this.refreshTime(),this._triggerTimeIntervalChange()},onTrafficShowAvg:function(){this._visualizeControlState(),this._lastShowState="avg",this._triggerTimeIntervalChange()},onTrafficShowNowMin:function(){this._visualizeControlState()},onTrafficShowAvgMin:function(){this._visualizeControlState()},onTrafficHide:function(){this._visualizeControlState()},onTrafficUnavailable:function(){this._visualizeControlState()},mainButtonClickHandler:function(e){switch(this.getState()){case"trafficShowNow":case"trafficShowNowMin":this.setState("trafficHide");break;case"trafficShowAvg":case"trafficShowAvgMin":this.setState("trafficHide");break;case"trafficHide":"avg"===this._lastShowState?this.setState("trafficShowAvg"):this.setState("trafficShowNow");break;case"trafficUnavailable":}},mapClickHandler:function(e){switch(this.getState()){case"trafficShowNow":this.setState("trafficShowNowMin");break;case"trafficShowAvg":this.setState("trafficShowAvgMin")}},mouseOverHandler:function(e){switch(this.timePointMouseMoveHandler(e),this.getState()){case"trafficShowNowMin":this.setState("trafficShowNow");break;case"trafficShowAvgMin":this.setState("trafficShowAvg")}},timePointMouseMoveHandler:function(e){var t=this._uiElements.avgTimeTextMove;return t.style.display="none",!0},nowTabClickHandler:function(e){this.isInState("trafficShowAvg")&&this.setState("trafficShowNow")},avgTabClickHandler:function(e){this.isInState("trafficShowNow")&&this.setState("trafficShowAvg")},weekDayClickHandler:function(e){var t,i=this._uiElements.weekDays,n=0;t="undefined"==typeof e.windowEvent.target?e.windowEvent.srcElement.id:e.windowEvent.target.id;for(var r=1;r<=7;r++)i[r].id===t&&(n=r);this._setAvgDay(n),this._triggerTimeIntervalChange()},timePointClickHandler:function(e){for(var t=this._uiElements.timePoints,i=0,n=0,r=1;r<=4;r++)if(t[r].id===e.windowEvent.target.id){i=parseInt(t[r].innerHTML,10);break}return 23===i&&(n=59),this._setAvgTime(i,n),this._triggerTimeIntervalChange(),!0},trackpadClickHandler:function(e){return this.timePointMouseMoveHandler(e),this.trackerDragHandler(e),this._triggerTimeIntervalChange(),!0},trackerDragHandler:function(e){var t=this._uiElements.avgTimeContainer,i=2,n=208,r=e.getPoint().x-this._dgMap.getElementPosition(t).x-i;r<0&&(r=0),r>n&&(r=n);var o=15*Math.floor(96*r/n),s=Math.floor(o/60),a=o-60*s;return this._setAvgTime(s,a),!0},languageChangeHandler:function(e){},trackpadDragEndHandler:function(e){return this.timePointMouseMoveHandler(e),this._triggerTimeIntervalChange(),!0},trackpadMouseMoveHandler:function(e){var t=this._uiElements.avgTimeContainer,i=2,n=208,r=e.getPoint().x-this._dgMap.getElementPosition(t).x-i;r<0&&(r=0),r>n&&(r=n);var o=15*Math.floor(96*r/n),s=Math.floor(o/60),a=o-60*s;return this._setAvgMoveTime(s,a,e.getPoint()),!0},_triggerTimeIntervalChange:function(){var e=new DG.Events.Control(this);DG.EventManager.caller(e,this._dgMap.getMapContainerId(),"DGControlStateChange")},_draw:function(){var e=this.getContainer();return this._position.apply(e),this._createControls(e),this._bindEvents(e),e},_createControls:function(e){e.className="dg-traf-control-container dg-traf-short dg-traf-min",this._uiElements.controlDivContainer=e,this._uiElements.controlDiv=null,this._uiElements.scoresListBlock=null,this._uiElements.scoresList=null,this._uiElements.scoresListItems=null,this._uiElements.tendencyIcon=null,this._uiElements.mainButton=null,this._uiElements.mainButtonHeader=null,this._uiElements.situationDiv=null,this._uiElements.tabs=null,this._uiElements.nowTab=null,this._uiElements.avgTab=null,this._uiElements.trackerContainerBox=null,this._uiElements.trackerContainer=null,this._uiElements.tracker=null,this._uiElements.avgTimeBlock=null,this._uiElements.avgTimeContainer=null,this._uiElements.avgTimeText=null,this._uiElements.avgTimeTextMove=null,this._uiElements.status=null,this._uiElements.statusAvgDay=null,this._uiElements.statusAvgTime=null,this._uiElements.weekDaysContainer=null,this._uiElements.weekDays=null,this._uiElements.timePointsConteiner=null,this._uiElements.timePoints=null,this._createButtonDiv(e),this._createDetailsDiv(e)},_createButtonDiv:function(e){var t=document.createElement("div");t.id=e.id+"control",t.className="dg-traf-control";var i=document.createElement("div");i.id=e.id+"MainButton",i.className="dg-traf-button dg-traf-min";var n=document.createElement("span");n.className="dg-traf-icon dg-traf-icon-traffic";var r=document.createElement("span");r.className="dg-traf-header",r.style.display="inline";var o=document.createElement("span");o.className="dg-traf-icon dg-traf-icon-expand";var s=document.createElement("span");s.className="dg-traf-icon dg-traf-icon-collapse";var a=document.createElement("div");a.className="dg-traf-scores-wr",a.innerHTML='<ul class="dg-traf-scores">\n    \t\t<li class="dg-traf-scores-item">1</li>\n    \t\t<li class="dg-traf-scores-item">2</li>\n    \t\t<li class="dg-traf-scores-item">3</li>\n    \t\t<li class="dg-traf-scores-item">4</li>\n    \t\t<li class="dg-traf-scores-item">5</li>\n    \t\t<li class="dg-traf-scores-item">6</li>\n    \t\t<li class="dg-traf-scores-item">7</li>\n    \t\t<li class="dg-traf-scores-item">8</li>\n    \t\t<li class="dg-traf-scores-item">9</li>\n    \t\t<li class="dg-traf-scores-item">10</li>\n    \t</ul>';var l=document.createElement("ins");l.className="dg-tendency-icon",r.innerHTML="балл",i.appendChild(n),i.appendChild(a),i.appendChild(r),i.appendChild(l),i.appendChild(o),i.appendChild(s),t.appendChild(i),e.appendChild(t),this._uiElements.scoresListBlock=a,this._uiElements.scoresList=DG.Utils.DOM.getElementsByClassName("dg-traf-scores",this._uiElements.scoresListBlock),this._uiElements.scoresListItems=DG.Utils.DOM.getElementsByClassName("dg-traf-scores-item",this._uiElements.scoresListBlock),this._uiElements.tendencyIcon=l,this._uiElements.controlDiv=t,this._uiElements.mainButton=i,this._uiElements.mainButtonHeader=r},_createDetailsDiv:function(e){var t=e;e=this._uiElements.controlDiv;var i=document.createElement("div");i.className="dg-traf-details";var n=document.createElement("div");n.className="dg-traf-situation",n.innerHTML="&nbsp;";var r=document.createElement("div");r.className="dg-traf-tabs dg-traf-tab-active-now";var o=document.createElement("span");o.id=e.id+"TabNow",o.className="dg-traf-tab dg-traf-tab-now",o.innerHTML=this._dgMap.locale.t("Now");var s=document.createElement("span");s.id=e.id+"TabAvg",s.className="dg-traf-tab dg-traf-tab-average",s.innerHTML=this._dgMap.locale.t("Usually");var a=document.createElement("span");a.className="dg-traf-tab-marker";var l=document.createElement("div");l.className="dg-traf-tab-content dg-traf-tab-content-now";var h=document.createElement("div");h.className="dg-traf-tab-content dg-traf-tab-content-average";var c=document.createElement("div");c.className="dg-traf-weekdays dg-traf-weekdays-active-5";for(var u=[],d=null,p=1;p<=7;p++){switch(d=document.createElement("span"),d.id=e.id+"Weekday"+p,d.className="dg-traf-weekdays-point dg-traf-weekdays-"+p,p){case 1:d.innerHTML=this._dgMap.locale.t("Mo");break;case 2:d.innerHTML=this._dgMap.locale.t("Tu");break;case 3:d.innerHTML=this._dgMap.locale.t("We");break;case 4:d.innerHTML=this._dgMap.locale.t("Th");break;case 5:d.innerHTML=this._dgMap.locale.t("Fr");break;case 6:d.innerHTML=this._dgMap.locale.t("Sa");break;case 7:d.innerHTML=this._dgMap.locale.t("Su")}u.push(d)}var g=document.createElement("span");g.className="dg-traf-weekdays-marker";var m=document.createElement("div");m.id=e.id+"TrafTime",m.className="dg-traf-time";var f=document.createElement("div");f.id=e.id+"timePointsContainer",f.className="dg-traf-time-points";var y=document.createElement("div");y.className="dg-traf-time-borders";var _=document.createElement("span");_.className="dg-traf-time-border dg-traf-time-border1";var v=document.createElement("span");v.className="dg-traf-time-border dg-traf-time-border2";var D=document.createElement("span");D.id=e.id+"TimePoint1",D.className="dg-traf-time-point dg-traf-time-point1",D.innerHTML="00:00";var b=document.createElement("span");b.id=e.id+"TimePoint2",b.className="dg-traf-time-point dg-traf-time-point2",b.innerHTML="08:00";var L=document.createElement("span");L.id=e.id+"TimePoint3",L.className="dg-traf-time-point dg-traf-time-point3",L.innerHTML="16:00";var C=document.createElement("span");C.id=e.id+"TimePoint4",C.className="dg-traf-time-point dg-traf-time-point4",C.innerHTML="23:59";var G=document.createElement("div");G.id=e.id+"currentTimeBlock",G.className="dg-traf-current-time-container";var M=document.createElement("span");M.id=e.id+"currentTime",M.className="dg-traf-current-time";var S=document.createElement("div");S.id=e.id+"currentTimeHandler",S.className="dg-traf-time-handle";var w=document.createElement("div");w.id=e.id+"currentTimeText",w.className="dg-traf-time-text",w.innerHTML="will be set";var E=document.createElement("div");E.id=e.id+"currentTimeMove",E.className="dg-traf-select-time",E.innerHTML="12:45";var O=document.createElement("div");O.className="dg-traf-status",O.innerHTML=this._dgMap.locale.t("Today");var P=document.createElement("div");P.className="dg-traf-status-hidden",P.innerHTML="";var T=document.createElement("div");for(T.className="dg-traf-status-hidden",T.innerHTML="",r.appendChild(o),r.appendChild(s),r.appendChild(a),r.appendChild(l),p=0;p<u.length;p++)c.appendChild(u[p]);for(c.appendChild(g),y.appendChild(_),y.appendChild(v),f.appendChild(D),f.appendChild(b),f.appendChild(L),f.appendChild(C),m.appendChild(f),m.appendChild(y),M.appendChild(S),M.appendChild(w),G.appendChild(M),t.appendChild(G),t.appendChild(E),h.appendChild(c),h.appendChild(m),r.appendChild(h),i.appendChild(n),i.appendChild(r),i.appendChild(O),i.appendChild(P),i.appendChild(T),e.appendChild(i),this._uiElements.situation=n,this._uiElements.tabs=r,this._uiElements.nowTab=o,this._uiElements.avgTab=s,this._uiElements.trackerContainerBox=G,this._uiElements.trackerContainer=M,this._uiElements.tracker=S,this._uiElements.avgTimeBlock=M,this._uiElements.avgTimeContainer=m,this._uiElements.avgTimeText=w,this._uiElements.avgTimeTextMove=E,this._uiElements.status=O,this._uiElements.statusAvgDay=P,this._uiElements.statusAvgTime=T,this._uiElements.weekDaysContainer=c,this._uiElements.weekDays={},p=0;p<u.length;p++)this._uiElements.weekDays[p+1]=u[p];this._uiElements.timePointsConteiner=f,this._uiElements.timePoints={},this._uiElements.timePoints[1]=D,this._uiElements.timePoints[2]=b,this._uiElements.timePoints[3]=L,this._uiElements.timePoints[4]=C},_visualizeControlState:function(){switch(clearTimeout(this._timeoutIdStep1),clearTimeout(this._timeoutIdStep2),this.getState()){case"trafficShowNow":case"trafficShowAvg":case"trafficShowNowMin":case"trafficShowAvgMin":this._visualizeControlStatePart2(),this._timeoutIdStep1=setTimeout(DG.Utils.bind(this._visualizeControlStatePart1,this),this._controlExpandAnimationTimeout),this._timeoutIdStep2=setTimeout(DG.Utils.bind(this._visualizeControlStatePart3,this),this._controlTrackerContainerTimeout);break;case"trafficHide":case"trafficUnavailable":this._visualizeControlStatePart1(),this._timeoutIdStep1=setTimeout(DG.Utils.bind(this._visualizeControlStatePart2,this),this._controlExpandAnimationTimeout),this._timeoutIdStep2=setTimeout(DG.Utils.bind(this._visualizeControlStatePart3,this),this._controlTrackerContainerTimeout)}},_visualizeControlStatePart1:function(){var e=this._uiElements;switch(this.getState()){case"trafficShowNow":e.controlDivContainer.className="dg-traf-control-container dg-traf-short",e.tabs.className="dg-traf-tabs dg-traf-tab-active-now",e.status.innerHTML=this._actualTime,this._isShowScore||(e.mainButtonHeader.innerHTML='Скрыть пробки<sup class="dg-traf-beta">β</sup>');break;case"trafficShowAvg":e.controlDivContainer.className="dg-traf-control-container dg-traf-tall",e.tabs.className="dg-traf-tabs dg-traf-tab-active-average",e.status.innerHTML=this._dgMap.locale.t("According to 2GIS statistics"),this._isShowScore||(e.mainButtonHeader.innerHTML='Скрыть пробки<sup class="dg-traf-beta">β</sup>');break;case"trafficShowNowMin":e.controlDivContainer.className="dg-traf-control-container dg-traf-short dg-traf-inactive",this._isShowScore||(e.mainButtonHeader.innerHTML='Скрыть пробки<sup class="dg-traf-beta">β</sup>');break;case"trafficShowAvgMin":e.controlDivContainer.className="dg-traf-control-container dg-traf-tall dg-traf-inactive",e.status.innerHTML="Обычно в "+e.statusAvgDay.innerHTML+", "+e.statusAvgTime.innerHTML,this._isShowScore||(e.mainButtonHeader.innerHTML='Скрыть пробки<sup class="dg-traf-beta">β</sup>');break;case"trafficHide":e.controlDivContainer.className="dg-traf-control-container dg-traf-short dg-traf-min",this._isShowScore||(e.mainButtonHeader.innerHTML='Пробки<sup class="dg-traf-beta">β</sup>');break;case"trafficUnavailable":e.controlDivContainer.className="dg-traf-control-container dg-traf-unavailable"}},_visualizeControlStatePart2:function(){var e=this._uiElements;switch(this.getState()){case"trafficShowNow":case"trafficShowAvg":case"trafficShowNowMin":case"trafficShowAvgMin":e.mainButton.className="dg-traf-button";break;case"trafficHide":case"trafficUnavailable":e.mainButton.className="dg-traf-button dg-traf-min"}},_visualizeControlStatePart3:function(){var e=this._uiElements;switch(this.getState()){case"trafficShowAvg":e.trackerContainer.style.display="block";break;case"trafficShowAvgMin":case"trafficShowNow":case"trafficShowNowMin":case"trafficHide":case"trafficUnavailable":e.trackerContainer.style.display="none"}},_bindEvents:function(e){var t=this._uiElements;this.registerHandler(t.mainButton.id,"DgClick",DG.Utils.bind(this.mainButtonClickHandler,this)),this.registerHandler(t.nowTab.id,"DgClick",DG.Utils.bind(this.nowTabClickHandler,this)),this.registerHandler(t.avgTab.id,"DgClick",DG.Utils.bind(this.avgTabClickHandler,this));for(var i=1;i<=7;i++)this.registerHandler(t.weekDays[i].id,"DgClick",DG.Utils.bind(this.weekDayClickHandler,this));for(i=1;i<=4;i++)this.registerHandler(t.timePoints[i].id,"DgClick",DG.Utils.bind(this.timePointClickHandler,this)),this.registerHandler(t.timePoints[i].id,"DgMouseMove",DG.Utils.bind(this.timePointMouseMoveHandler,this));this.registerHandler(t.tracker.id,"DgDrag",DG.Utils.bind(this.trackerDragHandler,this)),this.registerHandler(t.tracker.id,"DgDragStop",DG.Utils.bind(this.trackpadDragEndHandler,this)),this.registerHandler(t.avgTimeContainer.id,"DgClick",DG.Utils.bind(this.trackpadClickHandler,this)),this.registerHandler(t.avgTimeContainer.id,"DgMouseMove",DG.Utils.bind(this.trackpadMouseMoveHandler,this)),this.registerHandler(t.tracker.id,"DgMouseMove",DG.Utils.bind(this.timePointMouseMoveHandler,this)),this.registerHandler(t.avgTimeText.id,"DgMouseMove",DG.Utils.bind(this.timePointMouseMoveHandler,this)),this.registerHandler(t.avgTimeText.id,"DgMouseMove",DG.Utils.bind(this.timePointMouseMoveHandler,this)),this.registerHandler(t.trackerContainerBox.id,"DgMouseMove",DG.Utils.bind(this.trackpadMouseMoveHandler,this)),this.registerHandler(t.trackerContainerBox.id,"DgClick",DG.Utils.bind(this.trackpadClickHandler,this));var n=DG.Utils.detectBrowser();"Opera"===n[0]&&(this.registerHandler(t.trackerContainer.id,"DgDrag",DG.Utils.bind(this.trackerDragHandler,this)),this.registerHandler(t.trackerContainer.id,"DgDragStop",DG.Utils.bind(this.trackpadClickHandler,this))),this.registerHandler(this._dgMap,"DgClick",DG.Utils.bind(this.mapClickHandler,this)),this.registerHandler(this._dgMap,"DgDrag",DG.Utils.bind(this.mapClickHandler,this)),this.registerHandler(this._dgMap,"DgZoomChange",DG.Utils.bind(this.mapClickHandler,this)),this.registerHandler(this._dgMap,"DgMouseOver",DG.Utils.bind(this.timePointMouseMoveHandler,this)),this.registerHandler(t.controlDiv.id,"DgMouseOver",DG.Utils.bind(this.mouseOverHandler,this)),this.registerHandler(this._dgMap,"DgLanguageChange",DG.Utils.bind(this.languageChangeHandler,this)),this.registerHandler(this.getContainer().id,"DgClick",function(){return!0}),this.registerHandler(this.getContainer().id,"DgDrag",function(){return!0}),this.registerHandler(this.getContainer().id,"DgMouseMove",function(){return!0})},_initAvgSettings:function(){var e=DG.Utils.getProjectTime(this._dgMap),t=e.getDay();0==t&&(t=7),this._setAvgDay(t),this._setAvgTime(e.getHours(),e.getMinutes())},_setAvgDay:function(e){e=parseInt(e,10);for(var t,i,n=this._uiElements.weekDaysContainer,r=this._uiElements.weekDays,o=this._uiElements.statusAvgDay,s=1;s<=7;s++)t=r[s],i="",s===e&&(i=" dg-traf-active",n.className="dg-traf-weekdays dg-traf-weekdays-active-"+s),t.className="dg-traf-weekdays-point dg-traf-weekdays-"+s+i;switch(e){case 1:o.innerHTML=this._dgMap.locale.t("monday");break;case 2:o.innerHTML=this._dgMap.locale.t("tuesday");break;case 3:o.innerHTML=this._dgMap.locale.t("wednesday");break;case 4:o.innerHTML=this._dgMap.locale.t("thursday");break;case 5:o.innerHTML=this._dgMap.locale.t("friday");break;case 6:o.innerHTML=this._dgMap.locale.t("saturday");break;case 7:o.innerHTML=this._dgMap.locale.t("sunday")}this._intevalDays=e},_setAvgTime:function(e,t){24==e&&(e=23,t=45),e=parseInt(e,10),t=parseInt(t,10),t=t<15?0:t<30?15:t<45?30:45,23===e&&45===t&&(t=59),this._intervalHours=e,this._intervalMinutes=t;var i=this._uiElements.avgTimeText,n=this._uiElements.avgTimeBlock,r=this._uiElements.statusAvgTime,o=(this._uiElements.tracker,Math.floor((60*e+t)/15)),s=208,a=96,l=18,h=12,c=5,u=Math.floor(o*s/a),d=-2;u<l?d=h-u:u>s-l&&(d=s-u-h-c),n.style.left=u+"px",i.style.left=d+"px",e<10&&(e="0"+e),t<10&&(t="0"+t),i.innerHTML=e+":"+t,r.innerHTML=e+":"+t},_setAvgMoveTime:function(e,t,i){var n=this._uiElements.controlDivContainer,r=this._uiElements.avgTimeContainer,o=this._uiElements.avgTimeTextMove,s=15,a=i.x-this._dgMap.getElementPosition(r).x,l=i.y-this._dgMap.getElementPosition(r).y,h=this._dgMap.getElementPosition(r).x-this._dgMap.getElementPosition(n).x+a+s,c=this._dgMap.getElementPosition(r).y-this._dgMap.getElementPosition(n).y+l+s;o.style.display="block",o.style.left=h+"px",o.style.top=c+"px",e<10&&(e="0"+e),t<10&&(t="0"+t),o.innerHTML=e+":"+t},CLASS_NAME:"DG.Controls.Traffic"}),DG.Controls.Traffic.Touch=DG.Class(DG.Controls.Base,{_uiElements:null,_position:null,initialize:function(){var e,t=new DG.Configs.Traffic;if(e=DG.Utils.extend(t.controlConfig,e),DG.Controls.Base.prototype.initialize.call(this),!(e.position instanceof DG.ControlPosition))throw"The position is not an instance of DG.ControlPosition";DG.Utils.extendOptionsProtected(this,e,["controlId","position","title"]),this._uiElements={}},onAddToMap:function(e,t){this.setState("trafficHide"),this._draw()},onMapUpdate:function(e){},onRemoveFromMap:function(){this._dgMap&&this.getContainer()&&this.getContainer().parentNode==this._dgMap.getViewPortContainer()&&this._dgMap.getViewPortContainer().removeChild(this.getContainer());
},getStates:function(){return["trafficShowNow","trafficHide","trafficUnavailable"]},onTrafficHide:function(){DG.Utils.iNU(this._uiElements.button)||(this._uiElements.button.className="dg-traf-touch")},onTrafficUnavailable:function(){DG.Utils.iNU(this._uiElements.button)||(this._uiElements.button.className="dg-traf-unavailable")},onTrafficShowNow:function(){DG.Utils.iNU(this._uiElements.button)||(this._uiElements.button.className="dg-traf-touch dg-traf-pressed")},_draw:function(){var e=this.getContainer();return this._position.apply(e),this._createMainButton(e),this._bindEvents(e),e},_createMainButton:function(e){var t=document.createElement("div");t.id=this.getContainer().id+"Traffic",t.className="dg-traf-touch",t.innerHTML=this._dgMap.locale.t("Traffic"),this._uiElements.button=t,e.appendChild(t)},_bindEvents:function(e){this.registerHandler(e.id,"DgClick",function(){return!0}),this.registerHandler(e.id,"DgDrag",function(){return!0}),this.registerHandler(this._uiElements.button.id,"DgClick",DG.Utils.bind(this.buttonClickHandler,this)),this.registerHandler(this._dgMap,"DgLanguageChange",DG.Utils.bind(this.languageChangeHandler,this))},buttonClickHandler:function(){switch(this.getState()){case"trafficShowNow":this.setState("trafficHide");break;case"trafficHide":this.setState("trafficShowNow");break;case"trafficUnavailable":}},languageChangeHandler:function(){this._uiElements.button.innerHTML=this._dgMap.locale.t("Traffic")},CLASS_NAME:"DG.Controls.Traffic.Touch"}),DG.Controls.Zoom=DG.Class(DG.Controls.Base,{_uiElements:null,_zoomLevels:null,_minZoom:null,_maxZoom:null,_showTracker:!0,_plusClass:null,_minusClass:null,_title:"",_position:null,_size:null,initialize:function(){var e=DG.Configs.Zoom;if(DG.Controls.Base.prototype.initialize.call(this),e.size=DG.Utils.isTouchDevice()?DG.Configs.Zoom.sizeTouch:DG.Configs.Zoom.sizeNormal,e.plusClass=DG.Utils.isTouchDevice()?DG.Configs.Zoom.plusClassTouch:DG.Configs.Zoom.plusClassNormal,e.minusClass=DG.Utils.isTouchDevice()?DG.Configs.Zoom.minusClassTouch:DG.Configs.Zoom.minusClassNormal,!(e.position instanceof DG.ControlPosition))throw"The position is not an instance of DG.ControlPosition";if(!(e.size instanceof DG.Size))throw"The size is not an instance of DG.Size";DG.Utils.extendOptionsProtected(this,e,["controlId","position","size","title","plusClass","minusClass"]),e.enableControl?this.setState("enable"):this.setState("disable"),this._uiElements={plus:null,minus:null,tracker:null,drag:null}},getContainer:function(){if(!this._dgMap)throw new ReferenceError("Zoom control should be added on map");if(DG.Utils.iNU(this._DOMContainer)){var e=DG.Utils.createUniqueID(this._controlId);this._DOMContainer=DG.Utils.createDiv(e),this._DOMContainer.title=this._title,this._DOMContainer.className=DG.Utils.isTouchDevice()?"dgZoomTouch":"dgZoom",this._DOMContainer.style.zIndex=this._zIndex}return this._DOMContainer&&this._dgMap.getViewPortContainer().appendChild(this._DOMContainer),this._DOMContainer},setZIndex:function(e){if(DG.Utils.empty(e))throw new TypeError("Z-index should be specify");if(e=parseInt(e),e<0)throw new Error("Z-index should be positive");this._zIndex=e,this.getContainer()&&(this.getContainer().style.zIndex=e)},moveTo:function(e){if(DG.Utils.empty(e))throw"The position is incorrect!";e.apply(this.getContainer())},onAddToMap:function(e,t){this._draw()},onMapUpdate:function(e){var t=this._dgMap.getZoom();this._redraw(),this._drawInZoom(t),this._getZoomSettings()},onRemoveFromMap:function(){this._dgMap&&this.getContainer()&&this.getContainer().parentNode==this._dgMap.getViewPortContainer()&&this._dgMap.getViewPortContainer().removeChild(this.getContainer())},getStates:function(){return["enable","disable"]},onEnable:function(){DG.Utils.empty(this._uiElements)||DG.Utils.empty(this._uiElements.plus)||DG.Utils.empty(this._uiElements.minus)||(this._uiElements.plus&&(this._uiElements.plus.className=this._plusClass),this._uiElements.minus&&(this._uiElements.minus.className=this._minusClass),this._uiElements.drag&&(this._uiElements.drag.className="dgZoomDrag"),this._redraw())},onDisable:function(){DG.Utils.empty(this._uiElements)||DG.Utils.empty(this._uiElements.plus)||DG.Utils.empty(this._uiElements.minus)||(this._uiElements.plus&&(this._uiElements.plus.className=this._plusClass+" zmBtnDisable"),this._uiElements.minus&&(this._uiElements.minus.className=this._minusClass+" zmBtnDisable"),this._uiElements.drag&&(this._uiElements.drag.className="dgZoomDrag zmBtnDisable"),this._redraw())},minimize:function(){this._showTracker=!1,this._redraw()},maximize:function(){this._showTracker=!0,this._redraw()},zoomClickHandler:function(e){if(this.isInState("disable"))return!0;var t=8,i=t/2,n=parseInt(this._uiElements.tracker.style.height),r=e.getPoint().y-this._dgMap.getElementPosition(this._uiElements.tracker).y,o=r+i;o<0&&(o=0),o>n&&(o=n);var s=Math.floor(o/n*this._zoomLevels);s=this._maxZoom-s;try{this._dgMap.setZoom(s)}catch(a){}return!0},zoomDragHandler:function(e){if(this.isInState("disable"))return!0;var t=8,i=t/2,n=parseInt(this._uiElements.tracker.style.height),r=e.getPoint().y-this._dgMap.getElementPosition(this._uiElements.tracker).y,o=r-i;return o<=-1*i&&(o=-1*i),o>n-i&&(o=n-i),this._uiElements.drag.style.top=o+"px",!0},zoomSettingsChangeHandler:function(e){this._getZoomSettings()},zoomChangeHandler:function(e){var t=e.getZoom();this._drawInZoom(t)},viewResizeHandler:function(e){var t=e.getViewportSize();this._checkSize(t)},_checkSize:function(e){var t=20*(this._zoomLevels+5);e.height<t||e.width<300?this.minimize():this.maximize()},plusButtonClickHandler:function(e){if(this.isInState("disable"))return!0;try{this._dgMap.getMaxZoom()>this._dgMap.getZoom()&&(this._dgMap.zoomIn(),DG.UIStats.track({expl:"ZoomControl",name:"Key+"}))}catch(t){}return!0},minusButtonClickHandler:function(){if(this.isInState("disable"))return!0;try{this._dgMap.getMinZoom()<this._dgMap.getZoom()&&(this._dgMap.zoomOut(),DG.UIStats.track({expl:"ZoomControl",name:"Key-"}))}catch(e){}return!0},languageChangeHandler:function(e){this._uiElements.plus&&(this._uiElements.plus.title=this._dgMap.locale.t("Zoom in")),this._uiElements.minus&&(this._uiElements.minus.title=this._dgMap.locale.t("Zoom out")),this._uiElements.drag&&(this._uiElements.drag.title=this._dgMap.locale.t("Change zoom"))},_plusButtonDown:function(){if(this._uiElements.plus){var e=this._uiElements.plus.className;e.indexOf("zmBtnDisable")==-1&&(this._uiElements.plus.className=this._plusClass+" dgBtnPressed")}},_minusButtonDown:function(){if(this._uiElements.minus){var e=this._uiElements.minus.className;e.indexOf("zmBtnDisable")==-1&&(this._uiElements.minus.className=this._minusClass+" dgBtnPressed")}},_zoomButtonsUp:function(e){if(this._uiElements.plus){var t=this._uiElements.plus.className;t.indexOf("zmBtnDisable")==-1&&(this._uiElements.plus.className=this._plusClass)}if(this._uiElements.minus){var t=this._uiElements.minus.className;t.indexOf("zmBtnDisable")==-1&&(this._uiElements.minus.className=this._minusClass)}},_drawInZoom:function(e){if(this._uiElements.tracker){var t=this._maxZoom-e,i=parseInt(this._uiElements.tracker.style.height),n=8,r=i/this._zoomLevels*t;r=Math.round(r-n/2),this._uiElements.drag.style.top=r+"px"}this._uiElements.plus&&(e==this._maxZoom?this._uiElements.plus.className=this._plusClass+" zmBtnDisable":this._uiElements.plus.className=this._plusClass),this._uiElements.minus&&(e==this._minZoom?this._uiElements.minus.className=this._minusClass+" zmBtnDisable":this._uiElements.minus.className=this._minusClass)},_getZoomSettings:function(){var e=this._dgMap.getZoomRestrictions();this._minZoom=e.min,this._maxZoom=e.max,this._zoomLevels=this._maxZoom-this._minZoom,0==this._zoomLevels?this.hide():this.show()},_draw:function(){this._getZoomSettings();var e=this.getContainer();return this._position.apply(e),this._size.apply(e),DG.Utils.isTouchDevice()?(this._createTouchButtons(e),this._bindTouchEvents(e)):(this._createMainButtons(e),this._redraw(),this._bindEvents(e),this._checkSize(this._dgMap.getViewPort())),this._drawInZoom(this._dgMap.getZoom()),e},_createMainButtons:function(e){var t=document.createElement("div");t.className="dgZoomTop",e.appendChild(t);var i=document.createElement("div");i.id=this.getContainer().id+"Plus",i.className=this._plusClass,i.title=this._dgMap.locale.t("Zoom in"),e.appendChild(i),DG.EventManager.addBrowserAllowElementDomID(i.id);var n=document.createElement("div"),r=document.createElement("div");n.appendChild(r),e.appendChild(n),n.id=this.getContainer().id+"Tracker",n.className="dgZoomTracker",r.id=this.getContainer().id+"Drag",r.className="dgZoomDrag",r.title=this._dgMap.locale.t("Change zoom"),DG.EventManager.addBrowserAllowElementDomID(r.id);var o=document.createElement("div");o.id=this.getContainer().id+"Minus",o.className=this._plusClass,o.title=this._dgMap.locale.t("Zoom out"),e.appendChild(o),DG.EventManager.addBrowserAllowElementDomID(o.id);var s=document.createElement("div");s.className="dgZoomBottom",e.appendChild(s),this.isInState("disable")&&(i.className+=" zmBtnDisable",o.className+=" zmBtnDisable",r.className+=" zmBtnDisable"),this._uiElements.plus=i,this._uiElements.tracker=n,this._uiElements.drag=r,this._uiElements.minus=o},_createTouchButtons:function(e){var t=document.createElement("div");t.innerHTML="+",t.id=this.getContainer().id+"Plus",t.className=this._plusClass,e.appendChild(t);var i=document.createElement("div");i.innerHTML="&ndash;",i.id=this.getContainer().id+"Minus",i.className=this._plusClass,e.appendChild(i),this.isInState("disable")&&(t.className+=" zmBtnDisable",i.className+=" zmBtnDisable"),this._uiElements.plus=t,this._uiElements.minus=i},_redraw:function(){if(this._uiElements.tracker)if(this._showTracker){this._uiElements.tracker.style.display="block";var e=10*this._zoomLevels+2;this._uiElements.tracker.style.height=e+"px";var t=e+54;this.getContainer().style.height=t+"px"}else this._uiElements.tracker.style.display="none",this.getContainer().style.height="47px"},_bindEvents:function(e){var t=this._dgMap.getMapContainerId(),i=this._uiElements;this.registerHandler(e.id,"DgClick",function(){return!0}),this.registerHandler(e.id,"DgDrag",function(){return!0}),this.registerHandler(t,"DgSettingsChange",DG.Utils.bind(this.zoomSettingsChangeHandler,this)),this.registerHandler(i.plus.id,"DgClick",DG.Utils.bind(this.plusButtonClickHandler,this)),this.registerHandler(i.minus.id,"DgClick",DG.Utils.bind(this.minusButtonClickHandler,this)),this.registerHandler(i.tracker.id,"DgDrag",DG.Utils.bind(this.zoomDragHandler,this)),this.registerHandler(i.tracker.id,"DgDragStop",DG.Utils.bind(this.zoomClickHandler,this)),this.registerHandler(i.tracker.id,"DgClick",DG.Utils.bind(this.zoomClickHandler,this)),this.registerHandler(t,"DgMapRedraw",DG.Utils.bind(this.viewResizeHandler,this)),this.registerHandler(t,"DgZoomChange",DG.Utils.bind(this.zoomChangeHandler,this)),this.registerHandler(t,"DgSettingsChange",DG.Utils.bind(this.onMapUpdate,this)),this.registerHandler(this._dgMap,"DgLanguageChange",DG.Utils.bind(this.languageChangeHandler,this)),this.registerHandler(this.getContainer().id,"DgMouseMove",function(){return!0});var n=DG.Utils.detectBrowser();"IE"!=n[0]||6!=n[1]&&7!=n[1]||(this.registerHandler(i.plus.id,"DgMouseDown",DG.Utils.bind(function(){this._uiElements.plus.className="dgZoomPlus zmBtnPress"},this)),this.registerHandler(i.plus.id,"DgMouseUp",DG.Utils.bind(function(){this._uiElements.plus.className="dgZoomPlus"},this)),this.registerHandler(i.minus.id,"DgMouseDown",DG.Utils.bind(function(){this._uiElements.minus.className="dgZoomMinus zmBtnPress"},this)),this.registerHandler(i.minus.id,"DgMouseUp",DG.Utils.bind(function(){this._uiElements.minus.className="dgZoomMinus"},this)))},_bindTouchEvents:function(e){var t=this._dgMap.getMapContainerId(),i=this._uiElements;this.registerHandler(e.id,"DgClick",function(){return!0}),this.registerHandler(e.id,"DgDrag",function(){return!0}),this.registerHandler(i.plus.id,"DgClick",DG.Utils.bind(this.plusButtonClickHandler,this)),this.registerHandler(i.minus.id,"DgClick",DG.Utils.bind(this.minusButtonClickHandler,this)),this.registerHandler(i.plus.id,"DgMouseDown",DG.Utils.bind(this._plusButtonDown,this)),this.registerHandler(i.minus.id,"DgMouseDown",DG.Utils.bind(this._minusButtonDown,this)),this.registerHandler(t,"DgMouseUp",DG.Utils.bind(this._zoomButtonsUp,this)),this.registerHandler(t,"DgZoomChange",DG.Utils.bind(this.zoomChangeHandler,this)),this.registerHandler(t,"DgSettingsChange",DG.Utils.bind(this.onMapUpdate,this))},CLASS_NAME:"DG.Controls.Zoom"}),DG.AjaxManager={_callbacks:{},_callbackGroups:{},get:function(e){var t,i,n,r,o,s,a,l,h,c="";if("undefined"==typeof e.url||/https?:\/\/.+/.test(e.url)===!1)throw new Error("URL is required");t=e.success||function(){},i=e.failure||function(){},n=e.scope||this,r=e.url,o=e.data||{},l=e.cid||DG.Utils.createUniqueID("dga_"),DG.AjaxManager._callbacks[l]=function(e,r){"undefined"!=typeof r&&r===!0?i.apply(n,[e]):t.apply(n,[e])};for(var u in o)o.hasOwnProperty(u)&&(c+=encodeURIComponent(u)+"="+encodeURIComponent(o[u])+"&");return c&&(r+=r.indexOf("?")==-1?"?"+c:r.match(/\?[\w\d]+/)?"&"+c:c),r=DG.Utils.stringFormat(r,{callback:"DG.AjaxManager._callbacks."+l}),s=document.createElement("script"),a=!1,s.src=r,s.async=!0,s.type="text/javascript",s.onload=s.onreadystatechange=function(){a||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(a=!0,s.onload=s.onreadystatechange=null,s&&s.parentNode&&s.parentNode.removeChild(s),delete DG.AjaxManager._callbacks[l])},s.onerror=function(){if(DG.AjaxManager._callbacks[l])DG.AjaxManager._callbacks[l]({},!0),s.onload();else{var e=DG.Utils.detectBrowser();"IE"===e[0]&&e[1]>8&&console.log('AJAX request "'+l+'" broken!')}},h=0!==document.getElementsByTagName("head").length?document.getElementsByTagName("head")[0]:document,h.appendChild(s),l},addCallbackToGroup:function(e,t){DG.Utils.empty(this._callbackGroups[t])&&(this._callbackGroups[t]={}),this._callbackGroups[t][e]=!0},cancelCallback:function(e){DG.Utils.empty(DG.AjaxManager._callbacks[e])||(DG.AjaxManager._callbacks[e]=function(){});for(var t in this._callbackGroups)for(var i in this._callbackGroups[t])i==e&&delete this._callbackGroups[t][e]},cancelCallbacksByGroup:function(e){e instanceof RegExp?this._cancelCallbacksByGroupIdRegExp(e):this._cancelCallbacksByGroupId(e)},cancelAllCallbacks:function(){for(var e in this._callbackGroups)this.cancelCallbacksByGroup(e)},_cancelCallbacksByGroupId:function(e){if(!DG.Utils.empty(this._callbackGroups[e]))for(var t in this._callbackGroups[e])DG.Utils.empty(DG.AjaxManager._callbacks[t])||(DG.AjaxManager._callbacks[t]=function(){}),delete this._callbackGroups[e][t]},_cancelCallbacksByGroupIdRegExp:function(e){for(var t in this._callbackGroups)e.test(t)&&this.cancelCallbacksByGroup(t)},CLASS_NAME:"DG.AjaxManager"},DG.BalloonGroup=DG.Class(DG.OverlayGroup,{_name:null,_items:[],_manager:null,_isVisible:!0,initialize:function(e,t,i){DG.OverlayGroup.prototype.initialize.apply(this,arguments),this._registerHandler(this._dgMap.getContainerId(),"DgZoomChange",OpenLayers.Function.bind(this.onMapUpdate,this))},onMapUpdate:function(e){for(i=0,len=this._items.length;i<len;i++)this._items[i].onMapUpdate()},_makeSpecialAdd:function(e){e.initializeBeforeAddOnMap(),e.setLayerContainerDiv(this._dgMap.getOlMap().layerContainerDiv),e.prepareDivBeforeFirstDraw(),e.setZIndex(750+this._items.length),this._dgMap.getOlMap().layerContainerDiv.appendChild(e.getDiv())},_makeSpecialRemove:function(e){if(e.getDiv())try{this._dgMap.getOlMap().layerContainerDiv.removeChild(e.getDiv())}catch(t){}e.clearBeforeRemoveFromMap()},CLASS_NAME:"DG.BalloonGroup"}),DG.CollectionBounds=DG.Class(DG.Bounds,{_points:[],_lons:[],_lats:[],initialize:function(e){e instanceof Array&&0!=e.length?this._points=e:this._points=[],this._recalculateBounds()},addPoint:function(e){if(!(e instanceof DG.GeoPoint))throw TypeError("It must be an instance of DG.GeoPoint class");this._points.push(e),this._recalculateBounds()},removePoint:function(e){if(!(e instanceof DG.GeoPoint))throw TypeError("It must be an instance of DG.GeoPoint class");for(var t=null,i=0;i<this._points.length;i++)if(e.equals(this._points[i])){t=i;break}if(DG.Utils.iNU(t))throw TypeError("No point. Can't delete a non-existent point in bounds");this._points.splice(t,1),this._recalculateBounds()},clear:function(){this._lons=[],this._lats=[],this._points=[],this.centerLonLat=null,this.bottom=null,this.left=null,this.right=null,this.top=null,DG.Bounds.prototype.clear.apply(this),DG.Bounds.prototype.destroy.apply(this)},destroy:function(){this.clear()},_recalculateBounds:function(){if(0!=this._points.length){this._processPoints(),this._calculateEdges();var e=[new DG.GeoPoint(this.left,this.bottom),new DG.GeoPoint(this.right,this.top)];DG.Bounds.prototype.initialize.apply(this,e),this._centerGeoPoint=!1,this.centerLonLat=!1}},_processPoints:function(){this._lons=[],this._lats=[];var e,t;for(e=0;e<this._points.length;e++)t=this._points[e],this._lons.push(t.getLon()),this._lats.push(t.getLat())},_calculateEdges:function(){var e,t=this._lons,i=this._lats,n=t[0],r=t[0],o=i[0],s=i[0];for(e=0;e<t.length;e++)t[e]<n&&(n=t[e]),t[e]>r&&(r=t[e]),i[e]<o&&(o=i[e]),i[e]>s&&(s=i[e]);this.left=n,this.right=r,this.top=s,this.bottom=o},clone:function(){var e=new DG.CollectionBounds(this._points);return e},contains:function(e){if(!(e instanceof DG.GeoPoint))throw TypeError("It must be an instance of DG.GeoPoint class");return 0!=this._points.length&&DG.Bounds.prototype.contains.apply(this,[e])},CLASS_NAME:"DG.CollectionBounds"}),DG.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(e){alert(e)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"DG.Console"},function(){"undefined"!=typeof console&&(DG.Console=console)}(),DG.ControlGroup=DG.Class(DG.OverlayGroup,OpenLayers.Layer.Vector,{_name:null,_items:[],_manager:null,_isVisible:!0,initialize:function(e,t,i){DG.OverlayGroup.prototype.initialize.apply(this,arguments)},_makeSpecialAdd:function(e,t){e.setZIndex(this._dgMap.getOlMap().Z_INDEX_BASE.Control+this._manager.getAll().length),this._dgMap.getDisplayProjection()&&!e.displayProjection&&(e.displayProjection=this._dgMap.getDisplayProjection()),t instanceof DG.ControlPosition&&t.apply(e.getContainer())},_makeSpecialRemove:function(e){e.clearBeforeRemoveFromMap()},CLASS_NAME:"DG.ControlGroup"}),DG.Converter=DG.Class({_dgMap:null,initialize:function(e){if(!(e instanceof DG.Map))throw TypeError("DG.Converter constructor accepts DG.Map only!");this._dgMap=e},mapPixelsToCoordinates:function(e){if(!(e instanceof DG.Point))throw TypeError("Method 'mapPixelsToCoordinates' accept DG.Point only!");var t=this._dgMap.getOlMap().getLonLatFromPixel(e),i=new DG.GeoPoint(t.lon,t.lat,DG.GeoPoint.EPSG_900913);return i.toLonLat()},coordinatesToMapPixels:function(e){if(!(e instanceof DG.GeoPoint))throw TypeError("Method 'coordinatesToMapPixels' accept DG.GeoPoint only!");var t=this._dgMap.getOlMap().getPixelFromLonLat(e.toMercator());return new DG.Point(t.x,t.y)},coordinatesToGlobalPixels:function(e){if(!(e instanceof DG.GeoPoint))throw TypeError("Method 'coordinatesToGlobalPixels' accept DG.GeoPoint only!");e.toMercator();var t=this._dgMap.getOlMap().getMaxExtent(),i=this._dgMap.getOlMap().getResolution(),n=Math.floor((e.lon-t.left)/i),r=Math.floor((t.top-e.lat)/i);return new DG.Point(n,r)},getTileNumByGeoPoint:function(e){var t=this.coordinatesToGlobalPixels(e),i=Math.floor(t.x/this._dgMap.getOlMap().tileSize.w),n=Math.floor(t.y/this._dgMap.getOlMap().tileSize.h);return new DG.Point(i,n)},destroy:function(){this._dgMap=null},CLASS_NAME:"DG.Converter"}),DG.Cursor={ARROW:"dgDefaultCursor",CROSSHAIR:"dgCrosshairCursor",HELP:"dgHelpCursor",MOVE:"dgMoveCursor",POINTER:"dgPointerCursor",INHERIT:"dgIneritCursor"},DG.DeprecatedWarning=function(){var e=this._dgMap||DG.Geocoder._map;e&&e.showDeprecatedWarning&&e.showDeprecatedWarning()},DG.Geocoder={_dgMap:null,initialize:function(e){DG.Geocoder._map=e,this._dgMap=e},get:DG.DeprecatedWarning,cancelCallback:DG.DeprecatedWarning,_validateGetOptions:DG.DeprecatedWarning},DG.GeocoderClass=new DG.Class(DG.Geocoder),DG.Geocoder2={_dgMap:null,initialize:function(e){this._dgMap=e},get:function(e,t){var i,n,r,o,s,a={};if(!(e instanceof DG.GeoPoint)&&"[object String]"!==Object.prototype.toString.call(e)&&"[object Number]"!==Object.prototype.toString.call(e)||"[object String]"===Object.prototype.toString.call(e)&&e.length<2)throw new TypeError('Parameter "query" is required and should be a string at least two characters long, number or an instance of "DG.GeoPoint"');if(e instanceof DG.GeoPoint&&!DG.Utils.empty(t.bound))throw new TypeError('You can not specify options searched by coordinates "query" and set "bound" at the same time');if(t){a={fields:null,radius:null,limit:null,bound:null,success:null,failure:null},DG.Utils.extendOptions(a,t,["fields","radius","limit","bound","success","failure"]),this._validateGetOptions(a),a.fields=["geometry.centroid","geometry.selection","links","adm_div","address","floors","description","attraction"];for(var l=0,h=a.fields.length;l<h;l++)a.fields[l]="items."+a.fields[l]}return null!==this._dgMap&&(t.type?a.type=t.type:a.type=this._getTypesByZoom(this._dgMap.getZoom()),a.zoom_level=this._dgMap.getZoom()),e instanceof DG.GeoPoint?a.point=e.getLon()+","+e.getLat():a.q=e,DG.Utils.empty(a.bound)||(r=a.bound.getLeft()+","+a.bound.getTop(),o=a.bound.getRight()+","+a.bound.getBottom(),a.bound=null,delete a.bound,a.point1=r,a.point2=o),a.key=DG.Geocoder2.WEB_API_KEY,a.format="jsonp",DG.Utils.iNU(a.success)||(i=a.success,delete a.success),DG.Utils.iNU(a.failure)||(n=a.failure,delete a.failure),s=DG.AjaxManager.get({url:DG.Geocoder2.WEB_API_SERVER+"/"+DG.Geocoder2.WEB_API_VERSION+DG.Geocoder2.GEO_CODER_URL+"?callback=$[callback]",data:a,success:function(t){if(200!=t.meta.code||DG.Utils.empty(i))200==t.response_code||DG.Utils.empty(n)||n.apply(this,[parseInt(t.response_code),t.error_message]);else{for(var r=[],o=0,s=t.result.items.length;o<s;o++){var a=t.result.items[o],l={id:a.id,type:a.subtype||a.type,name:a.full_name,shortName:a.name||a.subtype_name||a.full_name,adm_div:a.adm_div,reference:a.reference,links:a.links,building_name:a.building_name,purpose_name:a.purpose_name,address:a.address,floors:a.floors};if(a.geometry&&a.geometry.centroid){var h=DG.WKTParser.getPoint(a.geometry.centroid);l.centroid=h.getPosition()}else e instanceof DG.GeoPoint&&(l.centroid=e);a.geometry&&a.geometry.selection&&(l.selection=DG.WKTParser.getObject(a.geometry.selection)),r.push(new DG.Geocoder2Object(l))}i.apply(this,[r])}},failure:function(){DG.Utils.empty(n)||n.apply(this,[400,"Bad Request"])},scope:this})},cancelCallback:function(e){DG.AjaxManager.cancelCallback(e)},_validateGetOptions:function(e){if(DG.Utils.empty(e.fields))delete e.fields;else for(var t=["geometry.selection","geometry.centroid","adm_div","address","floors","attraction","statistics","level_count","capacity","description","context","access_name","is_paid","access","access_comment","schedule"],i=0,n=e.fields.length;i<n;i++)if(!DG.Utils.inArray(e.fields[i],t))throw new TypeError('Option "type['+e.fields[i]+']" is unavailable');if(!DG.Utils.empty(e.radius)&&("[object Number]"!==Object.prototype.toString.call(e.radius)||e.radius<1||e.radius>250))throw new TypeError('Option "radius" should be a number from 1 to 250');if(DG.Utils.empty(e.radius)&&delete e.radius,!DG.Utils.empty(e.limit)&&("[object Number]"!==Object.prototype.toString.call(e.limit)||e.limit<1||e.limit>2e3))throw new TypeError('Option "limit" should be a number from 1 to 2000');if(DG.Utils.empty(e.limit)&&delete e.limit,!(DG.Utils.empty(e.bound)||e.bound instanceof DG.Bounds))throw new TypeError('Option "bound" should be an instance of DG.Bounds');if(DG.Utils.empty(e.bound)&&delete e.bound,!DG.Utils.empty(e.success)&&"[object Function]"!==Object.prototype.toString.call(e.success))throw new TypeError('Option "success" should be a function');if(DG.Utils.empty(e.success)&&delete e.success,!DG.Utils.empty(e.failure)&&"[object Function]"!==Object.prototype.toString.call(e.failure))throw new TypeError('Option "failure" should be a function');DG.Utils.empty(e.failure)&&delete e.failure},_getTypesByZoom:function(e){var t={"adm_div.settlement":8,"adm_div.city":8,"adm_div.division":11,"adm_div.district":12,street:14,building:14,"adm_div.place":15,poi:15,attraction:17},i=[];for(var n in t)e>=t[n]&&i.push(n);return i.length?i.join(","):null}},DG.Geocoder2.WEB_API_SERVER="http://catalog.api.2gis.ru",DG.Geocoder2.WEB_API_VERSION="2.0",DG.Geocoder2.GEO_CODER_URL="/geo/search",DG.Geocoder2.WEB_API_KEY="rubnkm7490",DG.Geocoder2Class=new DG.Class(DG.Geocoder2),DG.Geocoder2Object=DG.Class({_id:null,_type:null,_name:null,_shortName:null,_selection:null,_centroid:null,_attributes:null,initialize:function(e){this._validateInitOptions(e),this._id=e.id,this._type=e.type,this._name=e.name,this._shortName=e.shortName,this._selection=e.selection,this._centroid=e.centroid,this._reference=e.reference||null,this._attributes={buildingname:e.building_name,index:e.address&&e.address.postcode,purpose:e.purpose_name,elevation:e.floors&&e.floors.ground_count,firmcount:e.links&&e.links.branches&&e.links.branches.count}},getId:function(){return this._id},getType:function(){return this._type},getName:function(){return this._name},getShortName:function(){return this._shortName||this._reference&&this._reference.name},getAttributes:function(){return this._attributes},getReference:function(){return this._reference},getCenterGeoPoint:function(){return this._centroid},getSelection:function(){return this._selection},getMarker:function(e,t){var i={geoPoint:this._centroid};if(!DG.Utils.empty(e)){if(!(e instanceof DG.Icon))throw new TypeError('Parameter "icon" should be an instance of DG.Icon');i.icon=e}if(!DG.Utils.empty(t)){if("function"!=typeof t)throw new TypeError('Parameter "clickCallback" should be a function');i.clickCallback=t}return new DG.Markers.Common(i)},_validateInitOptions:function(e){if(!e.id)throw new Error('Option "id" is required');if("[object String]"!==Object.prototype.toString.call(e.type))throw new TypeError('Option "type" is required and should be a string');if("poi"!==e.type){if("[object String]"!==Object.prototype.toString.call(e.name))throw new TypeError('Option "name" is required and should be a string');if("[object String]"!==Object.prototype.toString.call(e.shortName))throw new TypeError('Option "shortName" is required and should be a string')}if(!(e.centroid instanceof DG.GeoPoint))throw new TypeError('Option "centroid" is required and should be instance of "DG.GeoPoint"')},CLASS_NAME:"DG.Geocoder2Object"}),DG.GeocoderObject=DG.Class({_id:null,_type:null,_name:null,_shortName:null,_selection:null,_centroid:null,_projectId:null,_attributes:null,initialize:function(e){this._validateInitOptions(e),this._id=e.id,this._type=e.type,this._name=e.name,this._shortName=e.shortName,this._selection=e.selection,this._centroid=e.centroid,this._projectId=e.projectId,this._attributes=e.attributes||null},getId:function(){return this._id},getType:function(){return this._type},getName:function(){return this._name},getShortName:function(){return this._shortName},getAttributes:function(){return this._attributes},getCenterGeoPoint:function(){return this._centroid},getSelection:function(){return this._selection},getProjectId:function(){return this._projectId},getMarker:function(e,t){var i={geoPoint:this._centroid};if(!DG.Utils.empty(e)){if(!(e instanceof DG.Icon))throw new TypeError('Parameter "icon" should be an instance of DG.Icon');i.icon=e}if(!DG.Utils.empty(t)){if("function"!=typeof t)throw new TypeError('Parameter "clickCallback" should be a function');i.clickCallback=t}return new DG.Markers.Common(i)},_validateInitOptions:function(e){if(!e.id)throw new Error('Option "id" is required');if("[object String]"!==Object.prototype.toString.call(e.type))throw new TypeError('Option "type" is required and should be a string');if("poi"!==e.type){if("[object String]"!==Object.prototype.toString.call(e.name))throw new TypeError('Option "name" is required and should be a string');if("[object String]"!==Object.prototype.toString.call(e.shortName))throw new TypeError('Option "shortName" is required and should be a string')}if("[object Number]"!==Object.prototype.toString.call(e.projectId))throw new TypeError('Option "projectId" is required and should be a number');if(e.selection instanceof DG.Geometries.Base==!1)throw new TypeError('Option "selection" is required and should have DG.Geometries.Base type');if(!(e.centroid instanceof DG.GeoPoint))throw new TypeError('Option "centroid" is required and should be instance of "DG.GeoPoint"')},CLASS_NAME:"DG.GeocoderObject"}),DG.Geometries=DG.Class(DG.OverlayManager,{_groups:{},_observers:[],_olLayerVector:null,zIndexLayer:350,zIndexMax:350,getGeneralLayer:function(){return DG.Utils.iNU(this._olLayerVector)&&(this._olLayerVector=new OpenLayers.Layer.Vector(DG.Utils.createUniqueID(this.CLASS_NAME),{strategies:[new OpenLayers.Strategy.Refresh],rendererOptions:{zIndexing:!0}}),this._dgMap.getOlMap().addLayer(this._olLayerVector),this._olLayerVector.setZIndex(this.zIndexLayer)),this._olLayerVector},_getGroupClass:function(){return DG.GeometryGroup},_getItemBaseClass:function(){return DG.Geometries.Base},createFromWKT:function(e,t,i,n){for(var r,o=/(\w+)\((.*)\)/,s=o.exec(e),a=[],l=s[2].split(","),h=0,c=l.length;h<c;h++)r=l[h].trim().split(" "),a.push(new DG.GeoPoint(r[0].trim(),r[1].trim()));switch(s[1]){case"POLYGON":return new DG.Geometries.Polygon(a,t,i,n);case"POLYLINE":return new DG.Geometries.Polyline(a,t,i,n);case"CIRCLE":var u=r[2].trim();return new DG.Geometries.Circle(a[0],u,t,i,n);default:throw"Wrong geometry type!"}},getBounds:function(e){var t,i=[];if(DG.Utils.empty(e))i=this.getAll();else{var n=this.getGroup(e);null!=n&&(i=n.getAll())}var r=[];for(t=0;t<i.length;t++)i[t].isHidden()||(r=r.concat(i[t].getPoints()));return r.length?new DG.CollectionBounds(r):null},createGroup:function(e){var t;return e=e||this.getDefaultGroupName(),DG.Utils.inArray(e,DG.Utils.arrayKeys(this._groups))||(t=this._getGroupClass(),this._groups[e]=new t(e,this._dgMap,this),this._groups[e].setGeneralLayer(this.getGeneralLayer()),this.zIndexMax++,this._groups[e]._zIndex=this.zIndexMax),this._groups[e]},add:function(e,t){var i=this._getItemBaseClass();if(!(e instanceof i))throw TypeError("Types mismatch");t=t||this.getDefaultGroupName(),this.createGroup(t),this._groups[t].add(e)},CLASS_NAME:"DG.Geometries"}),DG.Geometries.Base=DG.Class(DG.IOverlay,DG.IObservable,{_dgMap:null,_geometryId:null,_style:null,_isEventsEnabled:!0,_isHidden:!1,_observers:[],_hintContent:null,_hintEnabled:!0,initialize:function(e,t,i){throw new ReferenceError("You must implement constructor ")},destroy:function(){this._style=null},_initEvents:function(){var e=this.getContainerId();if("object"==typeof e)for(var t=0,i=this.getContainerId().length;t<i;t++)this._registeEvents(e[t]);else this._registeEvents(e)},_registeEvents:function(e){this._observers.push(this._dgMap.addEventListener(e,"DgMouseOut",DG.Utils.bind(this._mouseOutHandler,this))),this._observers.push(this._dgMap.addEventListener(e,"DgMouseMove",DG.Utils.bind(this._mouseMoveHandler,this))),this._observers.push(this._dgMap.addEventListener(e,"DgMouseDown",DG.Utils.bind(this._mouseDgMouseDownkHandler,this))),this._observers.push(this._dgMap.addEventListener(e,"DgMouseUp",DG.Utils.bind(this._mouseDgMouseUpHandler,this)))},_mouseOutHandler:function(){this._hideHint()},_mouseMoveHandler:function(e){!DG.Utils.empty(this._hintContent)&&this._hintEnabled&&(this._dgMap.hint.isShown()||this._showHint(),this._dgMap.hint.setPosition(e.getPoint()))},
_mouseDgMouseDownkHandler:function(){this._hintEnabled=!1,this._hideHint()},_mouseDgMouseUpHandler:function(){this._hintEnabled=!0},setDgMap:function(e){this._dgMap=e},getDgMap:function(){return this._dgMap},getId:function(){return this._geometryId},setStyle:function(e){this._checkStyle(e)},getStyle:function(){return this._style.clone()},clearBeforeRemoveFromMap:function(){this._dgMap=null},isEventsEnabled:function(){return this._isEventsEnabled},enableEvents:function(){this._isEventsEnabled=!0},disableEvents:function(){this._isEventsEnabled=!1},hide:function(){throw ReferenceError("You must implement method 'hide'")},show:function(){throw ReferenceError("You must implement method 'show'")},getPoints:function(){throw ReferenceError("You must implement method 'getPoints'")},isHidden:function(){return this._isHidden},toFront:function(){for(var e=this.getStyle(),t=this._dgMap.geometries._olLayerVector.features,i=t.length,n=0,r=i-1;r>=0;r--)n<t[r].style.graphicZIndex&&(n=t[r].style.graphicZIndex);e.graphicZIndex=n+1,this.setStyle(e)},toBack:function(){for(var e=this.getStyle(),t=this._dgMap.geometries._olLayerVector.features,i=t.length,n=0,r=i-1;r>=0;r--)n>t[r].style.graphicZIndex&&(n=t[r].style.graphicZIndex);e.graphicZIndex=n-1,this.setStyle(e)},onAddToMap:function(){DG.Utils.iNU(this._hintContent)||this._initEvents()},onMapUpdate:function(){},onRemoveFromMap:function(){},enableDraggable:function(){},disableDraggable:function(){},_toOLGeometryPoints:function(e){for(var t=[],i=0;i<e.length;i++)"undefined"!=typeof e[i]&&t.push(this._toOLGeometryPoint(e[i]));return t},_toOLGeometryPoint:function(e){var t=e.toMercator();return new OpenLayers.Geometry.Point(t.lon,t.lat)},_generateId:function(e){if(DG.Utils.empty(e)){if(null!==e&&void 0!==e)throw"Given geometry ID is invalid";this._geometryId=DG.Utils.createUniqueID(this.CLASS_NAME)}else this._geometryId=e},_riseUpdateEvent:function(){!DG.Utils.iNU(this._dgMap)&&this.isEventsEnabled()&&DG.EventManager.caller(new DG.Events.Geometry(this),this._dgMap.getContainerId(),"DgGeometryChange")},_checkStyle:function(e){if(e&&!(e instanceof DG.Style.Geometry))throw new TypeError('Parameter "style" should be an instance of "DG.Style.Geometry"');this._style=new DG.Style.Geometry(e)},_showHint:function(){this._dgMap.hint.setContent(this._hintContent),this._dgMap.hint.show()},_hideHint:function(){this._dgMap.hint.isShown()&&this._dgMap.hint.hide()},setHintContent:function(e){this._hintContent=e+"",this._dgMap&&this._initEvents()},getHintContent:function(){return this._hintContent},CLASS_NAME:"DG.Geometries.Base"}),DG.GeometryGroup=DG.Class(DG.OverlayGroup,OpenLayers.Layer.Vector,{_name:null,_items:[],_manager:null,_olLayerVector:null,_isVisible:!0,_browser:null,initialize:function(e,t,i){DG.OverlayGroup.prototype.initialize.apply(this,arguments),this._browser=DG.Utils.detectBrowser()[0],this._olLayerVector=new OpenLayers.Layer.Vector(e,{strategies:[new OpenLayers.Strategy.Refresh]}),this._registerHandler(this._dgMap.getContainerId(),"DgGeometryChange",OpenLayers.Function.bind(this.onGeometryChange,this)),this._registerHandler(this._dgMap.getContainerId(),"DgZoomChange",OpenLayers.Function.bind(this.onMapUpdate,this)),this._registerHandler(this._dgMap.getContainerId(),"DgMapRedraw",OpenLayers.Function.bind(this.redraw,this))},destroy:function(){this._dgMap.getOlMap().getLayerIndex(this._olLayerVector)!==-1&&this._dgMap.getOlMap().removeLayer(this._olLayerVector),this._olLayerVector.destroy(),this._removeHandlers()},setGeneralLayer:function(e){this._olLayerVector=e},_makeSpecialAdd:function(e){e.initializeBeforeAddOnMap(),this._dgMap.getOlMap().addLayer(this._olLayerVector);var t=e.getOlFeature(),i=DG.Utils.isArray(t)?t:[t];this._olLayerVector.addFeatures(i),this._olLayerVector.renderer instanceof OpenLayers.Renderer.SVG==!0&&"Chrome"===this._browser&&(this._olLayerVector.renderer.setSize=function(){})},_makeSpecialRemove:function(e){var t=e.getOlFeature(),i=DG.Utils.isArray(t)?t:[t];this._olLayerVector.destroyFeatures(i),e.clearBeforeRemoveFromMap()},redraw:function(){if(this._olLayerVector.redraw(),"Chrome"===this._browser){var e=this._olLayerVector.div.firstChild,t=this._dgMap.getContainerSize();e.style.position="absolute",e.setAttribute("width",t.width),e.setAttribute("height",t.height),e.setAttribute("viewBox","0 0 "+t.width+" "+t.height)}},onGeometryChange:function(e){this.contains(e.getGeometry())&&this.redraw()},onMapUpdate:function(e){for(var t=0,i=this._items.length;t<i;t++)this._items[t].onMapUpdate();this.redraw()},add:function(e,t,i){this._checkItem(e),t=this._prepareIndex(t),e.setDgMap(this._dgMap),this._makeSpecialAdd(e,i),this._items.splice(t,0,e),e.onAddToMap(this._dgMap),this._checkItemVisibility(e)},CLASS_NAME:"DG.GeometryGroup"}),DG.GeoPoint=DG.Class(OpenLayers.LonLat,{lon:null,lat:null,projection:null,initialize:function(e,t,i){if("number"!=typeof e&&(e=parseFloat(e)),"number"!=typeof t&&(t=parseFloat(t)),isNaN(e)===!0||isNaN(t)===!0)throw new TypeError("Incorrect lon or lat");i===DG.GeoPoint.EPSG_4326||i===DG.GeoPoint.EPSG_900913?this.projection=i:this.projection=DG.GeoPoint.EPSG_4326,this.lon=e,this.lat=t},toLonLat:function(){return this.transform(this.projection,DG.GeoPoint.EPSG_4326)},toMercator:function(){return this.transform(this.projection,DG.GeoPoint.EPSG_900913)},transform:function(e,t){var i=this._normalize(t);if(i.projCode!=this.projection){var n=this._normalize(e),r=[n,i];OpenLayers.LonLat.prototype.transform.apply(this,r),this.projection=i.projCode}return this},equals:function(e,t){if(DG.Utils.empty(e))return!1;var i,n,r=!1;if(e instanceof DG.GeoPoint&&e.projection==DG.GeoPoint.EPSG_900913)i=e.clone(),i.toLonLat();else if(e instanceof DG.GeoPoint&&e.projection==DG.GeoPoint.EPSG_4326)i=e.clone();else{if(!(e instanceof OpenLayers.LonLat&&"OpenLayers.LonLat"==e.CLASS_NAME))throw TypeError("Incorrect type for point");i=new DG.GeoPoint(e.lon,e.lat,DG.GeoPoint.EPSG_900913),i.toLonLat()}if(n=this.clone(),this instanceof DG.GeoPoint&&this.projection==DG.GeoPoint.EPSG_900913&&n.toLonLat(),!DG.Utils.iNU(t)){var o=n.lon.toString().indexOf(".");o>0&&(n.lon=n.lon.toString().substr(0,1*o+1*t+1));var s=n.lat.toString().indexOf(".");s>0&&(n.lat=n.lat.toString().substr(0,1*s+1*t+1));var a=i.lon.toString().indexOf(".");a>0&&(i.lon=i.lon.toString().substr(0,1*a+1*t+1));var l=i.lat.toString().indexOf(".");l>0&&(i.lat=i.lat.toString().substr(0,1*l+1*t+1))}return 1*i.lon==1*n.lon&&1*i.lat==1*n.lat&&(r=!0),r},toShortString:function(e,t){var i=this.getLon(),n=this.getLat();return"number"==typeof t&&(i=i.toFixed(t),n=n.toFixed(t),i=i.replace(/0+$/,"").replace(/\.$/,""),n=n.replace(/0+$/,"").replace(/\.$/,"")),e?i+""+e+n:i+", "+n},clone:function(){return new DG.GeoPoint(this.lon,this.lat,this.projection)},setLon:function(e){if(parseFloat(e)!=e)throw Error("Incorrect value for Lon");this.projection==DG.GeoPoint.EPSG_900913&&this.toLonLat(),this.lon=e},setLat:function(e){if(parseFloat(e)!=e)throw Error("Incorrect value for Lat");this.projection==DG.GeoPoint.EPSG_900913&&this.toLonLat(),this.lat=e},getLon:function(){return this.projection==DG.GeoPoint.EPSG_900913&&this.toLonLat(),this.lon},getLat:function(){return this.projection==DG.GeoPoint.EPSG_900913&&this.toLonLat(),this.lat},_normalize:function(e){return e instanceof OpenLayers.Projection?e:new OpenLayers.Projection(e)},CLASS_NAME:"DG.GeoPoint"}),DG.GeoPoint.cast=function(e){return e instanceof DG.GeoPoint||(e=new DG.GeoPoint(e.lon,e.lat,DG.GeoPoint.EPSG_4326)),e},DG.GeoPoint.fromString=function(e){var t=e.split(",");return new DG.GeoPoint(t[0],t[1])},DG.GeoPoint.EPSG_4326="EPSG:4326",DG.GeoPoint.EPSG_900913="EPSG:900913",DG.Icon=DG.Class(OpenLayers.Icon,{url:null,size:null,offset:null,_calculateOffset:null,calculateOffset:function(e){return new DG.Point((-(e.w/2)),(-e.h))},initialize:function(e,t,i){var n=[e,t,void 0];this._calculateOffset=i||this.calculateOffset,n.push(this._calculateOffset),OpenLayers.Icon.prototype.initialize.apply(this,n)},clone:function(){return new DG.Icon(this.url,new DG.Size(this.size.width,this.size.height),this._calculateOffset)},CLASS_NAME:"DG.Icon"}),DG.LayerGroup=DG.Class(DG.OverlayGroup,{_name:null,_items:[],_manager:null,_isVisible:!0,initialize:function(e,t,i){DG.OverlayGroup.prototype.initialize.apply(this,arguments)},destroy:function(){this._removeHandlers()},_makeSpecialAdd:function(e){e.initializeBeforeAddOnMap(),this._dgMap.getOlMap().addLayer(e.getOlLayer());var t=OpenLayers.Function.bind(e.onImageError,e);this._registerHandler(e.getContainerId(),"DgImageLoadError",t)},_makeSpecialRemove:function(e){this._dgMap.getOlMap().removeLayer(e.getOlLayer()),e.clearBeforeRemoveFromMap()},CLASS_NAME:"DG.LayerGroup"}),DG.Locale=DG.Class({_dgMap:null,_currentLang:null,initialize:function(e){this._dgMap=e,this._currentLang=this.getSystemLang()},getLangs:function(){return DG.enabledLangs},getSystemLang:function(){return"auto"!=DG.userDefinedLang&&this._isLangAvailable(DG.userDefinedLang)?DG.userDefinedLang:DG.defaultLang},getLang:function(){return this._currentLang},setLang:function(e){if(!this._isLangAvailable(e))throw new Error("Can't set this language, language is not available");this._currentLang!=e&&(this._currentLang=e,DG.EventManager.caller(new DG.Events.Locale(this._dgMap),this._dgMap.getContainerId(),"DgLanguageChange"))},t:function(e,t){var i=this.getLang();return"[object Number]"==Object.prototype.toString.call(t)?DG.Locale.Dictionary[i][e]?DG.Locale.Dictionary[i]._(e,t):e:DG.Locale.Dictionary[i][e]?DG.Locale.Dictionary[i][e]:e},destroy:function(){this._dgMap=null,this._currentLang=null},_isLangAvailable:function(e){for(var t=this.getLangs(),i=0,n=t.length;i<n;i++)if(t[i]==e)return!0;return!1}}),DG.Locale.Dictionary={},DG.Map=DG.Class(DG.IObservable,{map:null,divMap:null,viewPortSize:new DG.Size(0,0),moveStep:200,minZoomLevel:DG.Configs.MIN_ZOOM,maxZoomLevel:DG.Configs.MAX_ZOOM,enableDefaultUI:!0,dgMapEvents:{DgMouseWheel:"DG.Handlers.DgMapZoom",DgDoubleClick:"DG.Handlers.DgMapZoom",DgDrag:"DG.Handlers.DgMapDrag",DgDoubleRightClick:"DG.Handlers.DgMapZoom"},layers:null,balloons:null,geometries:null,controls:null,_plugins:null,ajax:null,hint:null,markers:null,locale:null,converter:null,cssClass:null,_observers:{},_controllers:[],_copyright:null,_cursors:[],geocoder:null,geocoder2:null,geoclicker:null,fullscreen:null,dragingOutsideMap:!0,userMaxZoom:null,_kinematicMoveIntervalId:null,_kinematicMoveObservers:[],_kinematicMoveStartTime:null,_dragEvent:null,kinematicZoom:null,mouseMoveTracker:null,_mouseMoveAudiencePercent:100,initialize:function(e){var t=this;if("string"==typeof e){if(this.divMap=DG.Utils.obj(e),!this.divMap)throw new Error("Incorrect container ID. Couldn't find element '"+e+"'.")}else"object"==typeof e&&(this.divMap=e);if(!this.divMap.style)throw new TypeError("Incorrect container type.");DG.Utils.iNU(this.divMap.style.backgroundColor)?this.initBackgroundColor="":this.initBackgroundColor=this.divMap.style.backgroundColor,this.divMap.innerHTML="",this.divMap.style.backgroundColor="#f7f3df",this._observers={},this._controllers=[],this._copyright=null,this._cursors=[],this.viewPortSize=new DG.Size(parseInt(this.divMap.clientWidth),parseInt(this.divMap.clientHeight));var i={theme:null};i.controls=[],OpenLayers.ImgPath="http://maps.api.2gis.ru/images/",OpenLayers.Util.onImageLoadError=DG.Utils.onImageLoadError,this.map=new OpenLayers.Map(this.divMap,i),this.map.layerContainerDiv.style.width="100%",this.map.layerContainerDiv.style.height="100%",this.cssClass=this.getContainer().className,this.kinematicZoom=new DG.Map.KinematicZoomHelper(this),this.activateEvents(this.dgMapEvents),this._initLocale(),this._initLayers(),this._initGeometries(),this._initControls(),this._initMarkers(),this._initBalloons(),this._initControllers(),this._initConverter(),this._initCopyrights(),this._initAjax(),this._initHint(),this._initPlugins(),this._initGeocoder(),this._initGeoclicker(),this._initFullScreen(),this._initUIStats(),this.cssClass=this.getContainer().className,this._initKinematicMove();var n=this._warningPopup=document.createElement("div");n.style.height="55px",n.style.position="absolute",n.style.left="50%",n.style.bottom="30px",n.style.marginLeft="-160px",n.style.font="12px/17px Arial,sans-serif",n.style.background="#fff",n.style.zIndex="5000",n.style.display="none",n.innerHTML='<div class="dg-callout"><div class="dg-callout-top"><div class="dg-callout-round-tr"><div class="dg-callout-sprite"></div></div><div class="dg-callout-round-tl"><div class="dg-callout-sprite"></div></div></div><div class="dg-callout-content" style="width: 298px; padding: 5px 5px 5px 15px;"><a style="text-decoration: none; margin: 5px 15px 0 0; float: left;" href="http://api.2gis.ru/" onclick="location.href=\'http://api.2gis.ru/\'"><img width="55px" height="24px" src="/images/dg-logo-new.png"></a><div>Карта ​​может работать некорректно.<br>Перейдите на новую версию <a style="text-decoration: none;" href="http://api.2gis.ru/" onclick="location.href=\'http://api.2gis.ru/\'">API 2ГИС</a>.</div></div><div class="dg-callout-bottom"><div class="dg-callout-round-br"><div class="dg-callout-sprite"></div></div><div class="dg-callout-round-bl"><div class="dg-callout-sprite"></div></div></div><div class="dg-callout-close"><div class="dg-callout-sprite"></div></div></div>',this.divMap.appendChild(n);var r=DG.Utils.DOM.getElementsByClassName("dg-callout-close",n)[0];r.onclick=function(){t.divMap.removeChild(n)}},showDeprecatedWarning:function(){this._warningPopup.style.display="block"},_initMarkers:function(){this.markers=new DG.Markers(this)},_initBalloons:function(){this.balloons=new DG.Balloons(this)},_initLayers:function(){this.layers=new DG.Layers(this)},_initGeometries:function(){this.geometries=new DG.Geometries(this)},_initControls:function(){this.controls=new DG.Controls(this)},_initCopyrights:function(){this._copyright=new DG.Copyrights,this._copyright.draw(),null!=this._copyright._divView&&this.getViewPortContainer().appendChild(this._copyright._divView),this._copyright.setDgMap(this),this._copyright.onAddToMap(),this._copyright.setZIndex(this.getOlMap().Z_INDEX_BASE.Control)},_initConverter:function(){this.converter=new DG.Converter(this)},_initAjax:function(){this.ajax=new DG.MapAjaxManager(this)},_initHint:function(){this.hint=new DG.Overlays.Hint(this)},_initControllers:function(){this._controllers.RightButtonMagnifier=new DG.Controllers.RightButtonMagnifier(this)},_initPlugins:function(){this._plugins=new DG.Plugins(this)},_initGeocoder:function(){this.geocoder=new DG.GeocoderClass(this),this.geocoder2=new DG.Geocoder2Class(this)},_initGeoclicker:function(){this.geoclicker=new DG.Geoclicker.ClickManager(this),this.geoclicker.enable()},_initFullScreen:function(){this.fullscreen=new DG.Controls.FullScreen(this),this.fullscreen.enable()},_initLocale:function(){this.locale=new DG.Locale(this)},_isHighlightShouldBeEnabled:function(){var e=DG.Map.HIGHLIGHT_PARTNERS_ACTIVE,t=DG.Map.HIGHLIGHT_PROJECTS_ACTIVE,i=e.split(","),n=t.split(","),r=!1,o=!1,s=DG.Utils.getDomainName(),a="";if(!DG.Map.HIGHLIGHT_ACTIVE||DG.Utils.isTouchDevice()||!this.geoclicker.isEnabled()&&"maps.2gis.ru"!=s)return!1;this.getCurrentProject()&&(a=this.getCurrentProject().prj);for(var l=0;l<i.length;l++)i[l]==s&&(r=!0);for(var h=0;h<n.length;h++)n[h]==a&&(o=!0);return"all"===e&&(r=!0),"all"===t&&(o=!0),!(!r||!o)},_enableHighlight:function(){null===this.mouseMoveTracker&&(this.mouseMoveTracker=new DG.Map.MouseMoveTracker(this,new DG.Map.HouseHighlightHelper(this),new DG.Layers.ContainPointStrategy.Beam))},_disableHighlight:function(){null!==this.mouseMoveTracker&&(this.mouseMoveTracker.destroy(),this.mouseMoveTracker=null)},_initUIStats:function(){DG.UIStats.init({google:{key:DG.Map.UI_STATS_GOOGLE_KEY,audience:DG.Map.UI_STATS_GOOGLE_AUDIENCE},yandex:{key:DG.Map.UI_STATS_YANDEX_KEY,audience:DG.Map.UI_STATS_YANDEX_AUDIENCE},dg:{key:DG.Map.UI_STATS_DG_KEY,audience:DG.Map.UI_STATS_DG_AUDIENCE}})},_trackGroupGeomLoad:function(){this.map._trackGroupGeomLoad()},activateEvents:function(e){var t;t="IE"==DG.Utils.detectBrowser()[0]?"document":"window";var i=this.getMapContainerId(),n=new DG.Handlers.MouseWheel(this);this._observers.DOMMouseScroll=n.register("window","DOMMouseScroll"),this._observers.MapOnMouseWheel=n.register(t,"mousewheel");var r=new DG.Handlers.ContextMenu(this);this._observers.MapOnContextMenu=r.register(t,"contextmenu");var o=new DG.Handlers.DoubleClick(this);this._observers.MapOnDblClick=o.register(t,"dblclick");var s=new DG.Handlers.MouseDown(this);this._observers.MapOnMouseDown=s.register(t,"mousedown");var a=new DG.Handlers.MouseUp(this);this._observers.MapOnMouseUp=a.register(t,"mouseup");var l=new DG.Handlers.MouseMove(this);this._observers.MapOnMouseMove=l.register(t,"mousemove");var h=new DG.Handlers.MouseOver(this);this._observers.MapOnMouseOver=h.register(t,"mouseover");var c=new DG.Handlers.MouseOut(this);this._observers.MapOnMouseOut=c.register(t,"mouseout");var u=new DG.Handlers.MousePreClick(this);this._observers.MapOnClick=u.register(t,"click");var d=new DG.Handlers.KeyDown(this);this._observers.MapOnKeyDown=d.register(t,"keydown");var p=new DG.Handlers.KeyUp(this);this._observers.MapOnKeyUp=p.register(t,"keyup");var g=new DG.Handlers.Resize(this);this._observers.MapOnResize=g.register("window","resize");var m=new DG.Handlers.MouseClick(this);this._observers.DgPreClick=m.register(i,"DgPreClick",null,300);var f=new DG.Handlers.ProjectChange(this);this._observers.DgMapMove=f.register(i,"DgMapMove"),this._observers.DgZoomChange=f.register(i,"DgZoomChange"),this._observers.DgProjectChange=this.addEventListener("DgProjectChange",DG.Utils.bind(this.onProjectChange,this)),this._observers.DgGeoclickerEnable=this.addEventListener("DgGeoclickerEnable",DG.Utils.bind(this.onGeoclickerEnable,this)),this._observers.DgGeoclickerDisable=this.addEventListener("DgGeoclickerDisable",DG.Utils.bind(this.onGeoclickerDisable,this)),this.map.events.on({moveend:this._fireMapMoveEvent,scope:this});var y=new DG.Handlers.DgLayerProcess(this);if(this._observers.DgClick=y.register(i,"DgClick"),this._observers.DgMouseMove=y.register(i,"DgMouseMove"),this._observers.DgDragTraffic=y.register(i,"DgDrag"),DG.Utils.isTouchDevice()){var _=new DG.Handlers.TouchStart(this);this._observers.MapOnTouchStart=_.register(t,"touchstart");var v=new DG.Handlers.TouchEnd(this);this._observers.MapOnTouchEnd=v.register(t,"touchend"),this._observers.MapOnTouchCancel=v.register(t,"touchcancel");var D=new DG.Handlers.TouchMove(this);this._observers.MapOnTouchMove=D.register(t,"touchmove");var b=new DG.Handlers.GestureStart(this);this._observers.GestureStart=b.register(i,"gesturestart");var L=new DG.Handlers.GestureEnd(this);this._observers.GestureEnd=L.register(i,"gestureend");var C=new DG.Handlers.GestureChange(this);this._observers.GestureChange=C.register(i,"gesturechange");var G=new DG.Handlers.PinchZoomStart(this);this._observers.PinchZoomStart=G.register(i,"DgPinchZoomStart");var M=new DG.Handlers.PinchZoomChange(this);this._observers.PinchZoomChange=M.register(i,"DgPinchZoomChange");var S=new DG.Handlers.PinchZoomStop(this);this._observers.PinchZoomStop=S.register(i,"DgPinchZoomStop")}for(var w in e)if(e.hasOwnProperty(w)){var E=DG.Utils.findFuncByName(e[w]);if(E){var O=new E(this);this._observers[w]=O.register(this.divMap.id,w)}}},destroy:function(){if(DG.Geocoder._map=null,this.divMap.style.backgroundColor=this.initBackgroundColor,!this.layers)throw new TypeError("You can not destroy already destroyed map");this.stopKinematicMove(),this._kinematicMoveIntervalId=null,this.layers.destroy(),this.layers=null,this.geoclicker.destroy(),this.geoclicker=null,this.fullscreen.destroy(),this.fullscreen=null,this.balloons.destroy(),this.balloons=null,this.controls.destroy(),this.controls=null,this.geometries.destroy(),this.geometries=null,this.markers.destroy(),this.markers=null;var e;for(e in this._observers)this._observers.hasOwnProperty(e)&&(this._observers[e].cleanup(),this._observers[e]=null);var t;for(t in this._controllers)this._controllers.hasOwnProperty(t)&&(this._controllers[t].destroy(),this._controllers[t]=null);this._copyright.destroy(),this._copyright=null,this.converter.destroy(),this.converter=null,this.ajax=null,this.hint.destroy(),this.hint=null,this.map.destroy(),this.map=null,this.locale.destroy(),this._disableHighlight(),this.kinematicZoom=null},addEventListener:function(e,t,i){if(DG.Utils.inArray(e,DG.Events.EVENT_TYPES)&&(i=t,t=e,e=this.getContainerId()),e instanceof Object){if("function"!=typeof e.getContainerId)throw"Incorrect object";e=e.getContainerId()}if(!DG.Utils.inArray(t,DG.Events.EVENT_TYPES))throw"Incorrect event type "+EventType;var n;return n=i instanceof DG.Handlers.Base?i:this._createHandler(i),n.register(e,t),new DG.Observer(n,e,t)},_createHandler:function(e){var t=new DG.Handlers.Base(this);return t.mainMethod=function(t){return e(t)},t},_fireZoomEvent:function(){DG.EventManager.caller(new DG.Events.Map(this),this.divMap.id,"DgZoomChange")},_fireMapMoveEvent:function(){DG.EventManager.caller(new DG.Events.Map(this),this.divMap.id,"DgMapMove")},_fireSettingsChangeEvent:function(){DG.EventManager.caller(new DG.Events.Map(this),this.divMap.id,"DgSettingsChange")},fireEventsInLayer:function(e,t){var i,n;if(n=this.layers.getAll(),n&&n.length)for(i=n.length-1;i>=0;--i)if(n[i].isVisible()&&n[i].eventProcessing(e,t))return!0;return!1},pinchZoomAction:function(e,t,i){var n=this.correctZoom(this.getZoomForResolution(this.map.getResolution()/i,!0));if(n!==this.getZoom()||!t.equals(e)){var r=this.getResolutionForZoom(n),o=this.converter.mapPixelsToCoordinates(e);o.toMercator();var s=t,a=this.map.getSize();o.lon+=r*(a.w/2-s.x),o.lat-=r*(a.h/2-s.y),this.setCenter(new DG.GeoPoint(o.lon,o.lat,"EPSG:900913"),n)}},getVirtualCenter:function(){var e=this.map.layerContainerDiv,t=this.getViewPort(),i=parseInt(e.style.left,10)+t.width/2,n=parseInt(e.style.top,10)+t.height/2;return new DG.Point(i,n)},setTransform:function(e){if("[object String]"!=Object.prototype.toString.call(e))throw new TypeError("Transform is required and shold be string");var t=this.map.layerContainerDiv.style;t["-webkit-transform"]=e,t["-moz-transform"]=e},dblClickZoomEnabled:function(){return this._observers.DgDoubleClick.isEnabled()&&this._observers.DgDoubleRightClick.isEnabled()},disableDblClickZoom:function(){this._observers.DgDoubleClick.disable(),this._observers.DgDoubleRightClick.disable()},enableDblClickZoom:function(){this._observers.DgDoubleClick.enable(),this._observers.DgDoubleRightClick.enable()},disableDragging:function(){this._observers.DgDrag.disable()},draggingEnabled:function(){return this._observers.DgDrag.isEnabled()},enableDragging:function(){this._observers.DgDrag.enable()},disableDragingOutsideMap:function(){this.dragingOutsideMap=!1},enableDragingOutsideMap:function(){this.dragingOutsideMap=!0},disableScrollZoom:function(){this._observers.DgMouseWheel.disable()},enableScrollZoom:function(){this._observers.DgMouseWheel.enable()},scrollZoomEnabled:function(){return this._observers.DgMouseWheel.isEnabled()},disableRightButtonMagnifier:function(){this._controllers.RightButtonMagnifier.disable()},enableRightButtonMagnifier:function(){return this._controllers.RightButtonMagnifier.enable()},rightButtonMagnifierEnabled:function(){return this._controllers.RightButtonMagnifier.isEnabled()},getContainer:function(){return this.divMap},getContainerSize:function(){return new DG.Size(this.divMap.clientWidth,this.divMap.clientHeight)},getContainerId:function(){return this.divMap.id},getCenter:function(){var e=this.map.getCenter();if(null===e)return null;var t=new DG.GeoPoint(e.lon,e.lat,DG.GeoPoint.EPSG_900913);return t.toLonLat()},setCenter:function(e,t){if(!(e instanceof DG.GeoPoint))throw TypeError("Center should be an instance of DG.GeoPoint");DG.Utils.iNU(t)&&DG.Utils.empty(this.getZoom())&&(t=this.minZoomLevel),this._setCenter(e,t,!0)},_setCenter:function(e,t,i){if(!DG.Utils.iNU(t)&&!this.checkZoom(t))throw"Zoom level should be between "+this.minZoomLevel+" and "+this.maxZoomLevel+"!";e.toMercator(),this.checkZoom(t)||(t=null);var n=!1;i&&DG.Utils.inArray(DG.Utils.detectBrowser()[0],["Opera","Firefox","Chrome","Safari"])&&(n=!0,null===t&&(t=this.getZoom())),this.map.setCenter(e,t,!1,n),null!=t&&this._fireZoomEvent()},mildSetCenter:function(e){this._setCenter(e,null,!1)},handleDragStart:function(e){this.stopKinematicMove(),this._kinematicMoveStartTime=(new Date).getTime()},handleDrag:function(e){this._dragEvent=e},handleDragStop:function(e){var t,i,n,r,o;Math.abs(this._dragEvent.point.x-e.point.x)>DG.Map.KINEMATIC_MOVE_MAX_DRAG_MOVE_DIFF||Math.abs(this._dragEvent.point.y-e.point.y)>DG.Map.KINEMATIC_MOVE_MAX_DRAG_MOVE_DIFF?(r=this._dragEvent.getPoint().x-this._dragEvent.getInitialPosition().x,o=this._dragEvent.getPoint().y-this._dragEvent.getInitialPosition().y,t=(new Date).getTime()-this._kinematicMoveStartTime,i=r/t,n=o/t,this.kinematicMove(i*DG.Map.KINEMATIC_MOVE_MASS,n*DG.Map.KINEMATIC_MOVE_MASS)):DG.EventManager.caller(new DG.Events.Locale(this),this.getContainerId(),"DgInertiaDragStop")},kinematicMove:function(e,t){var i,n,r,o={x1:null,y1:null,x2:null,y2:null,a:null,b:null},s={x1:null,y1:null,x2:null,y2:null,a:null,b:null},a=this;this._kinematicMoveIntervalId=window.setInterval(function(){i=Math.round(e),n=Math.round(t),e/=DG.Map.KINEMATIC_MOVE_SLOWING_SPEED,t/=DG.Map.KINEMATIC_MOVE_SLOWING_SPEED,o.x1=0,o.y1=0,a.moveXY(i,n),o.x2=s.x1=o.x1+i,o.y2=s.y1=o.y1+n,s.x2=s.x1+Math.round(e),s.y2=s.y1+Math.round(t),o.a=o.y1-o.y2,o.b=o.x2-o.x1,s.a=s.y1-s.y2,s.b=s.x2-s.x1,o.a*s.b-s.a*o.b!==0&&(r=Math.acos((o.b*s.b+o.a*s.a)/(Math.sqrt(Math.pow(o.b,2)+Math.pow(o.a,2))*Math.sqrt(Math.pow(s.b,2)+Math.pow(s.a,2)))),r*=180/Math.PI,r>=DG.Map.KINEMATIC_MOVE_STOP_CORNER&&(a.stopKinematicMove(),DG.EventManager.caller(new DG.Events.Map(a),a.getContainerId(),"DgInertiaDragStop"))),0===i&&0===n&&(a.stopKinematicMove(),DG.EventManager.caller(new DG.Events.Map(a),a.getContainerId(),"DgInertiaDragStop"))},33)},stopKinematicMove:function(){window.clearInterval(this._kinematicMoveIntervalId)},_initKinematicMove:function(){this._kinematicMoveObservers.push(this.addEventListener(this.getContainerId(),"DgDragStart",DG.Utils.bind(this.handleDragStart,this))),this._kinematicMoveObservers.push(this.addEventListener(this.getContainerId(),"DgDrag",DG.Utils.bind(this.handleDrag,this))),this._kinematicMoveObservers.push(this.addEventListener(this.getContainerId(),"DgDragStop",DG.Utils.bind(this.handleDragStop,this))),this._kinematicMoveObservers.push(this.addEventListener(this.getContainerId(),"DgMouseDown",DG.Utils.bind(this.stopKinematicMove,this))),this._kinematicMoveObservers.push(this.addEventListener(this.getContainerId(),"DgZoomChange",DG.Utils.bind(this.stopKinematicMove,this)))},_clearKinematicMoveObservers:function(){for(var e=0;e<this._kinematicMoveObservers.length;e++)this._kinematicMoveObservers[e].cleanup();this._kinematicMoveObservers=[]},setBoundsRestrictions:function(e,t,i){this.map.setOptions({restrictedExtent:e}),e=this._processBoundsWrapDateLine(e),i?this.minZoomLevel=this.correctZoom(this._getMinZoomForExtent(e)):this.minZoomLevel=this.correctZoom(this.map.getZoomForExtent(e)),1==t&&this.setBounds(e,i);var n=this.map.getZoomForExtent(e);n>this.getZoom()&&this.setZoom(n),this._fireSettingsChangeEvent()},getBoundsRestrictions:function(){},getCurrentProject:function(){for(var e,t=DG.Configs.ProjectsList,i=t.cities,n=0;n<i.length;n++)e=i[n],i[n].bound=new DG.Bounds(new DG.GeoPoint(e.bd.l,e.bd.b),new DG.GeoPoint(e.bd.r,e.bd.t));if(!this.getCenter())return!1;for(var r=this.getBounds(),n=0;n<i.length;n++)if(i[n].bound.intersects(r))return i[n];return!1},setBounds:function(e,t){var i;if(e=this._processBoundsWrapDateLine(e),0==this.getZoom())i=1001;else{var n=this.getBounds(),r=e.left-n.left,o=e.right-n.right,s=e.top-n.top,a=e.bottom-n.bottom;i=r*r+o*o+a*a+s*s}if(i>1e3){var l=e.getCenter();if(this.map.baseLayer.wrapDateLine&&(l=l.wrapDateLine(this.map.getMaxExtent())),t)var h=this._getMinZoomForExtent(e);else var h=this.map.getZoomForExtent(e);h<this.getMinZoom()?h=this.getMinZoom():h>this.getMaxZoom()&&(h=this.getMaxZoom()),this.setCenter(l,h)}},_processBoundsWrapDateLine:function(e){if(this.map.baseLayer.wrapDateLine){var t=this.map.getMaxExtent();for(e=e.clone();e.right<e.left;)e.right+=t.getWidth()}return e},_getMinZoomForExtent:function(e){var t=this.map.getSize(),i=Math.min(e.getWidth()/t.w,e.getHeight()/t.h),n=this.getZoomForResolution(i);return n},redraw:function(){this.map.updateSize(),DG.EventManager.caller(new DG.Events.Map(this),this.getContainerId(),"DgMapRedraw")},getBounds:function(){var e,t=this.map.getExtent();return null!==t?(e=t.transform(new OpenLayers.Projection("EPSG:900913"),new OpenLayers.Projection("EPSG:4326")).toArray(),new DG.Bounds(new DG.GeoPoint(e[0],e[1]),new DG.GeoPoint(e[2],e[3]))):null},showExtent:function(e){throw'Deprecated, use "setBounds" instead!'},getExtent:function(){throw"Deprecated, use getBounds instead"},getMapContainer:function(){return this.getContainer()},getMapContainerId:function(){return this.getContainerId()},getViewPortPxFromLayerPx:function(e){var t=this.getOlMap().getViewPortPxFromLayerPx(e);return new DG.Point(t.x,t.y)},moveN:function(e){var t=this.getMoveOptions(e);this.map.pan(0,-t.moveStep,t)},moveS:function(e){var t=this.getMoveOptions(e);this.map.pan(0,t.moveStep,t)},moveW:function(e){var t=this.getMoveOptions(e);this.map.pan(-t.moveStep,0,t)},moveE:function(e){var t=this.getMoveOptions(e);this.map.pan(t.moveStep,0,t)},moveXY:function(e,t){if(this.map){var i=this.getMoveOptions(e),n=this.getMoveOptions(t);this.map.pan(-i.moveStep,-n.moveStep,i)}},moveTo:function(e){this.map.panTo(e.toMercator())},moveBy:function(e){},getMoveOptions:function(e){var t={};return t.animate=!1,isNaN(e)?t.moveStep=this.moveStep:t.moveStep=e,t},getMaxZoom:function(){return this.maxZoomLevel},getMinZoom:function(){return this.minZoomLevel},getZoom:function(){return this.map.getZoom()},getZoomRestrictions:function(){return{min:this.minZoomLevel,max:this.maxZoomLevel}},setZoomRestrictions:function(e,t){if(DG.Utils.iNU(e)||e<DG.Configs.MIN_ZOOM)throw"Incorrect minimum zoom level value ";if(DG.Utils.iNU(t)||t>DG.Configs.MAX_ZOOM)throw"Incorrect maximum zoom level value ";if(e>t)throw"Maximum should be more than minimum ";this.setMaxZoom(t),this.setMinZoom(e),this.map.getZoom()>t&&this.setZoom(t),this.map.getZoom()<e&&this.setZoom(e)},setMaxZoom:function(e){if(DG.Utils.iNU(e)||e>DG.Configs.MAX_ZOOM)throw"Incorrect maximum zoom level value ";if(e<this.minZoomLevel)throw"Max zoom level should be more than minimum level.";this.userMaxZoom=e,this._setMaxZoom()},_setMaxZoom:function(e,t){DG.Utils.iNU(this.userMaxZoom)?((e&&!DG.Utils.iNU(t)||!e&&!DG.Utils.iNU(t))&&(this.maxZoomLevel=t),!e&&DG.Utils.iNU(t)&&(this.maxZoomLevel=DG.Configs.MAX_ZOOM_OUT_PROJECT)):this.getCurrentProject()?this.maxZoomLevel=this.userMaxZoom<=this.getCurrentProject().maxzoom?this.userMaxZoom:this.getCurrentProject().maxzoom:this.maxZoomLevel=this.userMaxZoom<=DG.Configs.MAX_ZOOM_OUT_PROJECT?this.userMaxZoom:DG.Configs.MAX_ZOOM_OUT_PROJECT,this._fireSettingsChangeEvent(),this.map.getZoom()>this.maxZoomLevel&&this.setZoom(this.maxZoomLevel)},setMinZoom:function(e){if(DG.Utils.iNU(e)||e<DG.Configs.MIN_ZOOM)throw"Incorrect minimum zoom level value ";if(e>this.maxZoomLevel)throw"Min zoom level should be less than maximum level.";this.minZoomLevel=e,this._fireSettingsChangeEvent(),this.map.getZoom()<e&&this.setZoom(e)},setZoom:function(e){this.getCenter()?e!=this.map.getZoom()&&(this.map.zoomTo(e),this._fireZoomEvent()):this.setCenter(new DG.GeoPoint(93.84,63.83),e)},zoomIn:function(){this.setZoom(this.map.getZoom()+1)},zoomOut:function(){this.setZoom(this.map.getZoom()-1)},zoomToMax:function(){this.setZoom(this.maxZoomLevel)},zoomToMin:function(){this.setZoom(this.minZoomLevel)},zoomBy:function(e){this.setZoom(this.map.getZoom()+e)},getResolutionForZoom:function(e){return this.map.baseLayer.getResolutionForZoom(e);
},getZoomForResolution:function(e,t){return this.map.getZoomForResolution(e,t)},checkZoom:function(e){return this.minZoomLevel<=e&&e<=this.maxZoomLevel},correctZoom:function(e){return this.minZoomLevel>e&&(e=this.minZoomLevel),e>this.maxZoomLevel&&(e=this.maxZoomLevel),e},zoomTo:function(e){return this.setZoom(e)},getNumZoomLevels:function(){return this.map.getNumZoomLevels()},onProjectChange:function(e){var t=e.getProject(),i=e.containsViewPort,n=t?t.maxzoom:null;this._setMaxZoom(i,n),this._isHighlightShouldBeEnabled()?this._enableHighlight():this._disableHighlight()},onGeoclickerEnable:function(e){this._isHighlightShouldBeEnabled()&&this._enableHighlight()},onGeoclickerDisable:function(e){this._isHighlightShouldBeEnabled()||this._disableHighlight()},getGeoPointFromPixel:function(e,t,i){var n;n=e instanceof OpenLayers.Pixel?this.map.getLonLatFromPixel(e):this.map.getLonLatFromPixel({x:e,y:t});var r=new DG.GeoPoint(n.lon,n.lat,DG.GeoPoint.EPSG_900913);return i?r:r.toLonLat()},checkSizeChanged:function(){var e=this.divMap.clientWidth,t=this.divMap.clientHeight,i=e!=this.viewPortSize.width||t!=this.viewPortSize.height;return i&&(this.viewPortSize=new DG.Size(e,t)),{viewPortSize:new DG.Size(e,t),isChanged:i}},getViewPort:function(){return this.checkSizeChanged(),this.viewPortSize},getOlMap:function(){return this.map},getViewPortContainer:function(){return this.map.viewPortDiv},getDisplayProjection:function(){return this.map.displayProjection},getScale:function(){return this.map.getScale()},getElementPosition:function(e){var t,i=0,n=this.getViewPortContainer();for(t=e.offsetLeft,i=e.offsetTop,e=e.offsetParent;;){if(null===e)break;if(e===n)break;t=parseInt(t)+parseInt(e.offsetLeft),i=parseInt(i)+parseInt(e.offsetTop),e=e.offsetParent}return new DG.Point(t,i)},getDefaultCssClass:function(){return this.cssClass},setCursor:function(e){void 0!=e?this.getContainer().className=this.getDefaultCssClass()+" "+e:this.getContainer().className=this.getDefaultCssClass()},addCursor:function(e){if(DG.Utils.iNU(e))throw ReferenceError("Unknown cursor type!");this._cursors.unshift(e),this.setCursor(e)},removeCursor:function(e){var t;for(t=0;t<this._cursors.length;t++)if(this._cursors[t]==e){this._cursors.splice(t,1),0==t&&this.setCursor(this._cursors[0]);break}},enablePlugin:function(e){if(null!==this.getPlugin(e))throw TypeError("Plugin '"+e+"' already created.");switch(e){case"traffic":var t=new DG.Plugins.Traffic;this._plugins.add(t,"traffic");break;case"ruler":if(!DG.Utils.isTouchDevice()){var t=new DG.Plugins.Ruler;this._plugins.add(t,"ruler")}break;default:throw TypeError("Plugin '"+e+"' doesn't exists.")}},disablePlugin:function(e){this._plugins.remove(e)},getPlugin:function(e){switch(e){case"traffic":return this._plugins.get("traffic");case"ruler":return this._plugins.get("ruler")}return null},getControlsPointBounds:function(){for(var e=[],t=this.controls.getAll(),i=0;i<t.length;i++)t[i].isVisible()&&e.push(t[i].getPointBounds());return e.push(this._copyright.getPointBounds()),e},CLASS_NAME:"DG.Map"}),DG.Map.KINEMATIC_MOVE_MASS=18,DG.Map.KINEMATIC_MOVE_SLOWING_SPEED=1.2,DG.Map.KINEMATIC_MOVE_STOP_CORNER=40,DG.Map.KINEMATIC_MOVE_MAX_DRAG_MOVE_DIFF=3,DG.Map.UI_STATS_GOOGLE_KEY="UA-38243181-1",DG.Map.UI_STATS_GOOGLE_AUDIENCE="100",DG.Map.UI_STATS_YANDEX_KEY="19894642",DG.Map.UI_STATS_YANDEX_AUDIENCE="100",DG.Map.UI_STATS_DG_KEY="dga_stats",DG.Map.UI_STATS_DG_AUDIENCE="100",DG.Map.HIGHLIGHT_ACTIVE="1",DG.Map.HIGHLIGHT_PARTNERS_ACTIVE="maps.2gis.ru",DG.Map.HIGHLIGHT_PROJECTS_ACTIVE="novosibirsk,biysk",DG.MapAjaxManager=DG.Class({_dgMap:{},initialize:function(e){this._dgMap=e},get:function(e){return DG.AjaxManager.get(e)},addCallbackToGroup:function(e,t){DG.AjaxManager.addCallbackToGroup(e,this._dgMap.getContainerId()+"_"+t)},cancelCallback:function(e){DG.AjaxManager.cancelCallback(e)},cancelCallbacksByGroup:function(e){DG.AjaxManager.cancelCallbacksByGroup(this._dgMap.getContainerId()+"_"+e)},cancelAllCallbacks:function(){var e=new RegExp(this._dgMap.getContainerId()+"_.+");DG.AjaxManager.cancelCallbacksByGroup(e)},CLASS_NAME:"DG.MapAjaxManager"}),DG.MarkerGroup=DG.Class(DG.OverlayGroup,{_name:null,_items:[],_manager:null,_olLayer:null,_isVisible:!0,initialize:function(e,t,i){DG.OverlayGroup.prototype.initialize.apply(this,arguments);var n=DG.Utils.bind(this.onMarkerUpdate,this);this._registerHandler(this._dgMap.getContainerId(),"DgMarkerUpdate",n)},setGeneralLayer:function(e){this._olLayer=e},destroy:function(){this._removeHandlers()},_makeSpecialAdd:function(e){e.initializeBeforeAddOnMap(),this._olLayer.addMarker(e)},_makeSpecialRemove:function(e){this._olLayer.removeMarker(e),e.clearBeforeRemoveFromMap()},redraw:function(){this._olLayer.redraw()},onMarkerUpdate:function(e){this.contains(e.getOverlay())&&this.redraw()},add:function(e,t,i){this._checkItem(e),t=this._prepareIndex(t),e.setDgMap(this._dgMap),e.setZIndex(this._zIndex),this._makeSpecialAdd(e,i),this._items.splice(t,0,e),e.onAddToMap(this._dgMap),this._checkItemVisibility(e)},CLASS_NAME:"DG.MarkerGroup"}),DG.Markers=DG.Class(DG.OverlayManager,{_groups:{},_observers:[],_olLayer:null,zIndexLayer:500,zIndexMax:500,_getGroupClass:function(){return DG.MarkerGroup},getGeneralLayer:function(){return DG.Utils.iNU(this._olLayer)&&(this._olLayer=new OpenLayers.Layer.Markers(DG.Utils.createUniqueID(this.CLASS_NAME)),this._dgMap.getOlMap().addLayer(this._olLayer),this._olLayer.div.style.width="0px",this._olLayer.div.style.height="0px",this._olLayer.setZIndex(this.zIndexLayer)),this._olLayer},_getItemBaseClass:function(){return DG.Markers.Base},getBounds:function(e){var t,i=[];if(DG.Utils.empty(e))i=this.getAll();else{var n=this.getGroup(e);null!=n&&(i=n.getAll())}var r=[];for(t=0;t<i.length;t++)i[t].isHidden()||r.push(i[t].getPosition());return r.length?new DG.CollectionBounds(r):null},createGroup:function(e){var t;return e=e||this.getDefaultGroupName(),DG.Utils.inArray(e,DG.Utils.arrayKeys(this._groups))||(t=this._getGroupClass(),this._groups[e]=new t(e,this._dgMap,this),this._groups[e].setGeneralLayer(this.getGeneralLayer()),this.zIndexMax++,this._groups[e]._zIndex=this.zIndexMax),this._groups[e]},add:function(e,t){var i=this._getItemBaseClass();if(!(e instanceof i))throw TypeError("Types mismatch");t=t||this.getDefaultGroupName(),this.createGroup(t),e.setZIndex(this._groups[t]._zIndex),this._groups[t].add(e)},CLASS_NAME:"DG.Markers"}),DG.Markers.Base=DG.Class(DG.IOverlay,{_id:null,_dgMap:null,initialize:function(e){throw Error("You should imlement constructor for your markers class")},erase:function(){},destroy:function(){throw Error("You should imlement destructor for your markers class")},getId:function(){return this._id},onAddToMap:function(){},onMapUpdate:function(){},onRemoveFromMap:function(){},CLASS_NAME:"DG.Markers.Base"}),DG.Observer=DG.Class({_handler:null,_eventType:null,_controllerId:null,initialize:function(e,t,i){this._handler=e,this._eventType=i,this._controllerId=t},cleanup:function(){this._handler.unregister(this._controllerId,this._eventType),this._handler=null},enable:function(){this._handler&&(this._handler.isEnable=!0)},disable:function(){this._handler&&(this._handler.isEnable=!1)},isEnabled:function(){return!!this._handler&&this._handler.isEnable},CLASS_NAME:"DG.Observer"}),DG.PixelBounds=DG.Class({_leftBottom:null,_rightTop:null,initialize:function(e,t){if(!(e instanceof DG.Point&&e instanceof DG.Point))throw TypeError("Wrong arguments for constructor");if(!(t instanceof DG.Point&&t instanceof DG.Point))throw TypeError("Wrong arguments for constructor");this._leftBottom=e.clone(),this._rightTop=t.clone()},getLeft:function(){return this._leftBottom.x},getRight:function(){return this._rightTop.x},getTop:function(){return this._rightTop.y},getBottom:function(){return this._leftBottom.y},getLeftBottom:function(){return this._leftBottom.clone()},getRightTop:function(){return this._rightTop.clone()},destroy:function(){this._leftBottom=null,this._rightTop=null},contains:function(e){if(e instanceof DG.Point){var t=this._leftBottom,i=this._rightTop;if(i.y<=e.y&&t.y>=e.y&&t.x<=e.x&&i.x>=e.x)return!0}return!1},clone:function(){return new DG.PixelBounds(this._leftBottom,this._rightTop)},getIntersectionsWithBounds:function(e){if(!(e instanceof DG.PixelBounds))throw TypeError("'getIntersectionsWithBounds()' method expect DG.PixelBounds as a parameter!");var t,i,n,r;return r=Math.max(this.getLeft(),e.getLeft()),n=Math.min(this.getRight(),e.getRight()),t=Math.max(this.getTop(),e.getTop()),i=Math.min(this.getBottom(),e.getBottom()),r<n&&t<i?new DG.PixelBounds(new DG.Point(r,i),new DG.Point(n,t)):null}}),DG.PixelBounds.getFromPointSet=function(e){if(!(e instanceof Array)||0==e.length)throw TypeError("You should set an array of geo points to the constructor with 1 geo point at least");var t,i=e[0].x,n=0,r=e[0].y,o=0;for(t=0;t<e.length;t++)e[t].x<i&&(i=e[t].x),e[t].x>n&&(n=e[t].x),e[t].y<r&&(r=e[t].y),e[t].y>o&&(o=e[t].y);return new DG.PixelBounds(new DG.Point(i,o),new DG.Point(n,r))},DG.Plugins=DG.Class({_dgMap:null,_items:null,initialize:function(e){this._dgMap=e,this._items=[]},add:function(e,t){var t=t||e.getName();if(!DG.Utils.iNU(this._items[t]))throw new TypeError("Plugin with same name already exists");this._items[t]=e,e.setDgMap(this._dgMap),e.onAddToMap()},get:function(e){return DG.Utils.iNU(this._items[e])?null:this._items[e]},remove:function(e){var t=this._items[e];DG.Utils.empty(t)||(t.destroy(),this._items[e]=null)},CLASS_NAME:"DG.Plugins"}),DG.WKTParser={getObject:function(e,t){var i,n;switch(i=DG.WKTParser.getObjectType(e)){case"POINT":n=DG.WKTParser.getPoint(e,t);break;case"MULTIPOINT":n=DG.WKTParser.getMultipoint(e,t);break;case"LINESTRING":n=DG.WKTParser.getPolyline(e,t);break;case"POLYGON":n=DG.WKTParser.getPolygon(e,t);break;case"MULTILINESTRING":n=DG.WKTParser.getMultipolyline(e,t);break;case"MULTIPOLYGON":n=DG.WKTParser.getMultipolygon(e,t)}return n},getObjectType:function(e){var t;if(!DG.WKTParser._isValidType(e))throw new SyntaxError("Invalid object type in WKT description");return t=/([A-Z]+).+/.exec(e),t[1]},getPoint:function(e,t){var i,n,r;if(!DG.WKTParser._isValidPoint(e))throw new SyntaxError("Invalid WKT description of the POINT");if(e=DG.WKTParser._deleteSpaces(e),i=/^POINT\((.*)\)/.exec(e),n=i[1].split(" "),r=new DG.GeoPoint(parseFloat(n[0]),parseFloat(n[1])),!this._isValidLonLat(parseFloat(n[0]),parseFloat(n[1])))throw new SyntaxError("Invalid WKT description of the POINT");return new DG.Geometries.Point(r,t)},getMultipoint:function(e,t){var i,n,r,o=[];if(!DG.WKTParser._isValidMultipoint(e))throw new SyntaxError("Invalid WKT description of the MULTIPOINT");e=DG.WKTParser._deleteSpaces(e),i=/^MULTIPOINT\((.*)\)/.exec(e),n=i[1].split(",");for(var s=0;s<n.length;s++){if(r=n[s].split(" "),!this._isValidLonLat(parseFloat(r[0]),parseFloat(r[1])))throw new SyntaxError("Invalid WKT description of the MULTIPOINT");o.push(new DG.GeoPoint(parseFloat(r[0]),parseFloat(r[1])))}return new DG.Geometries.Multipoint(o,t)},getPolyline:function(e,t){var i,n,r,o=[];if(!DG.WKTParser._isValidLineString(e))throw new SyntaxError("Invalid WKT description of the LINESTRING");e=DG.WKTParser._deleteSpaces(e),i=/^LINESTRING\((.*)\)/.exec(e),n=i[1].split(",");for(var s=0;s<n.length;s++){if(r=n[s].split(" "),!this._isValidLonLat(parseFloat(r[0]),parseFloat(r[1])))throw new SyntaxError("Invalid WKT description of the LINESTRING");o.push(new DG.GeoPoint(parseFloat(r[0]),parseFloat(r[1])))}return new DG.Geometries.Polyline(o,t)},getPolygon:function(e,t){var i,n,r,o,s,a=[],l=[];if(!DG.WKTParser._isValidPolygon(e))throw new SyntaxError("Invalid WKT description of the POLYGON");for(e=DG.WKTParser._deleteSpaces(e),i=/^POLYGON\((.*)\)/.exec(e),s=/\((.*?)\)/g;null!==(o=s.exec(i[1]));){a=[],n=o[1].split(",");for(var h=0;h<n.length;h++){if(r=n[h].split(" "),!this._isValidLonLat(parseFloat(r[0]),parseFloat(r[1])))throw new SyntaxError("Invalid WKT description of the POLYGON");a.push(new DG.GeoPoint(parseFloat(r[0]),parseFloat(r[1])))}l.push(a)}return 1===l.length?new DG.Geometries.Polygon(l[0],t):new DG.Geometries.Multipolygon(l,t)},getMultipolyline:function(e,t){var i,n,r,o,s=[],a=[];if(!DG.WKTParser._isValidMultilineString(e))throw new SyntaxError("Invalid WKT description of the MULTILINESTRING");e=DG.WKTParser._deleteSpaces(e),i=/^MULTILINESTRING\((.*)\)/.exec(e);for(var l=/\((.*?)\)/g;null!==(n=l.exec(i[1]));){r=n[1].split(","),s=[];for(var h=0;h<r.length;h++){if(o=r[h].split(" "),!this._isValidLonLat(parseFloat(o[0]),parseFloat(o[1])))throw new SyntaxError("Invalid WKT description of the MULTILINESTRING");s.push(new DG.GeoPoint(parseFloat(o[0]),parseFloat(o[1])))}a.push(s)}return new DG.Geometries.Multipolyline(a,t)},getMultipolygon:function(e,t){var i,n,r,o,s=[],a=[];if(!DG.WKTParser._isValidMultipolygon(e)){if(!(e.indexOf("),(")>-1))throw new SyntaxError("Invalid WKT description of the MULTIPOLYGON");e=e.split("),(")[0]+")))"}e=DG.WKTParser._deleteSpaces(e),i=/^MULTIPOLYGON\((.*)\)/.exec(e);for(var l=/\(\((.*?)\)\)/g;null!==(n=l.exec(i[1]));){r=n[1].split(","),s=[];for(var h=0;h<r.length;h++){if(o=r[h].split(" "),!this._isValidLonLat(parseFloat(o[0]),parseFloat(o[1])))throw new SyntaxError("Invalid WKT description of the MULTIPOLYGON");s.push(new DG.GeoPoint(parseFloat(o[0]),parseFloat(o[1])))}a.push(s)}return new DG.Geometries.Multipolygon(a,t)},_deleteSpaces:function(e){return e=e.replace(/, /g,","),e=e.replace(" (","(")},_isValidType:function(e){var t,i=["POINT","MULTIPOINT","LINESTRING","POLYGON","MULTILINESTRING","MULTIPOLYGON"];return e=DG.WKTParser._deleteSpaces(e),t=/^([A-Z]+).+/.exec(e),DG.Utils.inArray(t[1],i)},_isValidPoint:function(e){return e=DG.WKTParser._deleteSpaces(e),/^POINT\([-?\d|\.]+ [-?\d|\.]+\)/.test(e)},_isValidMultipoint:function(e){return e=DG.WKTParser._deleteSpaces(e),/^MULTIPOINT\(([-?\d|\.]+ [-?\d|\.]+,)*([-?\d|\.]+ [-?\d|\.]+)\)$/.test(e)},_isValidLineString:function(e){return e=DG.WKTParser._deleteSpaces(e),/^LINESTRING\(([-?\d|\.]+ [-?\d|\.]+,)+[-?\d|\.]+ [-?\d|\.]+\)/.test(e)},_isValidPolygon:function(e){return e=DG.WKTParser._deleteSpaces(e),/^POLYGON\((\(([-?\d|\.]+ [-?\d|\.]+,)+[-?\d|\.]+ [-?\d|\.]+\),?)+\)/.test(e)},_isValidMultilineString:function(e){return e=DG.WKTParser._deleteSpaces(e),/^MULTILINESTRING\((\(([-?\d|\.]+ [-?\d|\.]+,)+[-?\d|\.]+ [-?\d|\.]+\),?)+\)/.test(e)},_isValidMultipolygon:function(e){return e=DG.WKTParser._deleteSpaces(e),/^MULTIPOLYGON\((\(\(([-?\d|\.]+ [-?\d|\.]+,){2,}[-?\d|\.]+ [-?\d|\.]+\)\),?)+\)/.test(e)},_isValidLonLat:function(e,t){return e>=-180&&e<=180&&t>=-90&&t<=90},CLASS_NAME:"DG.WKTParser"},DG.Events.Control=DG.Class(DG.Events.Base,{_control:null,initialize:function(e){this._control=e},getControl:function(){return this._control},CLASS_NAME:"DG.Events.Control"}),DG.Events.Drag=DG.Class(DG.Events.Base,{windowEvent:null,delta:[0,0],point:new DG.Point(0,0),_startPoint:new DG.Point(0,0),_dgMap:null,initialize:function(e,t,i,n,r){this.windowEvent=e,this.point=i,this.delta=n,this._dgMap=r,this._startPoint=t},getInitialPosition:function(){return this._startPoint.clone()},getPoint:function(){return this.point.clone()},getDelta:function(){return new DG.Point(this.delta[0],this.delta[1])},CLASS_NAME:"DG.Events.Drag"}),DG.Events.Geoclicker=DG.Class(DG.Events.Base,{_dgMap:null,initialize:function(e){this._dgMap=e},getDgMap:function(){return this._dgMap},CLASS_NAME:"DG.Events.Geoclicker"}),DG.Events.Geometry=DG.Class(DG.Events.Base,{_geometry:null,initialize:function(e){this._geometry=e},getGeometry:function(){return this._geometry},CLASS_NAME:"DG.Events.Geometry"}),DG.Events.ImageError=DG.Class(DG.Events.Base,{_image:null,initialize:function(e){this._image=e},getImage:function(){return this._image},CLASS_NAME:"DG.Events.ImageError"}),DG.Events.Key=DG.Class(DG.Events.Base,{_dgMap:null,_event:null,initialize:function(e,t){this._dgMap=e,this._event=t},getMap:function(){return this._dgMap},getKeyCode:function(){return this._event.keyCode},getMetaKey:function(){return this._event.metaKey},getAltKey:function(){return this._event.altKey},getCtrlKey:function(){return this._event.ctrlKey},getShiftKey:function(){return this._event.metaKey},CLASS_NAME:"DG.Events.Key"}),DG.Events.Layers=DG.Class(DG.Events.Base,{_layer:null,initialize:function(e){this._layer=e},getLayer:function(){return this._layer},CLASS_NAME:"DG.Events.Layers"}),DG.Events.Locale=DG.Class(DG.Events.Base,{_dgMap:null,initialize:function(e){this._dgMap=e},getDgMap:function(){return this._dgMap},getLangs:function(){return this._dgMap.locale.getLangs()},getLang:function(){return this._dgMap.locale.getLang()},CLASS_NAME:"DG.Events.Locale"}),DG.Events.Map=DG.Class(DG.Events.Base,{_dgMap:null,initialize:function(e){this._dgMap=e},getMap:function(){return this._dgMap},getCenter:function(){return this._dgMap.getCenter()},getZoom:function(){return this._dgMap.getZoom()},getViewportSize:function(){return this._dgMap.getViewPort()},getZoomRestrictions:function(){return this._dgMap.getZoomRestrictions()},getMinZoom:function(){return this._dgMap.getMinZoom()},getMaxZoom:function(){return this._dgMap.getMaxZoom()},CLASS_NAME:"DG.Events.Map"}),DG.Events.Overlay=DG.Class(DG.Events.Base,{_overlay:null,initialize:function(e){this._overlay=e},getOverlay:function(){return this._overlay},CLASS_NAME:"DG.Events.Overlay"}),DG.Events.PinchZoom=DG.Class(DG.Events.Base,{_dgMap:null,_point:null,_distance:null,_middlePoint:null,_scale:null,initialize:function(e,t,i,n,r,o){this._dgMap=e,this.windowEvent=t,this._point=i,this._distance=n,this._middlePoint=r,this._scale=o},getMap:function(){return this._dgMap},getPoint:function(){return this._point.clone()},getDistance:function(){return this._distance},getMiddlePoint:function(){return this._middlePoint},getScale:function(){return this._scale},CLASS_NAME:"DG.Events.PinchZoom"}),DG.Events.ProjectChange=DG.Class(DG.Events.Base,{_project:null,containsViewPort:!1,initialize:function(e){this._project=e},getProject:function(){return this._project},CLASS_NAME:"DG.Events.ProjectChange"}),DG.Events.WindowUnload=DG.Class(DG.Events.Base,{initialize:function(){},CLASS_NAME:"DG.Events.WindowUnload"}),DG.Geoclicker.ClickManager=new DG.Class({_dgMap:null,_style:null,_routeStyle:null,_eventBehavior:null,initialize:function(e){this._dgMap=e,this._initDefaultStyles(),this._eventBehavior=new DG.Geoclicker.Helpers.EventBehavior(this)},getDgMap:function(){return this._dgMap},setStyle:function(e){if(!(e instanceof DG.Style.Geometry))throw new TypeError('Parameter "style" should be an instance of "DG.Style.Geometry"');this._style=e.clone()},getStyle:function(){return this._style.clone()},setRouteStyle:function(e){if(!(e instanceof DG.Style.Geometry))throw new TypeError('Parameter "style" should be an instance of "DG.Style.Geometry"');this._routeStyle=e.clone()},getRouteStyle:function(){return this._routeStyle.clone()},enable:function(){this._eventBehavior.enable()},disable:function(){this._eventBehavior.disable()},isEnabled:function(){return this._eventBehavior.isEnabled()},destroy:function(){this.disable(),this._eventBehavior.destroy(),this._eventBehavior=null},_initDefaultStyles:function(){this._style=new DG.Style.Geometry,this._style.strokeColor="#0da5d5",this._style.strokeOpacity=1,this._style.strokeWidth=3,this._style.fillOpacity=0,this._routeStyle=new DG.Style.Geometry,this._routeStyle.strokeColor="#867be8",this._routeStyle.strokeOpacity=1,this._routeStyle.strokeWidth=3,this._routeStyle.fillOpacity=0},CLASS_NAME:"DG.Geoclicker.ClickManager"}),DG.Geoclicker.Helpers.Common={getTypesByZoom:function(e){var t=null;return e>=14&&e<=DG.Configs.MAX_ZOOM?(t=["house","street"],e>=15&&(t=t.concat("sight","station_platform","poi"))):e>=12&&e<14?t=["district"]:e>=8&&e<12&&(t=["settlement","city"]),t},extractGeoObject:function(e,t){for(var i,n=0;n<e.length;n++){i=e[n].getType();for(var r=0;r<t.length;r++)if(t[r]==i)return e[n]}return e[0]}},DG.Geoclicker.Helpers.EventBehavior=new DG.Class({_clickManager:null,_currentPoint:null,_geoObject:null,_balloon:null,_balloonGeoContent:null,_balloonPrevContent:null,_routePathLoaderContainer:null,_freezeRoutePath:!1,_platformClickObservers:[],_routeClickObservers:[],_firmClickObservers:[],_scrollUpdateObserver:null,_firmClickReturnObserver:null,_observer:null,_lastGeocoderCallbackId:null,_lastFirmCallbackId:null,_lastRouteManagerCallbackId:null,_lastStationManagerCallbackId:null,_lastPlatformCallbackId:null,_isLastClickOnMap:!1,_ballonGroup:"_geoClicker",_isFirmsInLoad:!1,_pageFirmResult:null,_firmCount:null,_firmLinkId:"dg-map-geoclicker-firmcount",_firmLinkFullPref:"dg-map-firm-full-",_firmLinkSchedulePref:"dg-map-firm-schedule-",_firmLinkScheduleFullPref:"dg-map-weekly-schedule-",_firmIconExpandPref:"dg-map-icon-expand-",_firmIconCollapsePref:"dg-map-icon-collapse-",_firmLazyLoaderId:"dg-map-firm-loading",_firmLinkReturnId:"dg-map-firm-return-link",_firmLinkContactsWebsite:"dg-map-row-website-",_firmLinkContactsWebsiteUrl:"dg-map-row-website-url-",_firmLinkContactsEmail:"dg-map-row-email-",_firmLinkContactsEmailUrl:"dg-map-row-email-url-",_titleOffset:9,initialize:function(e){this._clickManager=e},enable:function(){null===this._observer&&(this._observer=this._clickManager.getDgMap().addEventListener(this._clickManager.getDgMap().getContainerId(),"DgClick",DG.Utils.bind(this.handleClick,this)),DG.EventManager.caller(new DG.Events.Geoclicker(this._clickManager.getDgMap()),this._clickManager.getDgMap().getContainerId(),"DgGeoclickerEnable"))},disable:function(){null!==this._observer&&(this._observer.cleanup(),this._observer=null,DG.EventManager.caller(new DG.Events.Geoclicker(this._clickManager.getDgMap()),this._clickManager.getDgMap().getContainerId(),"DgGeoclickerDisable"))},isEnabled:function(){return null!==this._observer},handleClick:function(e){var t,i;return this._isLastClickOnMap=!0,this._freezeRoutePath=!1,this._hideAllObjects(),i=this._clickManager.getDgMap().getZoom(),!(i<DG.Geoclicker.Helpers.EventBehavior.MIN_ZOOM_GEOCLICKER_SHOULD_WORK)&&(this._currentPoint=e.getGeoPoint(),this._showBalloon(DG.Geoclicker.Helpers.View.getLoaderContent(this._clickManager.getDgMap())),this._clearScrollUpdateObserver(),t=this._clickManager.getDgMap().getCurrentProject(),t===!1?this._showDummyBalloon():(this._clickManager.getDgMap().geocoder2.cancelCallback(this._lastGeocoderCallbackId),this._lastGeocoderCallbackId=this._clickManager.getDgMap().geocoder2.get(this._currentPoint,{success:DG.Utils.bind(this.handleGeocoderResult,this),failure:DG.Utils.bind(this.handleGeocoderError,this)})),!1)},handleRouteClicking:function(e){this._showRoutePathLoader(),this._getBalloon().hide(),this._isLastClickOnMap=!1,DG.Transport.RouteManager.cancelCallback(this._lastRouteManagerCallbackId),this._lastRouteManagerCallbackId=DG.Transport.RouteManager.getRouteById(e.getId(),{success:DG.Utils.bind(this.handleRouteInfoResult,this),failure:DG.Utils.bind(this.handleGeocoderError,this)})},handlePlatformClicking:function(e){this._freezeRoutePath=!1,this._hideAllObjects(),this._isLastClickOnMap=!1,this._showBalloon(DG.Geoclicker.Helpers.View.getLoaderContent(this._clickManager.getDgMap())),this._clickManager.getDgMap().geocoder2.cancelCallback(this._lastGeocoderCallbackId),this._lastGeocoderCallbackId=this._clickManager.getDgMap().geocoder2.get(e.getId(),{success:DG.Utils.bind(this.handleGeocoderResult,this),failure:DG.Utils.bind(this.handleGeocoderError,this)})},handleRoutePathMarkerClicking:function(e,t){this._currentPoint=e.getGeoPoint(),this._showBalloon(DG.Geoclicker.Helpers.View.getLoaderContent(this._clickManager.getDgMap())),this._isLastClickOnMap=!1,this._clickManager.getDgMap().geocoder2.cancelCallback(this._lastGeocoderCallbackId),this._lastGeocoderCallbackId=this._clickManager.getDgMap().geocoder2.get(t.getPosition(),{type:"poi",success:DG.Utils.bind(this.handleMarkerClickGeocoderResult,this),failure:DG.Utils.bind(this.handleGeocoderError,this)})},handleBalloonClosing:function(){this._clickManager.getDgMap().geocoder2.cancelCallback(this._lastGeocoderCallbackId),DG.Transport.RouteManager.cancelCallback(this._lastRouteManagerCallbackId),DG.Transport.StationManager.cancelCallback(this._lastStationManagerCallbackId),DG.Transport.Platform.cancelCallback(this._lastPlatformCallbackId),this._hideAllObjects()},handleGeocoderResult:function(e){var t,i,n,r,o,s,a;a=this._clickManager.getDgMap();for(var l=0;l<e.length;l++){if(this._geoObject=e[l],o=this._geoObject.getType(),s=this._geoObject.getReference(),DG.UIStats.track({expl:"Geoclicker",name:o}),"poi"===o&&"branch"===s.type)return void this._getPoiData(this._geoObject,DG.Utils.bind(this._handlePOI,this));if("poi"===o&&"station_platform"===s.type){this._currentPoint=this._geoObject.getCenterGeoPoint(),a.getZoom()<16&&a.setZoom(16),i=new DG.Transport.Platform({id:this._geoObject.getId(),location:this._geoObject.getCenterGeoPoint()});var h=this;return DG.Transport.Platform.cancelCallback(this._lastPlatformCallbackId),void(this._lastPlatformCallbackId=i.getRoutes({success:function(e){h.handlePlatformRoutesResult(e,!0,!h._isLastClickOnMap)},failure:DG.Utils.bind(this.handleGeocoderError,this)}))}if("city"===o||"settlement"===o||"district"===o||"street"===o||"building"===o||"attraction"===o)return t=this._geoObject.getSelection(),t instanceof DG.Geometries.Point||(a.geometries.add(t,DG.Geoclicker.Helpers.EventBehavior.GEOMETRIES_GROUP_NAME),t.setStyle(this._clickManager.getStyle())),n=DG.Geoclicker.Helpers.View.getBalloonContent(a,this._geoObject),this._showBalloon(n,this._geoObject),this._clearFirmClickObservers(),r=a.addEventListener(this._firmLinkId,"DgClick",DG.Utils.bind(this.handleFirmLinkClicking,this)),void this._firmClickObservers.push(r)}this.handleGeocoderError()},_getPoiData:function(e,t){var i,n=this._clickManager.getDgMap();try{i="string"==typeof e?e:this._geoObject.getReference().id}catch(r){t.call(this,null)}n.ajax.get({url:DG.Geoclicker.Helpers.EventBehavior.WEB_API_SERVER+"/"+DG.Geoclicker.Helpers.EventBehavior.WEB_API_VERSION+"/catalog/branch/get?callback=$[callback]",data:{id:i,format:"jsonp",key:DG.Geoclicker.Helpers.EventBehavior.WEB_API_KEY,fields:"items.reviews"},success:function(e){var n;n=200===e.meta.code&&e.result&&e.result.items&&e.result.items.length?e.result.items[0]:null,t.call(this,n,i)},failure:function(){t.call(this,null)},scope:this})},_handlePOI:function(e){var t=this._clickManager.getDgMap();if(!e)return void this.handleGeocoderError();var i=DG.Geoclicker.Helpers.View.getFirmMsgs(t),n=DG.Utils.getProjectTime(t),r=DG.Geoclicker.Helpers.FirmShedule.parseWhs(e.schedule,n),o=DG.Geoclicker.Helpers.FirmShedule.setSchedule(r,i),s=document.createElement("div"),a=DG.Geoclicker.Helpers.View.getFirmContentContainer();s.innerHTML=DG.Geoclicker.Helpers.View.getFirmContent(t,[e],[o]);var l=s.querySelector(".dg-map-firm-title"),h=l.children[0];l.innerHTML=h.innerHTML,l.setAttribute("class","dg-map-heading-poi"),s.querySelector(".dg-map-firm-full").style.display="block",this._showBalloon(a.header+s.innerHTML+a.footer,this._geoObject),this._clearFirmClickObservers();var c=t.addEventListener(this._firmLinkSchedulePref+e.id,"DgClick",DG.Utils.bind(this.handleScheduleFirmListClicking,this));this._firmClickObservers.push(c),e.register_bc_url&&DG.Utils.Tracker.regBC(e.register_bc_url);var u=this._firmLinkContactsEmail+e.id,d=document.getElementsByName(u),p=d.length;if(p)for(var g,m,f,y=0;y<p;y++)f=d[y].getAttribute("register_bc_url"),m=this._firmLinkContactsEmailUrl+e.id+"-"+y,g=DG.Utils.DOM.getChildNode(d[y]),g.setAttribute("id",m),function(e,i){var n=t.addEventListener(m,"DgClick",function(){e.handleSendApiTracker(i)});e._firmClickObservers.push(n)}(this,f)},handleFirmLinkClicking:function(e){var t=this._geoObject.getAttributes(),i=document.createElement("div"),n=document.createElement("div"),r="",o=DG.Utils.DOM.getElementsByClassName("dgInfocardGeo",this._getBalloon()._div)[0],s=o.offsetHeight+"px",a=o.offsetWidth+"px";this._pageFirmResult=1,this._balloonPrevContent=null,this._balloonGeoContent=this._getBalloon().getContent(),t&&t.firmcount&&(this._firmCount=t.firmcount),this._clearFirmClickObservers(),this._clearFirmClickReturnObserver(),this._clearScrollUpdateObserver(),n.id="balloonLoaderWrapper",n.innerHTML=DG.Geoclicker.Helpers.View.getLoaderContent(this._clickManager.getDgMap()),n.style.height=s,n.style.width=a,i.appendChild(n),r=i.innerHTML,this._showBalloon(r),this.handleLoadFirmData(this._pageFirmResult),this._scrollUpdateObserver=this._clickManager.getDgMap().addEventListener("DgBalloonScroll",DG.Utils.bind(this.handleScrollUpdate,this))},handleLoadFirmData:function(e){var t=this._clickManager.getDgMap(),i=this._geoObject.getId();this._isFirmsInLoad=!0,this._showPagesLoader(),this._lastFirmCallbackId=t.ajax.get({url:DG.Geoclicker.Helpers.EventBehavior.WEB_API_SERVER+"/"+DG.Geoclicker.Helpers.EventBehavior.WEB_API_VERSION+"/catalog/branch/list?callback=$[callback]",data:{building_id:i,page:e,format:"jsonp",key:DG.Geoclicker.Helpers.EventBehavior.WEB_API_KEY},success:DG.Utils.bind(this.handleFirmResult,this),failure:DG.Utils.bind(this.handleGeocoderError,this),scope:this})},handleFirmResult:function(e){var t,i,n,r,o,s,a,l,h=this._clickManager.getDgMap(),c=[],u=[];if(!(e&&e.result&&e.result.items))return a=DG.Geoclicker.Helpers.View.getFirmErrorContent(),void this._showBalloon(a);i=e.result.items;for(var d=!0,p=DG.Geoclicker.Helpers.View.getFirmMsgs(h),g=DG.Utils.getProjectTime(h),m=0,f=i.length;m<f;m++)u[m]=DG.Geoclicker.Helpers.FirmShedule.parseWhs(i[m].whs,g),c[m]=DG.Geoclicker.Helpers.FirmShedule.setSchedule(u[m],p);r=DG.Geoclicker.Helpers.View.getFirmList(h,i,c),o=DG.Geoclicker.Helpers.View.getHeaderContent(this._geoObject),s=DG.Geoclicker.Helpers.View.getFooterContent(h),t={header:o,footer:s},n=DG.Geoclicker.Helpers.View.getFirmContentContainer(),this._balloonPrevContent?(l=n.header+this._balloonPrevContent+r+n.footer,this._balloonPrevContent=this._balloonPrevContent+r):(l=n.header+r+n.footer,this._balloonPrevContent=r),1===this._pageFirmResult&&(d=!1),this._showBalloon(l,null,d,t),this._clearFirmClickReturnObserver(),this._firmClickReturnObserver=h.addEventListener(this._firmLinkReturnId,"DgClick",DG.Utils.bind(this.handleFirmReturnClicking,this));for(var y=0,_=i.length;y<_;y++){var v=h.addEventListener(i[y].id,"DgClick",DG.Utils.bind(this.handleFirmNameClicking,this));this._firmClickObservers.push(v)}this._isFirmsInLoad=!1},handleOneFirmResult:function(e,t){var i=this._clickManager.getDgMap();if(!e)return void this.handleGeocoderError();var n=DG.Geoclicker.Helpers.View.getFirmMsgs(i),r=DG.Utils.getProjectTime(i),o=DG.Geoclicker.Helpers.FirmShedule.parseWhs(e.schedule,r),s=DG.Geoclicker.Helpers.FirmShedule.setSchedule(o,n),a=document.getElementById(this._firmLinkFullPref+t);a.innerHTML=DG.Geoclicker.Helpers.View.getOneFirmContent(i,[e],[s]);var l=i.addEventListener(this._firmLinkSchedulePref+e.id,"DgClick",DG.Utils.bind(this.handleScheduleFirmListClicking,this));this._firmClickObservers.push(l),e.register_bc_url&&!function(e,t){var n=i.addEventListener(results[j].id,"DgClick",function(i){e.handleFirmOpenClicking(i,t)});e._firmClickObservers.push(n)}(this,e.register_bc_url);var h=this._firmLinkContactsEmail+e.id,c=document.getElementsByName(h),u=c.length;if(u)for(var d,p,g,m=0;m<u;m++)g=c[m].getAttribute("register_bc_url"),p=this._firmLinkContactsEmailUrl+e.id+"-"+m,d=DG.Utils.DOM.getChildNode(c[m]),d.setAttribute("id",p),function(e,t){var n=i.addEventListener(p,"DgClick",function(){e.handleSendApiTracker(t)});e._firmClickObservers.push(n)}(this,g);this._toggleVisible(this._firmLinkFullPref+t),this._setOpenFirmTitlePosition(t)},handleScrollUpdate:function(e){if(!this._isFirmsInLoad){var t=this._getBalloon().getMaxVerticalScrollPosition(),i=this._getBalloon().getVerticalScrollPosition(),n=20;t&&t===i&&(this._pageFirmResult++,this._firmCount&&this._pageFirmResult<=Math.ceil(this._firmCount/n)?this.handleLoadFirmData(this._pageFirmResult):this._hidePagesLoader())}},handleFirmReturnClicking:function(e){var t=this._clickManager.getDgMap();this._showBalloon(this._balloonGeoContent),
this._balloonPrevContent=null,this._clearFirmClickObservers(),this._clearFirmClickReturnObserver(),this._clearScrollUpdateObserver();var i=t.addEventListener(this._firmLinkId,"DgClick",DG.Utils.bind(this.handleFirmLinkClicking,this));this._firmClickObservers.push(i)},handleFirmNameClicking:function(e){var t=e.getId();this._getPoiData(t,DG.Utils.bind(this.handleOneFirmResult,this)),DG.EventManager.stopEventBuble(e.windowEvent)},handleScheduleFirmListClicking:function(e){var t=e.getId().replace(/dg-map-firm-schedule-/g,"");this._toggleVisible(this._firmLinkScheduleFullPref+t),this._toggleVisible(this._firmIconExpandPref+t),this._toggleVisible(this._firmIconCollapsePref+t)},_setOpenFirmTitlePosition:function(e){var t=document.getElementById(e),i=document.getElementById("content_"+this._getBalloon().getContainerId());if(t&&i){var n=DG.Utils.DOM.getOffset(t),r=DG.Utils.DOM.getOffset(i),o=n.top-r.top-this._titleOffset;this._getBalloon().scrollContent(!1,o)}},_showPagesLoader:function(){var e=document.getElementById(this._firmLazyLoaderId);e&&(e.style.display="block",this._getBalloon().redraw())},_hidePagesLoader:function(){var e=document.getElementById(this._firmLazyLoaderId);e&&(e.style.display="none")},_toggleVisible:function(e){var t=document.getElementById(e);t&&("none"!==t.style.display?t.style.display="none":t.style.display="",this._getBalloon().redraw())},handleFirmOpenClicking:function(e,t){var i=e.getId();"none"!==document.getElementById(this._firmLinkFullPref+i).style.display&&DG.Utils.Tracker.regBC(t)},handleSendApiTracker:function(e){DG.Utils.Tracker.regBC(e)},handlePlatformRoutesResult:function(e,t,i){var n,r=this;DG.Transport.StationManager.cancelCallback(this._lastStationManagerCallbackId),this._lastStationManagerCallbackId=DG.Transport.StationManager.getStationByPlatformId(this._geoObject.getId(),{success:function(n){r.handleStationInfoResult(n,e,t,i)},failure:DG.Utils.bind(this.handleGeocoderError,this)}),this._clearPlatformClickObservers(),this._clearRouteClickObservers();for(var o=0;o<e.length;o++)n=this._clickManager.getDgMap().addEventListener(e[o].getId(),"DgClick",DG.Utils.bind(this.handleRouteClicking,this)),this._routeClickObservers.push(n)},handleStationInfoResult:function(e,t,i,n){var r=DG.Geoclicker.Helpers.View.getBalloonContent(this._clickManager.getDgMap(),this._geoObject,t,e);n===!0?this._showBalloon(r,this._geoObject.getCenterGeoPoint()):this._showBalloon(r)},handleRouteInfoResult:function(e){var t,i,n,r,o;r=e.getPlatforms(),n=new DG.Icon(DG.Configs.Geoclicker.transportImagesUrl+"/route-"+e.getType()+".png",new DG.Size(20,20),function(){return new DG.Point((-10),(-10))}),this._hideRoutePath(),this._hidePlatforms();for(var s=0;s<r.length;s++)i=new DG.Markers.Common({geoPoint:r[s].getLocation(),icon:n.clone(),clickCallback:DG.Utils.bind(this.handleRoutePathMarkerClicking,this)}),this._clickManager.getDgMap().markers.add(i,DG.Geoclicker.Helpers.EventBehavior.ROUTE_MARKERS_GROUP_NAME);t=e.getDirections(),t[0].setStyle(this._clickManager.getRouteStyle()),this._clickManager.getDgMap().geometries.add(t[0],DG.Geoclicker.Helpers.EventBehavior.GEOMETRIES_GROUP_NAME),t[1].setStyle(this._clickManager.getRouteStyle()),this._clickManager.getDgMap().geometries.add(t[1],DG.Geoclicker.Helpers.EventBehavior.GEOMETRIES_GROUP_NAME),this._freezeRoutePath=!0,this._hideRoutePathLoader(),o=this._clickManager.getDgMap().markers.getBounds(DG.Geoclicker.Helpers.EventBehavior.ROUTE_MARKERS_GROUP_NAME),this._clickManager.getDgMap().setBounds(o)},handleMarkerClickGeocoderResult:function(e){for(var t,i=this,n=0;n<e.length;n++)"station_platform"===e[n].getReference().type&&(this._geoObject=e[n]);this._currentPoint=this._geoObject.getCenterGeoPoint(),t=new DG.Transport.Platform({id:this._geoObject.getId(),location:this._currentPoint}),DG.Transport.Platform.cancelCallback(this._lastPlatformCallbackId),this._lastPlatformCallbackId=t.getRoutes({success:function(e){i.handlePlatformRoutesResult(e,!1,!1)},failure:DG.Utils.bind(this.handleGeocoderError,this)})},handleGeocoderError:function(){this._showDummyBalloon()},destroy:function(){this._clearPlatformClickObservers(),this._clearRouteClickObservers(),this._clearFirmClickObservers(),this._clearFirmClickReturnObserver(),this._clearScrollUpdateObserver(),null!==this._balloon&&(this._clickManager.getDgMap().balloons.remove(this._balloon),this._balloon=null),this._clickManager=null,this._currentPoint=null,this._geoObject=null},_getBalloon:function(){return null===this._balloon&&(this._balloon=new DG.Balloons.Common({geoPoint:this._currentPoint,contentHtml:"",fixedRelativePosition:!0,maxContentHeight:300,maxContentWidth:400,closeCallback:DG.Utils.bind(this.handleBalloonClosing,this),adjustMapCenterToBalloon:!0}),this._clickManager.getDgMap().balloons.add(this._balloon,this._ballonGroup)),this._balloon},_showBalloon:function(e,t,i,n){this._getBalloon().setContent(e,i),n&&!DG.Utils.iNU(n.header)?this._getBalloon().setHeaderContent(n.header):this._getBalloon().setHeaderContent(""),n&&!DG.Utils.iNU(n.footer)?this._getBalloon().setFooterContent(n.footer):this._getBalloon().setFooterContent(""),this._getBalloon().setPosition(this._currentPoint),this._getBalloon().show(),t instanceof DG.GeoPoint&&this._clickManager.getDgMap().setCenter(t)},_redrawBalloon:function(){this._getBalloon().fullRedraw(!0,!1,!0,!0)},_showDummyBalloon:function(){var e;e=DG.Geoclicker.Helpers.View.getDummyBalloonContent(this._clickManager.getDgMap()),this._showBalloon(e)},_hideAllObjects:function(){null!==this._balloon&&this._balloon.hide(),this._freezeRoutePath===!1&&(this._hideRoutePath(),this._hidePlatforms()),this._hideRoutePathLoader()},_showRoutePathLoader:function(){var e,t;e=this._clickManager.getDgMap().getViewPortContainer(),t=this._clickManager.getDgMap().getContainerSize(),null===this._routePathLoaderContainer?(this._routePathLoaderContainer=document.createElement("div"),this._routePathLoaderContainer.style.left=parseInt(t.w/2)-42.5+"px",this._routePathLoaderContainer.style.top=parseInt(t.h/2)+42.5+"px",this._routePathLoaderContainer.className="transport-loader-container",this._routePathLoaderContainer.innerHTML=DG.Geoclicker.Helpers.View.getRoutePathLoaderContent(),e.appendChild(this._routePathLoaderContainer)):this._routePathLoaderContainer.style.display="block"},_hideRoutePathLoader:function(){null!==this._routePathLoaderContainer&&(this._routePathLoaderContainer.style.display="none")},_hideRoutePath:function(){var e,t;e=this._clickManager.getDgMap().geometries.getGroup(DG.Geoclicker.Helpers.EventBehavior.GEOMETRIES_GROUP_NAME),null!==e&&e.removeAll(),t=this._clickManager.getDgMap().markers.getGroup(DG.Geoclicker.Helpers.EventBehavior.ROUTE_MARKERS_GROUP_NAME),null!==t&&t.removeAll()},_hidePlatforms:function(){var e;e=this._clickManager.getDgMap().markers.getGroup(DG.Geoclicker.Helpers.EventBehavior.PLATFORM_MARKERS_GROUP_NAME),null!==e&&e.removeAll()},_clearRouteClickObservers:function(){for(var e=0;e<this._routeClickObservers.length;e++)this._routeClickObservers[e].cleanup();this._routeClickObservers=[]},_clearPlatformClickObservers:function(){for(var e=0;e<this._platformClickObservers.length;e++)this._platformClickObservers[e].cleanup();this._platformClickObservers=[]},_clearFirmClickObservers:function(){if(this._firmClickObservers){for(var e=0;e<this._firmClickObservers.length;e++)this._firmClickObservers[e].cleanup();this._firmClickObservers=[]}},_clearFirmClickReturnObserver:function(){this._firmClickReturnObserver&&(this._firmClickReturnObserver.cleanup(),this._firmClickReturnObserver=null)},_clearScrollUpdateObserver:function(){this._scrollUpdateObserver&&(this._scrollUpdateObserver.cleanup(),this._scrollUpdateObserver=null)},CLASS_NAME:"DG.Geoclicker.Helpers.EventBehavior"}),DG.Geoclicker.Helpers.EventBehavior.GEOMETRIES_GROUP_NAME="geoclickerGeometries",DG.Geoclicker.Helpers.EventBehavior.ROUTE_MARKERS_GROUP_NAME="geoclickerRouteMarkers",DG.Geoclicker.Helpers.EventBehavior.PLATFORM_MARKERS_GROUP_NAME="geoclickerPlatformMarkers",DG.Geoclicker.Helpers.EventBehavior.MIN_ZOOM_GEOCLICKER_SHOULD_WORK=8,DG.Geoclicker.Helpers.EventBehavior.WEB_API_SERVER="http://catalog.api.2gis.ru",DG.Geoclicker.Helpers.EventBehavior.WEB_API_VERSION="2.0",DG.Geoclicker.Helpers.EventBehavior.WEB_API_KEY="rubnkm7490",DG.Geoclicker.Helpers.FirmShedule={T_MON:"Mon",T_TUE:"Tue",T_WED:"Wed",T_THU:"Thu",T_FRI:"Fri",T_SAT:"Sat",T_SUN:"Sun",T_WH0:0,T_WH1:1,payMethods:["cash","mastercard","noncash","visa"],schedule:null,msgs:null,parseWhs:function(e,t){var i,n,r,o,s,a,l=DG.Geoclicker.Helpers.FirmShedule;return r={aroundTheClock:!1,daily:!1,byPeriods:!1,allTable:!1,anyLunchExists:!1,isOpened:!1,timeToOpen:!1,timeToClose:!1,timeToLunchBegin:!1,timeToLunchEnd:!1,nextWorkDay:!1,todayWorkhours:!1,weekDayStr:!1},e?(i=l.groupDaysWithSameWh(e),n=l.parsePeriods(i,e),r.aroundTheClock=n.aroundTheClock,r.daily=n.daily,r.byPeriods=n.byPeriods,r.allTable=n.allTable,r.anyLunchExists=n.anyLunchExists,t=t||new Date,a=DG.Geoclicker.Helpers.FirmShedule.getWeekDayNum(t),r.weekDayStr=DG.Geoclicker.Helpers.FirmShedule.getWeek()[a],o=l.getTodayWorkhours(r.weekDayStr,e),r.todayWorkhours=l.convertWorkhours(o),s=l.checkIsNowOpen(t,o),r.isOpened=s.isOpened,r.timeToOpen=s.timeToOpen,r.timeToClose=s.timeToClose,r.timeToLunchBegin=s.timeToLunchBegin,r.timeToLunchEnd=s.timeToLunchEnd,r.isLunchNow=s.isLunchNow,o||(r.nextWorkDay=l.getNextWorkDay(t,e)),r):r},getTodayWorkhours:function(e,t){return!!t[e]&&t[e]},checkIsNowOpen:function(e,t){var i,n,r,o,s;r=DG.Geoclicker.Helpers.FirmShedule;var a={isOpened:!1,timeToOpen:!1,timeToClose:!1,isLunchNow:!1,timeToLunchBegin:!1,timeToLunchEnd:!1};if(!t||!t.working_hours)return a;for(s=t.working_hours,o=-1,i=0,n=s.length;i<n;i++){o++;var l=!1,h=s[i].from.split(":"),c=s[i].to.split(":");1*h[0]>1*c[0]&&(l=!0);var u=r.setTimeStrInDate(e,s[i].from,!1)-e,d=r.setTimeStrInDate(e,s[i].to,l)-e;if(!(d<=0))return u>0?(a.isOpened=!1,a.timeToOpen=u,o>0&&(a.isLunchNow=!0,a.timeToLunchEnd=a.timeToOpen),a):(a.isOpened=!0,a.timeToClose=d,r.isNextWorkPeriodExists(s,i)&&(a.timeToLunchBegin=a.timeToClose),a)}return a},isNextWorkPeriodExists:function(e,t){return e.hasOwnProperty(t+1)},setTimeStrInDate:function(e,t,i){var n=new Date(e.getTime()),r=t.split(":");return i&&n.setDate(e.getDate()+1),n.setHours(r[0],r[1],r[2]?r[2]:0,0),n},getWeekDayNum:function(e){var t;return t=e.getDay(),0===t?6:t-1},getNextWorkDay:function(e,t){var i,n,r,o="_in",s=0;for(i=n=DG.Geoclicker.Helpers.FirmShedule.getWeekDayNum(e),r=DG.Geoclicker.Helpers.FirmShedule.getWeek(),n++,n%=7;i!=n&&s++<8;){if(t[r[n]])return r[n]+o;n++,n%=7}return!1},groupDaysWithSameWh:function(e){function t(e,t){return DG.Utils.toJSON(e)===DG.Utils.toJSON(t)}var i,n,r,o,s,a=DG.Geoclicker.Helpers.FirmShedule;for(s=[],r=-1,o=a.getWeek(),n=0;n<7;n++)i=o[n],e[i]||(e[i]=!1),r>-1&&t(s[r].workhours,e[i])?(s[r].lastDay=i,s[r].daysCount++):s[++r]={workhours:e[i],firstDay:i,lastDay:i,daysCount:1};return s},parsePeriods:function(e,t){var i,n,r=DG.Geoclicker.Helpers.FirmShedule,o={aroundTheClock:!1,daily:!1,byPeriods:!1,allTable:!1,anyLunchExists:!1},s=e.length;if(1==s&&e[0].firstDay==r.T_MON&&e[0].lastDay==r.T_SUN){var a=r.convertWorkhours(e[0].workhours);return"00:00"==a.workFrom&&"24:00"==a.workTo?o.aroundTheClock=!0:(o.daily=a,o.anyLunchExists=!!a.lunchFrom),o}if(s<4){o.byPeriods=[];for(var i=0;i<s;i++)o.byPeriods[i]=r.convertWorkhours(e[i].workhours),o.byPeriods[i].daysCount=e[i].daysCount,o.byPeriods[i].workingDays=e[i].firstDay==r.T_MON&&e[i].lastDay==r.T_FRI,o.byPeriods[i].firstDay=e[i].firstDay,e[i].lastDay&&e[i].lastDay!=e[i].firstDay&&(o.byPeriods[i].lastDay=e[i].lastDay),o.anyLunchExists=o.anyLunchExists||!!e[i].lunchFrom}else{n=r.getWeek(),o.allTable=[];for(i in n)o.allTable[i]=r.convertWorkhours(t[n[i]]),o.allTable[i].firstDay=n[i],o.anyLunchExists=o.anyLunchExists||!!o.allTable[i].lunchFrom}return o},convertWorkhours:function(e){var t,i=DG.Geoclicker.Helpers.FirmShedule,n={workFrom:!1,workTo:!1,lunchFrom:!1,lunchTo:!1,isRestDay:!1};return e&&e.working_hours?(t=e.working_hours,t[i.T_WH1]?(n.workFrom=t[i.T_WH0].from,n.workTo=t[i.T_WH1].to,n.lunchFrom=t[i.T_WH0].to,n.lunchTo=t[i.T_WH1].from):(n.workFrom=t[i.T_WH0].from,n.workTo=t[i.T_WH0].to),n):(n.isRestDay=!0,n)},getWeek:function(){var e=DG.Geoclicker.Helpers.FirmShedule;return[e.T_MON,e.T_TUE,e.T_WED,e.T_THU,e.T_FRI,e.T_SAT,e.T_SUN]},setSchedule:function(e,t){return this.schedule=e,this.msgs=t,this.schedule.aroundTheClock&&(this.schedule.todayWorkhours=!1,this.schedule.timeToClose=!1),this._chooseScheduleHintMsgs(),this._schedulePeriodsHelper(),this.schedule},_chooseScheduleHintMsgs:function(){var e;if(this.schedule.msgCrntState="",this.schedule.msgHint="",this.schedule.isLunchNow?this.schedule.msgCrntState=this._msgU("is_lunch"):this.schedule.isOpened?this.schedule.msgCrntState=this._msgU("is_open"):this.schedule.isOpened||(this.schedule.msgCrntState=this._msgU("is_close")),this.schedule.timeToClose){var t=5*Math.floor(this.schedule.timeToClose/1e3/60/5),i=5*Math.ceil(this.schedule.timeToClose/1e3/60/5);if(t<=60)if(e=this.schedule.timeToLunchBegin?this._msg("to_lunch"):this._msg("to_close"),t>55)i<=60&&(this.schedule.msgHint=". "+this._msgU("less_then_hour")+" "+e+".");else if(i<15)this.schedule.msgHint=". "+this._msgU("less")+" "+i+" "+this._msg("minutes")+" "+e+". "+this._msgU("you_could_late"),this.schedule.timeToLunchBegin||(this.schedule.msgHint+="today msg"===this._msg("today_msg")?"":" "+this._msg("today_msg")),this.schedule.msgHint+=".";else{var n="Remains"===this._msgU("remains")?"":this._msgU("remains")+" ";this.schedule.msgHint=". "+n+t+" "+this._msg("minutes")+" "+e+"."}}if(this.schedule.timeToOpen){var r=5*Math.ceil(this.schedule.timeToOpen/1e3/60/5);(r<60||this.schedule.timeToLunchEnd&&r<120)&&(60==r?this.schedule.msgHint=". "+this._msgU("open_in")+" "+this._msg("hour")+".":(this.schedule.timeToLunchEnd&&r>60&&(r=this._msgU("one_hour")+" "+r%60),this.schedule.msgHint=". "+this._msgU("open_in")+" "+r+" "+this._msg("minutes")+"."))}this.schedule.nextWorkDay&&(this.schedule.msgHint=". "+this._msgU("will_open")+" "+this._msg(this.schedule.nextWorkDay))},_schedulePeriodsHelper:function(){for(var e=0,t=this.schedule.byPeriods.length;e<t;e++){var i,n;i=this.schedule.byPeriods[e],i.workingDays?i.days=this._msgU("working_days"):(i.days=this._msgU(i.firstDay),i.daysCount>1&&(n=2==i.daysCount?", ":" &ndash; ",i.days+=n+this._msg(i.lastDay))),i.workFrom?i.labelText=i.workFrom+"&ndash;"+i.workTo:i.labelText=" &mdash; "+this._msg("rest_day")}},_paymentsHelper:function(){if(this.data.profile){for(var e=0,t=this.payMethods.length;e<t;e++)if(this.data.profile["pay_"+this.payMethods[e]])return;this.data.profile=!1}},_msg:function(e){return this.msgs.hasOwnProperty(e)?this.msgs[e]:(console&&console.log("Cant't find translation for '"+e+"'."),e.toString().replace("_"," "))},_msgU:function(e){var t=this._msg(e),i=t.charAt(0).toUpperCase();return i+t.substr(1)},_getFlampUrl:function(e){var t=DG.Geoclicker.Helpers.FirmShedule.FLAMP_URL,i=DG.Geoclicker.Helpers.FirmShedule.FLAMP_GOOGLE_ANALYTICS;return t+e.id+"?"+i},_isPaymentGroup:function(e){if(!e||!e.attributes)return!1;for(var t=0,i=e.attributes.length;t<i;t++)if(0!==(e.attributes[t].tag||"").indexOf("general_payment_type"))return!1;return!0},_getPaymentAttributes:function(e){if(e&&e.attribute_groups){for(var t=[],i=0,n=e.attribute_groups.length;i<n;i++)this._isPaymentGroup(e.attribute_groups[i])&&t.push(e.attribute_groups[i]);return t}},getPayment:function(e){for(var t=this._getPaymentAttributes(e)||{},i={},n=0,r=t.length;n<r;n++)if(t[n].attributes)for(var o=0,s=t[n].attributes.length;o<s;o++)t[n].attributes[o].tag&&(i[t[n].attributes[o].tag]=!0);return i}},DG.Geoclicker.Helpers.FirmShedule.FLAMP_URL="http://flamp.ru/r/",DG.Geoclicker.Helpers.FirmShedule.FLAMP_GOOGLE_ANALYTICS="utm_source=api2gis&utm_medium=api&utm_campaign=geoclicker",DG.Geoclicker.Helpers.View={_clickManager:null,getLoaderContent:function(e){var t;return t='<div class="dgInfocardGeo"><div class="loaderContainer"><img width="32px" height="32px" alt="" src="',t+=DG.Configs.Geoclicker.stationLoaderImg+'"/> <span class="loading">',t+=e.locale.t("data loading")+"</span></div></div>"},getRoutePathLoaderContent:function(){return'<img alt="" src="'+DG.Configs.Geoclicker.routePathLoaderImg+'"/>'},getDummyBalloonContent:function(e){return'<div class="dgInfocardGeo">'+e.locale.t("unknown place")+"</div>"},getBalloonContent:function(e,t,i,n){var r;switch(t.getType()){case"district":r=DG.Geoclicker.Helpers.View._getDistrictContent(e,t);break;case"street":r=DG.Geoclicker.Helpers.View._getStreetContent(e,t);break;case"city":r=DG.Geoclicker.Helpers.View._getCityContent(t);break;case"building":r=DG.Geoclicker.Helpers.View._getHouseContent(e,t);break;case"poi":r="station_platform"===t.getReference().type?DG.Geoclicker.Helpers.View._getPlatformContent(e,t,i,n):t.getShortName();break;case"sight":r=DG.Geoclicker.Helpers.View._getSightContent(t);break;default:r=t.getShortName()}return'<div class="dgInfocardGeo">'+r+"</div>"},getHeaderContent:function(e){return'<div class="dg-map-firm-header">'+e.getName().split(",").slice(1).join(",")+"</div>"},getFooterContent:function(e){var t='<a id="dg-map-firm-return-link" class="dg-map-firm-return-link" href="javascript:void(0)">';return t+=e.locale.t("Hide the organization in building")+"</a>",'<div class="dg-map-firm-return">'+t+"</div>"},_getDistrictContent:function(e,t){return e.locale.t("disctict")+": "+t.getShortName()},_getStreetContent:function(e,t){var i;return i=e.locale.t("street")+": ",i+=t.getShortName().trim()?t.getShortName():e.locale.t("unnamed street")},_getCityContent:function(e){return e.getName()},_getHouseContent:function(e,t){var i,n="";return i=t.getAttributes(),i.buildingname&&(n+="<h1>"+i.buildingname+"</h1>"),t.getName()&&(n+='<div class="dg-map-geoclicker-address">',i.index&&(n+=i.index+","),n+=t.getName().split(",").slice(1).join(",")+"</div>"),n+='<span class="dg-map-geoclicker-purpose">'+i.purpose+"</span>",i.elevation&&(n+='<span class="dg-map-geoclicker-elevation"> '+i.elevation+" "+e.locale.t("%d elevation",1*i.elevation)+"</span>"),i.firmcount&&i.firmcount>0&&(n+='<a class="dg-map-geoclicker-firmcount" id="dg-map-geoclicker-firmcount" href="javascript:void(0);">',n+=e.locale.t("Show organization in the building")+"</a><sup>"+i.firmcount+"</sup>"),n},_getPlatformContent:function(e,t,i,n){var r;r='<h1 class="infocard-transport-station">'+e.locale.t("station platform")+": "+n.getName()+"</h1>",r+='<ul class="result-list">';for(var o=0;o<i.length;o++)r+='<li class="'+i[o].getType()+'">',r+='<div class="infocard-transport-route">',r+='<a id="'+i[o].getId()+'" href="javascript: void(0);" class="route-link">'+i[o].getName()+"</a>",r+="<span>, "+e.locale.t(i[o].getType())+"</span>",r+="</div>",r+='<div class="infocard-transport-stations">',r+="<span>"+i[o].getFromName()+"</span>&nbsp;&mdash;&nbsp;<span>"+i[o].getToName()+"</span>",r+="</div>",r+="</li>";return r+="</ul>"},_getSightContent:function(e){var t;return t=e.getShortName(),t.trim()||(t=e.getAttributes().mapclass),t},getFirmContentContainer:function(){var e='<div class="dg-map-balloon-content"><div class="dg-map-infocard-firmlist">',t='<div class="dg-map-firm-loading" id="dg-map-firm-loading"></div></div></div>',i={header:e,footer:t};return i},getFirmList:function(e,t){var i='<% for (var i = 0, count = firms.length; i < count; i++) { %>\n            <div class="dg-map-firm" id="dg-map-firm-<%=firms[i].id%>">\n                <div class="dg-map-firm-bullet"></div>\n                <h2 class="dg-map-firm-title dg-map-result-title">\n                    <a id="<%=firms[i].id%>" class="pseudo link-natural link-text"\n                       href="javascript:void(0)"><%=firms[i].name%></a>\n                </h2>\n                <div id="dg-map-firm-full-<%=firms[i].id%>" class="dg-map-firm-full" style="display:none;"></div>\n            </div>\n            <% } %>',n={firms:t};return DG.Utils.Template.tmpl(i,n)},getFirmContent:function(e,t,i){var n='<% for (var i = 0, count = firms.length; i < count; i++) { %>\n        <div class="dg-map-firm" id="dg-map-firm-<%=firms[i].id%>">\n            <div class="dg-map-firm-bullet"></div>\n            <h2 class="dg-map-firm-title dg-map-result-title">\n                <a id="<%=firms[i].id%>" class="pseudo link-natural link-text"\n                   href="javascript:void(0)"><%=firms[i].name%></a>\n            </h2>\n            <div id="dg-map-firm-full-<%=firms[i].id%>" class="dg-map-firm-full" style="display:none;">\n                <!--Name and address-->\n                <ul class="dg-map-firm-box">\n                    <li class="dg-map-firm-row dg-map-firm-address"><%=firms[i].address_name%>\n                        <% if(firms[i].additional_info && firms[i].additional_info.office) { %>\n                        <span class="note"> &mdash; <%=firms[i].additional_info.office%></span>\n                        <% } %>\n                    </li>\n                </ul>\n                <!--Subcats-->\n                <ul class="dg-map-firm-box dg-map-firm-box-rubric dg-map-firm-subcats">\n                    <% for (var r = 0, rubrics = firms[i].rubrics.length; r < rubrics; r++) { %>\n                        <li><%=firms[i].rubrics[r].name%><%if (r !== rubrics-1) print(",");%></a></li>\n                    <% } %>\n                </ul>\n                <!--Contacts-->\n                <% if (firms[i].contact_groups){ %>\n                <ul class="dg-map-firm-box">\n                    <% for (var c = 0, contact_groups = firms[i].contact_groups.length; c < contact_groups; c++) { %>\n                    <li class="dg-map-firm-row <%if (c > 0) {print("additional-addresses");} else {print("dg-map-firm-contacts");} %>">\n                    <% if (firms[i].contact_groups[c].name){ %>\n                        <div class="dg-map-contact-group"><%=firms[i].contact_groups[c].name%></div>\n                    <% } %>\n                    <ul class="dg-map-contacts-list">\n                        <% for (var cont = 0, contlen = firms[i].contact_groups[c].contacts.length; cont < contlen; cont++) { %>\n                        <li class="dg-map-contacts-row dg-map-row-with-icon dg-map-row-<%=firms[i].contact_groups[c].contacts[cont].type %>">\n                            <span name="dg-map-row-<%=firms[i].contact_groups[c].contacts[cont].type%>-<%=firms[i].id%>"\n                            <% if (firms[i].contact_groups[c].contacts[cont].reg_bc_url && firms[i].contact_groups[c].contacts[cont].type === "email") {%>\n                            register_bc_url=<%=firms[i].contact_groups[c].contacts[cont].reg_bc_url %>\n                            <% } %>\n                            >\n                                <% if (firms[i].contact_groups[c].contacts[cont].type === "website"){ %>                                    <a target="_blank" href="<%=firms[i].contact_groups[c].contacts[cont].value%>">                                        <%=firms[i].contact_groups[c].contacts[cont].text%></a>\n                                <% } else if (firms[i].contact_groups[c].contacts[cont].type === "email"){ %>                                    <a href="mailto:<%=firms[i].contact_groups[c].contacts[cont].value%>">                                        <%=firms[i].contact_groups[c].contacts[cont].text%></a>\n                                <% } else { %>                                    <%=firms[i].contact_groups[c].contacts[cont].value%>\n                                <% } %>                            </span>\n                        </li>\n                        <% } %>\n                    </ul>\n                    </li>\n                    <% } %>\n                </ul>\n                <% } %>\n                <!--Time Shedule-->\n                <ul class="dg-map-firm-box">\n                    <li class="dg-map-firm-row">\n                        <div class="dg-map-firm-schedule">\n                            <% if (schedule[i].aroundTheClock) { %>\n                            <span class="dg-map-firm-schedule-24">24/7</span>\n                            <div class="dg-map-firm-schedule-short dg-map-firm-schedule-short-24"><%=msg.works_around_the_clock%></div>\n                            <% } %>\n                            \n                            <% if (schedule[i].byPeriods || schedule[i].allTable || schedule[i].daily) { %>\n                                <span class="dg-map-firm-schedule-clock<%if (schedule[i].isOpened) { %> opened<% }%>"></span>\n                                <div class="dg-map-firm-schedule-short">\n                                    <% if (schedule[i].byPeriods || schedule[i].allTable) { %>\n                                    <a class="dg-map-work-time" id="dg-map-firm-schedule-<%=firms[i].id%>" href="javascript:void(0)">\n                                        <% if (schedule[i].todayWorkhours.isRestDay) { %>\n                                        <%=self._msgU("today_is_restday")%>\n                                        <% } else { %>\n                                        <%=self._msgU("today")%> <%=schedule[i].todayWorkhours.workFrom%>&ndash;<%=schedule[i].todayWorkhours.workTo%><% if (schedule[i].todayWorkhours.lunchFrom) {%>, <%=msg.lunch%> <%=schedule[i].todayWorkhours.lunchFrom%>&ndash;<%=schedule[i].todayWorkhours.lunchTo%><% } %>\n                                        <% } %>\n                                    </a>\n                                    \n                                    <span id="dg-map-icon-expand-<%=firms[i].id%>" class="link-icon dg-map-icon dg-map-icon-expand"></span>\n                                    <span id="dg-map-icon-collapse-<%=firms[i].id%>" class="dg-map-icon dg-map-icon-collapse" style="display: none;"></span>\n                                    \n                                    <% } %>\n                                    <% if (schedule[i].daily) { %>\n                                    <%=self._msgU("daily")%> <%=schedule[i].todayWorkhours.workFrom%>&ndash;<%=schedule[i].todayWorkhours.workTo%><% if (schedule[i].todayWorkhours.lunchFrom) {%>, <%=msg.lunch%> <%=schedule[i].todayWorkhours.lunchFrom%>&ndash;<%=schedule[i].todayWorkhours.lunchTo%><% } %>\n                                    <% } %>\n                                    \n                                    <span class="dg-map-work-info"><%=schedule[i].msgCrntState + schedule[i].msgHint%></span>\n                                </div>\n                            <% } %>\n                        </div>\n                         \n                        <% if (schedule[i].byPeriods) { %>\n                        <div class="dg-map-weekly-schedule" id="dg-map-weekly-schedule-<%=firms[i].id%>" style="display:none;">\n                            <div class="dg-map-weekly-schedule-inner">\n                            <% for ( var per in schedule[i].byPeriods) {\n                            var period = schedule[i].byPeriods[per]; %>\n                                <div>\n                                <%=period.days%>\n                                <span class="dg-map-label"><%=period.labelText%></span><%if (period.lunchFrom) { %>, <%=self._msg("lunch")%> <span class="dg-map-label"><%=period.lunchFrom%>&ndash;<%=period.lunchTo%></span>\n                                </div>\n                            <% } %>\n                            <% } %>\n                            </div>\n                        </div>\n                        <% } %>\n                        \n                        \n                        <% if (schedule[i].allTable) { %>\n                        <div class="dg-map-weekly-schedule tabled" id="dg-map-weekly-schedule-<%=firms[i].id%>" style="display:none;">\n                        <!--<div class="dg-map-weekly-schedule"> -->\n                            <table class="dg-map-weekly-schedule-table">\n                            <thead>\n                                <tr>\n                                <% var i, period;%>\n                                <th class="dg-map-schedule-icon">&nbsp;</th>\n                                <% for( tab1 in schedule[i].allTable) {\n                                period = schedule[i].allTable[tab1];\n                                clas = (period.firstDay == schedule[i].weekDayStr) ? \' class="current-day"\' : "";%>\n                                <th<%=clas%>><span><%=self._msgU(period.firstDay+"_short")%></span></th>\n                                <% } %>\n                                </tr>\n                                </thead>\n                                <tbody>\n                                    <tr<% if (!schedule[i].anyLunchExists) print(\' class="last-row"\');%>>\n                                    <td class="dg-map-schedule-icon">\n                                        <span class="dg-map-img-wrap dg-map-icon-schedule" title="<%=self._msgU("working_time")%>"></span>\n                                    </td>\n                                    <% for( tab2 in schedule[i].allTable) {\n                                    period = schedule[i].allTable[tab2];\n                                    clas = (period.firstDay == schedule[i].weekDayStr) ? \' class="current-day"\' : "";%>\n                                    <td<%=clas%>>\n                                        <%if (period.workFrom) {%>\n                                        <div><%=period.workFrom%></div>\n                                        <div><%=period.workTo%></div>\n                                        <% } %>\n                                    </td>\n                                    <% } %>\n                                </tr>\n                                <% if (schedule[i].anyLunchExists) { %>\n                                <tr class="dinner-time">\n                                    <td class="dg-map-schedule-icon">\n                                        <span class="dg-map-img-wrap dg-map-icon-lunch" title="<%=self._msgU("lunch")%>"></span>\n                                    </td>\n                                    <% for( tab3 in schedule[i].allTable) {\n                                    period = schedule[i].allTable[tab3];\n                                    clas = (period.firstDay == schedule[i].weekDayStr) ? \' class="current-day"\' : "";%>\n                                    <td<%=clas%>>\n                                        <%if (period.lunchFrom) {%>\n                                        <div><%=period.lunchFrom%></div>\n                                        <div><%=period.lunchTo%></div>\n                                        <% } %>\n                                    </td>\n                                    <% } %>\n                                </tr>\n                                <% } %>\n                            </tbody>\n                        </table>\n                        <!--</div>-->\n                    </div>\n                    <% } %>\n                    \n                    </li>\n                </ul>\n                \n                <!-- Flamp -->\n                <% if (firms[i].reviews && firms[i].reviews.is_reviewable && firms[i].reviews.items){ %>                    <% for (var rr = 0, rrlen = firms[i].reviews.items.length; rr < rrlen; rr++) {%>                        <% if (firms[i].reviews.items[rr].tag === "flamp" && firms[i].reviews.items[rr].is_reviewable) {%>                            <ul class="dg-map-firm-box">\n                                <li class="dg-map-firm-row dg-map-flamp-row">\n                                    <a target="_blank" class="dg-map-firm-link-with-icon" href="<%=self._getFlampUrl(firms[i])%>">\n                                        <span class="link-icon dg-map-icon dg-map-icon-flamp"></span>\n                                        <% if (firms[i].reviews.items[rr].review_count) { %>                                        <span class="dg-map-firm-link-text"><%=self._msg("reviews_on_flamp")%></span>\n                                        <% } else { %>                                        <span class="dg-map-firm-link-text"><%=self._msg("write_review_on_flamp")%></span>\n                                        <% } %>                                    </a>\n                                    <% if (firms[i].reviews.items[rr].review_count) { %>                                    <sup><%=firms[i].reviews.items[rr].review_count%></sup>\n                                    <% } %>                                </li>\n                            </ul>\n                        <% break; } %>                    <% } %>                <% } %>\n                <!-- Company payment methods -->\n                <% var payment = self.getPayment(firms[i]); %>                <% if (payment) { %>                <% var count_pay = 0; %>\n                <ul class="dg-map-firm-box dg-map-firm-payments">\n                    <li class="dg-map-firm-row">\n                        <%for (var t = 0, pays = self.payMethods.length; t < pays; t++) { %>\n                            <% var payM = self.payMethods[t]; %>\n                            <%if (payment["general_payment_type_"+payM]) { %>\n                                <%if (count_pay < 1) { %>\n                                <span class="dg-map-label"><%=self._msgU("payment")%></span>\n                                <%}%>\n                                <span class="dg-map-icon-pay dg-map-icon-pay-<%=payM%>" title="<%=self._msgU("pay_"+payM)%>"></span>\n                                <% count_pay++; %>\n                            <%}%>\n                        <%}%>\n                    </li>\n                </ul>\n                <% } %>\n                \n            </div>\n        </div>\n        <% } %>',r={
firms:t,schedule:i,msg:this.getFirmMsgs(e),self:DG.Geoclicker.Helpers.FirmShedule};return DG.Utils.Template.tmpl(n,r)},getOneFirmContent:function(e,t,i){var n='<% for (var i = 0, count = firms.length; i < count; i++) { %>\n                <!--Name and address-->\n                <ul class="dg-map-firm-box">\n                    <li class="dg-map-firm-row dg-map-firm-address"><%=firms[i].address_name%>\n                        <% if(firms[i].additional_info && firms[i].additional_info.office) { %>\n                        <span class="note"> &mdash; <%=firms[i].additional_info.office%></span>\n                        <% } %>\n                    </li>\n                </ul>\n                <!--Subcats-->\n                <ul class="dg-map-firm-box dg-map-firm-box-rubric dg-map-firm-subcats">\n                    <% for (var r = 0, rubrics = firms[i].rubrics.length; r < rubrics; r++) { %>\n                        <li><%=firms[i].rubrics[r].name%><%if (r !== rubrics-1) print(",");%></a></li>\n                    <% } %>\n                </ul>\n                <!--Contacts-->\n                <% if (firms[i].contact_groups){ %>\n                <ul class="dg-map-firm-box">\n                    <% for (var c = 0, contact_groups = firms[i].contact_groups.length; c < contact_groups; c++) { %>\n                    <li class="dg-map-firm-row <%if (c > 0) {print("additional-addresses");} else {print("dg-map-firm-contacts");} %>">\n                    <% if (firms[i].contact_groups[c].name){ %>\n                        <div class="dg-map-contact-group"><%=firms[i].contact_groups[c].name%></div>\n                    <% } %>\n                    <ul class="dg-map-contacts-list">\n                        <% for (var cont = 0, contlen = firms[i].contact_groups[c].contacts.length; cont < contlen; cont++) { %>\n                        <li class="dg-map-contacts-row dg-map-row-with-icon dg-map-row-<%=firms[i].contact_groups[c].contacts[cont].type %>">\n                            <span name="dg-map-row-<%=firms[i].contact_groups[c].contacts[cont].type%>-<%=firms[i].id%>"\n                            <% if (firms[i].contact_groups[c].contacts[cont].reg_bc_url && firms[i].contact_groups[c].contacts[cont].type === "email") {%>\n                            register_bc_url=<%=firms[i].contact_groups[c].contacts[cont].reg_bc_url %>\n                            <% } %>\n                            >\n                                <% if (firms[i].contact_groups[c].contacts[cont].type === "website"){ %>                                    <a target="_blank" href="<%=firms[i].contact_groups[c].contacts[cont].value%>">                                        <%=firms[i].contact_groups[c].contacts[cont].text%></a>\n                                <% } else if (firms[i].contact_groups[c].contacts[cont].type === "email"){ %>                                    <a href="mailto:<%=firms[i].contact_groups[c].contacts[cont].value%>">                                        <%=firms[i].contact_groups[c].contacts[cont].text%></a>\n                                <% } else { %>                                    <%=firms[i].contact_groups[c].contacts[cont].value%>\n                                <% } %>                            </span>\n                        </li>\n                        <% } %>\n                    </ul>\n                    </li>\n                    <% } %>\n                </ul>\n                <% } %>\n                <!--Time Shedule-->\n                <ul class="dg-map-firm-box">\n                    <li class="dg-map-firm-row">\n                        <div class="dg-map-firm-schedule">\n                            <% if (schedule[i].aroundTheClock) { %>\n                            <span class="dg-map-firm-schedule-24">24/7</span>\n                            <div class="dg-map-firm-schedule-short dg-map-firm-schedule-short-24"><%=msg.works_around_the_clock%></div>\n                            <% } %>\n                            \n                            <% if (schedule[i].byPeriods || schedule[i].allTable || schedule[i].daily) { %>\n                                <span class="dg-map-firm-schedule-clock<%if (schedule[i].isOpened) { %> opened<% }%>"></span>\n                                <div class="dg-map-firm-schedule-short">\n                                    <% if (schedule[i].byPeriods || schedule[i].allTable) { %>\n                                    <a class="dg-map-work-time" id="dg-map-firm-schedule-<%=firms[i].id%>" href="javascript:void(0)">\n                                        <% if (schedule[i].todayWorkhours.isRestDay) { %>\n                                        <%=self._msgU("today_is_restday")%>\n                                        <% } else { %>\n                                        <%=self._msgU("today")%> <%=schedule[i].todayWorkhours.workFrom%>&ndash;<%=schedule[i].todayWorkhours.workTo%><% if (schedule[i].todayWorkhours.lunchFrom) {%>, <%=msg.lunch%> <%=schedule[i].todayWorkhours.lunchFrom%>&ndash;<%=schedule[i].todayWorkhours.lunchTo%><% } %>\n                                        <% } %>\n                                    </a>\n                                    \n                                    <span id="dg-map-icon-expand-<%=firms[i].id%>" class="link-icon dg-map-icon dg-map-icon-expand"></span>\n                                    <span id="dg-map-icon-collapse-<%=firms[i].id%>" class="dg-map-icon dg-map-icon-collapse" style="display: none;"></span>\n                                    \n                                    <% } %>\n                                    <% if (schedule[i].daily) { %>\n                                    <%=self._msgU("daily")%> <%=schedule[i].todayWorkhours.workFrom%>&ndash;<%=schedule[i].todayWorkhours.workTo%><% if (schedule[i].todayWorkhours.lunchFrom) {%>, <%=msg.lunch%> <%=schedule[i].todayWorkhours.lunchFrom%>&ndash;<%=schedule[i].todayWorkhours.lunchTo%><% } %>\n                                    <% } %>\n                                    \n                                    <span class="dg-map-work-info"><%=schedule[i].msgCrntState + schedule[i].msgHint%></span>\n                                </div>\n                            <% } %>\n                        </div>\n                         \n                        <% if (schedule[i].byPeriods) { %>\n                        <div class="dg-map-weekly-schedule" id="dg-map-weekly-schedule-<%=firms[i].id%>" style="display:none;">\n                            <div class="dg-map-weekly-schedule-inner">\n                            <% for ( var per in schedule[i].byPeriods) {\n                            var period = schedule[i].byPeriods[per]; %>\n                                <div>\n                                <%=period.days%>\n                                <span class="dg-map-label"><%=period.labelText%></span><%if (period.lunchFrom) { %>, <%=self._msg("lunch")%> <span class="dg-map-label"><%=period.lunchFrom%>&ndash;<%=period.lunchTo%></span>\n                                </div>\n                            <% } %>\n                            <% } %>\n                            </div>\n                        </div>\n                        <% } %>\n                        \n                        \n                        <% if (schedule[i].allTable) { %>\n                        <div class="dg-map-weekly-schedule tabled" id="dg-map-weekly-schedule-<%=firms[i].id%>" style="display:none;">\n                        <!--<div class="dg-map-weekly-schedule"> -->\n                            <table class="dg-map-weekly-schedule-table">\n                            <thead>\n                                <tr>\n                                <% var i, period;%>\n                                <th class="dg-map-schedule-icon">&nbsp;</th>\n                                <% for( tab1 in schedule[i].allTable) {\n                                period = schedule[i].allTable[tab1];\n                                clas = (period.firstDay == schedule[i].weekDayStr) ? \' class="current-day"\' : "";%>\n                                <th<%=clas%>><span><%=self._msgU(period.firstDay+"_short")%></span></th>\n                                <% } %>\n                                </tr>\n                                </thead>\n                                <tbody>\n                                    <tr<% if (!schedule[i].anyLunchExists) print(\' class="last-row"\');%>>\n                                    <td class="dg-map-schedule-icon">\n                                        <span class="dg-map-img-wrap dg-map-icon-schedule" title="<%=self._msgU("working_time")%>"></span>\n                                    </td>\n                                    <% for( tab2 in schedule[i].allTable) {\n                                    period = schedule[i].allTable[tab2];\n                                    clas = (period.firstDay == schedule[i].weekDayStr) ? \' class="current-day"\' : "";%>\n                                    <td<%=clas%>>\n                                        <%if (period.workFrom) {%>\n                                        <div><%=period.workFrom%></div>\n                                        <div><%=period.workTo%></div>\n                                        <% } %>\n                                    </td>\n                                    <% } %>\n                                </tr>\n                                <% if (schedule[i].anyLunchExists) { %>\n                                <tr class="dinner-time">\n                                    <td class="dg-map-schedule-icon">\n                                        <span class="dg-map-img-wrap dg-map-icon-lunch" title="<%=self._msgU("lunch")%>"></span>\n                                    </td>\n                                    <% for( tab3 in schedule[i].allTable) {\n                                    period = schedule[i].allTable[tab3];\n                                    clas = (period.firstDay == schedule[i].weekDayStr) ? \' class="current-day"\' : "";%>\n                                    <td<%=clas%>>\n                                        <%if (period.lunchFrom) {%>\n                                        <div><%=period.lunchFrom%></div>\n                                        <div><%=period.lunchTo%></div>\n                                        <% } %>\n                                    </td>\n                                    <% } %>\n                                </tr>\n                                <% } %>\n                            </tbody>\n                        </table>\n                        <!--</div>-->\n                    </div>\n                    <% } %>\n                    \n                    </li>\n                </ul>\n                \n                <!-- Flamp -->\n                <% if (firms[i].reviews && firms[i].reviews.is_reviewable && firms[i].reviews.items){ %>                    <% for (var rr = 0, rrlen = firms[i].reviews.items.length; rr < rrlen; rr++) {%>                        <% if (firms[i].reviews.items[rr].tag === "flamp" && firms[i].reviews.items[rr].is_reviewable) {%>                            <ul class="dg-map-firm-box">\n                                <li class="dg-map-firm-row dg-map-flamp-row">\n                                    <a target="_blank" class="dg-map-firm-link-with-icon" href="<%=self._getFlampUrl(firms[i])%>">\n                                        <span class="link-icon dg-map-icon dg-map-icon-flamp"></span>\n                                        <% if (firms[i].reviews.items[rr].review_count) { %>                                        <span class="dg-map-firm-link-text"><%=self._msg("reviews_on_flamp")%></span>\n                                        <% } else { %>                                        <span class="dg-map-firm-link-text"><%=self._msg("write_review_on_flamp")%></span>\n                                        <% } %>                                    </a>\n                                    <% if (firms[i].reviews.items[rr].review_count) { %>                                    <sup><%=firms[i].reviews.items[rr].review_count%></sup>\n                                    <% } %>                                </li>\n                            </ul>\n                        <% break; } %>                    <% } %>                <% } %>\n                <!-- Company payment methods -->\n                <% var payment = self.getPayment(firms[i]); %>                <% if (payment) { %>                <% var count_pay = 0; %>\n                <ul class="dg-map-firm-box dg-map-firm-payments">\n                    <li class="dg-map-firm-row">\n                        <%for (var t = 0, pays = self.payMethods.length; t < pays; t++) { %>\n                            <% var payM = self.payMethods[t]; %>\n                            <%if (payment["general_payment_type_"+payM]) { %>\n                                <%if (count_pay < 1) { %>\n                                <span class="dg-map-label"><%=self._msgU("payment")%></span>\n                                <%}%>\n                                <span class="dg-map-icon-pay dg-map-icon-pay-<%=payM%>" title="<%=self._msgU("pay_"+payM)%>"></span>\n                                <% count_pay++; %>\n                            <%}%>\n                        <%}%>\n                    </li>\n                </ul>\n                <% } %>\n                \n        <% } %>',r={firms:t,schedule:i,msg:this.getFirmMsgs(e),self:DG.Geoclicker.Helpers.FirmShedule};return DG.Utils.Template.tmpl(n,r)},getFirmErrorContent:function(){return'<div class=".dg-map-balloon-content">Извините, что-то пошло не так. <br>Повторите попытку позже.</div>'},getFirmMsgs:function(e){var t=DG.Geoclicker.Helpers.FirmShedule,i={show_all_org_in_rubric:e.locale.t("know more"),know_more:e.locale.t("know more"),works_around_the_clock:e.locale.t("works around the clock"),lunch:e.locale.t("lunch"),daily:e.locale.t("daily"),working_days:e.locale.t("Working days"),rest_day:e.locale.t("rest day"),today_is_restday:e.locale.t("today is restday"),today:e.locale.t("today"),today_msg:e.locale.t("today msg"),working_time:e.locale.t("working time"),is_open:e.locale.t("Open"),is_close:e.locale.t("Close"),is_lunch:e.locale.t("Lunch"),less_then_hour:e.locale.t("less then hour"),to_lunch:e.locale.t("to lunch"),to_close:e.locale.t("to close"),you_could_late:e.locale.t("you could late"),less:e.locale.t("less"),remains:e.locale.t("remains"),minutes:e.locale.t("minutes"),one_hour:e.locale.t("one hour"),hour:e.locale.t("hour"),open_in:e.locale.t("open in"),will_open:e.locale.t("will open"),reviews_on_flamp:e.locale.t("reviews on Flamp"),write_review_on_flamp:e.locale.t("write review on Flamp"),payment:e.locale.t("payment"),pay_americanexpress:e.locale.t("pay americanexpress"),pay_cash:e.locale.t("pay cash"),pay_visa:e.locale.t("pay visa"),pay_mastercard:e.locale.t("pay mastercard"),pay_dinersclub:e.locale.t("pay dinersclub"),pay_goldcrown:e.locale.t("pay goldcrown"),pay_internet:e.locale.t("pay internet"),pay_noncash:e.locale.t("pay noncash")};return i[t.T_MON]=e.locale.t("monday"),i[t.T_MON+"_in"]=e.locale.t("in monday"),i[t.T_MON+"_short"]=e.locale.t("Mo"),i[t.T_TUE]=e.locale.t("tuesday"),i[t.T_TUE+"_in"]=e.locale.t("in tuesday"),i[t.T_TUE+"_short"]=e.locale.t("Tu"),i[t.T_WED]=e.locale.t("wednesday"),i[t.T_WED+"_in"]=e.locale.t("in wednesday"),i[t.T_WED+"_short"]=e.locale.t("We"),i[t.T_THU]=e.locale.t("thursday"),i[t.T_THU+"_in"]=e.locale.t("in thursday"),i[t.T_THU+"_short"]=e.locale.t("Th"),i[t.T_FRI]=e.locale.t("friday"),i[t.T_FRI+"_in"]=e.locale.t("in friday"),i[t.T_FRI+"_short"]=e.locale.t("Fr"),i[t.T_SAT]=e.locale.t("saturday"),i[t.T_SAT+"_in"]=e.locale.t("in saturday"),i[t.T_SAT+"_short"]=e.locale.t("Sa"),i[t.T_SUN]=e.locale.t("sunday"),i[t.T_SUN+"_in"]=e.locale.t("in sunday"),i[t.T_SUN+"_short"]=e.locale.t("Su"),i}},DG.Geometries.Circle=DG.Class(DG.Geometries.Base,{_initializeArguments:{},_olPointVector:null,_olGeoPoint:null,_center:null,_radius:null,initialize:function(e,t,i,n,r){if(!DG.Utils.iNU(t)&&t<=0)throw new RangeError("The radius should be a positive float!");if(!(e instanceof DG.GeoPoint))throw new TypeError("The center is not an instance of DG.GeoPoint");this._checkStyle(i),this._center=e.clone(),this._radius=t,this._generateId(n),this._hintContent="undefined"==typeof r?r:r+""},destroy:function(){this._initializeArguments=null,this._center=null,this._radius=null,this._style=null},getPoints:function(){var e=this.getBounds();return[this._center,e.getLeftTop(),e.getRightTop(),e.getRightBottom(),e.getLeftBottom()]},initializeBeforeAddOnMap:function(){this.setStyle(this._style),this._olGeoPoint=this._toOLGeometryPoint(this._center),this._style.pointRadius=this.calculateRadius()/DG.Utils.getResolutionFromScale(this._dgMap.getScale(),"Meter"),this._olPointVector=new OpenLayers.Feature.Vector(this._olGeoPoint,null,this._style)},clearBeforeRemoveFromMap:function(){DG.Geometries.Base.prototype.clearBeforeRemoveFromMap.apply(this,arguments),this._olGeoPoint=null,this._olPointVector=null},getContainerId:function(){return null!=this.getOlFeature()?this.getOlFeature().geometry.id:null},getOlFeature:function(){return this._olPointVector},getCenter:function(){return this._center},getRadius:function(){return this._radius},setRadius:function(e){if(!DG.Utils.iNU(e)&&e<=0)throw"The radius should be positive float!";this._radius=e,this._style.pointRadius=this.calculateRadius()/DG.Utils.getResolutionFromScale(this._dgMap.getScale(),"Meter"),this._riseUpdateEvent()},getBounds:function(){var e=this._center,t=this.calculateRadius();return e=e.toMercator(),new DG.Bounds(new DG.GeoPoint(e.lon-t,e.lat-t,"EPSG:900913"),new DG.GeoPoint(e.lon+t,e.lat+t,"EPSG:900913"))},hide:function(){this._isHidden=!0,this._olPointVector.style.display="none",this._riseUpdateEvent()},show:function(){this._isHidden=!1,this._olPointVector.style.display="",this._riseUpdateEvent()},setStyle:function(e){if(!e)throw new TypeError('Parameter "style" should be an instance of "DG.Style.Geometry"');this._checkStyle(e),null!=this._olPointVector&&(this._olPointVector.style=this._style),this._riseUpdateEvent()},onMapUpdate:function(){this._style.pointRadius=this.calculateRadius()/DG.Utils.getResolutionFromScale(this._dgMap.getScale(),"Meter"),this._riseUpdateEvent()},calculateRadius:function(){var e=6371,t=this._radius/1e3,i=t/e,n=Math.tan(i/2),r=n*n/(1-n*n),o=this.getCenter().toLonLat().lat*Math.PI/180,s=this.getCenter().toLonLat().lon*Math.PI/180,a=2*Math.asin(Math.sqrt(r/(Math.cos(o)*Math.cos(o))))+s,l=180/Math.PI*a,h=this.getCenter().toMercator().lon,c=this.getCenter().toLonLat().lat,u=new DG.GeoPoint(l,c),d=u.toMercator().lon,p=d-h,g=p;return g},CLASS_NAME:"DG.Geometries.Circle"}),DG.Geometries.Multipoint=DG.Class(DG.Geometries.Base,{_geoPoints:[],_points:[],_dgMap:null,initialize:function(e,t,i,n){this._validateInitParams(e,t,i),this._generateId(i),this._geoPoints=e,this._points=[];for(var r=0;r<e.length;r++){var o=new DG.Geometries.Point(e[r],t);o.disableEvents(),this._points.push(o)}this._hintContent="undefined"==typeof n?n:n+""},destroy:function(){for(var e=0;e<this._points.length;e++)this._points[e].destroy();this._points=[],this._geoPoints=[]},initializeBeforeAddOnMap:function(){for(var e=0;e<this._points.length;e++)this._points[e].initializeBeforeAddOnMap()},clearBeforeRemoveFromMap:function(){for(var e=0;e<this._points.length;e++)this._points[e].clearBeforeRemoveFromMap()},getBounds:function(){for(var e=[],t=0;t<this._points.length;t++)e.push(this._points[t].getPosition());return new DG.CollectionBounds(e)},getNumPoints:function(){return this._points.length},getGeoPoints:function(){return this._geoPoints},getPoints:function(){for(var e=[],t=0;t<this._points.length;t++)e.push(this._points[t].getPosition());return e},hide:function(){this._isHidden=!0;for(var e=0;e<this._points.length;e++)this._points[e].hide();this._riseUpdateEvent()},show:function(){this._isHidden=!1;for(var e=0;e<this._points.length;e++)this._points[e].show();this._riseUpdateEvent()},getStyle:function(){return this._points[0].getStyle()},setStyle:function(e){for(var t=0;t<this._points.length;t++)this._points[t].setStyle(e);this._riseUpdateEvent()},getOlFeature:function(){for(var e=[],t=0;t<this._points.length;t++)null!==this._points[t].getOlFeature()&&e.push(this._points[t].getOlFeature());return e.length>0?e:null},setDgMap:function(e){for(var t=0;t<this._points.length;t++)this._points[t].setDgMap(e);this._dgMap=e},getContainerId:function(){for(var e=[],t=0;t<this._points.length;t++)e.push(this._points[t].getContainerId());return e},_validateInitParams:function(e,t,i){if("[object Array]"!=Object.prototype.toString.call(e)||e.length<1)throw new TypeError('Parameter "geoPoints" is required and should be not empty array');if(t&&!(t instanceof DG.Style.Geometry))throw new TypeError('Parameter "style" should be an instance of "DG.Style.Geometry"');for(var n=0;n<e.length;n++)if(!(e[n]instanceof DG.GeoPoint))throw new TypeError('Each element of the "geoPoints" array should be a DG.GeoPoint instance');if("undefined"!=typeof i&&"[object String]"!==Object.prototype.toString.call(i))throw new TypeError('Parameter "name" should be a string')},CLASS_NAME:"DG.Geometries.Multipoint"}),DG.Geometries.Multipolygon=DG.Class(DG.Geometries.Base,{_pointSets:[],_polygons:[],_dgMap:null,initialize:function(e,t,i,n){this._validateInitParams(e,t,i),this._generateId(i),this._pointSets=e,this._polygons=[];for(var r=0;r<e.length;r++){var o=new DG.Geometries.Polygon(e[r],t);o.disableEvents(),this._polygons.push(o)}this._hintContent="undefined"==typeof n?n:n+""},destroy:function(){for(var e=0;e<this._polygons.length;e++)this._polygons[e].destroy();this._polygons=[],this._pointSets=[]},initializeBeforeAddOnMap:function(){for(var e=0;e<this._polygons.length;e++)this._polygons[e].initializeBeforeAddOnMap()},clearBeforeRemoveFromMap:function(){for(var e=0;e<this._polygons.length;e++)this._polygons[e].clearBeforeRemoveFromMap()},getBounds:function(){for(var e={top:-90,right:-180,bottom:90,left:180},t=null,i=null,n=0;n<this._polygons.length;n++)t=this._polygons[n].getBounds(),t.getTop()>e.top&&(e.top=t.getTop()),t.getRight()>e.right&&(e.right=t.getRight()),t.getBottom()<e.bottom&&(e.bottom=t.getBottom()),t.getLeft()<e.left&&(e.left=t.getLeft());return i=new DG.Bounds(new DG.GeoPoint(e.left,e.bottom),new DG.GeoPoint(e.right,e.top))},getNumPolygons:function(){return this._polygons.length},getPointSets:function(){return this._pointSets},getPoints:function(){for(var e=[],t=0;t<this._polygons.length;t++)e=e.concat(this._polygons[t].getPoints());return e},hide:function(){this._isHidden=!0;for(var e=0;e<this._polygons.length;e++)this._polygons[e].hide();this._riseUpdateEvent()},show:function(){this._isHidden=!1;for(var e=0;e<this._polygons.length;e++)this._polygons[e].show();this._riseUpdateEvent()},setStyle:function(e){for(var t=0;t<this._polygons.length;t++)this._polygons[t].setStyle(e);this._riseUpdateEvent()},getStyle:function(){return 0!=this._polygons.length?this._polygons[0].getStyle():null},getOlFeature:function(){for(var e=[],t=0;t<this._polygons.length;t++)e.push(this._polygons[t].getOlFeature());return e},setDgMap:function(e){for(var t=0;t<this._polygons.length;t++)this._polygons[t].setDgMap(e);this._dgMap=e},getContainerId:function(){for(var e=[],t=0;t<this._polygons.length;t++)e.push(this._polygons[t].getContainerId());return e},_validateInitParams:function(e,t,i){if("[object Array]"!==Object.prototype.toString.call(e)||e.length<1)throw new TypeError('Parameter "pointSets" is required and should be not empty array');if(t&&!(t instanceof DG.Style.Geometry))throw new TypeError('Parameter "style" should be an instance of "DG.Style.Geometry"');for(var n=0;n<e.length;n++)if("[object Array]"!==Object.prototype.toString.call(e[n])||e[n].length<3)throw new TypeError('Each element of the "pointSets" should be an array and the minimun number of DG.GeoPoint instances in these arrays should be 3 or more');if("undefined"!=typeof i&&"[object String]"!==Object.prototype.toString.call(i))throw new TypeError('Parameter "name" should be a string')},CLASS_NAME:"DG.Geometries.Multipolygon"}),DG.Geometries.Multipolyline=DG.Class(DG.Geometries.Base,{_pointSets:[],_polylines:[],_dgMap:null,initialize:function(e,t,i,n){this._validateInitParams(e,t,i),this._generateId(i),this._pointSets=e,this._polylines=[];for(var r=0;r<e.length;r++){var o=new DG.Geometries.Polyline(e[r],t);o.disableEvents(),this._polylines.push(o)}this._hintContent="undefined"==typeof n?n:n+""},destroy:function(){for(var e=0;e<this._polylines.length;e++)this._polylines[e].destroy();this._polylines=[],this._pointSets=[]},initializeBeforeAddOnMap:function(){for(var e=0;e<this._polylines.length;e++)this._polylines[e].initializeBeforeAddOnMap()},clearBeforeRemoveFromMap:function(){for(var e=0;e<this._polylines.length;e++)this._polylines[e].clearBeforeRemoveFromMap()},getBounds:function(){for(var e={top:-90,right:-180,bottom:90,left:180},t=null,i=null,n=0;n<this._polylines.length;n++)t=this._polylines[n].getBounds(),t.getTop()>e.top&&(e.top=t.getTop()),t.getRight()>e.right&&(e.right=t.getRight()),t.getBottom()<e.bottom&&(e.bottom=t.getBottom()),t.getLeft()<e.left&&(e.left=t.getLeft());return i=new DG.Bounds(new DG.GeoPoint(e.left,e.bottom),new DG.GeoPoint(e.right,e.top))},getNumPolylines:function(){return this._polylines.length},getPointSets:function(){return this._pointSets},getPoints:function(){for(var e=[],t=0;t<this._polylines.length;t++)e=e.concat(this._polylines[t].getPoints());return e},hide:function(){this._isHidden=!0;for(var e=0;e<this._polylines.length;e++)this._polylines[e].hide();this._riseUpdateEvent()},show:function(){this._isHidden=!1;for(var e=0;e<this._polylines.length;e++)this._polylines[e].show();this._riseUpdateEvent()},setStyle:function(e){for(var t=0;t<this._polylines.length;t++)this._polylines[t].setStyle(e);this._riseUpdateEvent()},getStyle:function(){return 0!=this._polylines.length?this._polylines[0].getStyle():null},getOlFeature:function(){for(var e=[],t=0;t<this._polylines.length;t++)e.push(this._polylines[t].getOlFeature());return e},setDgMap:function(e){for(var t=0;t<this._polylines.length;t++)this._polylines[t].setDgMap(e);this._dgMap=e},getContainerId:function(){for(var e=[],t=0;t<this._polylines.length;t++)e.push(this._polylines[t].getContainerId());return e},_validateInitParams:function(e,t,i){if("[object Array]"!==Object.prototype.toString.call(e)||e.length<1)throw new TypeError('Parameter "pointSets" is required and should be not empty array');if(t&&!(t instanceof DG.Style.Geometry))throw new TypeError('Parameter "style" should be an instance of "DG.Style.Geometry"');for(var n=0;n<e.length;n++)if("[object Array]"!==Object.prototype.toString.call(e[n])||e[n].length<2)throw new TypeError('Each element of the "pointSets" should be an array and the minimun number of DG.GeoPoint instances in these arrays should be 2 or more');if("undefined"!=typeof i&&"[object String]"!==Object.prototype.toString.call(i))throw new TypeError('Parameter "name" should be a string')},CLASS_NAME:"DG.Geometries.Multipolyline"}),DG.Geometries.Point=DG.Class(DG.Geometries.Base,{_olFeatureVector:null,_olGeometryPoint:null,_position:null,_style:null,initialize:function(e,t,i,n){if(!(e instanceof DG.GeoPoint))throw TypeError('Parameter "position" is required and should be DG.GeoPoint');if("undefined"!=typeof i&&"[object String]"!==Object.prototype.toString.call(i))throw new TypeError('Parameter "name" should be a string');this._checkStyle(t),this._position=e.clone(),this._generateId(i),this._hintContent="undefined"==typeof n?n:n+""},destroy:function(){this._position=null,this._style=null},initializeBeforeAddOnMap:function(){this._olGeometryPoint=this._toOLGeometryPoint(this._position),this._olFeatureVector=new OpenLayers.Feature.Vector(this._olGeometryPoint,null,this._style)},clearBeforeRemoveFromMap:function(){DG.Geometries.Base.prototype.clearBeforeRemoveFromMap.apply(this,arguments),this._olGeometryPoint=null,this._olFeatureVector=null},getOlFeature:function(){return this._olFeatureVector},getPosition:function(){return this._position.toLonLat().clone()},getPoints:function(){return[this._position]},setPosition:function(e){if(!(e instanceof DG.GeoPoint))throw TypeError('Parameter "position" is required and should be DG.GeoPoint');this._position=e,this._olGeometryPoint=this._toOLGeometryPoint(this._position),this._olFeatureVector.move(this._dgMap.converter.coordinatesToMapPixels(this._position)),this._riseUpdateEvent()},getStyle:function(){return this._style},setStyle:function(e){if(!e)throw new TypeError('Parameter "style" should be an instance of "DG.Style.Geometry"');this._checkStyle(e),null!=this._olFeatureVector&&(this._olFeatureVector.style=this._style),this._riseUpdateEvent()},hide:function(){this._isHidden=!0,this._olFeatureVector.style.display="none",this._riseUpdateEvent()},show:function(){this._isHidden=!1,this._olFeatureVector.style.display="",this._riseUpdateEvent()},getContainerId:function(){return null!=this.getOlFeature()?this.getOlFeature().geometry.id:null},CLASS_NAME:"DG.Geometries.Point"}),DG.Geometries.Polygon=DG.Class(DG.Geometries.Base,{_olPolygonVector:null,_olGeoPoints:[],_points:[],initialize:function(e,t,i,n){if("[object Array]"!==Object.prototype.toString.call(e)||e.length<1)throw new TypeError('Parameter "points" is required and should be not empty array');if(e.length<3)throw"The minimun number of points in polygone is 3";this._checkStyle(t),this._points=e,this._generateId(i),this._hintContent="undefined"==typeof n?n:n+""},destroy:function(){this._points=null,this._style=null},initializeBeforeAddOnMap:function(){this._olGeoPoints=this._toOLGeometryPoints(this._points);var e=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(this._olGeoPoints)]);this._olPolygonVector=new OpenLayers.Feature.Vector(e,null,this._style)},clearBeforeRemoveFromMap:function(){DG.Geometries.Base.prototype.clearBeforeRemoveFromMap.apply(this,arguments),this._olGeoPoints=[],this._olPolygonVector=null},getOlFeature:function(){return this._olPolygonVector},getBounds:function(){if(0==this._points.length)throw"No points in polygone";return new DG.CollectionBounds(this._points)},getNumPoints:function(){return this._points.length},getPoint:function(e){if(parseInt(e)!==e)throw"An index should be unsigned integer!";return this._points[e].clone()},getPoints:function(){var e=this._points.slice(0);return e},removePoint:function(e){if(!DG.Utils.iNU(e)&&(parseInt(e)!==e||e<0))throw"An index should be unsigned integer!";if(!DG.Utils.iNU(e)&&e>=this._points.length)throw"The index is out of range!";if(this._points.length<4)throw"The polygon should contain 3 points at least!";return!!this._removePoint(e)&&(this._riseUpdateEvent(),!0)},addPoint:function(e,t){if(!DG.Utils.iNU(t)&&(parseInt(t)!==t||t<0))throw"An index should be unsigned integer!";return!!this._addPoint(e,t)&&(this._riseUpdateEvent(),!0)},splicePoints:function(e,t,n){if(!DG.Utils.iNU(e)&&(parseInt(e)!==e||e<0))throw"An index should be unsigned integer!";if(!DG.Utils.iNU(e)&&e>=this._points.length)throw"The index is out of range!";if(this._points.length-e<t)throw"The number of points to remove is out of range!";if(this._points.length-t<3)throw"The polygon should contain 3 points at least!";for(i=e;i<e+t;i++)this._removePoint(i);if(!DG.Utils.iNU(n))for(i=0,len=n.length;i<len;i++){var r=e+i;this._addPoint(n[i],r)}this._riseUpdateEvent()},_removePoint:function(e){return!(e>this._points.length-1||e<0)&&(DG.Utils.iNU(this._olPolygonVector)||(this._olPolygonVector.geometry.components[0].removeComponent(this._olGeoPoints[e]),this._olGeoPoints.splice(e,1)),this._points.splice(e,1),!0)},_addPoint:function(e,t){var i,n;if(!(e instanceof DG.GeoPoint))throw"The point is not an instance of DG.GeoPoint";return DG.Utils.iNU(this._olPolygonVector)?(DG.Utils.iNU(t)||t>this._points.length?this._points.push(e):this._points=DG.Utils.pushIntoSpecifiedPosition(this._points,e,t),
!0):(i=this._toOLGeometryPoint(e),n=this._olPolygonVector.geometry.components[0].addComponent(i,DG.Utils.iNU(t)?null:t),n&&(DG.Utils.iNU(t)||t>this._points.length?(this._olGeoPoints.push(i),this._points.push(e)):(this._points=DG.Utils.pushIntoSpecifiedPosition(this._points,e,t),this._olGeoPoints=DG.Utils.pushIntoSpecifiedPosition(this._olGeoPoints,i,t))),n)},hide:function(){this._isHidden=!0,this._olPolygonVector.style.display="none",this._riseUpdateEvent()},show:function(){this._isHidden=!1,this._olPolygonVector.style.display="",this._riseUpdateEvent()},setStyle:function(e){if(!e)throw new TypeError('Parameter "style" should be an instance of "DG.Style.Geometry"');this._checkStyle(e),null!=this._olPolygonVector&&(this._olPolygonVector.style=this._style),this._riseUpdateEvent()},getContainerId:function(){return null!=this.getOlFeature()?this.getOlFeature().geometry.id:null},CLASS_NAME:"DG.Geometries.Polygon"}),DG.Geometries.Polyline=DG.Class(DG.Geometries.Base,{_olPolylineVector:null,_olGeoPoints:[],_points:[],initialize:function(e,t,i,n){if("[object Array]"!==Object.prototype.toString.call(e)||e.length<1)throw new TypeError('Parameter "points" is required and should be not empty array');if(e.length<2)throw"The minimun number of points in polyline is 2";this._checkStyle(t),this._points=e,this._generateId(i),this._hintContent="undefined"==typeof n?n:n+""},destroy:function(){this._points=null,this._style=null},initializeBeforeAddOnMap:function(){this._olGeoPoints=this._toOLGeometryPoints(this._points);var e=new OpenLayers.Geometry.LineString(this._olGeoPoints);this._olPolylineVector=new OpenLayers.Feature.Vector(e,null,this._style)},clearBeforeRemoveFromMap:function(){DG.Geometries.Base.prototype.clearBeforeRemoveFromMap.apply(this,arguments),this._olGeoPoints=null,this._olPolygonVector=null},getOlFeature:function(){return this._olPolylineVector},getBounds:function(){return new DG.CollectionBounds(this._points)},getNumPoints:function(){return this._points.length},getPoint:function(e){if(parseInt(e)!==e)throw"An index should be unsigned integer!";return this._points[e].clone()},getPoints:function(){var e=this._points.slice(0);return e},removePoint:function(e){if(!DG.Utils.iNU(e)&&(parseInt(e)!==e||e<0))throw"An index should be unsigned integer!";if(!DG.Utils.iNU(e)&&e>=this._points.length)throw"The index is out of range!";if(this._points.length<3)throw"The polyline should contain 2 points at least!";return!!this._removePoint(e)&&(this._riseUpdateEvent(),!0)},addPoint:function(e,t){if(!DG.Utils.iNU(t)&&(parseInt(t)!==t||t<0))throw"An index should be unsigned integer!";return!!this._addPoint(e,t)&&(this._riseUpdateEvent(),!0)},splicePoints:function(e,t,i){if(!DG.Utils.iNU(e)&&(parseInt(e)!==e||e<0))throw"An index should be unsigned integer!";if(!DG.Utils.iNU(e)&&e>=this._points.length)throw"The index is out of range!";if(this._points.length-e<t)throw"The number of points to remove is out of range!";if(this._points.length-t<2)throw"The polyline should contain 2 points at least!";for(var n=e;n<e+t;n++)this._removePoint(n);if(!DG.Utils.iNU(i))if(null==i.length)this._addPoint(i,e);else for(var n=0,r=i.length;n<r;n++){var o=e+n;this._addPoint(i[n],o)}this._riseUpdateEvent()},_removePoint:function(e){return!(e>this._points.length-1||e<0)&&(DG.Utils.iNU(this._olPolylineVector)||(this._olPolylineVector.geometry.removeComponent(this._olGeoPoints[e]),this._olGeoPoints.splice(e,1)),this._points.splice(e,1),!0)},_addPoint:function(e,t){if(!(e instanceof DG.GeoPoint))throw"The point is not an instance of DG.GeoPoint";if(DG.Utils.iNU(this._olPolylineVector))return DG.Utils.iNU(t)||t>this._points.length?this._points.push(e):this._points=DG.Utils.pushIntoSpecifiedPosition(this._points,e,t),!0;var i,n;return i=this._toOLGeometryPoint(e),n=this._olPolylineVector.geometry.addComponent(i,DG.Utils.iNU(t)?null:t),n&&(DG.Utils.iNU(t)||t>this._points.length?(this._olGeoPoints.push(i),this._points.push(e)):(this._points=DG.Utils.pushIntoSpecifiedPosition(this._points,e,t),this._olGeoPoints=DG.Utils.pushIntoSpecifiedPosition(this._olGeoPoints,i,t))),n},hide:function(){this._isHidden=!0,this._olPolylineVector.style.display="none",this._riseUpdateEvent()},show:function(){this._isHidden=!1,this._olPolylineVector.style.display="",this._riseUpdateEvent()},setStyle:function(e){if(!e)throw new TypeError('Parameter "style" should be an instance of "DG.Style.Geometry"');this._checkStyle(e),null!=this._olPolylineVector&&(this._olPolylineVector.style=this._style),this._riseUpdateEvent()},getContainerId:function(){return null!=this.getOlFeature()&&null!=this.getOlFeature().geometry?this.getOlFeature().geometry.id:null},CLASS_NAME:"DG.Geometries.Polyline"}),DG.Handlers.ContextMenu=DG.Class(DG.Handlers.Mouse,{mainMethod:function(e){return!!this.isMapEvent()},CLASS_NAME:"DG.Handlers.ContextMenu"}),DG.Handlers.DgLayerProcess=DG.Class(DG.Handlers.Base,{mainMethod:function(e){return this._dgMap.fireEventsInLayer(e,this.eventType)},CLASS_NAME:"DG.Handlers.DgLayerProcess"}),DG.Handlers.DgMapDrag=DG.Class(DG.Handlers.Base,{mainMethod:function(e){var t=e.delta[0],i=e.delta[1],n=this._dgMap.getContainerSize(),r=new DG.Point(n.width/2+t,n.height/2+i),o=this._dgMap.getGeoPointFromPixel(r,null,!0);this._dgMap.mildSetCenter(o);var s=this._dgMap.getMapContainer();return s.style.cursor="move",!0},CLASS_NAME:"DG.Handlers.DgMapDrag"}),DG.Handlers.DgMapResize=DG.Class(DG.Handlers.Base,{mainMethod:function(e){},CLASS_NAME:"DG.Handlers.DgMapResize"}),DG.Handlers.DgMapZoom=DG.Class(DG.Handlers.Base,{mainMethod:function(e){if(!DG.Utils.iNU(DG.EventManager.mouseWheelTime)){var t=DG.EventManager.mouseWheelTime,i=(new Date).getTime(),n=i-t;if(n<120)return!1}var r=this._getDelta(e),o=e.point,s=this._dgMap.getZoom(),a=this._dgMap.getZoom()+r;if(a=Math.max(a,this._dgMap.getZoomRestrictions().min),a=Math.min(a,this._dgMap.getZoomRestrictions().max),a===s)return!1;var l=this._dgMap.getContainerSize(),h=l.width/2-o.x,c=o.y-l.height/2,u=this._dgMap.getResolutionForZoom(a),d=this._dgMap.getGeoPointFromPixel(o.x,o.y,!0),p=new DG.GeoPoint(d.lon+h*u,d.lat+c*u,DG.GeoPoint.EPSG_900913);return this._dgMap.setCenter(p,a),DG.EventManager.mouseWheelTime=(new Date).getTime(),!1},_getDelta:function(e){var t=e.getDelta();return t=t?Math.round(t):1,e.isLeftButton()?t:e.isRightButton()?-t:t},CLASS_NAME:"DG.Handlers.DgMapZoom"}),DG.Handlers.DoubleClick=DG.Class(DG.Handlers.Mouse,{mainMethod:function(e){if(DG.EventManager.touchable)return!1;if(this.isMapEvent()){var t=new DG.Events.Mouse(this._dgMap,this.event,this.getPosition());if(t.isRightButton())return!1;DG.EventManager.firstMouseClick=!1;var i=e.target||e.srcElement;return this.raiseEvent(i,t,"DgDoubleClick"),!0}return!1},CLASS_NAME:"DG.Handlers.DoubleClick"}),DG.Handlers.GeometriesChange=DG.Class(DG.Handlers.Mouse,{mainMethod:function(e){for(var t,i,n=this._dgMap.geometries.getAllGroupsNames(),r=e.getGeometry();t=n.pop();)i=this._dgMap.geometries.getGroup(t),i.contains(r)&&i.redraw()},CLASS_NAME:"DG.Handlers.GeometriesChange"}),DG.Handlers.GestureChange=DG.Class(DG.Handlers.Touch,{mainMethod:function(e){return e.preventDefault(),!1},CLASS_NAME:"DG.Handlers.GestureChange"}),DG.Handlers.GestureEnd=DG.Class(DG.Handlers.Touch,{mainMethod:function(e){return e.preventDefault(),!1},CLASS_NAME:"DG.Handlers.GestureEnd"}),DG.Handlers.GestureStart=DG.Class(DG.Handlers.Touch,{mainMethod:function(e){return e.preventDefault(),!1},CLASS_NAME:"DG.Handlers.GestureStart"}),DG.Handlers.KeyDown=DG.Class(DG.Handlers.Base,{mainMethod:function(){var e=new DG.Events.Key(this._dgMap,this.event);return this.raiseEvent(this._dgMap.getContainer(),e,"DgKeyDown"),!1},CLASS_NAME:"DG.Handlers.KeyDown"}),DG.Handlers.KeyUp=DG.Class(DG.Handlers.Base,{mainMethod:function(){var e=new DG.Events.Key(this._dgMap,this.event);return this.raiseEvent(this._dgMap.getContainer(),e,"DgKeyUp"),!1},CLASS_NAME:"DG.Handlers.KeyUp"}),DG.Handlers.MouseClick=DG.Class(DG.Handlers.Mouse,{mainMethod:function(e){return!!DG.EventManager.firstMouseClick&&(DG.EventManager.firstMouseClick=!1,this.raiseEvent(e.child,e.clickEvent,e.type),!0)},CLASS_NAME:"DG.Handlers.MouseClick"}),DG.Handlers.MouseDown=DG.Class(DG.Handlers.Mouse,{mainMethod:function(e){if(DG.EventManager.touchable)return!1;var t=e.target||e.srcElement;if(this.isMapEvent()){var i=new DG.Events.Mouse(this._dgMap,this.event,this.getPosition());if(i.isLeftButton())DG.EventManager.mouseDragButton="left",this.raiseEvent(t,i,"DgMouseDown");else{if(!i.isRightButton())return DG.EventManager.mouseDragButton=null,!1;DG.EventManager.mouseDragButton="right",this.raiseEvent(t,i,"DgMouseRightDown"),this._flushRightButtonTimer()}return DG.EventManager.mouseDragPoint=this.getPosition(),DG.EventManager.mouseDragStartPoint=this.getPosition(),DG.EventManager.mouseDragMapId=this._dgMap.getContainerId(),DG.EventManager.mouseDownAndMove&&!DG.EventManager.touchable&&(DG.EventManager.mouseDownAndMove=!1),!0}return!1},_flushRightButtonTimer:function(){if(!DG.Utils.iNU(DG.EventManager.mouseRightClickTime)){var e=DG.EventManager.mouseRightClickTime,t=DG.EventManager.mouseRightClickPos,i=new Date,n=this.getPosition(),r=i.getTime()-e.getTime(),o=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y);(r>300||o>100)&&(DG.EventManager.mouseRightClickTime=null,DG.EventManager.mouseRightClickPos=null)}},CLASS_NAME:"DG.Handlers.MouseDown"}),DG.Handlers.MouseMove=DG.Class(DG.Handlers.Mouse,{mainMethod:function(e){if(DG.EventManager.touchable)return!1;var t,i=this.getPosition(),n=e.target||e.srcElement;if(this._dgMap.dragingOutsideMap)t=!0;else if(this.isMapEvent())t=!0;else if(t=!1,!DG.Utils.iNU(DG.EventManager.mouseDragPoint)&&DG.EventManager.mouseDragMapId==this._dgMap.getContainerId()){if(!DG.Utils.iNU(DG.EventManager.mouseDragObject)){var r=new DG.Events.Mouse(this._dgMap,this.event,this.getPosition());this.fireEvent(DG.EventManager.mouseDragObject,r,"DgDragStop")}DG.EventManager.mouseDragPoint=null,DG.EventManager.mouseDragStartPoint=null,DG.EventManager.mouseDragObject=null,DG.EventManager.mouseDragButton=null,DG.EventManager.mouseDragMapId=null;var o=this._dgMap.getMapContainer();o.style.cursor=""}if(t){var s=DG.EventManager.mouseDragPoint;if(DG.Utils.iNU(s)||DG.EventManager.mouseDragMapId!=this._dgMap.getContainerId()){if(this.isMapEvent()){var a=new DG.Events.Mouse(this._dgMap,this.event,this.getPosition());this.raiseEvent(n,a,"DgMouseMove")}}else{var l=s.x-i.x,h=s.y-i.y;if(l*l+h*h==0)return!1;var c="DgDrag";"right"==DG.EventManager.mouseDragButton&&(c="DgRightDrag"),DG.EventManager.mouseDragPoint=i,DG.EventManager.mouseDownAndMove=!0;var u=new DG.Events.Drag(this.event,DG.EventManager.mouseDragStartPoint,new DG.Point(s.x,s.y),[l,h],this._dgMap);if(DG.EventManager.mouseDragObject)return this.fireEvent(DG.EventManager.mouseDragObject,u,c),!0;if(this.isMapEvent())return this.raiseEvent(n,u,c),!0}return!1}},CLASS_NAME:"DG.Handlers.MouseMove"}),DG.Handlers.MouseOut=DG.Class(DG.Handlers.Mouse,{mainMethod:function(e){if(DG.EventManager.touchable)return!1;if(this.isMapEvent()){var t=e.target||e.srcElement,i=new DG.Events.Mouse(this._dgMap,this.event,this.getPosition());this.raiseEvent(t,i,"DgMouseOut")}return!1},CLASS_NAME:"DG.Handlers.MouseOut"}),DG.Handlers.MouseOver=DG.Class(DG.Handlers.Mouse,{mainMethod:function(e){if(DG.EventManager.touchable)return!1;if(this.isMapEvent()){var t=e.target||e.srcElement,i=new DG.Events.Mouse(this._dgMap,this.event,this.getPosition());this.raiseEvent(t,i,"DgMouseOver"),window.TilesLoadActivated||(window.TilesLoadActivated=!0,this._dgMap._trackGroupGeomLoad())}return!1},CLASS_NAME:"DG.Handlers.MouseOver"}),DG.Handlers.MousePreClick=DG.Class(DG.Handlers.Mouse,{mainMethod:function(e){if(DG.EventManager.touchable){var t=e.target||e.srcElement,i=new DG.Events.Mouse(this._dgMap,this.event,this.getPosition());return this.fireEvent(t,i,"DgFastClick"),!1}var n=this.isMapEvent();if(!n&&!this.isInsideIgnored()||DG.EventManager.mouseDownAndMove)DG.EventManager.mouseDownAndMove===!0&&(DG.EventManager.mouseDownAndMove=!1);else{var t=e.target||e.srcElement,i=new DG.Events.Mouse(this._dgMap,this.event,this.getPosition());if(n){if(i.isLeftButton()&&(this.raiseEvent(t,i,"DgFastClick"),!DG.EventManager.firstMouseClick&&(DG.EventManager.firstMouseClick=!0,n))){var r={child:t,clickEvent:i,type:"DgClick"};return this.fireEvent(this._dgMap.getMapContainer(),r,"DgPreClick"),!0}}else this.fireEvent(t,i,"DgFastClick")}return!1},CLASS_NAME:"DG.Handlers.MousePreClick"}),DG.Handlers.MouseUp=DG.Class(DG.Handlers.Mouse,{mainMethod:function(e){if(DG.EventManager.touchable)return!1;var t=new DG.Events.Mouse(this._dgMap,this.event,this.getPosition()),i=e.target||e.srcElement;if(!DG.Utils.iNU(DG.EventManager.mouseDragPoint)&&DG.EventManager.mouseDragMapId==this._dgMap.getContainerId()){DG.Utils.iNU(DG.EventManager.mouseDragObject)||this.fireEvent(DG.EventManager.mouseDragObject,t,"DgDragStop"),DG.EventManager.mouseDragPoint=null,DG.EventManager.mouseDragStartPoint=null,DG.EventManager.mouseDragObject=null,DG.EventManager.mouseDragButton=null,DG.EventManager.mouseDragMapId=null;var n=this._dgMap.getMapContainer();n.style.cursor=""}if(t.isRightButton())if(this.isMapEvent())if(this.raiseEvent(i,t,"DgMouseRightUp"),DG.Utils.iNU(DG.EventManager.mouseRightClickTime))DG.EventManager.mouseRightClickTime=new Date,DG.EventManager.mouseRightClickPos=this.getPosition(),this.target=i,this.mEvent=t,DG.EventManager.rightClickTimerId=window.setTimeout(DG.Utils.bind(this.rightClickEvent,this),300);else{var r=DG.EventManager.mouseRightClickTime,o=DG.EventManager.mouseRightClickPos;DG.EventManager.mouseRightClickTime=null,DG.EventManager.mouseRightClickPos=null;var s=new Date,a=this.getPosition(),l=s.getTime()-r.getTime(),h=(a.x-o.x)*(a.x-o.x)+(a.y-o.y)*(a.y-o.y);l<300&&h<100&&(this.raiseEvent(i,t,"DgDoubleRightClick"),window.clearTimeout(DG.EventManager.rightClickTimerId),DG.EventManager.rightClickTimerId=null)}else this.raiseEvent(this._dgMap.getContainer(),t,"DgMouseRightUp");else this.fireEvent(i.id,t,"DgMouseUp");return!1},rightClickEvent:function(){this.raiseEvent(this.target,this.mEvent,"DgRightClick")},CLASS_NAME:"DG.Handlers.MouseUp"}),DG.Handlers.MouseWheel=DG.Class(DG.Handlers.Mouse,{mainMethod:function(e){if(DG.EventManager.touchable)return!1;if(this.isMapEvent()){var t=e.target||e.srcElement,i=new DG.Events.Mouse(this._dgMap,this.event,this.getPosition());return this.raiseEvent(t,i,"DgMouseWheel"),this._dgMap.scrollZoomEnabled()}return!1},CLASS_NAME:"DG.Handlers.MouseWheel"}),DG.Handlers.PinchZoomChange=DG.Class(DG.Handlers.Base,{mainMethod:function(e){var t,i,n,r,o,s;return n=DG.EventManager.startPinchPoint,null!==n&&(i=this._dgMap.getVirtualCenter(),r=e.getMiddlePoint(),t=e.getScale(),o=Math.round(r.x-n.x+(t-1)*(i.x-n.x)),s=Math.round(r.y-n.y+(t-1)*(i.y-n.y)),this._dgMap.setTransform("translate("+o+"px, "+s+"px) scale("+t+") "),DG.EventManager.lastPinchPoint=r),!1},CLASS_NAME:"DG.Handlers.PinchZoomChange"}),DG.Handlers.PinchZoomStart=DG.Class(DG.Handlers.Base,{mainMethod:function(e){var t=e.getMiddlePoint();return DG.EventManager.startPinchPoint=t,DG.EventManager.lastPinchPoint=t,!1},CLASS_NAME:"DG.Handlers.PinchZoomStart"}),DG.Handlers.PinchZoomStop=DG.Class(DG.Handlers.Base,{mainMethod:function(e){return this._dgMap.setTransform(""),this._dgMap.pinchZoomAction(DG.EventManager.startPinchPoint.clone(),DG.EventManager.lastPinchPoint.clone(),DG.EventManager.lastPinch.getScale()),DG.EventManager.startPinchPoint=null,DG.EventManager.lastPinchPoint=null,DG.EventManager.lastPinch=null,!1},CLASS_NAME:"DG.Handlers.PinchZoomStop"}),DG.Handlers.ProjectChange=DG.Class(DG.Handlers.Base,{currentProject:null,lastEvent:null,initialize:function(e){var t=DG.Configs.ProjectsList;this._cities=t.cities;for(var i=0;i<this._cities.length;i++){var n=this._cities[i];this._cities[i].bound=new DG.Bounds(new DG.GeoPoint(n.bd.l,n.bd.b),new DG.GeoPoint(n.bd.r,n.bd.t))}DG.Handlers.Base.prototype.initialize.call(this,e)},mainMethod:function(e){var t=e._dgMap;if(!t.getCenter())return!1;for(var i,n,r=t.getBounds(),i=new DG.Events.ProjectChange(null),o=null,n=t.getContainer(),s=0;s<this._cities.length;s++)if(this._cities[s].bound.intersects(r)){o=this._cities[s],i=new DG.Events.ProjectChange(o),o.bound.containsBounds(r)&&(i.containsViewPort=!0);break}return null!=this.lastEvent&&this.lastEvent.getProject()==o&&this.lastEvent.containsViewPort==i.containsViewPort||(this.currentProject=o,this.lastEvent=i,this.raiseEvent(n,i,"DgProjectChange")),!1},CLASS_NAME:"DG.Handlers.ProjectChange"}),DG.Handlers.Resize=DG.Class(DG.Handlers.Base,{mainMethod:function(e){var t=this._dgMap.checkSizeChanged();if(t.isChanged){var i=new DG.Events.Map(this._dgMap);this.fireEvent(this._dgMap.getMapContainer(),i,"DgViewResize"),this._dgMap.redraw()}},CLASS_NAME:"DG.Handlers.Resize"}),DG.Handlers.TouchEnd=DG.Class(DG.Handlers.Touch,{mainMethod:function(e){if(this.event=DG.EventManager.lastTouch,this.event)if(DG.EventManager.lastTouch=null,this.isMultiTouch());else{var t=new DG.Events.Mouse(this._dgMap,this.event,this.getPosition()),i=this.event.target||this.event.srcElement;if(this.raiseEvent(i,t,"DgMouseUp"),this.isMapEvent()&&!DG.EventManager.mouseDownAndMove){var n=this.event.target||this.event.srcElement;if(DG.EventManager.firstMouseClick){DG.EventManager.firstMouseClick=!1;var r=DG.EventManager.firstTouchPos;DG.EventManager.firstTouchPos=null;var o=this.getPosition(),s=r.x-o.x,a=r.y-o.y,l=s*s+a*a;return l<300&&this.raiseEvent(n,t,"DgDoubleClick"),!0}this.raiseEvent(n,t,"DgFastClick"),DG.EventManager.firstMouseClick=!0,DG.EventManager.firstTouchPos=this.getPosition();var h={child:n,clickEvent:t,type:"DgClick"};return this.fireEvent(this._dgMap.getMapContainer(),h,"DgPreClick"),!0}DG.EventManager.mouseDownAndMove&&(DG.Utils.iNU(DG.EventManager.mouseDragObject)||this.fireEvent(DG.EventManager.mouseDragObject,t,"DgDragStop"),DG.EventManager.mouseDragPoint=null,DG.EventManager.mouseDragObject=null,DG.EventManager.mouseDragButton=null,DG.EventManager.mouseDragMapId=null,DG.EventManager.mouseDragStartPoint=null,DG.EventManager.mouseDownAndMove=!1)}else if(DG.EventManager.pinching){var i=e.target||e.srcElement,c=DG.EventManager.lastPinch;this.raiseEvent(i,c,"DgPinchZoomStop"),DG.EventManager.pinching=!1}return!1},CLASS_NAME:"DG.Handlers.TouchEnd"}),DG.Handlers.TouchMove=DG.Class(DG.Handlers.Touch,{mainMethod:function(e){if(this.isMultiTouch()){var t=this.getPinchData(e);DG.EventManager.lastPinch=t;var i=e.target||e.srcElement;this.raiseEvent(i,t,"DgPinchZoomChange")}else{var n=this.getPosition(),r=DG.EventManager.mouseDragPoint;if(!DG.Utils.iNU(r)&&DG.EventManager.mouseDragMapId==this._dgMap.getContainerId()){var o=r.x-n.x,s=r.y-n.y;if(o*o+s*s==0)return!1;var a="DgDrag";DG.EventManager.mouseDragPoint=n,DG.EventManager.mouseDownAndMove=!0;var l=new DG.Events.Drag(this.event,DG.EventManager.mouseDragStartPoint,new DG.Point(r.x,r.y),[o,s],this._dgMap);if(DG.EventManager.mouseDragObject)return this.fireEvent(DG.EventManager.mouseDragObject,l,a),!0;if(this.isMapEvent()){var h=e.target||e.srcElement;return this.raiseEvent(h,l,a),!0}}}return!1},CLASS_NAME:"DG.Handlers.TouchMove"}),DG.Handlers.TouchStart=DG.Class(DG.Handlers.Touch,{mainMethod:function(e){if(this.isMapEvent()){var t=this.getPosition();if(DG.EventManager.touchable=!0,this.isMultiTouch()){DG.EventManager.pinching=!0,DG.EventManager.lastTouch=null,DG.EventManager.mouseDragPoint=null,DG.EventManager.mouseDragMapId=null,DG.EventManager.mouseDownAndMove=!1;var i=e.target||e.srcElement,n=new DG.Events.PinchZoom(this._dgMap,this.event,t,this.getDistance(e.touches),this.getMiddlePosition(),1);DG.EventManager.lastPinch=n,DG.EventManager.startPinchDistance=n.getDistance(),this.raiseEvent(i,n,"DgPinchZoomStart")}else{DG.EventManager.pinching=!1,DG.EventManager.lastPinch=null,DG.EventManager.startPinchDistance=null,DG.EventManager.lastTouch=this.event,DG.EventManager.mouseDragPoint=t,DG.EventManager.mouseDragStartPoint=t,DG.EventManager.mouseDragMapId=this._dgMap.getContainerId(),DG.EventManager.mouseDownAndMove=!1;var i=e.target||e.srcElement;DG.EventManager.mouseDragButton="left";var n=new DG.Events.Mouse(this._dgMap,this.event,this.getPosition());this.raiseEvent(i,n,"DgMouseDown")}return!0}return!1},CLASS_NAME:"DG.Handlers.TouchStart"}),DG.Handlers.WindowUnload=DG.Class(DG.Handlers.Base,{mainMethod:function(e){var t=this._dgMap.getContainer(),i=new DG.Events.WindowUnload;return this.raiseEvent(t,i,"DgWindowUnload"),!0},CLASS_NAME:"DG.Handlers.WindowUnload"}),DG.Layers.Common=DG.Class(DG.Layers.Base,{_initializeArguments:{},_noImageSrc:"http://maps.api.2gis.ru/images/blanktile.png",_noImageCSSClass:"olBlankErrorTile",_version:null,initialize:function(e,t,i){this._initializeArguments=arguments,this._generateId(e)},initializeBeforeAddOnMap:function(){var e,t,i,n,r;e=this._initializeArguments[0],t=this._initializeArguments[1],i=this._initializeArguments[2],this._version&&(i.version=this._version),n=new this._XYZClass(e,t,i),r=[e,n],DG.Layers.Base.prototype.initialize.apply(this,r)},clearBeforeRemoveFromMap:function(){DG.Layers.Base.prototype.clearBeforeRemoveFromMap.apply(this)},getId:function(){return DG.Layers.Base.prototype.getId.apply(this,arguments)},show:function(){return DG.Layers.Base.prototype.show.apply(this,arguments)},hide:function(){return DG.Layers.Base.prototype.hide.apply(this,arguments)},_XYZClass:DG.Class(OpenLayers.Layer.XYZ,{tileLoadingDelay:2,_countTileServers:0,_square:0,_squareSide:0,_tilePrefix:"",_version:null,_versionParamName:"v",sphericalMercator:!0,isBaseLayer:!1,_isEnabled:!0,buffer:0,_transparentImageSrc:"http://maps.api.2gis.ru/images/transparent.png",initialize:function(e,t,i){DG.Utils.extendOptionsProtected(this,i,["tilePrefix","countTileServers","version"]),OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this._square=this._calcNearestSquare(this._countTileServers),this._squareSide=Math.sqrt(this._square)},destroy:function(){OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)},disable:function(){this._isEnabled=!1,this.flush()},enable:function(){this._isEnabled=!0,this.redraw()},flush:function(){for(var e=0;e<this.div.children.length;e++)this.div.children[e].children[0].src=this._transparentImageSrc},moveTo:function(){this._isEnabled&&OpenLayers.Layer.XYZ.prototype.moveTo.apply(this,arguments)},setUrl:function(e){this.url=e},getURL:function(e){var t,i;if(i=OpenLayers.Layer.XYZ.prototype.getURL.call(this,e),this._countTileServers>0){t=this._getTileServerNumber(e);var n=i.replace(/http:\/\//g,"http://"+this._tilePrefix+t+".")}else n=i;return this._version&&(n+="&"+this._versionParamName+"="+this._version),n},_getTileServerNumber:function(e){var t,i,n,r;return t=this._calcXYTilesByBounds(e),i=t.x,n=t.y,r=i%this._squareSide+n%this._squareSide*this._squareSide,this._countTileServers!=this._square&&(r%=this._countTileServers),r=Math.abs(r)},_calcNearestSquare:function(e){var t,i;for(i=0,t=0;t<=this.MAX_ALLOWED_SQUARE;i++,t=i*i)if(t>=e)return t;return this.MAX_ALLOWED_SQUARE},_calcXYTilesByBounds:function(e){var t=this.map.getResolution(),i=Math.round((e.left-this.maxExtent.left)/(t*this.tileSize.w)),n=Math.round((this.maxExtent.top-e.top)/(t*this.tileSize.h));return{x:i,y:n}},CLASS_NAME:"DG.Layers.Common.XYZClass",MAX_ALLOWED_SQUARE:81}),CLASS_NAME:"DG.Layers.Common"}),DG.Layers.ContainPointStrategy=DG.Class({initialize:function(){},checkInclusion:function(e,t){throw ReferenceError('You must redefine "checkInclusion" method!')}}),DG.Layers.ContainPointStrategy.Beam=DG.Class(DG.Layers.ContainPointStrategy,{checkInclusion:function(e,t){var i,n=0;this._validateCheckInclusionParams(e,t),i=this._getEdges(e);for(var r=0,o=i.length;r<o;r++)switch(this._getEdgeType(i[r],t)){case"TOUCHING":return!0;case"CROSSING":n=1-n}return!!n},_validateCheckInclusionParams:function(e,t){if("[object Array]"!==Object.prototype.toString.call(e)||e.length<1)throw new TypeError('Parameter "geometryParams" is required and should be not empty array');if(t instanceof DG.Point==!1)throw new TypeError('Parameter "point" is required and should be a DG.Point instance');for(var i=0;i<e.length;i++)if(e[i]instanceof DG.Point==!1)throw new TypeError('Each element of the "geometryParams" array should be a DG.Point instance')},_getEdges:function(e){for(var t,i,n,r=[],o=0,s=e.length;o<s;o++)i=e[o],n=o!=s-1?e[o+1]:e[0],t={startPoint:i,endPoint:n},r.push(t);return r},_getEdgeType:function(e,t){var i=this._classify(e,t);switch(i){case"LEFT":return e.startPoint.y<t.y&&t.y<=e.endPoint.y?"CROSSING":"INESSENTIAL";case"RIGHT":return e.endPoint.y<t.y&&t.y<=e.startPoint.y?"CROSSING":"INESSENTIAL";case"BETWEEN":case"ORIGIN":case"DESTINATION":return"TOUCHING";default:return"INESSENTIAL"}},_classify:function(e,t){var i,n,r;return i={x:e.endPoint.x-e.startPoint.x,y:e.endPoint.y-e.startPoint.y},n={x:t.x-e.startPoint.x,y:t.y-e.startPoint.y},r=i.x*n.y-n.x*i.y,r>0?"LEFT":r<0?"RIGHT":i.x*n.x<0||i.y*n.y<0?"BEHIND":this._getLengthSquared(i)<this._getLengthSquared(n)?"BEYOND":this._isEqual(e.startPoint,t)?"ORIGIN":this._isEqual(e.endPoint,t)?"DESTINATION":"BETWEEN"},_getLengthSquared:function(e){return Math.pow(e.x,2)+Math.pow(e.y,2)},_isEqual:function(e,t){return e.x==t.x&&e.y==t.y},CLASS_NAME:"DG.Layers.ContainPointStrategy.Beam"}),DG.Layers.ContainPointStrategy.Circle=DG.Class(DG.Layers.ContainPointStrategy,{checkInclusion:function(e,t){var i,n,r,o;return this._validateCheckInclusionParams(e,t),i=e[0],n=e[1],r=Math.abs(i.x-t.x),o=Math.abs(i.y-t.y),!(r>=n||o>=n)&&(r+o<=n||Math.pow(n,2)>=Math.pow(r,2)+Math.pow(o,2))},_validateCheckInclusionParams:function(e,t){if("[object Array]"!=Object.prototype.toString.call(e)||e.length<1)throw new TypeError('Parameter "geometryParams" is required and should be not empty array');if(!(t instanceof DG.Point))throw new TypeError('Parameter "point" is required and should be a DG.Point instance');if(!(e[0]instanceof DG.Point))throw new TypeError('First element (center) of the "geometryParams" array should be a DG.Point instance');if(e[1]<0)throw new TypeError('Second element (radius) of the "geometryParams" array should be a positive number')},CLASS_NAME:"DG.Layers.ContainPointStrategy.Circle"}),DG.Layers.ContainPointStrategyStorage=DG.Class({_strategies:[],initialize:function(){this._strategies=[]},getStrategy:function(e){if(!DG.Utils.empty(this._strategies[e]))return this._strategies[e];switch(e){case"circle":return this._strategies[e]=new DG.Layers.ContainPointStrategy.Circle,this._strategies[e];case"rect":return this._strategies[e]=new DG.Layers.ContainPointStrategy.Beam,this._strategies[e];case"cpoly":return this._strategies[e]=new DG.Layers.ContainPointStrategy.Beam,this._strategies[e];case"npoly":return this._strategies[e]=new DG.Layers.ContainPointStrategy.Beam,this._strategies[e];default:throw TypeError("Unknown shape type!")}},destroy:function(){this._strategies=[]},CLASS_NAME:"DG.Layers.ContainPointStrategyStorage"}),DG.Layers.DataLoader=DG.Class({_sourceUrl:null,initialize:function(e){if("undefined"==typeof e||/^\s*$/.test(e))throw TypeError("DG.Layers.DataLoader constructor take url arguments only");this._sourceUrl=e},getData:function(e,t,i){throw"You must implement getData() method"},CLASS_NAME:"DG.Layers.DataLoader"}),DG.Layers.DataLoader.OnlineArray=DG.Class(DG.ILayerDataLoader,{_dataAnswer:null,_tdHashAnswer:null,_radius:6,initialize:function(e){DG.Utils.iNU(e)||(this._radius=DG.Configs.TileMarkers[e+"MarkerRadius"])},getData:function(e){DG.Utils.iNU(e)||e(this._dataAnswer)},setData:function(e){DG.Utils.empty(e)||(this._dataAnswer=this._prepareObjDescription(e.objects),this._tdHashAnswer=e.tilehash)},_prepareObjDescription:function(e){var t=null;if(!DG.Utils.empty(e)){t={objects:[]};for(var i=0,n=e.length;i<n;i++){var r={};r.data=e[i].data,r.coordinateType="pixel",r.basePoint=e[i].geoPoint,r.geometry=[{type:"circle",coords:"(0 0,"+this._radius+")"}],t.objects.push(r)}}return t},getTileDrawerHash:function(){return this._tdHashAnswer},CLASS_NAME:"DG.Layers.DataLoader.OnlineArray"}),DG.Layers.DataLoader.TrafficJam=DG.Class(DG.ILayerDataLoader,{_graphSpeedUrl:"",_speedGraph:{},_currentProject:null,_map:null,_plugin:null,_timeInterval:0,_maxMetaServers:0,_minZoomLevel:0,_actualTrafficTime:0,initialize:function(){this._dataCallbacks=[],this._keyCallbacks=[],this._timeInterval=0;var e=new DG.Configs.Traffic;this._graphSpeedUrl=e.graphSpeedUrl,this._minZoomLevel=e.minZoomLevel,this._maxMetaServers=e.metaServersCount},getDgMap:function(){return this._map},setDgMap:function(e){this._map=e},getPlugin:function(){return this._plugin},setPlugin:function(e){this._plugin=e},setTimeInterval:function(e){this._timeInterval=e},flush:function(){this._speedGraph={}},getData:function(e,t,i,n,r){this._makeRequest(e,t,i,n,r)},_makeRequest:function(e,t,i,n,r){if(!this.getPlugin().isEnable())return!1;if(this._minZoomLevel>this.getDgMap().getZoom())return!1;var o=Math.ceil((t+i+n)%this._maxMetaServers),s="trf_clb_"+t+"_"+i+"_"+n,a=this._graphSpeedUrl.replace("${x}",t).replace("${y}",i).replace("${z}",n).replace(/\$\{project\}/g,this._getCurrentProject()).replace("${interval}",this._timeInterval).replace("${metaPrefix}",o),l=this.getPlugin().getActualTime(),h=l>0?l:(new Date).getTime();0===this._timeInterval&&(a+="?"+h),DG.AjaxManager.get({url:a,cid:s,data:{},success:function(o){this._speedHandler(o,t,i,n,r,e)},failure:function(){},scope:this})},_speedHandler:function(e,t,i,n,r,o){for(var s,a=0;a<e[1].length;a++)s=e[1][a],DG.Utils.iNU(this._speedGraph[s.graph_id])&&(this._speedGraph[s.graph_id]=s.speed_text);var l={},h=this._getConfigFromWKT(e[0],r);l.objects=h,o(l,t,i,n)},_getConfigFromWKT:function(e,t){for(var i,n,r,o,s,a,l=[],h=0;h<e.length;h++){var c,u,d={};if(c=e[h],u=c.graph_id,d.data={},d.geometry=[],d.coordinateType="geo","undefined"!=typeof this._speedGraph[u]){d.data.graphId=u,d.data.speed=this._speedGraph[u];for(var p=0;p<c.geometry.length;p++){n=c.geometry[p].width,o=c.geometry[p].object,"string"==typeof o&&(s=[],s.push(o),o=s);for(var g=0;g<o.length;g++){var m;if(r=o[g],r.indexOf("POLYGON")!==-1)m=r.replace("POLYGON((","").replace("))",""),i={},i.type="cpoly",i.coords="("+m+")",d.geometry.push(i);else if(r.indexOf("MULTIPOLYGON")!==-1){r=DG.WKTParser._deleteSpaces(r),m=/^MULTIPOLYGON\((.*)\)/.exec(r);for(var f=/\(\((.*?)\)\)/g;null!==(a=f.exec(m[1]));)i={},i.type="cpoly",i.coords="("+a[1]+")",d.geometry.push(i)}}}l.push(d)}}return l},_getCurrentProject:function(){return this._plugin.getCurrentProject()},CLASS_NAME:"DG.Layers.DataLoader.TrafficJam"}),DG.Layers.DataLoader.WebApi=DG.Class(DG.ILayerDataLoader,{_sourceUrl:"http://catalog.api.2gis.ru/advanced?output=jsonp&key=rubnkm7490&version=2.0&callback=$[callback]",_requestParams:null,_isWaitingForAnswer:!1,_dataCallback:null,_dataAnswer:null,_tdHashAnswer:null,_radius:6,initialize:function(e,t){DG.Utils.iNU(t)||(this._radius=DG.Configs.TileMarkers[t+"MarkerRadius"]),this._requestParams=e},getData:function(e){if(DG.Utils.iNU(e))throw TypeError("DG.Layers.DataLoader getData() method is waiting callback parameter to be passed!");if("[object Function]"!==Object.prototype.toString.call(e))throw TypeError("DG.Layers.DataLoader getData() method is waiting callback parameter to be a Function!");DG.Utils.iNU(this._dataAnswer)?(this._dataCallback=e,this._makeRequest()):e(this._dataAnswer)},getTileDrawerHash:function(){return this._tdHashAnswer},_makeRequest:function(){return!!this._isWaitingForAnswer||!DG.Utils.iNU(this._requestParams)&&(DG.AjaxManager.get({url:this._sourceUrl,data:this._requestParams,success:this.onAnswer,failture:this.onAnswerFail,scope:this}),void(this._isWaitingForAnswer=!0))},_prepareObjDescription:function(e){for(var t={objects:[]},i=0;i<e.length;i++){var n={};n.data=e[i],n.coordinateType="pixel",n.basePoint=new DG.GeoPoint(e[i].lon,e[i].lat),n.geometry=[{type:"circle",coords:"(0 0,"+this._radius+")"}],t.objects.push(n)}return t},onAnswer:function(e){this._isWaitingForAnswer=!1,this._dataAnswer=this._prepareObjDescription(e.results.firm.magic.geometries),this._tdHashAnswer=e.results.firm.tilehash,
this._dataCallback(this._dataAnswer),this._dataCallback=null},onAnswerFail:function(){this._isWaitingForAnswer=!1},setRequestParams:function(e){this._requestParams=e,this._dataAnswer=null,this._tdHashAnswer=null,this._dataCallback=null,this._isWaitingForAnswer=!1},CLASS_NAME:"DG.Layers.DataLoader.WebApi"}),DG.Layers.DataLoader.WebApiArray=DG.Class(DG.ILayerDataLoader,{_dataAnswer:null,_tdHashAnswer:null,_radius:6,initialize:function(e,t){DG.Utils.iNU(t)||(this._radius=DG.Configs.TileMarkers[t+"MarkerRadius"]),DG.Utils.iNU(e)||this.setData(e)},getData:function(e){if(DG.Utils.iNU(e))throw TypeError("DG.Layers.DataLoader getData() method is waiting callback parameter to be passed!");if("[object Function]"!==Object.prototype.toString.call(e))throw TypeError("DG.Layers.DataLoader getData() method is waiting callback parameter to be a Function!");DG.Utils.empty(this._dataAnswer)||e(this._dataAnswer)},setData:function(e){if(DG.Utils.empty(e))throw TypeError("DG.Layers.DataLoader setData() method is waiting for Object!");if(DG.Utils.empty(e)||DG.Utils.empty(e.results)||DG.Utils.empty(e.results.firm)||DG.Utils.empty(e.results.firm.magic)||DG.Utils.empty(e.results.firm.magic.geometries)||DG.Utils.empty(e.results.firm.tilehash))throw TypeError("DG.Layers.DataLoader setData() method is waiting for proper WebApi answer!");DG.Utils.empty(e)||(this._dataAnswer=this._prepareObjDescription(e.results.firm.magic.geometries),this._tdHashAnswer=e.results.firm.tilehash)},_prepareObjDescription:function(e){var t=null;if(!DG.Utils.empty(e)){t={objects:[]};for(var i=0;i<e.length;i++){var n={};n.data=e[i],n.coordinateType="pixel",n.basePoint=new DG.GeoPoint(e[i].lon,e[i].lat),n.geometry=[{type:"circle",coords:"(0 0,"+this._radius+")"}],t.objects.push(n)}}return t},getTileDrawerHash:function(){return this._tdHashAnswer},CLASS_NAME:"DG.Layers.DataLoader.WebApiArray"}),DG.Layers.Interactive=DG.Class(DG.Layers.Common,{_loadDataStrategy:null,_objectToTileMapper:null,_dataLoader:null,_loadDataStrategyName:null,_clickCallback:null,_clickCallbackContext:null,_mouseoverCallback:null,_mouseoverCallbackContext:null,_mouseoverCursor:DG.Cursor.POINTER,_balloon:null,_hasBalloon:!1,_hasHint:!1,_cursorUnderObject:!1,_rendered:null,_hintHideTimeoutId:null,initialize:function(e,t,i){this._validateOptions(i),DG.Layers.Common.prototype.initialize.apply(this,arguments),this._applyOptions(i)},enable:function(){this._olLayer.enable()},disable:function(){this._olLayer.disable()},isEnabled:function(){return this._olLayer._isEnabled},setDgMap:function(e){this._dgMap=e},getDgMap:function(){return this._dgMap},getDataLoader:function(){return this._dataLoader},onAddToMap:function(){DG.Layers.Common.prototype.onAddToMap.apply(this,arguments),this._objectToTileMapper=new DG.Layers.ObjectToTileMapper(this);var e=new DG.Layers.ShapeFactory(this._dgMap,new DG.Layers.ContainPointStrategyStorage),t=new DG.Layers.ObjectSource(this._dataLoader,e);this._loadDataStrategy=DG.Layers.LoadDataStrategy.Create(this._loadDataStrategyName,this,t),this._loadDataStrategy.startLoadData()},eventProcessing:function(e,t){if(this._isVisible)switch(t){case"DgMouseMove":if(e.point.x%2==0)return;var i=this._getActiveObjectForEvent(e);if(i!==!1)return this._cursorUnderObject||(this._cursorUnderObject=!0,this._dgMap.addCursor(this._mouseoverCursor)),this._hasHint&&this._showHint(i,e.getPoint()),DG.Utils.iNU(this._mouseoverCallback)||(DG.Utils.iNU(this._mouseoverCallbackContext)?this._mouseoverCallback(i,e):this._mouseoverCallback.call(this._mouseoverCallbackContext,i,e)),!0;this._cursorUnderObject&&(this._cursorUnderObject=!1,this._hasHint&&this._dgMap.hint.hide(),this._dgMap.removeCursor(this._mouseoverCursor)),window.clearTimeout(this._hintHideTimeoutId),this._hintHideTimeoutId=window.setTimeout(DG.Utils.bind(function(){this._dgMap.hint.hide(),this._dgMap.removeCursor(this._mouseoverCursor)},this),3e3);break;case"DgClick":if(!DG.Utils.iNU(this._clickCallback)){var i=this._getActiveObjectForEvent(e);if(i!==!1)return this._hasBalloon&&this._showBalloon(i,e.getGeoPoint()),this._hideHint(),DG.Utils.iNU(this._clickCallbackContext)?this._clickCallback(i,e):this._clickCallback.call(this._clickCallbackContext,i,e),!0}break;case"DgDrag":this._dgMap.hint.isShown()&&this._dgMap.hint.setPosition(e.getPoint())}return!1},_getActiveObjectForEvent:function(e){var t,i,n;if(t=this.getTileNumberByGeoPoint(e.getGeoPoint()),i=this._objectToTileMapper.getObjectsForTile(t.x,t.y),DG.Utils.iNU(i))return!1;for(var r=i.length;r--;){n=i[r].getShapes();for(var o=n.length;o--;)if(n[o].contains(this._dgMap.converter.coordinatesToGlobalPixels(e.getGeoPoint())))return i[r]}return!1},updateLayer:function(){this._objectToTileMapper.flushObjects(),this._loadDataStrategy.reload()},flushLayer:function(){this._objectToTileMapper.flushObjects()},setLayerObjects:function(e){this._objectToTileMapper.setObjects(e)},addLayerObjects:function(e,t,i,n){this._objectToTileMapper.addObjects(e,t,i,n)},removeLayerObjects:function(e,t,i){this._objectToTileMapper.removeObjects(e,t,i)},_showHint:function(e,t){this._dgMap.hint.setContent(this.getHintData(e)),this._dgMap.hint.setPosition(t),this._dgMap.hint.show()},_hideHint:function(){this._hasHint&&this._dgMap.hint.hide()},getHintData:function(e){return""},_showBalloon:function(e,t){DG.Utils.empty(this._balloon)&&(this._balloon=this._getBalloon()),this._hideHint(),this._balloon.moveToGeoPoint(t,this.getBalloonData(e)),this._balloon.show()},getBalloonData:function(e){return""},_getBalloon:function(){var e=new DG.Balloons.Common({geoPoint:new DG.GeoPoint(82.927810142519,55.028936234826),adjustMapCenterToBalloon:!0,contentHtml:"",isClosed:!0});return this._dgMap.balloons.add(e),e.hide(),e},_validateOptions:function(e){if(DG.Utils.iNU(e.loader))throw Error("No Data loader provided!");if(!e.loader instanceof DG.ILayerDataLoader)throw TypeError("Data loader should be an instance of DG.ILayerDataLoader!");if(DG.Utils.iNU(e.dataLoadStrategy))throw Error("No Data loader strategy provided!");if(!DG.Utils.inHash(e.dataLoadStrategy,DG.Layers.LoadDataStrategy.Strategies))throw TypeError("Unknown Data loader strategy type!")},_applyOptions:function(e){!DG.Utils.iNU(e.hasBalloon)&&e.hasBalloon&&(this._hasBalloon=e.hasBalloon),DG.Utils.iNU(e.getBalloonData)||(this.getBalloonData=e.getBalloonData),!DG.Utils.iNU(e.hasHint)&&e.hasHint&&(this._hasHint=e.hasHint),DG.Utils.iNU(e.getHintData)||(this.getHintData=e.getHintData),DG.Utils.iNU(e.clickCallback)||(this._clickCallback=e.clickCallback),DG.Utils.iNU(e.clickCallbackContext)||(this._clickCallbackContext=e.clickCallbackContext),DG.Utils.iNU(e.mouseOverCallback)||(this._mouseoverCallback=e.mouseOverCallback),DG.Utils.iNU(e.mouseOverCallbackContext)||(this._mouseoverCallbackContext=e.mouseOverCallbackContext),DG.Utils.iNU(e.cursor)||(this._mouseoverCursor=e.cursor),this._dataLoader=e.loader,this._loadDataStrategyName=e.dataLoadStrategy},getTileNumberByGeoPointAndZoom:function(e,t){e.toMercator();var i=this.getMaxExtent(),n=this.getResolutionForZoom(t),r=this.getTilePxSize(),o=Math.floor((e.lon-i.left)/(n*r.w)),s=Math.floor((i.top-e.lat)/(n*r.h));return{x:o,y:s}},getTileNumberByGeoPoint:function(e){var t=this._dgMap.getZoom(),i=this.getTileNumberByGeoPointAndZoom(e,t);return i.z=t,i},getResolutionForZoom:function(e){return this._olLayer.getResolutionForZoom(e)},getTilePxSize:function(){return this._olLayer.getImageSize()},getMaxExtent:function(){return this._olLayer.maxExtent},CLASS_NAME:"DG.Layers.Interactive"}),DG.Layers.Interactive.Traffic=DG.Class(DG.Layers.Interactive,{_tileUrlTemplate:null,_dataLoader:null,_control:null,_plugin:null,_pluginName:null,_currentProject:null,_timeInterval:0,_actualTrafficTime:0,_observers:[],_isDebugMode:!1,initialize:function(e,t,i){function n(e){return e.getData().speed+r.hintSpeedText}this._control=null,this._plugin=null,this._tileUrlTemplate=null,this._currentProject=null,this._timeInterval=0;var r=new DG.Configs.Traffic;this._pluginName=r.pluginName,this._tileUrlTemplate=r.tileUrl,this._dataLoader=new DG.Layers.DataLoader.TrafficJam,this._isDebugMode=r.isDebugMode;var o={};o.loader=this._dataLoader,o.dataLoadStrategy=r.strategy,o.hasHint=r.displayHint,o.cursor=DG.Cursor.ARROW,o.clickCallback=null,o.getHintData=n,o.tilePrefix=r.tileServersPrefix,o.countTileServers=r.tileServersCount,this.setProject(e),this.setTimeInterval(t),this.setActualTrafficTime(i);var s=this._getTileUrl(),a=this._XYZClass;this._XYZClass=DG.Class(a,{minZoomLevel:r.minZoomLevel,zoomChangeTimeout:r.zoomChangeTimeout,_moveToArguments:null,_zoomChangeTimeoutId:0,_isWait:!1,initialize:function(){this._moveToArguments=null,this._zoomChangeTimeoutId=0,this._isWait=!1,a.prototype.initialize.apply(this,arguments)},moveTo:function(e,t,i){this._isEnabled&&this.map.getZoom()>=this.minZoomLevel&&(this._moveToArguments=arguments,t?(this._isWait=!0,this.display(!1),clearTimeout(this._zoomChangeTimeoutId),this._zoomChangeTimeoutId=setTimeout(DG.Utils.bind(this.moveToApply,this),this.zoomChangeTimeout)):(this._isWait&&(clearTimeout(this._zoomChangeTimeoutId),this._moveToArguments=[arguments[0],!0,!1]),this.moveToApply()))},moveToApply:function(){this._isWait=!1,this.display(!0),OpenLayers.Layer.XYZ.prototype.moveTo.apply(this,this._moveToArguments)}});var l=[r.layerName,s,o];DG.Layers.Interactive.prototype.initialize.apply(this,l)},initializeBeforeAddOnMap:function(){DG.Layers.Interactive.prototype.initializeBeforeAddOnMap.apply(this,arguments)},onAddToMap:function(){this._plugin=this._dgMap.getPlugin(this._pluginName),this._dataLoader.setDgMap(this._dgMap),this._dataLoader.setPlugin(this._plugin),DG.Layers.Interactive.prototype.onAddToMap.apply(this)},onMapUpdate:function(e){return!1},getPlugin:function(){return this._plugin},getControl:function(){return this.getPlugin().getControl()},setProject:function(e){this._currentProject=e},getProject:function(){return this._currentProject},redrawLayer:function(){this.setUrl(this._getTileUrl()),this.redraw()},setTimeInterval:function(e){this._timeInterval=e,this._dataLoader.setTimeInterval(e),this._dataLoader.flush()},setActualTrafficTime:function(e){this._actualTrafficTime=e},_showHint:function(e,t){if(DG.Layers.Interactive.prototype._showHint.apply(this,arguments),this._isDebugMode){var i=this._dgMap.converter.mapPixelsToCoordinates(t),n="speed="+e.getData().speed+", graphId="+e.getData().graphId+", ";n+=i.toString()}},_getTileUrl:function(){var e=this._actualTrafficTime>0?this._actualTrafficTime:(new Date).getTime(),t=this._tileUrlTemplate.replace(/\$\{project\}/g,this.getProject()).replace("${interval}",this._timeInterval);return 0===this._timeInterval&&(t+="?"+e),t},CLASS_NAME:"DG.Layers.Interactive.Traffic"}),DG.Layers.Interactive.WebapiMarkers=DG.Class(DG.Layers.Interactive,{_tileDrawerBaseUrl:"http://drawer.2gis.ru/drawer/cache/grid/${z}/${x}/${y}/query/",_layerSpecificOptions:{tilePrefix:"tile",wrapDateLine:!0,countTileServers:4,dataLoadStrategy:"whole"},initialize:function(e,t){t.tilePrefix=this._layerSpecificOptions.tilePrefix,t.wrapDateLine=this._layerSpecificOptions.wrapDateLine,t.countTileServers=this._layerSpecificOptions.countTileServers,t.dataLoadStrategy=this._layerSpecificOptions.dataLoadStrategy,DG.Layers.Interactive.prototype.initialize.apply(this,[e,null,t])},initializeBeforeAddOnMap:function(){DG.Layers.Common.prototype.initializeBeforeAddOnMap.apply(this,arguments),this._olLayer.disable()},setLayerObjects:function(e){DG.Layers.Interactive.prototype.setLayerObjects.apply(this,arguments),this.setUrl(this._tileDrawerBaseUrl+this._dataLoader.getTileDrawerHash()+"/"),this.enable()},flushLayer:function(){DG.Layers.Interactive.prototype.flushLayer.apply(this),this.disable(),this.setUrl(null)},CLASS_NAME:"DG.Layers.Interactive.WebapiMarkers"}),DG.Layers.InteractiveObject=DG.Class({_id:null,_data:{},_geometry:{},_shapes:[],_shapeFactory:null,initialize:function(e){throw Error("You must implement constructor in successor classes!")},getGeometry:function(){return this._geometry},getData:function(){return this._data},flushShapes:function(){for(var e=0;e<this._shapes.length;e++)this._shapes[e].destroy();this._shapes=null},destroy:function(){throw Error('The method should "destroy" should be defined!')},CLASS_NAME:"DG.Layers.InteractiveObject"}),DG.Layers.InteractiveObject.Geo=DG.Class(DG.Layers.InteractiveObject,{initialize:function(e,t,i){if(DG.Utils.iNU(t))throw Error('"data" parameter should be not empty!');if(DG.Utils.iNU(i))throw Error('"geometry" parameter should be not empty!');if(DG.Utils.iNU(e)||!(e instanceof DG.Layers.ShapeFactory))throw Error('Wrong "shapeFactory" parameter!');for(var n=0;n<i.length;n++)for(var r=0;r<i[n].coords.length;r++)i[n].coords[r]=new DG.GeoPoint(i[n].coords[r][0],i[n].coords[r][1]);this._shapes=[],this._data=t,this._geometry=i,this._shapeFactory=e,this._id=DG.Utils.createUniqueID()},getShapes:function(){if(DG.Utils.empty(this._shapes)){this._shapes=[];for(var e=null,t=0;t<this._geometry.length;t++)e=this._geometry[t],this._shapes.push(this._shapeFactory.getShape(e.type,e.coords))}return this._shapes},destroy:function(){this._data=null,this._geometry=null,this._shapeFactory=null,this._id=null;for(var e=1;e<this._shapes.length;e++)this._shapes[e].destroy();this._shapes=[]},CLASS_NAME:"DG.Layers.InteractiveObject.Geo"}),DG.Layers.InteractiveObject.Pixel=DG.Class(DG.Layers.InteractiveObject,{_basePoint:null,initialize:function(e,t,i,n){if(DG.Utils.iNU(t))throw Error('"data" parameter should be not empty!');if(DG.Utils.iNU(i))throw Error('"geometry" parameter should be not empty!');if(DG.Utils.iNU(n)||!(n instanceof DG.GeoPoint))throw Error('Wrong "basePoint" parameter!');if(DG.Utils.iNU(e)||!(e instanceof DG.Layers.ShapeFactory))throw Error('Wrong "shapeFactory" parameter!');this._shapes=[],this._data=t,this._geometry=i,this._basePoint=n.clone(),this._shapeFactory=e,this._id=DG.Utils.createUniqueID()},getBasePoint:function(){return this._basePoint},getShapes:function(){if(DG.Utils.empty(this._shapes)){this._shapes=[];for(var e=null,t=0;t<this._geometry.length;t++)e=this._geometry[t],this._shapes.push(this._shapeFactory.getShape(e.type,e.coords,this._basePoint))}return this._shapes},destroy:function(){this._data=null,this._geometry=null,this._shapeFactory=null,this._basePoint=null,this._id=null;for(var e=1;e<this._shapes.length;e++)this._shapes[e].destroy();this._shapes=[]},CLASS_NAME:"DG.Layers.InteractiveObject.Pixel"}),DG.Layers.LoadDataStrategy=DG.Class({_objectSource:null,_belongsTo:null,initialize:function(e,t){if(DG.Utils.iNU(t)||!(t instanceof DG.Layers.ObjectSource))throw TypeError("Incorrect object source!");if(DG.Utils.iNU(e)||!(e instanceof DG.Layers.Interactive))throw TypeError("Incorrect layer LoadDataStrategy belongs to!");this._objectSource=t,this._belongsTo=e},startLoadData:function(){},CLASS_NAME:"DG.Layers.LoadDataStrategy"}),DG.Layers.LoadDataStrategy.Strategies={},DG.Layers.LoadDataStrategy.Strategies.Whole="whole",DG.Layers.LoadDataStrategy.Strategies.Tile="tile",DG.Layers.LoadDataStrategy.Strategies.MouseTile="mouseTile",DG.Layers.LoadDataStrategy.Create=function(e,t,i){if(e===DG.Layers.LoadDataStrategy.Strategies.Whole)return new DG.Layers.LoadDataStrategy.Whole(t,i);if(e===DG.Layers.LoadDataStrategy.Strategies.Tile)return new DG.Layers.LoadDataStrategy.Tile(t,i);if(e===DG.Layers.LoadDataStrategy.Strategies.MouseTile)return new DG.Layers.LoadDataStrategy.MouseTile(t,i);throw Error("Unknown Data load strategy!")},DG.Layers.LoadDataStrategy.MouseTile=DG.Class(DG.Layers.LoadDataStrategy,{_loadedTiles:[],_tilesTTL:[],initialize:function(e,t){this._loadedTiles=[],DG.Layers.LoadDataStrategy.prototype.initialize.apply(this,arguments);var i=e.getDgMap();i.addEventListener(i.getContainerId(),"DgMouseMove",DG.Utils.bind(this._mouseMoveCallback,this)),i.addEventListener(i.getContainerId(),"DgZoomChange",DG.Utils.bind(this._zoomChangeCallback,this))},onDataLoad:function(e,t,i,n,r){this._belongsTo.addLayerObjects(e,t,i,n),DG.Utils.empty(r)||(r+=Math.round((new Date).getTime()/1e3),this._tilesTTL.push({x:t,y:i,z:n,ttl:r}))},startLoadData:function(){},reload:function(){this._loadedTiles=[],this._tilesTTL=[]},_loadTileData:function(e,t,i){var n;this._isTileDataLoaded(e,t,i)||(this._loadedTiles.push(e+"."+t+"."+i),n=this._getBasePointForTile(e,t),this._objectSource.getObjects(DG.Utils.bind(this.onDataLoad,this),e,t,i,n))},_getBasePointForTile:function(e,t){var i=this._belongsTo,n=i.getDgMap(),r=i.getMaxExtent(),o=i.getResolutionForZoom(n.getZoom()),s=i.getTilePxSize(),a=r.left+e*o*s.w,l=r.top-t*o*s.h;return new DG.GeoPoint(a,l,DG.GeoPoint.EPSG_900913)},_isTileDataLoaded:function(e,t,i){return DG.Utils.inArray(e+"."+t+"."+i,this._loadedTiles)},_mouseMoveCallback:function(e){var t=this._belongsTo.getTileNumberByGeoPoint(e.getGeoPoint());this._loadTileData(t.x,t.y,t.z)},_zoomChangeCallback:function(e){for(var t,i=e.getMap().getZoom(),n=0;n<this._loadedTiles.length;n++)t=this._loadedTiles[n].split("."),i!=t[2]&&(this._loadedTiles.splice(n,1),n--)},CLASS_NAME:"DG.Layers.LoadDataStrategy.MouseTile"}),DG.Layers.LoadDataStrategy.Tile=DG.Class(DG.Layers.LoadDataStrategy,{_loadedTiles:[],_tilesTTL:[],initialize:function(e,t){this._loadedTiles=[],DG.Layers.LoadDataStrategy.prototype.initialize.apply(this,arguments);var i=e.getDgMap();i.addEventListener(i.getContainerId(),"DgMapMove",DG.Utils.bind(this._mapMoveCallback,this)),i.addEventListener(i.getContainerId(),"DgZoomChange",DG.Utils.bind(this._zoomChangeCallback,this))},onDataLoad:function(e,t,i,n,r){this._belongsTo.addLayerObjects(e,t,i,n),DG.Utils.empty(r)||(r+=Math.round((new Date).getTime()/1e3),this._tilesTTL.push({x:t,y:i,z:n,ttl:r}))},startLoadData:function(){this._updateTileData()},reload:function(){this._loadedTiles=[],this._tilesTTL=[],this._updateTileData()},_updateTileData:function(){var e=this._belongsTo,t=(e.getOlLayer(),e.getDgMap()),i={},n=t.converter.mapPixelsToCoordinates(new DG.Point(0,0)),r=t.converter.mapPixelsToCoordinates(new DG.Point(t.getViewPort().width,t.getViewPort().height)),o=e.getTileNumberByGeoPoint(n),s=e.getTileNumberByGeoPoint(r);i.left=o.x,i.right=s.x,i.top=o.y,i.bottom=s.y;var a=o.z;this._loadTilesSpirally(i,a)},_loadTilesSpirally:function(e,t){function i(e,t){for(var i=0;i<n.length;i++)if(n[i].x===e&&n[i].y===t)return!0;return!1}var n=[],r=Math.floor((e.right-e.left)/2)+e.left,o=Math.floor((e.bottom-e.top)/2)+e.top,s=1,a=-1,l=0,h=["up","right","down","left"],c=0,u=0;for(n.push({x:r,y:o}),this._loadTileData(r,o,t);u<10&&!(++l>500);){switch(h[c]){case"up":s=0,a=-1;break;case"down":s=0,a=1;break;case"left":s=-1,a=0;break;case"right":s=1,a=0}r+=s,o+=a,i(r,o)?(c=(c-1)%4,c===-1&&(c=3),r-=s,o-=a,u++):r>e.right||r<e.left?c=(c+1)%4:o>e.bottom||o<e.top?c=(c+1)%4:(n.push({x:r,y:o}),this._loadTileData(r,o,t),u=0,c=(c+1)%4)}},_loadTilesLinearly:function(e,t){for(var i=e.top;i<=e.bottom;i++)for(var n=e.left;n<=e.right;n++)this._loadTileData(n,i,t)},_loadTileData:function(e,t,i){var n;this._isTileDataLoaded(e,t,i)||(this._loadedTiles.push(e+"."+t+"."+i),n=this._getBasePointForTile(e,t),this._objectSource.getObjects(DG.Utils.bind(this.onDataLoad,this),e,t,i,n))},_getBasePointForTile:function(e,t){var i=this._belongsTo,n=i.getDgMap(),r=i.getMaxExtent(),o=i.getResolutionForZoom(n.getZoom()),s=i.getTilePxSize(),a=r.left+e*o*s.w,l=r.top-t*o*s.h;return new DG.GeoPoint(a,l,DG.GeoPoint.EPSG_900913)},_isTileDataLoaded:function(e,t,i){return DG.Utils.inArray(e+"."+t+"."+i,this._loadedTiles)},_checkValidCachedTiles:function(){for(var e,t,i=Math.round((new Date).getTime()/1e3),n=0;n<this._tilesTTL.length;n++)if(e=this._tilesTTL[n],e.ttl<i){t=e.x+"."+e.y+"."+e.z;for(var r=0;r<this._loadedTiles.length;r++)if(this._loadedTiles[r]===t){this._loadedTiles.splice(r,1);break}this._tilesTTL.splice(n,1),this._belongsTo.removeLayerObjects(e.x,e.y,e.z),n--}},_mapMoveCallback:function(e){this._updateTileData()},_zoomChangeCallback:function(e){for(var t,i=e.getMap().getZoom(),n=0;n<this._loadedTiles.length;n++)t=this._loadedTiles[n].split("."),i!=t[2]&&(this._loadedTiles.splice(n,1),n--)},CLASS_NAME:"DG.Layers.LoadDataStrategy.Tile"}),DG.Layers.LoadDataStrategy.Whole=DG.Class(DG.Layers.LoadDataStrategy,{initialize:function(e,t){DG.Layers.LoadDataStrategy.prototype.initialize.apply(this,arguments),this._loadData()},_loadData:function(){this._objectSource.getObjects(DG.Utils.bind(this.onDataLoad,this))},onDataLoad:function(e){this._belongsTo.setLayerObjects(e)},reload:function(){this._loadData()},CLASS_NAME:"DG.Layers.LoadDataStrategy.Whole"}),DG.Layers.ObjectSource=DG.Class({_dataLoader:null,_callback:null,_shapeFactory:null,initialize:function(e,t){if(DG.Utils.iNU(e)||!(e instanceof DG.ILayerDataLoader))throw TypeError('Wrong "dataLoader" argument type for DG.Layers.ObjectSource constructor!');if(DG.Utils.iNU(t)||!(t instanceof DG.Layers.ShapeFactory))throw TypeError('Wrong "shapeFactory" argument type for DG.Layers.ShapeFactory constructor!');this._dataLoader=e,this._shapeFactory=t},getObjects:function(e,t,i,n,r){this._callback=e,this._dataLoader.getData(DG.Utils.bind(this.onConfigReady,this),t,i,n,r)},onConfigReady:function(e,t,i,n){if(!DG.Utils.empty(e)){for(var r=e.objects,o=[],s=e.ttl,a=0;a<r.length;a++)"pixel"===r[a].coordinateType?o.push(new DG.Layers.InteractiveObject.Pixel(this._shapeFactory,r[a].data,this._prepareGeometry(r[a].geometry),r[a].basePoint)):"geo"===r[a].coordinateType&&o.push(new DG.Layers.InteractiveObject.Geo(this._shapeFactory,r[a].data,this._prepareGeometry(r[a].geometry)));this._callback(o,t,i,n,s)}},_prepareGeometry:function(e){for(var t=0;t<e.length;t++){for(var i=e[t].coords.replace("(","").replace(")",""),n=i.split(","),r=0;r<n.length;r++){n[r]=n[r].trim().split(" ");for(var o=0;o<n[r].length;o++)n[r][o]=1*n[r][o]}e[t].coords=n}return e},CLASS_NAME:"DG.Layers.ObjectSource "}),DG.Layers.ObjectToTileMapper=DG.Class({_objects:[],_relationsMap:[],_layer:null,_observers:[],initialize:function(e){this._objects=[],this._relationsMap=[],this._layer=e,this._observers.push(this._layer.getDgMap().addEventListener(this._layer.getDgMap(),"DgZoomChange",DG.Utils.bind(this.onZoomChange,this)))},destroy:function(){this._objects=[],this._relationsMap=[],this._layer=null;for(var e=0;e<this._observers.length;e++)this._observers[e].cleanup(),delete this._observers[e];for(var t=0;t<this._objects.length;t++)this._objects[t].destroy();for(var i=0;i<this._relationsMap.length;t++)this._relationsMap[i]=[];this._relationsMap=[]},setObjects:function(e){this._objects=e,this._recalculateMap()},addObjects:function(e,t,i){var n=t+"."+i;this._relationsMap[n]=[];for(var r=0;r<e.length;r++)this._relationsMap[n].push(e[r])},removeObjects:function(e,t){var i=e+"."+t;this._relationsMap[i]=[]},flushObjects:function(){this._relationsMap=[];for(var e=0;e<this._objects.length;e++)this._objects[e].destroy();this._objects=[]},getObjectsForTile:function(e,t,i){var n=e+"."+t;return this._relationsMap[n]},_recalculateMap:function(){for(var e=0;e<this._objects.length;e++)this._processObject(this._objects[e])},_processObject:function(e){for(var t,i,n,r,o,s,a,l=this._layer.getTilePxSize(),h=e.getShapes(),c=0;c<h.length;c++){t=h[c].getBounds(),i=t.getLeft(),r=t.getRight(),n=t.getTop(),o=t.getBottom(),s=[],a=[];do s.push(Math.floor(i/l.w)),i+=l.w;while(i<r);s[s.length-1]!=Math.floor(r/l.w)&&s.push(Math.floor(r/l.w));do a.push(Math.floor(n/l.h)),n+=l.h;while(n<o);a[a.length-1]!=Math.floor(o/l.w)&&a.push(Math.floor(o/l.w));for(var u=0;u<s.length;u++)for(var d=0;d<a.length;d++){var p=s[u]+"."+a[d];DG.Utils.iNU(this._relationsMap[p])&&(this._relationsMap[p]=[]),this._relationsMap[p].push(e)}}},onZoomChange:function(){this._relationsMap=[];for(var e=0;e<this._objects.length;e++)this._objects[e].flushShapes();this._recalculateMap()}}),DG.Layers.Shape=DG.Class({_containsStrategy:null,initialize:function(){throw Error("You must implement shape constructor")},contains:function(e){return this._containsStrategy.checkInclusion(this._points,e)},destroy:function(){throw Error("You must implement destroy method")},getBounds:function(){throw Error("You must implement shape getBounds method")},CLASS_NAME:"DG.Layers.Shape"}),DG.Layers.Shape.Circle=DG.Class(DG.Layers.Shape,{_center:null,_radius:null,initialize:function(e,t,i){if(DG.Utils.iNU(e)||!(e instanceof DG.Point))throw TypeError('Wrong "point" parameter!');if(DG.Utils.iNU(t)||"[object Number]"!==Object.prototype.toString.call(t))throw TypeError('Wrong "radius" parameter!');if(DG.Utils.iNU(i)||!(i instanceof DG.Layers.ContainPointStrategy))throw TypeError('Wrong "containPointStrategy" parameter!');this._center=e.clone(),this._radius=t,this._containsStrategy=i},destroy:function(){this._center=null,this._radius=null,this._containsStrategy=null},contains:function(e){return this._containsStrategy.checkInclusion([this._center,this._radius],e)},getBounds:function(){return new DG.PixelBounds(new DG.Point(this._center.x-this._radius,this._center.y+this._radius),new DG.Point(this._center.x+this._radius,this._center.y-this._radius))},CLASS_NAME:"DG.Layers.Shape.Circle"}),DG.Layers.Shape.CPoly=DG.Class(DG.Layers.Shape,{_points:null,initialize:function(e,t){if(DG.Utils.iNU(e)||"[object Array]"!==Object.prototype.toString.call(e))throw TypeError('Wrong "points" parameter!');if(DG.Utils.iNU(t)||!(t instanceof DG.Layers.ContainPointStrategy))throw TypeError('Wrong "containPointStrategy" parameter!');this._points=e,this._containsStrategy=t},destroy:function(){this._points=null,this._containsStrategy=null},getBounds:function(){return null},CLASS_NAME:"DG.Layers.Shape.CPoly"}),DG.Layers.Shape.NPoly=DG.Class(DG.Layers.Shape,{_points:null,initialize:function(e,t){if(DG.Utils.iNU(e)||"[object Array]"!==Object.prototype.toString.call(e))throw TypeError('Wrong "points" parameter!');if(DG.Utils.iNU(t)||!(t instanceof DG.Layers.ContainPointStrategy))throw TypeError('Wrong "containPointStrategy" parameter!');this._points=e,this._containsStrategy=t},destroy:function(){this._points=null,this._containsStrategy=null},getBounds:function(){return null},CLASS_NAME:"DG.Layers.Shape.NPoly"}),DG.Layers.Shape.Rect=DG.Class(DG.Layers.Shape,{_points:null,initialize:function(e,t){if(DG.Utils.iNU(e)||"[object Array]"!==Object.prototype.toString.call(e))throw TypeError('Wrong "points" parameter!');if(DG.Utils.iNU(t)||!(t instanceof DG.Layers.ContainPointStrategy))throw TypeError('Wrong "containPointStrategy" parameter!');this._points=e,this._containsStrategy=t},destroy:function(){this._points=null,this._containsStrategy=null},getBounds:function(){return null},CLASS_NAME:"DG.Layers.Shape.Rect"}),DG.Layers.ShapeFactory=DG.Class({_dgMap:null,_shapeCPStrStorage:null,initialize:function(e,t){if(DG.Utils.iNU(e)||!(e instanceof DG.Map))throw TypeError('Wrong "dgMap" parameter for DG.Layers.ShapeFactory constructor!');if(DG.Utils.iNU(t)||!(t instanceof DG.Layers.ContainPointStrategyStorage))throw TypeError('Wrong "shapeCPStrStorage" parameter for DG.Layers.ShapeFactory constructor!');this._dgMap=e,this._shapeCPStrStorage=t},getShape:function(e,t,i){if(DG.Utils.iNU(t)||"[object Array]"!==Object.prototype.toString.call(t))throw TypeError('Wrong data type! Parameter "data" should be an array');if(!(DG.Utils.iNU(i)||i instanceof DG.GeoPoint))throw TypeError('Wrong "basePoint" parameter, it should be an instance of DG.GeoPoint');var n;switch(e){case"circle":var r=t[1][0],o=[t[0]];return n=this._getPixData(o,i),new DG.Layers.Shape.Circle(n[0],r,this._shapeCPStrStorage.getStrategy(e));case"rect":return n=this._getPixData(t,i),new DG.Layers.Shape.Rect(n,this._shapeCPStrStorage.getStrategy(e));case"cpoly":return n=this._getPixData(t,i),new DG.Layers.Shape.CPoly(n,this._shapeCPStrStorage.getStrategy(e));case"npoly":return n=this._getPixData(t,i),new DG.Layers.Shape.NPoly(n,this._shapeCPStrStorage.getStrategy(e));default:throw TypeError("Wrong shape type!")}},_getPixData:function(e,t){var i,n=[];DG.Utils.iNU(t)||(i=this._dgMap.converter.coordinatesToGlobalPixels(t));for(var r=0;r<e.length;r++)e[r]instanceof DG.GeoPoint?n.push(this._dgMap.converter.coordinatesToGlobalPixels(e[r])):n.push(new DG.Point(i.x+e[r][0],i.y+e[r][1]));return n},destroy:function(){this._dgMap=null,this._shapeCPStrStorage=null},CLASS_NAME:"DG.Layers.ShapeFactory"}),DG.Layers.TileMap=DG.Class(DG.Layers.Common,{_noImageSrc:"http://maps.api.2gis.ru/images/nomap.png",wrapDateLine:!0,_observers:[],_noImageCSSClass:"olImageNoMap",_version:"46",initialize:function(){var e={isBaseLayer:!0,opacity:1,transitionEffect:"resize",tilePrefix:"tile",wrapDateLine:!0,countTileServers:4,numZoomLevels:DG.Configs.MAX_ZOOM+1},t=[this.LAYER_NAME,this.TILE_SERVER_URL,e];DG.Layers.Common.prototype.initialize.apply(this,t)},initializeBeforeAddOnMap:function(){DG.Layers.Common.prototype.initializeBeforeAddOnMap.apply(this,arguments),this._olLayer.events.on({loadend:this._fireMapLoadedEvent,scope:this})},onRemoveFromMap:function(){for(;this._observers.length;)this._observers.pop().cleanup()},_fireMapLoadedEvent:function(){DG.EventManager.caller(new DG.Events.Map(this.getDgMap()),this.getDgMap().getContainerId(),"DgMapLoaded")},getImageErrorSrc:function(){return this._noImageSrc},destroy:function(){this.onRemoveFromMap()},CLASS_NAME:"DG.Layers.TileMap",LAYER_NAME:"DgBaseLayer",TILE_SERVER_URL:"http://maps.2gis.com/tiles?x=${x}&y=${y}&z=${z}"}),DG.Layers.TrafficTouch=DG.Class(DG.Layers.Common,{_tileUrlTemplate:null,_plugin:null,_pluginName:null,_currentProject:null,_timeInterval:0,_actualTrafficTime:0,initialize:function(e,t,i){this._plugin=null,this._tileUrlTemplate=null,this._currentProject=null,this._timeInterval=0,this._currentProject=e;var n=new DG.Configs.Traffic;this._pluginName=n.pluginName,this._tileUrlTemplate=n.tileUrl;var r={};r.tilePrefix=n.tileServersPrefix,r.countTileServers=n.tileServersCount,this.setActualTrafficTime(i);var o=this._getTileUrl(),s=this._XYZClass;this._XYZClass=DG.Class(s,{minZoomLevel:n.minZoomLevel,moveTo:function(){this.map.getZoom()>=this.minZoomLevel&&this._isEnabled&&OpenLayers.Layer.XYZ.prototype.moveTo.apply(this,arguments)}});var a=[n.layerName,o,r];DG.Layers.Common.prototype.initialize.apply(this,a)},onAddToMap:function(){this._plugin=this._dgMap.getPlugin(this._pluginName),DG.Layers.Common.prototype.onAddToMap.apply(this)},onMapUpdate:function(e){return!1},getPlugin:function(){return this._plugin},setProject:function(e){this._currentProject=e},getProject:function(){return this._currentProject},redrawLayer:function(){this.setUrl(this._getTileUrl()),this.redraw()},setActualTrafficTime:function(e){this._actualTrafficTime=e},_getTileUrl:function(){var e=this._actualTrafficTime>0?this._actualTrafficTime:(new Date).getTime(),t=this._tileUrlTemplate.replace(/\$\{project\}/g,this.getProject()).replace("${interval}",this._timeInterval);return t+="?"+e},CLASS_NAME:"DG.Layers.TrafficTouch"}),DG.Locale.Dictionary.cs={_:function(e,t){return this[e][t%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2]},Expand:"Rozbalit",Recover:"Obnovit",Traffic:"Zácpy","%d points":["bod","body","bodů"],Slow:"Pomalu",Fast:"Rychle",Now:"Nyní",Usually:"Standardně",Mo:"Po",Tu:"Út",We:"St",Th:"Čt",Fr:"Pá",Sa:"So",Su:"Ne",Today:"dnes","According to 2GIS statistics":"Podle údajů ze statistiky 2GIS",monday:"pondělí",tuesday:"úterý",wednesday:"středa",thursday:"čtvrtek",friday:"pátek",saturday:"sobota",sunday:"neděle","in monday":"v pondělí","in tuesday":"v úterý","in wednesday":"ve středu","in thursday":"ve čtvrtek","in friday":"v pátek","in saturday":"v sobotu","in sunday":"v neděli","Zoom in":"Přiblížit","Zoom out":"Oddálit","Change zoom":"Změnit měřítko",PTC:"2GIS","2GIS":"Limited","License agreement":"Licenční smlouva","API 2GIS":"Pracuje na API 2GIS","Map data. Members":"Údaje na mapě. Účastníci","data loading":"Nahrávání dat","unknown place":"O tomto místě zatím nemáme informace",disctict:"Městská část",street:"Ulice","unnamed street":"bez názvu","%d elevation":["patro","patra","pater"],"station platform":"Zastávka",bus:"autobus",trolleybus:"trolejbus",tram:"tramvaj",minibus:"minibus taxi",
metro:"metro",eltrain:"vlak",funicular:"lanová dráha",monorail:"jednokolejka",river:"vodní doprava",ropeway:"lanová dráha",highspeed_tram:"expresní tramvaj",metrotram:"metrotramvaj",light_metro:"metro s malou kapacitou přepravy","Traffic state 1":"Klid na silnicích","Traffic state 2":"Na obzoru jsou maximálně dvě vozidla","Traffic state 3":"Plynulý provoz","Traffic state 4":"Provoz jedným pruhem","Traffic state 5":"Někdy si musíme &laquo;počkat&raquo;","Traffic state 6":"Spěcháme pomalu","Traffic state 7":"Cesta bude dlouhá","Traffic state 8":"Stojíme dobře!","Traffic state 9":"Lepší to bude pěšky nebo metrem","Traffic state 10":"Dopravní kolaps","Show organization in the building":"Zobrazit organizace v budově","Hide the organization in building":"Skrýt organizace v budově",Open:"Otevřeno",Close:"Zavřeno",lunch:"oběd",Lunch:"Oběd","Working days":"Pracovní dny","rest day":"nepracovní den",minutes:"minut","will open":"otevírá se","reviews on Flamp":"Recenze na Flampu","open in":"otevírá se za","write review on Flamp":"Napsat recenzi na Flampu",payment:"úhrada",daily:"každý den","works around the clock":"Pracuje nonstop","know more":"dozvědět se více","one hour":"1 hodina",hour:"hodiny",less:"méně",remains:"","pay internet":"Platba prostřednictvím Internetu","pay noncash":"Bezhotovostní platba","pay goldcrown":"Zolotaja Korona","pay dinersclub":"Diners Club","pay mastercard":"Mastercard","pay visa":"Visa","pay cash":"Platba hotově","pay americanexpress":"American Express","to close":"do zavření","is lunch":"oběd","working time":"pracovní doba","show all org in rubric":"Zobrazit všechny organizace v rubrice","today is restday":"dnes je nepracovní den",today:"dnes","today msg":"dnes","less then hour":"méně než hodina","you could late":"nemusíte to stihnout","to lunch":"do oběda","copyright logo":"http://praha.2gis.cz/?utm_source=copyright&utm_medium=map&utm_campaign=partners","copyright apilink":"http://praha.2gis.cz/?utm_source=copyright&utm_medium=map&utm_campaign=partners","copyright license":"http://law.2gis.cz/licensing-agreement/","copyright osmlink":"http://www.openstreetmap.org/",m:"m",km:"km",Ruler:"Pravítko",separator:",","remove point":"Odstranit bod"},DG.Locale.Dictionary.en={_:function(e,t){return this[e][t%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2]},Expand:"Expand",Recover:"Recover",Traffic:"Traffic","%d points":["point","points","points"],Slow:"Slow",Fast:"Fast",Now:"Now",Usually:"Normal",Mo:"Mon",Tu:"Tue",We:"Wed",Th:"Thu",Fr:"Fri",Sa:"Sat",Su:"Sun",Today:"Today","According to 2GIS statistics":"According to 2GIS statistics",monday:"Monday",tuesday:"Tuesday",wednesday:"Wednesday",thursday:"Thursday",friday:"Friday",saturday:"Saturday",sunday:"Sunday","in monday":"on Monday","in tuesday":"on Tuesday","in wednesday":"on Wednesday","in thursday":"on Thursday","in friday":"on Friday","in saturday":"on Saturday","in sunday":"on Sunday","Zoom in":"Zoom in","Zoom out":"Zoom out","Change zoom":"Zoom",PTC:"LLC","2GIS":"Double GIS","License agreement":"License agreement","API 2GIS":"Uses 2GIS API","Map data. Members":"Map data. Members","data loading":"Loading data","unknown place":"We haven't collected data on this place",disctict:"District",street:"Street","unnamed street":"without name","%d elevation":["floor","floors","floors"],"station platform":"Stop",bus:"bus",trolleybus:"trolleybus",tram:"tram",minibus:"shuttle bus",metro:"metro",eltrain:"suburban train",funicular:"funicular railway",monorail:"monorail",river:"water transport",ropeway:"cable car",highspeed_tram:"light rail",metrotram:"premetro",light_metro:"light metro","Traffic state 1":"Clear horizon","Traffic state 2":"Empty road","Traffic state 3":"Easy ride","Traffic state 4":"Heavy traffic","Traffic state 5":"Slow ride","Traffic state 6":"Occasional stoppages","Traffic state 7":"Bumper-to-bumper traffic","Traffic state 8":"Chock-a-block!","Traffic state 9":"You’ll better make a walk","Traffic state 10":"Traffic standstill","Show organization in the building":"Show organizations in the building","Hide the organization in building":"Hide organizations in the building",Open:"Open",Close:"Closed",lunch:"lunch",Lunch:"Lunch","Working days":"Working days","rest day":"holiday",minutes:"minutes","will open":"will open","reviews on Flamp":"Reviews on Flamp","open in":"open in","write review on Flamp":"Write a review on Flamp",payment:"payment",daily:"daily","works around the clock":"Open 24 hours","know more":"see also","one hour":"1 hour",hour:"hour",less:"less",remains:"","pay internet":"Online","pay noncash":"Non-cache","pay goldcrown":"Golden Crown","pay dinersclub":"Diners Club","pay mastercard":"Mastercard","pay visa":"Visa","pay cash":"Cash","pay americanexpress":"American Express","to close":"until closing","is lunch":"lunch","working time":"working hours","show all org in rubric":"Show all organizations in the category","today is restday":"closed today",today:"today","today msg":"today","less then hour":"less then one hour","you could late":"you might be late","to lunch":"until lunch","copyright logo":"http://limassol.2gis.com.cy/?utm_source=copyright&utm_medium=map&utm_campaign=partners","copyright apilink":"http://limassol.2gis.com.cy/?utm_source=copyright&utm_medium=map&utm_campaign=partners","copyright license":"http://law.2gis.com.cy/licensing-agreement/","copyright osmlink":"http://www.openstreetmap.org/",m:"m",km:"km",Ruler:"Ruler",separator:".","remove point":"Remove point"},DG.Locale.Dictionary.es={_:function(e,t){return this[e][t%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2]},Expand:"Desplegar",Recover:"Restaurar",Traffic:"Taco","%d points":["punto","punto","puntos"],Slow:"Despacio",Fast:"Rápido",Now:"Ahora",Usually:"Normalmente",Mo:"Lu",Tu:"Ma",We:"Mi",Th:"Ju",Fr:"Vi",Sa:"Sá",Su:"Do",Today:"hoy","According to 2GIS statistics":"Según los datos estadísticos de 2GIS",monday:"lunes",tuesday:"martes",wednesday:"miércoles",thursday:"jueves",friday:"viernes",saturday:"sábado",sunday:"domingo","in monday":"el lunes","in tuesday":"el martes","in wednesday":"el miércoles","in thursday":"el jueves","in friday":"el viernes","in saturday":"el sábado","in sunday":"el domingo","Zoom in":"Acercar","Zoom out":"Alejar","Change zoom":"Modificar escala",PTC:"S.L.","2GIS":"DublGIS","License agreement":"Acuerdo de licencia","API 2GIS":"Funciona con API 2GIS","Map data. Members":"Datos del mapa. Miembros","data loading":"Descarga de datos","unknown place":"Todavía no hemos recopilado la información sobre este lugar",disctict:"Comuna",street:"Calle","unnamed street":"sin nombre","%d elevation":["piso","piso","pisos"],"station platform":"Parada",bus:"autobús",trolleybus:"trolebús",tram:"tranvía",minibus:"minibús",metro:"metro",eltrain:"metrotren",funicular:"funicular",monorail:"monorraíl",river:"transporte fluvial",ropeway:"teleférico",highspeed_tram:"tren ligero",metrotram:"premetro",light_metro:"metro ligero","Traffic state 1":"Trayecto despejado","Traffic state 2":"No más de un par de vehículos a lo lejos","Traffic state 3":"La vía puede soportar el tráfico actual","Traffic state 4":"Desplazamiento en bloque","Traffic state 5":"En algunos lugares breves &laquo;espera&raquo;","Traffic state 6":"El desplazamiento es lento","Traffic state 7":"El trayecto será largo","Traffic state 8":"¡Estamos parados!","Traffic state 9":"Mejor a pie o en metro","Traffic state 10":"Colapso en las vías","Show organization in the building":"Mostrar empresas del edificio","Hide the organization in building":"Ocultar empresas del edificio",Open:"Abierto",Close:"Cerrado",lunch:"hora de colación",Lunch:"Hora de colación","Working days":"Días laborables","rest day":"fin de semana",minutes:"minutos","will open":"se abrirá","reviews on Flamp":"Comentarios en Flamp","open in":"se abre dentro de","write review on Flamp":"Escribir un comentario en Flamp",payment:"pago",daily:"diariamente","works around the clock":"Abierto las 24 horas","know more":"para saber más","one hour":"1 hora",hour:"hora",less:"menos de",remains:"","pay internet":"Pago por Internet","pay noncash":"Pago sin efectivo","pay goldcrown":"Zolotaya Korona","pay dinersclub":"Diners Club","pay mastercard":"Mastercard","pay visa":"Visa","pay cash":"Pago en efectivo","pay americanexpress":"American Express","to close":"hasta el cierre","is lunch":"hora de colación","working time":"horario de trabajo","show all org in rubric":"Mostrar todas las empresas de la categoría","today is restday":"hoy cerrado",today:"hoy","today msg":"hoy","less then hour":"menos de una hora","you could late":"puede que no llegue","to lunch":"antes de la hora de colación","copyright logo":"http://santiago.2gis.cl/?utm_source=copyright&utm_medium=map&utm_campaign=partners","copyright apilink":"http://santiago.2gis.cl/?utm_source=copyright&utm_medium=map&utm_campaign=partners","copyright license":"http://law.2gis.cl/licensing-agreement/","copyright osmlink":"http://www.openstreetmap.org/",m:"m",km:"km",Ruler:"Regla",separator:".","remove point":"Eliminar punto"},DG.Locale.Dictionary.it={_:function(e,t){return this[e][t%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2]},Expand:"Espandi",Recover:"Ripristina",Traffic:"Traffico","%d points":["punto","punti","punti"],Slow:"Lentamente",Fast:"Velocemente",Now:"Adesso",Usually:"Normalmente",Mo:"Lun",Tu:"Mar",We:"Mer",Th:"Gio",Fr:"Ven",Sa:"Sab",Su:"Dom",Today:"Oggi","According to 2GIS statistics":"",monday:"lunedi",tuesday:"martedì",wednesday:"mercoledì",thursday:"giovedi",friday:"venerdì",saturday:"sabato",sunday:"domenica","in monday":"il Lunedi","in tuesday":"il Martedì","in wednesday":"il Mercoledì","in thursday":"il Giovedi","in friday":"il Venerdì","in saturday":"il Sabato","in sunday":"la Domenica","Zoom in":"Zoom avanti","Zoom out":"Zoom indietro","Change zoom":"Modifica la scala",PTC:"Srl","2GIS":"Double GIS LLC","License agreement":"Accordo di licenza","API 2GIS":"2GIS API","Map data. Members":"Dati della mappa. Partecipanti a","data loading":"Caricamento dati in corso","unknown place":"Non disponiamo ancora di informazioni su questo posto",disctict:"Località",street:"Via","unnamed street":"nome non presente","%d elevation":["piano","piani","piani"],"station platform":"Fermata",bus:"autobus",trolleybus:"filobus",tram:"tram",minibus:"minibus",metro:"metropolitana",eltrain:"elettrotreno",funicular:"funicolare",monorail:"monorotaie",river:"trasporti fluviali",ropeway:"funivia",highspeed_tram:"tram",metrotram:"tram",light_metro:"metropolitana leggera","Traffic state 1":"","Traffic state 2":"","Traffic state 3":"","Traffic state 4":"","Traffic state 5":"","Traffic state 6":"","Traffic state 7":"","Traffic state 8":"","Traffic state 9":"","Traffic state 10":"","Show organization in the building":"Mostra le aziende presenti nell'edificio","Hide the organization in building":"Nascondere le aziende nell'edificio",Open:"Aperto",Close:"Chiuso",lunch:"pausa pranzo",Lunch:"Pausa pranzo","Working days":"Giorni feriali","rest day":"chiusura",minutes:"minuti","will open":"apre","reviews on Flamp":"Recensioni su Flamp","open in":"Riapre tra","write review on Flamp":"Scrivi una recensione su Flamp",payment:"pagamento",daily:"Ogni giorno dalle","works around the clock":"Operativo 24 ore su 24","know more":"ulteriori informazioni","one hour":"1h e",hour:"un'ora",less:"meno di",remains:"mancano","pay internet":"Pagamento on-line","pay noncash":"Pagamento non in contanti","pay goldcrown":"Zolotaja Korona","pay dinersclub":"Diners Club","pay mastercard":"MasterCard","pay visa":"Visa","pay cash":"Pagamento in contanti","pay americanexpress":"American Express","to close":"alla chiusura","is lunch":"Pranzo","working time":"Orario di lavoro","show all org in rubric":"Visualizza tutte le aziende della categoria","today is restday":"Oggi chiuso",today:"oggi","today msg":"","less then hour":"meno di un'ora","you could late":"Affrettarsi, chiusura imminente","to lunch":"alla pausa pranzo","copyright logo":"http://2gis.it/?utm_source=copyright&utm_medium=map&utm_campaign=partners","copyright apilink":"http://2gis.it/?utm_source=copyright&utm_medium=map&utm_campaign=partners","copyright license":"http://2gis.it/","copyright osmlink":"http://www.openstreetmap.org/",m:"m",km:"km",Ruler:"Righello",separator:".","remove point":"Rimuovere un punto"},DG.Locale.Dictionary.ru={_:function(e,t){return this[e][t%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2]},Expand:"Развернуть",Recover:"Восстановить",Traffic:"Пробки","%d points":["балл","балла","баллов"],Slow:"Медленно",Fast:"Быстро",Now:"Сейчас",Usually:"Обычно",Mo:"Пн",Tu:"Вт",We:"Ср",Th:"Чт",Fr:"Пт",Sa:"Сб",Su:"Вс",Today:"cегодня","According to 2GIS statistics":"По данным статистики 2ГИС",monday:"понедельник",tuesday:"вторник",wednesday:"среда",thursday:"четверг",friday:"пятница",saturday:"суббота",sunday:"воскресенье","in monday":"в понедельник","in tuesday":"во вторник","in wednesday":"в среду","in thursday":"в четверг","in friday":"в пятницу","in saturday":"в субботу","in sunday":"в воскресенье","Zoom in":"Приблизить","Zoom out":"Отдалить","Change zoom":"Изменить масштаб",PTC:"ООО","2GIS":"ДубльГИС","License agreement":"Лицензионное соглашение","API 2GIS":"Работает на API 2ГИС","Map data. Members":"Данные карты. Участники","data loading":"Загрузка данных","unknown place":"Мы ещё не собрали информацию об этом месте",disctict:"Район",street:"Улица","unnamed street":"без названия","%d elevation":["этаж","этажа","этажей"],"station platform":"Остановка",bus:"автобус",trolleybus:"троллейбус",tram:"трамвай",minibus:"микроавтобус",metro:"метро",eltrain:"электропоезд",funicular:"фуникулёр",monorail:"монорельса",river:"речной транспорт",ropeway:"канатная дорога",highspeed_tram:"скоростной трамвай",metrotram:"наземное метро",light_metro:"лёгкое метро","Traffic state 1":"Тишина на дорогах","Traffic state 2":"Не больше 2-х машин на горизонте","Traffic state 3":"Дороги хватит на всех","Traffic state 4":"Движение в едином потоке","Traffic state 5":"Местами кратковременные &laquo;подожди&raquo;","Traffic state 6":"Спешим медленно","Traffic state 7":"Дорога будет долгой","Traffic state 8":"Хорошо стоим!","Traffic state 9":"Лучше пешком или на метро","Traffic state 10":"Дорожный апокалипсис","Show organization in the building":"Показать организации в здании","Hide the organization in building":"Скрыть организации в здании",Open:"Открыто",Close:"Закрыто",lunch:"обед",Lunch:"Обед","Working days":"Рабочие дни","rest day":"выходной",minutes:"минут","will open":"откроется","reviews on Flamp":"Отзывы на Флампе","open in":"открывается через","write review on Flamp":"Написать отзыв на Флампе",payment:"оплата",daily:"ежедневно","works around the clock":"Работает круглосуточно","know more":"узнать больше","one hour":"1 час",hour:"час",less:"менее",remains:"","pay internet":"Оплата через Интернет","pay noncash":"Безналичный расчет","pay goldcrown":"Золотая Корона","pay dinersclub":"Diners Club","pay mastercard":"Mastercard","pay visa":"Visa","pay cash":"Наличный расчет","pay americanexpress":"American Express","to close":"до закрытия","is lunch":"обед","working time":"рабочее время","show all org in rubric":"Показать все организации рубрики","today is restday":"cегодня выходной",today:"cегодня","today msg":"cегодня","less then hour":"менее часа","you could late":"вы можете не успеть","to lunch":"до обеда","copyright logo":"http://info.2gis.ru/?utm_source=copyright&utm_medium=map&utm_campaign=partners","copyright apilink":"http://api.2gis.ru/?utm_source=copyright&utm_medium=map&utm_campaign=partners","copyright license":"http://help.2gis.ru/licensing-agreement/","copyright osmlink":"http://www.openstreetmap.org/",m:"м",km:"км",Ruler:"Линейка",separator:".","remove point":"Удалить точку"},DG.Map.HouseHighlightHelper=DG.Class({_dgMap:null,geomCollection:{},geomCollectionIndx:{},activeAreaId:null,_observers:{},_areasZoomLevels:{},_lastAjaxCallbackId:null,initialize:function(e){this._dgMap=e,this._bindEvents(),this._disableHighlightHandlers(),this._dgMap.getZoom()>=16&&(this._trackGroupGeomLoad(),this._enableHighlightHandlers())},destroy:function(){DG.AjaxManager.cancelCallback(this._lastAjaxCallbackId);for(var e in this._observers)this._observers[e].cleanup(),delete this._observers[e];for(var t in this.geomCollection)if(this.geomCollection.hasOwnProperty(t)&&"function"!=typeof t){for(var i=this.geomCollection[t].length,n=0;n<i[t];n++)i[t][n].destroy();delete this.geomCollection[t],delete this._areasZoomLevels[t]}},_bindEvents:function(){this._observers.MapInertiaDragStop=this._dgMap.addEventListener("DgInertiaDragStop",DG.Utils.bind(this._trackGroupGeomLoad,this)),this._observers.DgMapRedraw=this._dgMap.addEventListener("DgMapRedraw",DG.Utils.bind(this._trackGroupGeomLoad,this)),this._observers.MapZoomChange=this._dgMap.addEventListener("DgZoomChange",DG.Utils.bind(this._zoomChangeHandler,this))},_zoomChangeHandler:function(){this._dgMap.getZoom()>=16?(this._trackGroupGeomLoad(),this._enableHighlightHandlers()):this._disableHighlightHandlers()},_enableHighlightHandlers:function(){this._observers.MapInertiaDragStop.enable(),this._observers.DgMapRedraw.enable()},_disableHighlightHandlers:function(){this._observers.MapInertiaDragStop.disable(),this._observers.DgMapRedraw.disable()},_trackGroupGeomLoad:function(){var e,t,i,e=this._dgMap.layers._baseLayer.getOlLayer(),n=e.getExtent(),r=OpenLayers.Projection.transform({x:n.left,y:n.top},new OpenLayers.Projection("EPSG:900913"),new OpenLayers.Projection("EPSG:4326")),o=OpenLayers.Projection.transform({x:n.right,y:n.bottom},new OpenLayers.Projection("EPSG:900913"),new OpenLayers.Projection("EPSG:4326")),s=DG.Map.HIGHLIGHT_AREA_RATIO,a=(o.x-r.x)*s,l=(r.y-o.y)*s,h={},c={},u=this._dgMap.getZoom();if(h.x=r.x,h.y=r.y,c.x=o.x,c.y=o.y,r.x=r.x-a,r.y=r.y+l,o.x=o.x+a,o.y=o.y-l,t=r.x+","+r.y+","+o.x+","+o.y,this.geomCollection[t])return void(this.activeAreaId=t);for(var d in this.geomCollection)if(d=d.split(","),u==this._areasZoomLevels[d]&&d[0]<=h.x&&d[1]>=h.y&&d[2]>=c.x&&d[3]<=c.y)return void(this.activeAreaId=d[0]+","+d[1]+","+d[2]+","+d[3]);if(DG.Map.HIGHLIGHT_CACHED_AREAS_SIZE&&DG.Utils.getObjectSize(this.geomCollection)>=DG.Map.HIGHLIGHT_CACHED_AREAS_SIZE)for(var p in this.geomCollection)if(this.geomCollection.hasOwnProperty(p)){for(g=0;g<this.geomCollection[p].length;g++)this.geomCollection[p][g].destroy();delete this.geomCollection[p],delete this.geomCollectionIndx[p],delete this._areasZoomLevels[p];break}if(this.activeAreaId=t,i=this._getRequestBoundAreas(r,o),1==i.length)this._getHighlightGeometries(t,i[0],u);else if(i.length>1)for(var g=0;g<i.length;g++)this._getHighlightGeometries(t,i[g],u)},_getRequestBoundAreas:function(e,t){var i=t.x-e.x,n=e.y-t.y,r=parseFloat(DG.Map.HIGHLIGHT_API_BOUND_LIMIT),o=[];if(i/r>1||n/r>1){var s=e.x+i/2,a=e.y-n/2;o.push({point1:e.x+","+e.y,point2:s+","+a}),o.push({point1:s+","+e.y,point2:t.x+","+a}),o.push({point1:e.x+","+a,point2:s+","+t.y}),o.push({point1:s+","+a,point2:t.x+","+t.y})}else o.push({point1:e.x+","+e.y,point2:t.x+","+t.y});return o},_saveGeometries:function(e,t){if(t.response&&200==t.response.code){var i,n,r=this._dgMap.getZoom();this._areasZoomLevels[e]=r,"undefined"==typeof this.geomCollection[e]&&(this.geomCollection[e]=[],this.geomCollectionIndx[e]={});for(var o in t.result.data){if(t.result.data[o].geometry.selection3d)try{i=DG.WKTParser.getObject(t.result.data[o].geometry.selection3d)}catch(s){}else i=DG.WKTParser.getObject(t.result.data[o].geometry.location);n=this.geomCollection[e].push(i)-1,this._indexGeometry(e,n,i,r)}}},_indexGeometry:function(e,t,i,n){for(var r,o,s=i.getPoints(),a=0;a<s.length;a++)r=this._dgMap.converter.getTileNumByGeoPoint(s[a]),o=r.x+","+r.y+","+n,"undefined"==typeof this.geomCollectionIndx[e][o]&&(this.geomCollectionIndx[e][o]=[]),DG.Utils.inArray(t,this.geomCollectionIndx[e][o])||this.geomCollectionIndx[e][o].push(t)},_getHighlightGeometries:function(e,t,i){try{this._lastAjaxCallbackId=DG.AjaxManager.get({url:DG.Map.WEB_API2_SERVER+"/search?callback=$[callback]",data:{key:DG.Map.WEB_API2_KEY,type:"geo",geo_type:"house",point:t.point1,point2:t.point2,page_size:2e3,output:"jsonp",fields:"data.geometry.location,data.geometry.selection3d",zoom_level:i},success:function(t){this._saveGeometries(e,t)},scope:this})}catch(n){console.log("Error getting geometries via AjaxManager:",n)}}}),DG.Map.WEB_API2_SERVER="http://catalog.api.2gis.ru/2.0",DG.Map.WEB_API2_KEY="ruxlih0718",DG.Map.HIGHLIGHT_CACHED_AREAS_SIZE="10",DG.Map.HIGHLIGHT_AREA_RATIO="0.3",DG.Map.HIGHLIGHT_API_BOUND_LIMIT="0.025",DG.Map.KinematicZoomHelper=DG.Class({_dgMap:null,_stubLayer:null,_scaleTo:1,_currentScaling:1,_centerXOffset:0,_centerYOffset:0,_scalingTimerId:null,_dissolveTimerId:null,_zoomTo:null,_zoomPoint:null,_browser:null,initialize:function(e){this._dgMap=e,this._browser=DG.Utils.detectBrowser()},_flushData:function(){this._stubLayer=null,this._scaleTo=1,this._currentScaling=1,this._centerXOffset=0,this._centerYOffset=0,this._scalingTimerId=null,this._dissolveTimerId=null,this._zoomTo=null,this._zoomPoint=null},doubleClickZoomHandler:function(e){var t,i,n;e.isLeftButton()?t=1:e.isRightButton()&&(t=-1),n=this._detectInitialZoom(),i=this._dgMap.correctZoom(n+t),this._applyZoomChanges(n,i,e.point)},wheelZoomHandler:function(e){var t,i,n;n=this._getDelta(e),i=this._detectInitialZoom(),t=this._dgMap.correctZoom(i+n),this._applyZoomChanges(i,t,e.point)},zoomTo:function(e){var t,i;return i=this._detectInitialZoom(),t=this._dgMap.correctZoom(e),t!==i&&void this._applyZoomChanges(i,t)},zoomIn:function(){var e=this._detectInitialZoom();this.zoomTo(e+1)},zoomOut:function(){var e=this._detectInitialZoom();this.zoomTo(e-1)},_applyZoomChanges:function(e,t,i){var n;return window.clearInterval(this._dissolveTimerId),this._dissolveTimerId=null,t!==e&&(this._zoomTo=t,n=t-e,this._scaleTo*=Math.pow(2,n),DG.Utils.iNU(i)||this._setEventOffsetAndPoint(i),void(DG.Utils.iNU(this._scalingTimerId)&&(this._scalingTimerId=window.setInterval(DG.Utils.bind(this.provideScaling,this),DG.Map.KinematicZoomHelper.SCALING_TIME_STEP))))},provideScaling:function(){var e,t,i;this._scaleTo>1?this._currentScaling+=(this._scaleTo-this._currentScaling)/DG.Map.KinematicZoomHelper.SCALING_SPEED_FACTOR:this._currentScaling-=(this._currentScaling-this._scaleTo)/DG.Map.KinematicZoomHelper.SCALING_SPEED_FACTOR,Math.abs(this._currentScaling-this._scaleTo)>DG.Map.KinematicZoomHelper.COMPARATION_LIMIT?(e=this._getStubLayerContainer(),t=this._centerXOffset*(this._currentScaling-1),i=this._centerYOffset*-1*(this._currentScaling-1),this._scaleTo&&(this._dgMap.layers._baseLayer._olLayer.div.parentNode.style.opacity=0),this._applyTransformations(e,this._currentScaling,t,i)):(window.clearInterval(this._scalingTimerId),this._scalingTimerId=null,DG.Utils.iNU(this._zoomPoint)?this._dgMap.setZoom(this._zoomTo):this._dgMap.setCenter(this._calculateNewCenter(this._centerXOffset,this._centerYOffset),this._zoomTo),this._dissolveTimerId=window.setInterval(DG.Utils.bind(this.dissolveLayer,this),DG.Map.KinematicZoomHelper.OPACITY_TIME_STEP))},dissolveLayer:function(){if(DG.Utils.iNU(this._stubLayer.style.opacity)&&(this._stubLayer.style.opacity=1),this._dgMap.layers._baseLayer._olLayer.div.parentNode.style.opacity=1,this._stubLayer.style.opacity>DG.Map.KinematicZoomHelper.OPACITY_LIMIT)this._stubLayer.style.opacity-=DG.Map.KinematicZoomHelper.OPACITY_STEP,this._dgMap.layers._baseLayer._olLayer.div.parentNode.style.opacity+=DG.Map.KinematicZoomHelper.OPACITY_STEP;else if(window.clearInterval(this._dissolveTimerId),this._dissolveTimerId=null,!DG.Utils.iNU(this._stubLayer.parentNode)){var e=this._stubLayer.parentNode;e.removeChild(this._stubLayer),this._stubLayer=null,this._flushData()}},_calculateNewCenter:function(e,t){var i=this._dgMap.getResolutionForZoom(this._zoomTo),n=this._dgMap.getGeoPointFromPixel(this._zoomPoint.x,this._zoomPoint.y,!0);return new DG.GeoPoint(n.lon+e*i,n.lat+t*i,DG.GeoPoint.EPSG_900913)},_getDelta:function(e){return e.getDelta()},_detectInitialZoom:function(){return DG.Utils.iNU(this._zoomTo)?this._dgMap.getZoom():this._zoomTo},_setEventOffsetAndPoint:function(e){var t=this._dgMap.getContainerSize();this._centerXOffset=t.width/2-e.x,this._centerYOffset=e.y-t.height/2,this._zoomPoint=e},_getStubLayerContainer:function(){return DG.Utils.iNU(this._stubLayer)&&(this._stubLayer=this._dgMap.layers._baseLayer._olLayer.div.parentNode.cloneNode(!0),this._stubLayer.removeAttribute("id"),this._stubLayer.style.opacity=1,this._dgMap.layers._baseLayer._olLayer.div.parentNode.parentNode.appendChild(this._stubLayer)),this._stubLayer},_applyTransformations:function(e,t,i,n){switch(this._browser[0]){case"Chrome":e.style.WebkitTransform="matrix("+t+",0,0,"+t+","+i+", "+n+")";break;case"Firefox":e.style.MozTransform="matrix("+t+",0,0,"+t+","+i+", "+n+")";break;case"Safari":e.style.WebkitTransform="matrix("+t+",0,0,"+t+","+i+", "+n+")";break;case"IE":e.style["-ms-transform"]="matrix("+t+",0,0,"+t+","+i+", "+n+")";break;case"Opera":e.style.OTransform="matrix("+t+",0,0,"+t+","+i+", "+n+")"}}}),DG.Map.KinematicZoomHelper.SCALING_SPEED_FACTOR=2.5,DG.Map.KinematicZoomHelper.SCALING_TIME_STEP=33,DG.Map.KinematicZoomHelper.OPACITY_LIMIT=.05,DG.Map.KinematicZoomHelper.OPACITY_STEP=.15,DG.Map.KinematicZoomHelper.OPACITY_TIME_STEP=33,DG.Map.KinematicZoomHelper.COMPARATION_LIMIT=1e-4,DG.Map.MouseMoveTracker=DG.Class({_dgMap:null,_highlight:null,_mouseMoveTimer:null,_beam:null,_observers:{},initialize:function(e,t,i){this._dgMap=e,this._highlight=t,this._beam=i,this._bindEvents(),this._dgMap.getZoom()>=16&&this._enableTrackerHandlers()},destroy:function(){for(var e in this._observers)this._observers[e].cleanup(),delete this._observers[e];this._highlight.destroy()},_bindEvents:function(){this._observers.MapMouseMove=this._dgMap.addEventListener("DgMouseMove",DG.Utils.bind(this._mouseMoveHandler,this)),this._observers.MapDrag=this._dgMap.addEventListener("DgDrag",DG.Utils.bind(this._clearMouseMoveTimeout,this)),this._observers.MapMouseOut=this._dgMap.addEventListener("DgMouseOut",DG.Utils.bind(this._clearMouseMoveTimeout,this)),this._observers.MapZoomChange=this._dgMap.addEventListener("DgZoomChange",DG.Utils.bind(this._zoomChangeHandler,this)),this._disableTrackerHandlers()},_mouseMoveHandler:function(e){var t=this;this._clearMouseMoveTimeout(),this._mouseMoveTimer=window.setTimeout(function(){t._testPointOccurence(e.getGeoPoint())},DG.Map.MouseMoveTracker.MOUSEMOVE_TIMEOUT)},_clearMouseMoveTimeout:function(){window.clearTimeout(this._mouseMoveTimer)},_zoomChangeHandler:function(e){this._clearMouseMoveTimeout(),this._dgMap.getZoom()>=16?this._enableTrackerHandlers():this._disableTrackerHandlers()},_enableTrackerHandlers:function(){this._observers.MapMouseMove.enable(),this._observers.MapDrag.enable(),this._observers.MapMouseOut.enable()},_disableTrackerHandlers:function(){this._observers.MapMouseMove.disable(),this._observers.MapDrag.disable(),this._observers.MapMouseOut.disable(),this._highlightPointerOff()},_highlightPointerOn:function(){DG.Utils.DOM.addClass(this._dgMap.divMap,"dg-map-pointer")},_highlightPointerOff:function(){DG.Utils.DOM.removeClass(this._dgMap.divMap,"dg-map-pointer")},_testPointOccurence:function(e){var t,i=this._dgMap.getZoom(),n=this._dgMap.converter.getTileNumByGeoPoint(e),r=this._highlight.activeAreaId;if(r&&this._highlight.geomCollection[r])if(t=this._highlight.geomCollectionIndx[r][n.x+","+n.y+","+i],"undefined"!=typeof t)for(var o=0;o<t.length;o++){for(var s,a=t[o],l=this._highlight.geomCollection[r][a],h=l.getPoints(),c=[],u=0;u<h.length;u++)s=this._dgMap.converter.coordinatesToGlobalPixels(h[u]),c.push(s);if(this._beam.checkInclusion(c,this._dgMap.converter.coordinatesToGlobalPixels(e))){this._highlightPointerOn();break}this._highlightPointerOff()}else this._highlightPointerOff()}}),DG.Map.MouseMoveTracker.HIGHLIGHT_MOUSEMOVE_TIMEOUT="10",DG.Markers.Common=DG.Class(DG.Markers.Base,{_icon:null,lonlat:null,_observers:null,_observersDraggable:null,_dragStartObserver:null,_dragStopObserver:null,_clickCallback:null,_clickCallbackContext:null,_dragStartCallback:null,_dragStopCallback:null,_defaultIcon:null,_hoverIcon:null,_clickIcon:null,_isHidden:!1,_markerAnimationEnabled:!1,_markerAnimationTimeout:null,_iconActiveState:!1,_hintContent:null,_hintEnabled:!0,_isEnableShowHint:!0,_draggable:null,_draggingNow:null,_isHintShowed:!1,_isHintWasShowed:!1,_currentPoint:null,initialize:function(e){this._validateInitOptions(e),this._observers=[],this._id=DG.Utils.createUniqueID(this.CLASS_NAME),this.lonlat=e.geoPoint.clone(),this.lonlat.toMercator();var t=e.icon?e.icon:this._getStandardIcon();this._defaultIcon=t.clone(),this.icon=t,this.icon.imageDiv.className="dgMarker",this.icon.imageDiv.childNodes[0].className="dgIcon",this._hintContent="undefined"==typeof e.hint?e.hint:e.hint+"";var i=["clickIcon","hoverIcon","clickCallback","clickCallbackContext","draggable","dragStartCallback","dragStopCallback"];DG.Utils.extendOptionsProtected(this,e,i),e.couldShowHint&&(this.couldShowHint=e.couldShowHint),DG.Utils.isTouchDevice()||"function"!=typeof e.clickCallback&&!e.balloonOptions||e.icon||e.hoverIcon||e.clickIcon||this._enableMarkerAnimation()},destroy:function(){this.lonlat=null,this._destroyIcon()},show:function(){this._isHidden=!1,this.icon.display(!0)},hide:function(){this._isHidden=!0,this.icon.display(!1)},isHidden:function(){return this._isHidden},getPosition:function(){return this.lonlat.clone().toLonLat()},setPosition:function(e){var t;if(!(e instanceof DG.GeoPoint))throw new TypeError('Parameter "geoPoint" is required and should be instance of "DG.GeoPoint"');t=e.clone(),this.lonlat=t.toMercator(),this._riseUpdateEvent()},setIcon:function(e){if(!(e instanceof DG.Icon))throw new TypeError('Parameter "icon" is required and should be instance of "DG.Icon"');this.icon.url=e.url,this.icon.size=e.size,this.icon.offset=e.offset,this.icon.calculateOffset=e.calculateOffset,this._defaultIcon=this.icon.clone(),this.icon.draw()},setHoverIcon:function(e){if(!(e instanceof DG.Icon))throw new TypeError('Parameter "hoverIcon" is required and should be instance of "DG.Icon"');this._hoverIcon=e.clone()},changeIcon:function(e){if(!(e instanceof DG.Icon))throw new TypeError('Parameter "icon" is required and should be instance of "DG.Icon"');this.icon.url=e.url,this.icon.size=e.size,this.icon.offset=e.offset,this.icon.calculateOffset=e.calculateOffset,this.icon.draw()},getIcon:function(){return this.icon},setIconState:function(e,t){var i=this,t=t||100;switch(e){case"hover":this._iconActiveState=!1,clearTimeout(this._markerAnimationTimeout),DG.Utils.DOM.removeClass(this.icon.imageDiv,"dgMarkerMousedown"),DG.Utils.DOM.removeClass(this.icon.imageDiv,"dgMarkerActive"),DG.Utils.DOM.addClass(this.icon.imageDiv,"dgMarkerEmulateHover"),DG.Utils.DOM.addClass(this.icon.imageDiv,"dgMarkerMouseover");break;case"active":this._iconActiveState=!0,DG.Utils.DOM.addClass(this.icon.imageDiv,"dgMarkerMouseover"),DG.Utils.DOM.addClass(this.icon.imageDiv,"dgMarkerEmulateHover"),DG.Utils.DOM.addClass(this.icon.imageDiv,"dgMarkerMousedown"),DG.Utils.DOM.addClass(this.icon.imageDiv,"dgMarkerActive");break;default:this._iconActiveState=!1,DG.Utils.DOM.removeClass(i.icon.imageDiv,"dgMarkerEmulateHover"),this._markerAnimationTimeout=setTimeout(function(){DG.Utils.DOM.removeClass(i.icon.imageDiv,"dgMarkerMouseover"),DG.Utils.DOM.removeClass(i.icon.imageDiv,"dgMarkerMousedown"),DG.Utils.DOM.removeClass(i.icon.imageDiv,"dgMarkerActive")},t)}},draw:function(e){if(!(e instanceof DG.Point||e instanceof OpenLayers.Pixel))throw new TypeError('Point should be instance of "DG.Point"');return this.icon.draw(e)},isDrawn:function(){return this.icon&&this.icon.isDrawn()},getContainerId:function(){return this.getIcon().imageDiv.firstChild.id},getContainer:function(){return this.getIcon().imageDiv},setDgMap:function(e){if(!(e instanceof DG.Map))throw new ReferenceError('Parameter "dgMap" is required and should be instance of "DG.Map"');this._dgMap=e,this._observers=[],
this._observers.push(this._dgMap.addEventListener(this,"DgMouseOver",DG.Utils.bind(this._mouseOverHandler,this))),this._observers.push(this._dgMap.addEventListener(this,"DgMouseOut",DG.Utils.bind(this._mouseOutHandler,this))),this._observers.push(this._dgMap.addEventListener(this,"DgMouseMove",DG.Utils.bind(this._mouseMoveHandler,this))),this._observers.push(this._dgMap.addEventListener(this,"DgMouseDown",DG.Utils.bind(this._mouseDownHandler,this))),this._observers.push(this._dgMap.addEventListener(this,"DgMouseUp",DG.Utils.bind(this._mouseUpHandler,this))),this._draggable?this.enableDraggable():this._registerDragStopHandler()},_registerDragStopHandler:function(){this._dragStopObserver||(this._dragStopObserver=this._dgMap.addEventListener(this._dgMap.getContainerId(),"DgDragStop",DG.Utils.bind(this._handleOnDragStop,this)))},_registerDragStartHandler:function(){this._dragStartObserver||(this._dragStartObserver=this._dgMap.addEventListener(this._dgMap.getContainerId(),"DgDragStart",DG.Utils.bind(this._handleOnDragStart,this)))},onRemoveFromMap:function(){this.icon.erase()},initializeBeforeAddOnMap:function(){this._initCallbacks()},clearBeforeRemoveFromMap:function(){this._removeHandlers(),this._removeDraggableHandlers(),this._removeDragStartHandler(),this._removeDragStopHandler(),this._dgMap=null},onScreen:function(){var e=this._dgMap.getBounds();return e.contains(this.lonlat)},_validateInitOptions:function(e){if(DG.Utils.empty(e))throw new ReferenceError("Options is required and should be set");if(!(e.geoPoint instanceof DG.GeoPoint))throw new TypeError('Option "geoPoint" is required and should be instance of "DG.GeoPoint"');if(!(DG.Utils.empty(e.icon)||e.icon instanceof DG.Icon))throw new TypeError('Option "icon" should be an instance of "DG.Icon"');if(!(DG.Utils.iNU(e.hoverIcon)||e.hoverIcon instanceof DG.Icon))throw new TypeError("Hover icon must be an instance of DG.Icon");if(!(DG.Utils.iNU(e.clickIcon)||e.clickIcon instanceof DG.Icon))throw new TypeError("Click icon must be an instance of DG.Icon");if(!(DG.Utils.empty(e.clickCallback)||e.clickCallback instanceof Function))throw new TypeError('Option "clickCallback" should be a function');if(!DG.Utils.empty(e.draggable)&&"[object Boolean]"!==Object.prototype.toString.call(e.draggable))throw new TypeError('Option "draggable" should be Boolean');if(!(DG.Utils.empty(e.dragStartCallback)||e.dragStartCallback instanceof Function))throw new TypeError('Option "dragStartCallback" should be a function');if(!(DG.Utils.empty(e.dragStopCallback)||e.dragStopCallback instanceof Function))throw new TypeError('Option "dragStopCallback" should be a function')},_getStandardIcon:function(){var e=DG.Utils.getScreenDensity(),t=DG.Utils.getAdaptiveIcon({desktop:["http://maps.api.2gis.ru/images/markers/"+e+"-standard.png",15,23],mobile:["http://maps.api.2gis.ru/images/markers/"+e+"-standard.png",24,38]});return t},_enableMarkerAnimation:function(){DG.Utils.DOM.addClass(this.icon.imageDiv,"dgMarkerWithAnimation"),this._markerAnimationEnabled=!0},_disableMarkerAnimation:function(){DG.Utils.DOM.removeClass(this.icon.imageDiv,"dgMarkerWithAnimation"),this._markerAnimationEnabled=!1},_getDefaultIcon:function(){return this._defaultIcon},_destroyIcon:function(){null!=this.icon&&(this.icon.destroy(),this.icon=null)},_mouseOverHandler:function(e){this._clickCallback&&e.getMap().addCursor(DG.Cursor.POINTER),DG.Utils.iNU(this._hoverIcon)||this.changeIcon(this._hoverIcon),this._markerAnimationEnabled&&!this._iconActiveState&&this.setIconState("hover"),!DG.Utils.empty(this._hintContent)&&this._hintEnabled&&this._isEnableShowHint&&(this._dgMap.hint.setPosition(e.getPoint()),this._showHint())},_mouseOutHandler:function(e){this._clickCallback&&e.getMap().removeCursor(DG.Cursor.POINTER),DG.Utils.iNU(this._hoverIcon)||this.changeIcon(this._defaultIcon),this._markerAnimationEnabled&&!this._iconActiveState&&this.setIconState("default"),this._hideHint()},_mouseMoveHandler:function(e){this._dgMap.hint.isShown()&&this._dgMap.hint.setPosition(e.getPoint())},_mouseDownHandler:function(e){DG.Utils.iNU(this._clickIcon)||this.changeIcon(this._clickIcon),this._draggable||DG.Utils.empty(this._hintContent)||!this._hintEnabled||this._registerDragStartHandler()},_handleOnDragStart:function(){this._isEnableShowHint=!1,this._hideHint()},_mouseUpHandler:function(e){DG.Utils.iNU(this._clickIcon)||(DG.Utils.iNU(this._hoverIcon)?this.changeIcon(this._getDefaultIcon()):this.changeIcon(this._hoverIcon)),this._draggable||DG.Utils.empty(this._hintContent)||!this._hintEnabled||(this._isEnableShowHint=!0,this._dgMap.hint.setPosition(e.getPoint()),this._showHint()),this._hintEnabled||this._hideHint()},_handleOnDragStop:function(){this._isEnableShowHint=!0},_initCallbacks:function(){this._clickCallback&&this._observers.push(this._dgMap.addEventListener(this.icon.imageDiv.id,"DgClick",DG.Utils.bind(this._clickWrapper,this)))},_clickWrapper:function(e){var t,i;if(this._clickCallback)return i=this._clickCallback,i=DG.Utils.empty(this._clickCallbackContext)?DG.Utils.bind(this._clickCallback,this):DG.Utils.bind(this._clickCallback,this._clickCallbackContext),t=this,i(e,t)},_removeHandlers:function(){for(var e in this._observers)this._observers.hasOwnProperty(e)&&(this._observers[e].cleanup(),this._observers[e]=null);this._observers=null},_removeDraggableHandlers:function(){for(var e in this._observersDraggable)this._observersDraggable.hasOwnProperty(e)&&(this._observersDraggable[e].cleanup(),this._observersDraggable[e]=null);this._observersDraggable=null},_removeDragStopHandler:function(){this._dragStopObserver&&(this._dragStopObserver.cleanup(),this._dragStopObserver=null)},_removeDragStartHandler:function(){this._dragStartObserver&&(this._dragStartObserver.cleanup(),this._dragStartObserver=null)},_riseUpdateEvent:function(){DG.Utils.iNU(this._dgMap)||DG.EventManager.caller(new DG.Events.Overlay(this),this._dgMap.getContainerId(),"DgMarkerUpdate")},setZIndex:function(e){this.icon.imageDiv.style.zIndex=e},_showHint:function(){("function"!=typeof this.couldShowHint||this.couldShowHint())&&(this._isHintShowed=!0,this._dgMap.hint.setContent(this._hintContent),this._dgMap.hint.show())},_hideHint:function(){this._isHintShowed=!1,this._dgMap.hint.isShown()&&this._dgMap.hint.hide()},_isHintShow:function(){return this._isHintShowed},setHintContent:function(e){this._hintContent=e+""},getHintContent:function(){return this._hintContent},enableDraggable:function(){this._observersDraggable||(this._observersDraggable=[],this._observersDraggable.push(this._dgMap.addEventListener(this,"DgDragStart",DG.Utils.bind(this._handleDragStart,this))),this._observersDraggable.push(this._dgMap.addEventListener(this,"DgDrag",DG.Utils.bind(this._handleDrag,this))),this._observersDraggable.push(this._dgMap.addEventListener(this,"DgDragStop",DG.Utils.bind(this._handleDragStop,this))),this._observersDraggable.push(this._dgMap.addEventListener(this._dgMap.getContainerId(),"DgZoomChange",DG.Utils.bind(this._handleZoomChange,this))),this._removeDragStopHandler(),this._removeDragStartHandler(),this._draggable=!0)},disableDraggable:function(){this._removeDraggableHandlers(),this._registerDragStopHandler(),this._draggable=!1},getDraggable:function(){return this._draggable},_handleDragStart:function(e){return this._draggingNow=!0,this._dgMap.setCursor(DG.Cursor.MOVE),DG.Utils.DOM.addClass(this.getContainer(),"dg-marker-draggable"),this._isEnableShowHint=!1,this._hideHintOnDragStart(),this._dragStartCallback&&this._dragStartCallback(this),!0},_handleDrag:function(e){var t,i,n,r,o;return this._draggingNow=!0,this._currentPoint=e.point,t=this._dgMap.converter.coordinatesToMapPixels(this.getPosition()),i=e.delta[0],n=e.delta[1],r=new DG.Point(t.x-i,t.y-n),o=this._dgMap.converter.mapPixelsToCoordinates(r),this.setPosition(o),this._dragCallback&&this._dragCallback(this,r),!0},_handleDragStop:function(e){return!this._draggingNow||(this._draggingNow=!1,this._dgMap.setCursor(DG.Cursor.ARROW),DG.Utils.DOM.removeClass(this.getContainer(),"dg-marker-draggable"),this._isEnableShowHint=!0,this._showHintOnDragStop(e),this._dragStopCallback&&this._dragStopCallback(this),!0)},_handleZoomChange:function(){var e,t,i,n=.6;this._draggingNow&&this._currentPoint&&this._currentPoint.x&&this._currentPoint.y&&(i=this.getIcon().size.h*n,e=new DG.Point(this._currentPoint.x,this._currentPoint.y+i),t=this._dgMap.converter.mapPixelsToCoordinates(e),this.setPosition(t))},_hideHintOnDragStart:function(){this._isHintWasShowed=this._dgMap.hint.isShown(),this._hideHint()},_showHintOnDragStop:function(e){this._isHintWasShowed&&(this._dgMap.hint.setPosition(e.getPoint()),this._showHint())},CLASS_NAME:"DG.Markers.Common"}),DG.Markers.MarkerWithBalloon=DG.Class(DG.Markers.Common,{_balloon:null,_balloonOptions:null,initialize:function(e){this._validateBalloonOptions(e.balloonOptions),this._balloonOptions=e.balloonOptions,DG.Utils.iNU(this._balloonOptions.contentHtml)&&(this._balloonOptions.contentHtml=""),DG.Markers.Common.prototype.initialize.apply(this,arguments)},hide:function(){DG.Markers.Common.prototype.hide.call(this),DG.Utils.iNU(this._balloon)||this._balloon.hide()},setPosition:function(e){DG.Markers.Common.prototype.setPosition.call(this,e),this._balloon&&this._balloon.setPosition(e)},showBalloon:function(){var e=this;DG.Utils.iNU(this._balloon)?this._getOwnBalloon():this._balloon.show(),DG.Utils.empty(this._balloonOptions.shouldHideIcon)||this.icon.display(!1),(DG.Utils.iNU(this._balloonOptions.showLatestOnly)||this._balloonOptions.showLatestOnly===!0)&&(DG.EventManager.caller(new DG.Events.Overlay(this._balloon),this._dgMap.getMapContainerId(),"DgMarkerBalloonShow"),DG.Utils.iNU(this._observers.DgMarkerBalloonShow)?this._observers.DgMarkerBalloonShow=this._dgMap.addEventListener("DgMarkerBalloonShow",DG.Utils.bind(this._markerBalloonShowHandler,this)):this._observers.DgMarkerBalloonShow.enable(),DG.Utils.iNU(this._observers.DgBalloonHide)?this._observers.DgBalloonHide=this._dgMap.addEventListener(this._balloon.getContainerId(),"DgBalloonHide",DG.Utils.bind(this._hideBalloonHandler,this)):this._observers.DgBalloonHide.enable(),this._dgMap.addEventListener(this._balloon.getHelper().getCloseId(),"DgClick",function(t){e.setIconState("default")})),this.setIconState("active"),this._hintEnabled=!1,DG.EventManager.caller(new DG.Events.Overlay(this),this.getContainerId(),"DgBalloonShow")},_getOwnBalloon:function(){this._balloon=new DG.Balloons.Common({geoPoint:this.getPosition(),adjustMapCenterToBalloon:this._balloonOptions.adjustMapCenterToBalloon,contentHtml:this._balloonOptions.contentHtml,headerContentHtml:this._balloonOptions.headerContentHtml,footerContentHtml:this._balloonOptions.footerContentHtml,isClosed:this._balloonOptions.isClosed,contentSize:this._balloonOptions.contentSize,fixedRelativePosition:this._balloonOptions.fixedRelativePosition,maxContentHeight:this._balloonOptions.maxContentHeight,maxContentWidth:this._balloonOptions.maxContentWidth,closeCallback:this._balloonOptions.closeCallback}),this._dgMap.balloons.add(this._balloon,"__markerOwnBalloonGroup__"),this._balloon.show()},hideBalloon:function(){DG.Utils.iNU(this._balloon)||(this._balloon.hide(),DG.Utils.iNU(this._observers.DgMarkerBalloonShow)||this._observers.DgMarkerBalloonShow.disable(),DG.Utils.iNU(this._observers.DgBalloonHide)||this._observers.DgBalloonHide.disable(),this._balloonOptions.shouldHideIcon&&this.icon.display(!0),this._hintEnabled=!0)},setBalloonContent:function(e){if(DG.Utils.iNU(e)||"[object String]"!==Object.prototype.toString.call(e))throw TypeError('"setBalloonContent" is waiting for a string as parameter!');this._balloonOptions.contentHtml=e,DG.Utils.iNU(this._balloon)||this._balloon.setContent(this._balloonOptions.contentHtml)},getBalloonContent:function(){return this._balloonOptions.contentHtml},setBalloonContentSize:function(e){if(!(e instanceof DG.Size))throw new TypeError('Option size should be an instance of "DG.Size"');this._balloonOptions.contentSize=e,DG.Utils.iNU(this._balloon)||this._balloon.setSize(e)},getBalloonContentSize:function(){return this._balloonOptions.contentSize},setBalloonHeaderContent:function(e){if(DG.Utils.iNU(e)||"[object String]"!==Object.prototype.toString.call(e))throw TypeError('"headerContentHtml" is waiting for a string as parameter!');this._balloonOptions.headerContentHtml=e,DG.Utils.iNU(this._balloon)||this._balloon.setHeaderContent(this._balloonOptions.headerContentHtml)},getBalloonHeaderContent:function(){return this._balloonOptions.headerContentHtml},setBalloonFooterContent:function(e){if(DG.Utils.iNU(e)||"[object String]"!==Object.prototype.toString.call(e))throw TypeError('"footerContentHtml" is waiting for a string as parameter!');this._balloonOptions.footerContentHtml=e,DG.Utils.iNU(this._balloon)||this._balloon.setFooterContent(this._balloonOptions.footerContentHtml)},getBalloonFooterContent:function(){return this._balloonOptions.footerContentHtml},_validateBalloonOptions:function(e){if(DG.Utils.iNU(e))throw new Error("Marker of this type should not be created without balloonOptions");if(!DG.Utils.iNU(e.contentHtml)&&"[object String]"!=Object.prototype.toString.call(e.contentHtml))throw new TypeError("'contentHtml' should be a string");if(!DG.Utils.iNU(e.headerContentHtml)&&"[object String]"!=Object.prototype.toString.call(e.headerContentHtml))throw new TypeError("'headerContentHtml' should be a string");if(!DG.Utils.iNU(e.footerContentHtml)&&"[object String]"!=Object.prototype.toString.call(e.footerContentHtml))throw new TypeError("'footerContentHtml' should be a string");if(!DG.Utils.iNU(e.showLatestOnly)&&"[object Boolean]"!==Object.prototype.toString.call(e.showLatestOnly))throw new TypeError("'showLatestOnly' should be a boolean value");if(!DG.Utils.iNU(e.shouldHideIcon)&&"[object Boolean]"!==Object.prototype.toString.call(e.shouldHideIcon))throw new TypeError("'shouldHideIcon' should be a boolean value");if(!DG.Utils.iNU(e.isClosed)&&"[object Boolean]"!==Object.prototype.toString.call(e.isClosed))throw new TypeError("'isClosed' should be a boolean value");if(!DG.Utils.iNU(e.adjustMapCenterToBalloon)&&"[object Boolean]"!==Object.prototype.toString.call(e.adjustMapCenterToBalloon))throw new TypeError("'adjustMapCenterToBalloon' should be a boolean value");if(!(DG.Utils.empty(e.contentSize)||e.contentSize instanceof DG.Size))throw new TypeError("Content size should be an instance of DG.Size");if(!DG.Utils.iNU(e.fixedRelativePosition)&&"[object Boolean]"!==Object.prototype.toString.call(e.fixedRelativePosition))throw new TypeError("'fixedRelativePosition' should be Boolean!");if(!DG.Utils.iNU(e.closeCallback)&&"[object Function]"!==Object.prototype.toString.call(e.closeCallback))throw new TypeError('Option "closeCallback" should be Function');this._initializeMaxContentHeight(e.maxContentHeight),this._initializeMaxContentWidth(e.maxContentWidth)},_initializeMaxContentHeight:function(e){if(void 0!==e){if("[object Number]"!==Object.prototype.toString.call(e))throw new TypeError('Option "maxContentHeight" should be Number');this._maxContentHeight=e}},_initializeMaxContentWidth:function(e){if(void 0!==e){if("[object Number]"!==Object.prototype.toString.call(e))throw new TypeError('Option "maxContentWidth" should be Number');var t=850;if(e>t)throw new ReferenceError("Maximum acceptable balloon maxContentWidth is "+t+"px");var i=87;if(e<i)throw new ReferenceError("Minimal acceptable balloon maxContentWidth is "+i+"px");this._maxContentWidth=e}},_clickCallback:function(){DG.Utils.empty(this._balloonOptions)||(DG.Utils.iNU(this._balloon)||!this._balloon.isVisible()?this.showBalloon():(this.hideBalloon(),this.setIconState("hover")))},_markerBalloonShowHandler:function(e){this._balloon.getId()!==e.getOverlay().getId()&&(DG.Utils.iNU(this._balloonOptions.showLatestOnly)||this._balloonOptions.showLatestOnly===!0)&&(this.hideBalloon(),this.setIconState("default"))},_hideBalloonHandler:function(e){this._balloon.getId()===e.getOverlay().getId()&&this._balloonOptions.shouldHideIcon&&this.icon.display(!0),this._hintEnabled=!0,DG.EventManager.caller(new DG.Events.Overlay(this),this.getContainerId(),"DgBalloonHide")},isBalloonVisible:function(){return!!this._balloon&&this._balloon.isVisible()},CLASS_NAME:"DG.Markers.MarkerWithBalloon"}),DG.mockEvents={destroy:function(){}},DG.Overlays.ActiveHint=DG.Class({_container:null,_position:{x:0,y:0},_dgMap:null,_isShown:!1,_content:null,_owner:null,_static:!1,_contentWrapperId:null,_contentWrapperStart:null,_contentWrapperEnd:null,_closeButtonId:null,_closeButton:null,forceHide:!0,initialize:function(e,t){return t=t||{},this._validateInitParams(e,t),this.observers=[],this._customHintClass=" "+t.hintClass||"",this._dgMap=e,this._id=DG.Utils.createUniqueID(this.CLASS_NAME),this._contentWrapperId=DG.Utils.createUniqueID(this.CLASS_NAME+"_contentWrapper"),this.contentWrapperStart('<div id="'+this.getContentWrapperId()+'" class="dg-active-hint'+this._customHintClass+'">'),this.contentWrapperEnd("</div>"),this._closeButtonId=DG.Utils.createUniqueID(this.CLASS_NAME+"_closeButton"),this._closeButtonTitle=t.closeButtonTitle||"",this._closeButton=' <span id="'+this._closeButtonId+'" class="dg-close-active-hint" title="'+this._closeButtonTitle+'"></span>',this._container=DG.Utils.createDiv(DG.Utils.createUniqueID(this.CLASS_NAME)),this._container.style.left=this._position.x+"px",this._container.style.top=this._position.y+"px",this._container.style.maxWidth=t.maxWidth||"none",this._container.style.maxHeight=t.maxHeight||"none",this._container.style.width=t.width||"300px",this._container.style.zIndex=700,this.initHandlers(),this},initHandlers:function(){var e=this,t=e.getContainerId();this.observers.push(this._dgMap.addEventListener(t,"DgMouseOver",function(){e.owner()&&e.owner().isLast()||(e.forceHide=!1)}),this._dgMap.addEventListener(this.getContentWrapperId(),"DgMouseOut",function(t){e.owner()&&e.owner().isLast()||t.windowEvent.relatedTarget!==document.getElementById(e.getCloseButtonId())&&t.windowEvent.toElement!==document.getElementById(e.getCloseButtonId())&&(e.forceHide=!0,e.hide())}),this._dgMap.addEventListener(e.getCloseButtonId(),"DgMouseOver",function(e){return!0}),this._dgMap.addEventListener(e.getCloseButtonId(),"DgMouseOut",function(e){return!0}),this._dgMap.addEventListener(t,"DgDoubleClick",function(e){return!0}),this._dgMap.addEventListener(t,"DgClick",function(e){return!0}),this._dgMap.addEventListener(t,"DgDragStart",function(e){return!0}),this._dgMap.addEventListener(t,"DgDrag",function(e){return!0}),this._dgMap.addEventListener(t,"DgDragStop",function(e){return!0}),this._dgMap.addEventListener("DgZoomChange",function(t){e._isShown&&e.owner()&&e.setPosition(e.owner().pxPoint())}),this._dgMap.addEventListener("DgViewResize",function(t){e._isShown&&e.owner()&&e.setPosition(e.owner().pxPoint())}),this._dgMap.addEventListener("DgMapRedraw",function(t){e._isShown&&e.owner()&&e.setPosition(e.owner().pxPoint())}))},owner:function(e){return e&&(this._owner=e),this._owner},getCloseButtonId:function(){return this._closeButtonId},getCloseButton:function(){return this._closeButton},getContentWrapperId:function(){return this._contentWrapperId},contentWrapperStart:function(e){return e&&(this._contentWrapperStart=e),this._contentWrapperStart},contentWrapperEnd:function(e){return e&&(this._contentWrapperEnd=e),this._contentWrapperEnd},getContent:function(){return this._content},setContent:function(e){if("[object String]"!==Object.prototype.toString.call(e))throw new TypeError('Parameter "content" is required and should be a string');this._content=e,this._container.innerHTML=this.contentWrapperStart()+this._content+this.contentWrapperEnd()},getPosition:function(){return this._position},setPosition:function(e){if(!(e instanceof DG.Point))throw new TypeError('Parameter "position" is required and should be an instance of "DG.Point"');this.isShown()&&this.hide(),this._position=e,this.show();var t=this._container.childNodes[0];if(t&&t.offsetWidth&&t.offsetHeight){var i=parseFloat(this._dgMap.getOlMap().layerContainerDiv.style.left),n=parseFloat(this._dgMap.getOlMap().layerContainerDiv.style.top);this._position.x-=i,this._position.y-=n,this._container.style.left=this._position.x-t.offsetWidth/2+"px",this._container.style.top=this._position.y-(t.offsetHeight/2+25)+"px"}},_added:!1,show:function(){this._added||(this._dgMap.getOlMap().layerContainerDiv.appendChild(this._container),this._added=!0),this._container.style.display="block",this._isShown=!0},hide:function(){null!=document.getElementById(this._container.id)&&(this._container.style.display="none"),this._isShown=!1},isShown:function(){return this._isShown},getContainerId:function(){return this._container.id},getContainer:function(){return this._container},removeCloseButton:function(){var e=document.getElementById(this.getCloseButtonId());e&&e.parentNode&&e.parentNode.removeChild(e)},destroy:function(){this._dgMap=null,this._container=null,this._position=null;for(var e=0;e<this.observers.length;e++)this.observers[e].cleanup();this.observers=null},_validateInitParams:function(e,t){if(!(e instanceof DG.Map))throw new TypeError('Parameter "dgMap" should be an instance of "DG.Map"');if("undefined"!=typeof t.maxWidth&&"[object Number]"!==Object.prototype.toString.call(t.maxWidth))throw new TypeError('Option "maxWidth" should be a number');if("undefined"!=typeof t.maxHeight&&"[object Number]"!==Object.prototype.toString.call(t.maxHeight))throw new TypeError('Option "maxHeight" should be a number')},CLASS_NAME:"DG.Overlays.ActiveHint"}),DG.Copyrights=DG.Class(DG.IOverlay,DG.IObservable,{_displayClass:"DGControlsCopyright",_dgMap:null,_zIndex:null,infoHtml:null,_divView:null,_position:new DG.Point(7,5),_observers:[],initialize:function(){this._observers=[],this.id=DG.Utils.createUniqueID(this.CLASS_NAME)},registerHandlers:function(){this._observers.push(this._dgMap.addEventListener("DgLanguageChange",DG.Utils.bind(this.onLanguageChange,this)),this._dgMap.addEventListener("DgMapMove",DG.Utils.bind(this.onMapMove,this)))},destroy:function(){for(var e,e=0;e<this._observers.length;e++)this._observers[e].cleanup(),delete this._observers[e];DG.EventManager.removeIgnorElementDomID(this.getContainerId())},setDgMap:function(e){DG.Controls.Base.prototype.setDgMap.call(this,e),this.registerHandlers(),DG.EventManager.addIgnorElementDomID(this.getContainerId())},getId:function(){return this.id},setZIndex:function(e){this._divView.style.zIndex=e},getZIndex:function(){return this._divView.style.zIndex},getDgMap:function(){return this._dgMap},draw:function(){return null==this._divView&&(this._divView=DG.Utils.createDiv(this.id),this._divView.className=this._displayClass,this._divView.style.right=this._position.x+"px",this._divView.style.bottom=this._position.y+"px",this._divView.style.textAlign="right"),this._divView},onMapMove:function(e){this.updateCopyrights()},onLanguageChange:function(e){this.updateCopyrights()},updateCopyrights:function(){var e=this._dgMap.locale._currentLang,t=this.checkUsageOnlyDGApi(),i='<div class="dg-mapcopyright dg-mapcopyright_lang_'+e+'">\n                <a href="'+this._dgMap.locale.t("copyright logo")+'"" class="dg-mapcopyright__logolink" target="_blank" alt="'+this._dgMap.locale.t("PTC")+" "+this._dgMap.locale.t("2GIS")+'">\n                    <span class="dg-mapcopyright__logo"></span>\n                </a>\n';t||(i+='<a class="dg-link dg-mapcopyright__osmlink" href="'+this._dgMap.locale.t("copyright osmlink")+'" target="_blank" alt="'+this._dgMap.locale.t("OpenStreetMap contributors")+'">'+this._dgMap.locale.t("OpenStreetMap contributors")+"</a>\n"),i+='<a class="dg-link dg-mapcopyright__apilink" href="'+this._dgMap.locale.t("copyright apilink")+'" target="_blank" alt="'+this._dgMap.locale.t("API 2GIS")+'"></a>\n                <a class="dg-link dg-mapcopyright__license" href="'+this._dgMap.locale.t("copyright license")+'" target="_blank" alt="'+this._dgMap.locale.t("License agreement")+'"></a>\n            </div>',this.infoHtml!=i&&(this.infoHtml=i,this._divView.innerHTML=this.infoHtml)},checkUsageOnlyDGApi:function(){var e=this._dgMap.getBounds(),t=this._dgMap.getCurrentProject();return null===e||t===!1||t.bound.containsBounds(e)},getContainerId:function(){return this._divView.id},onAddToMap:function(){this.updateCopyrights()},onMapUpdate:function(){},onRemoveFromMap:function(){this._divView&&this._divView.parentNode==this._dgMap.getViewPortContainer()&&this._dgMap.getViewPortContainer().removeChild(this._divView)},enableDraggable:function(){},disableDraggable:function(){},getPointBounds:function(){return DG.Utils.iNU(this._divView)?null:DG.Utils.getPointBounds(this._divView,this.getDgMap().getContainerId())},CLASS_NAME:"DG.Copyrights"}),DG.Overlays.Hint=DG.Class({_container:null,_position:new DG.Point(0,0),_dgMap:null,_isShown:!1,_content:null,initialize:function(e,t){t=t||{},this._validateInitParams(e,t),this._dgMap=e,this._container=DG.Utils.createDiv(DG.Utils.createUniqueID(this.CLASS_NAME)),this._container.style.left=this._position.x+"px",this._container.style.top=this._position.y+"px",this._container.style.maxWidth=t.maxWidth||"none",this._container.style.maxHeight=t.maxHeight||"none",this._container.style.width=t.width||"300px",this._container.style.zIndex=999},getContent:function(){return this._content},setContent:function(e){if("[object String]"!==Object.prototype.toString.call(e))throw new TypeError('Parameter "content" is required and should be a string');this._content=e,this._container.innerHTML='<div class="dg-hint">'+this._content+"</div>"},getPosition:function(){return this._position},setPosition:function(e){if(!(e instanceof DG.Point))throw new TypeError('Parameter "position" is required and should be an instance of "DG.Point"');this.isShown()&&this.hide(),this._position=e,this._container.style.left=this._position.x+"px",this._container.style.top=this._position.y+"px",this.show()},show:function(){this._dgMap.getViewPortContainer().appendChild(this._container),this._isShown=!0},hide:function(){null!=document.getElementById(this._container.id)&&this._dgMap.getViewPortContainer().removeChild(this._container),this._isShown=!1},isShown:function(){return this._isShown},getContainerId:function(){return this._container.id},destroy:function(){this._dgMap=null,this._container=null,this._position=null},_validateInitParams:function(e,t){if(!(e instanceof DG.Map))throw new TypeError('Parameter "dgMap" should be an instance of "DG.Map"');if("undefined"!=typeof t.maxWidth&&"[object Number]"!==Object.prototype.toString.call(t.maxWidth))throw new TypeError('Option "maxWidth" should be a number');if("undefined"!=typeof t.maxHeight&&"[object Number]"!==Object.prototype.toString.call(t.maxHeight))throw new TypeError('Option "maxHeight" should be a number')},CLASS_NAME:"DG.Overlays.Hint"}),DG.Plugins.Ruler=DG.Class({_control:null,_observers:[],_state:"",initialize:function(){this._control=null,this._state="hide"},setDgMap:function(e){this._dgMap=e},onAddToMap:function(){var e=this._dgMap,t=new DG.Plugins.Ruler.RulerPoints(e);this._control=new DG.Controls.Ruler("ruler"),this._control.setRulerPoints(t),DG.Plugins.Ruler.RulerPoint.prototype.rulerPoints=t,DG.Plugins.Ruler.RulerPoint.prototype.map=e,e.controls.add(this._control,"ruler",new DG.ControlPosition(DG.ControlPosition.TOP_RIGHT,new DG.Point(45,10))),this._control.initHandlers();var i=e.getPlugin("traffic");if(i){var n=new DG.ControlPosition(DG.ControlPosition.TOP_RIGHT,new DG.Point(85,10)),r=i.getControl().getContainer();n.apply(r)}},destroy:function(){var e,t=this._dgMap.getPlugin("traffic"),i=new DG.Configs.Traffic;this._dgMap.activeHint.destroy(),this._dgMap.activeHint=null,this._dgMap.activeStaticHint.destroy(),this._dgMap.activeStaticHint=null,this._control.toggleRuler(),this._dgMap.controls.remove(this._control),t&&(e=t.getControl().getContainer(),i.controlConfig.position.apply(e))},getControl:function(){return this._control},getStates:function(){return["hide","show"]},getName:function(){return"ruler"},isRulerEnabled:function(){return this._control.rulerEnabled},CLASS_NAME:"DG.Plugins.Ruler"}),DG.Plugins.Ruler.RulerPoint=DG.Class({initialize:function(e,t){this.geoPoint=e,this.rulerPoints=t,this.distance=0,this.segmentDistance=0,this.segmentGeom=null,this.marker=null,this.observers=[]},createIcon:function(e){var t=DG.Controls.Ruler.prototype["RULER_"+e+"_POINT_ICON"],i=t.offset?function(){return new DG.Point(t.offset.x,t.offset.y)}:void 0;return new DG.Icon(t.url,new DG.Size(t.size.w,t.size.h),i)},placeMarker:function(e){if(!this.marker){var t=this;return e=e||"EDGE",this.marker=new DG.Markers.Common({geoPoint:this.geoPoint,icon:t.createIcon(e)}),DG.Utils.DOM.addClass(this.marker.getContainer(),"dg-ruler-marker"),this.map.markers.add(this.marker,DG.Controls.Ruler.prototype.RULER_MARKERS_GROUP),this.observers.push(this.map.addEventListener(this.marker.getContainerId(),"DgMouseOver",function(e){t.rulerPoints._somePointIsDragging||t.isLast()||(t.map.activeHint.forceHide=!0,t.map.activeHint.owner(t),t.map.activeHint.setContent(t.rulerPoints.preferredMeasurementRounding(t.distance)+t.map.activeHint.getCloseButton()),t.map.activeHint.setPosition(t.pxPoint()),t.map.activeHint.show())}),this.map.addEventListener(this.marker.getContainerId(),"DgMouseOut",function(e){t.isLast()||setTimeout(function(){t.map.activeHint.forceHide&&!t.rulerPoints._somePointIsDragging&&t.map.activeHint.hide()},300)}),this.map.addEventListener(this.marker.getContainerId(),"DgClick",function(e){return!0})),this.marker._dragStartCallback=function(e,i){t.rulerPoints._somePointIsDragging=!0},this.marker._dragCallback=DG.Utils.Throttle(function(e,i){t.rulerPoints.redrawOnlyNecessary(t,i)},16),this.marker._dragStopCallback=function(e){t.rulerPoints._somePointIsDragging=!1,t.move(e.getPosition())},this.marker.enableDraggable(),this}},removeMarker:function(){this._removeHandlers(),this.map.markers.remove(this.marker,DG.Controls.Ruler.prototype.RULER_MARKERS_GROUP)},_removeHandlers:function(){for(var e=0;e<this.observers.length;e++)this.observers[e].cleanup();this.marker.disableDraggable(),this.observers=null},move:function(e){this.geoPoint=e instanceof DG.GeoPoint?e:e.getGeoPoint(),this.marker.setPosition(this.geoPoint),this.rulerPoints.redraw()},pxPoint:function(){return this.map.converter.coordinatesToMapPixels(this.geoPoint)},isLast:function(){return this.rulerPoints.list().indexOf(this)===this.rulerPoints.list().length-1}}),DG.Plugins.Ruler.RulerPoints=DG.Class({initialize:function(e){this.map=e,this._list=[],this._createBetweenMarker(),this.style=new DG.Style.Geometry(DG.Controls.Ruler.prototype.RULER_SELECTION_STYLE),this.geometryObservers=[]},_somePointIsDragging:!1,_cursorEdgeMarker:null,_cursorBetweenMarker:null,_hoveredGeometry:null,_hoveredMarker:null,_redrawCallback:null,_mousedOver:!1,insertingMarkersLayer:null,_removeGeometries:function(){this.getGeometryGroup()&&this.getGeometryGroup().removeAll(),this._removeHandlersFromGeometries()},_removeHandlersFromGeometries:function(){for(var e=0;e<this.geometryObservers.length;e++)this.geometryObservers[e].cleanup();this.geometryObservers=[]},_removeHandlersFromRulerPoints:function(){for(var e=0,t=this._list.length;e<t;e++)this._list[e]._removeHandlers()},getGeometryGroup:function(e){return e=e||DG.Controls.Ruler.prototype.RULER_GEOMETRY_GROUP,this.map.geometries.getGroup(e)},getMarkerGroup:function(){return this.map.markers.getGroup(DG.Controls.Ruler.prototype.RULER_MARKERS_GROUP)},add:function(e){var t=new DG.Plugins.Ruler.RulerPoint(e.getGeoPoint(),this);return t.placeMarker(),this._list.push(t),this.redraw(),t},insert:function(e,t){var i=new DG.Plugins.Ruler.RulerPoint(e.getGeoPoint(),this);i.placeMarker(),this._list.splice(t,0,i),this.redraw()},removeRulerPoint:function(e){var t=this._list.indexOf(e);this._list.splice(t,1),this.redraw(),e.removeMarker(),this.map.activeHint.hide(),this._list.length||this.map.activeStaticHint.hide()},removeRuler:function(){var e,t=this._list.length;for(e=0;e<t;e++)this._list[e].removeMarker();
this._list.splice(0,t),this.redraw(),this.hideBetweenMarker(),this.map.activeHint.hide(),this.map.activeStaticHint.hide()},list:function(){return this._list},calculateDistanceOnHover:function(e,t){var i,n;return n=DG.Utils.getDistance(e.marker.getPosition(),t),i=e.distance+n},updateHint:function(e,t){var i=this.map.converter.coordinatesToMapPixels(t);this.map.activeHint.setContent(this.preferredMeasurementRounding(e)),this.map.activeHint.setPosition(i)},_lightRedrawGeometry:function(e,t,i){var n;i=i||e.marker,n=i.getPosition().toMercator(),e.segmentGeom._olGeoPoints[t].x=n.lon,e.segmentGeom._olGeoPoints[t].y=n.lat,e.segmentGeom._riseUpdateEvent()},redrawOnlyNecessary:function(e,t){var i=this._list.indexOf(e);if(i!==-1){var n=this._list[i],r=this._list[i-1],o=this._list[i+1];if(0!==i&&(n.segmentDistance=DG.Utils.getDistance(r.marker.getPosition(),n.marker.getPosition()),n.distance=r.distance+n.segmentDistance,this._lightRedrawGeometry(n,1)),o){o.segmentDistance=DG.Utils.getDistance(n.marker.getPosition(),o.marker.getPosition()),o.distance=n.distance+o.segmentDistance,this._lightRedrawGeometry(o,0,n.marker);for(var s=o.distance,a=i+2;a<this._list.length;a++)s+=this._list[a].segmentDistance;this._list[this._list.length-1].distance=s,this.map.activeStaticHint.setContent(this.preferredMeasurementRounding(s)+this.map.activeStaticHint.getCloseButton()),this.map.activeHint.setContent(this.preferredMeasurementRounding(e.distance)),this.map.activeHint.setPosition(t)}else this.map.activeStaticHint.setPosition(t),this.map.activeStaticHint.setContent(this.preferredMeasurementRounding(e.distance)+this.map.activeStaticHint.getCloseButton())}},redraw:function(){var e=this,t=this.map,i=this._list,n=i.length-1;this._removeGeometries();for(var r=0;r<i.length;r++){var o,s=i[r];0===r?s.distance=0:(o=i[r-1],s.segmentDistance=DG.Utils.getDistance(o.geoPoint,s.geoPoint),s.distance=o.distance+s.segmentDistance,s.segmentGeom=new DG.Geometries.Polyline([o.geoPoint,s.geoPoint],e.style),t.geometries.add(s.segmentGeom,DG.Controls.Ruler.prototype.RULER_GEOMETRY_GROUP),e._addGeomEventListeners(s.segmentGeom,o,r)),0===r||r===n?i[r].marker.setIcon(i[r].createIcon("EDGE")):i[r].marker.setIcon(i[r].createIcon("BETWEEN")),r===n&&(t.activeStaticHint.owner(s),t.activeStaticHint.setContent(this.preferredMeasurementRounding(s.distance)+t.activeStaticHint.getCloseButton()),t.activeStaticHint.setPosition(s.pxPoint()))}"function"==typeof this._redrawCallback&&this._redrawCallback()},_addGeomEventListeners:function(e,t,i){var n=this,r=this.map;n.geometryObservers.push(r.addEventListener(e.getContainerId(),"DgMouseOver",function(e){return function(t){n._mousedOver=!0,n._hoveredGeometry=e,n._somePointIsDragging||n.showBetweenMarker(t)}}(e)),r.addEventListener(e.getContainerId(),"DgMouseMove",function(e){return function(t){if(n._mousedOver){n._mousedOver=!1;var i,r,o=t.getGeoPoint(),s=n._hoveredGeometry.getPoints()[0].toLonLat(),a=n._hoveredGeometry.getPoints()[1].toLonLat();r=DG.Utils.getNearestPointInLine(o.lon,o.lat,s.lon,s.lat,a.lon,a.lat),i=n.calculateDistanceOnHover(e,r),n.updateHint(i,r),n._cursorBetweenMarker.setPosition(r)}}}(t)),r.addEventListener(e.getContainerId(),"DgMouseOut",function(e){setTimeout(function(){n._cursorBetweenMarker.isHidden()||n._betweenMarkerIsHovered||(n._cursorBetweenMarker.hide(),n.map.activeHint.hide())},0)}),r.addEventListener(e.getContainerId(),"DgMouseDown",function(e){return function(t){n.insert(t,e)}}(i)))},preferredMeasurementRounding:function(e){var t=(e/1e3).toFixed(1),i=e<1e3?Math.round(e)+" "+this.map.locale.t("m"):10*t%10===0?Math.round(t)+" "+this.map.locale.t("km"):t+" "+this.map.locale.t("km");return i.replace(".",this.map.locale.t("separator"))},_createBetweenMarker:function(){var e=this,t=new DG.GeoPoint(0,0);this._cursorBetweenMarker=new DG.Markers.Common({geoPoint:t,icon:DG.Plugins.Ruler.RulerPoint.prototype.createIcon("BETWEEN")}),DG.Utils.DOM.addClass(this._cursorBetweenMarker.getContainer(),"dg-ruler-marker"),this.map.markers.add(this._cursorBetweenMarker,DG.Controls.Ruler.prototype.RULER_MARKERS_GROUP),this.map.addEventListener(this._cursorBetweenMarker.getContainerId(),"DgMouseOver",function(t){e._betweenMarkerIsHovered=!0}),this.map.addEventListener(this._cursorBetweenMarker.getContainerId(),"DgMouseDown",function(t){e.insertingMarkersLayer||(e.insertingMarkersLayer=e._cursorBetweenMarker.getContainer().parentElement.id),e._cursorBetweenMarker.hide(),DG.EventManager.caller(t,e._hoveredGeometry.getContainerId(),"DgMouseDown")}),this.map.addEventListener(this._cursorBetweenMarker.getContainerId(),"DgMouseMove",function(t){e._mousedOver=!0,DG.EventManager.caller(t,e._hoveredGeometry.getContainerId(),"DgMouseMove")}),this.map.addEventListener(this._cursorBetweenMarker.getContainerId(),"DgMouseOut",function(t){e._mousedOver=!1,e._betweenMarkerIsHovered=!1,e._cursorBetweenMarker.hide(),e.map.activeHint.hide()})},showBetweenMarker:function(e){this._cursorBetweenMarker.show()},hideBetweenMarker:function(e){this._cursorBetweenMarker.hide()},toString:function(e){var t,i,n,r="";for(t=0;t<this._list.length&&(i=this._list[t].geoPoint,n=i.projection===DG.GeoPoint.EPSG_900913?i.clone().toLonLat():i,r+=r?",":"",r+=n.lon.toFixed(6)+" "+n.lat.toFixed(6),null==e||t!==e-1);t++);return r},fromString:function(e){var t=this;"IE"==DG.Utils.detectBrowser()[0]||"Opera"==DG.Utils.detectBrowser()[0]?setTimeout(function(){t._fromString(e)},0):t._fromString(e)},_fromString:function(e){if(this.toString()!==e){var t,i,n,r=e.split(",");for(t=0;t<r.length;t++)n=r[t].split(" "),i={getGeoPoint:function(){return new DG.GeoPoint(n[0],n[1],DG.GeoPoint.EPSG_4326)}},this.add(i)}}}),DG.Plugins.Traffic=DG.Class({_layer:null,_control:null,_observers:[],_currentProject:null,_scoreUrlTemplate:null,_actualTimeUrlTemplate:null,_actualTime:0,_timeInterval:0,_tab:"",_state:"",_zoomPrevState:"",_zoomPrevLevel:0,_minZoomLevel:0,_checkActualTimeInterval:0,_uiUpdateTimeout:0,_setScoreIntervalId:0,_setActualTimeIntervalId:0,_setUIUpdateTimeoutId:0,_isInitScore:null,_isInitActualTime:null,_actualTimeCallbackId:null,_isShowScore:!1,_obscuresLayer:null,_parentObscuresLayer:null,initialize:function(){this._layer=null,this._control=null,this._currentProject=null,this._actualTime=0,this._timeInterval=0,this._setScoreIntervalId=0,this._setActualTimeIntervalId=0,this._setUIUpdateTimeoutId=0,this._tab="now",this._state="hide",this._zoomPrevState="trafficHide",this._zoomPrevLevel=0,this._isInitScore=!0,this._isInitActualTime=!0,this._actualTimeCallbackId=0;var e=new DG.Configs.Traffic;this._scoreUrlTemplate=e.scoreUrl,this._actualTimeUrlTemplate=e.timeUrl,this._checkActualTimeInterval=e.checkActualTimeInterval,this._uiUpdateTimeout=e.uiUpdateTimeout,this._minZoomLevel=e.minZoomLevel,this._isShowScore=e.controlConfig.isShowScore},destroy:function(){this._dgMap.controls.remove(this._control),this._layer&&this._dgMap.layers.remove(this._layer),this._unbindEvents(),this._destroyObscuresLayer()},setDgMap:function(e){this._dgMap=e},onAddToMap:function(){this._control=DG.Utils.isTouchDevice()?new DG.Controls.Traffic.Touch:new DG.Controls.Traffic,this._dgMap.controls.add(this._control),this._zoomPrevLevel=this._dgMap.getZoom(),this._bindEvents(),this._attachTimeIntervals(),this._getScoreTendency(),this._getActualTimeFromServer(),this.getControl().setState("trafficUnavailable"),this._setInitControlState();var e=this._dgMap.getPlugin("ruler");if(e){var t=new DG.ControlPosition(DG.ControlPosition.TOP_RIGHT,new DG.Point(85,10)),i=this._control.getContainer();t.apply(i)}},getLayer:function(){return this._layer},getControl:function(){return this._control},getStates:function(){return["hide","showNow","showAvg"]},getTabs:function(){return["now","avg"]},getName:function(){return"traffic"},getState:function(){return{controlState:this.getControl().getState(),interval:this._timeInterval}},setState:function(e){DG.AjaxManager.cancelCallback(this._actualTimeCallbackId),DG.Utils.isTouchDevice()||this.getControl().setTimeInterval(e.interval),this.getControl().setState(e.controlState)},isEnable:function(){return this.getLayer().isVisible()},getActualTime:function(){return this._actualTime},_getActualTimeFromServer:function(){if(null!==this.getCurrentProject()&&(this._isInitActualTime||"hide"!==this._state&&"avg"!==this._tab)){var e=this._actualTimeUrlTemplate.replace(/\$\{project\}/g,this.getCurrentProject());this._actualTimeCallbackId=DG.AjaxManager.get({url:e,data:{},success:function(e){this._isInitActualTime=!1,e!==this._actualTime&&(this._actualTime=e,this._redrawLayer(),DG.Utils.isTouchDevice()||this.getControl().setActualTime(e))},failure:function(){},scope:this})}},_getScoreTendency:function(){if(!DG.Utils.isTouchDevice()&&this._isShowScore){if(null===this.getCurrentProject()||this._dgMap.getZoom()<this._minZoomLevel)return;if("now"!==this._tab&&!this._isInitScore)return;var e=this._scoreUrlTemplate.replace(/\$\{project\}/g,this.getCurrentProject()).replace("${interval}",this._timeInterval);DG.AjaxManager.get({url:e,data:{},success:function(e){var t,i=e.toString().split(",");this.getCurrentProject()&&this.getControl().getIsInitScoreSetted()&&this.getControl().setState("trafficHide"),i[0]&&(t=parseInt(i[0],10),t<0&&(t=0),this._isInitScore=!1,this.getControl().setScore(t)),i[1]?this.getControl().setTendency(i[1]):this.getControl().setTendency(!1)},failure:function(){this.getControl().setScore(0),this.getControl().setTendency(!1)},scope:this})}},_setInitControlState:function(){DG.Utils.isTouchDevice()&&this.getCurrentProject()&&this.getControl().setState("trafficHide")},_bindEvents:function(){this._observers.pc=this._dgMap.addEventListener("DgProjectChange",DG.Utils.bind(this.projectChange,this)),this._observers.zc=this._dgMap.addEventListener("DgZoomChange",DG.Utils.bind(this.zoomChange,this)),this._observers.csc=this._dgMap.addEventListener("DGControlStateChange",DG.Utils.bind(this.controlChangeState,this)),this._observers.mol=this._dgMap.addEventListener("DgMapMove",DG.Utils.bind(this.moveObscuresLayer,this))},_unbindEvents:function(){this._observers.pc.disable(),this._observers.zc.disable(),this._observers.csc.disable(),this._observers.mol.disable()},_attachTimeIntervals:function(){this._setScoreIntervalId=setInterval(DG.Utils.bind(this._getScoreTendency,this),1e3*this._checkActualTimeInterval),this._setActualTimeIntervalId=setInterval(DG.Utils.bind(this._getActualTimeFromServer,this),1e3*this._checkActualTimeInterval)},projectChange:function(e){var t=e.getProject();return DG.Utils.iNU(t)?(this.getControl().setState("trafficUnavailable"),!1):void(t.trfc?(this._currentProject=t.prj,this._getActualTimeFromServer(),this._isInitScore=!0,this._getScoreTendency(),DG.Utils.isTouchDevice()||this.getControl().refreshTime(),null!==this.getLayer()&&this.getLayer().setProject(this._currentProject),"hide"!==this._state?this._redrawLayer():this.getControl().isInState("trafficUnavailable")&&this._dgMap.getZoom()>=this._minZoomLevel&&this.getControl().setState("trafficHide")):this.getControl().setState("trafficUnavailable"))},zoomChange:function(e){var t,i=e.getMap().getZoom(),n=this._zoomPrevLevel,r=this._zoomPrevState;this._zoomPrevLevel=i,this._setOpacityZoomObscuresLayer(i),i>=this._minZoomLevel&&n>=this._minZoomLevel||i<this._minZoomLevel&&n<this._minZoomLevel||("trafficUnavailable"!==this.getControl().getState()&&"trafficHide"!==this.getControl().getState()&&(this._zoomPrevState=this.getControl().getState()),i>=this._minZoomLevel?(t=this._dgMap.getCurrentProject(),t&&t.trfc&&(this._redrawLayer(),this.getControl().refreshTime(),this.getControl().setState(r),this._getScoreTendency())):this.getControl().setState("trafficUnavailable"))},getCurrentProject:function(){if(null===this._currentProject){var e=this._dgMap,t=e.getCurrentProject();t.trfc&&(this._currentProject=t.prj)}return this._currentProject},controlChangeState:function(e){var t,i;if(this._getActualTimeFromServer(),t=this.getControl().isInState("trafficUnavailable")||this.getControl().isInState("trafficHide")?"hide":this.getControl().isInState("trafficShowNow")||this.getControl().isInState("trafficShowNowMin")?"showNow":"showAvg",!DG.Utils.isTouchDevice()){if(i=this.getControl().getTimeInterval(),this._state===t)return void(this._timeInterval!==i&&(clearTimeout(this._setUIUpdateTimeoutId),this._timeInterval=i,this._setUIUpdateTimeoutId=setTimeout(DG.Utils.bind(this.uiUpdateTimeout,this),this._uiUpdateTimeout)));this._timeInterval!==i&&(this._timeInterval=i,this._redrawLayer())}this._state=t,this._pluginChangeState()},uiUpdateTimeout:function(){this._redrawLayer()},_pluginChangeState:function(){switch(this._state){case"hide":this._hideLayer(),this._hideObscuresLayer();break;case"showNow":this._tab="now",this._showLayer(),this._showObscuresLayer();break;case"showAvg":this._tab="avg",this._showLayer(),this._showObscuresLayer()}},_showLayer:function(){null===this.getLayer()&&(this._layer=DG.Utils.isTouchDevice()?new DG.Layers.TrafficTouch(this.getCurrentProject(),this._timeInterval,this._actualTime):new DG.Layers.Interactive.Traffic(this.getCurrentProject(),this._timeInterval,this._actualTime),this._dgMap.layers.add(this._layer)),this.getLayer().show()},_hideLayer:function(){null!==this.getLayer()&&this.getLayer().hide()},_redrawLayer:function(){if(null!==this.getLayer()){if(DG.Utils.isTouchDevice())return this._redrawTouchLayer();this._isInitScore=!0,this._getScoreTendency(),this.getLayer().setActualTrafficTime(this._actualTime),this.getLayer().setTimeInterval(this._timeInterval),this.getLayer().redrawLayer(),this.getLayer().updateLayer()}},_redrawTouchLayer:function(){this.getLayer().setActualTrafficTime(this._actualTime),this.getLayer().redrawLayer()},_addObscuresLayer:function(){var e,t;e=document.getElementById(this.getLayer().getContainerId()),t=e.style.zIndex,this._parentObscuresLayer=e.parentNode,this._obscuresLayer=document.createElement("div"),this._obscuresLayer.id="ObscuresTrafficLayer",this._obscuresLayer.style.position="absolute",this._obscuresLayer.style.width="100%",this._obscuresLayer.style.height="100%",this._obscuresLayer.style.display="block",this._obscuresLayer.style.backgroundColor="white",this._obscuresLayer.style.opacity=0,this._obscuresLayer.style.zIndex=t-1,this._obscuresLayer.style.right=this._parentObscuresLayer.style.left,this._obscuresLayer.style.bottom=this._parentObscuresLayer.style.top,this._parentObscuresLayer.appendChild(this._obscuresLayer)},_destroyObscuresLayer:function(){null!==this._obscuresLayer&&null!==this._parentObscuresLayer&&(this._parentObscuresLayer.removeChild(this._obscuresLayer),this._parentObscuresLayer=null,this._obscuresLayer=null)},moveObscuresLayer:function(){null!==this._obscuresLayer&&(this._obscuresLayer.style.right=this._parentObscuresLayer.style.left,this._obscuresLayer.style.bottom=this._parentObscuresLayer.style.top)},_hideObscuresLayer:function(){null!==this._obscuresLayer&&(this._obscuresLayer.style.display="none")},_showObscuresLayer:function(){null===this._obscuresLayer&&(this._addObscuresLayer(),this._setOpacityZoomObscuresLayer()),this._obscuresLayer.style.display="block"},_setOpacityObscuresLayer:function(e){null!==this._obscuresLayer&&(this._obscuresLayer.style.opacity=e,this._obscuresLayer.style.filter="progid:DXImageTransform.Microsoft.Alpha(Opacity="+100*e+")")},_setOpacityZoomObscuresLayer:function(e){var t=e?e:this._dgMap.getZoom();switch(t){case 13:this._setOpacityObscuresLayer(DG.Plugins.Traffic.OPACITY_ZOOM_13);break;case 12:this._setOpacityObscuresLayer(DG.Plugins.Traffic.OPACITY_ZOOM_12);break;case 11:this._setOpacityObscuresLayer(DG.Plugins.Traffic.OPACITY_ZOOM_11);break;case 10:this._setOpacityObscuresLayer(DG.Plugins.Traffic.OPACITY_ZOOM_10);break;default:this._setOpacityObscuresLayer(0)}},CLASS_NAME:"DG.Plugins.Traffic"}),DG.Plugins.Traffic.OPACITY_ZOOM_13=.15,DG.Plugins.Traffic.OPACITY_ZOOM_12=.2,DG.Plugins.Traffic.OPACITY_ZOOM_11=.25,DG.Plugins.Traffic.OPACITY_ZOOM_10=.3,DG.Renderer={},DG.Renderer.Canvas=new DG.Class({_shards:[],_data:[],_map:null,_observers:[],_visualization:null,initialize:function(e,t){this._map=e,this._visualization=t,this._registerHandlers()},setData:function(e){this._data=e,this._createShard(this._map.getBounds(),this._map.getViewPort(),this._visualization),this._updateShards()},_updateShards:function(){for(var e=this._data,t=0;t<this._shards.length;t++){for(var i=[],n=0;n<e.length;n++){var r=e[n];r.pixelCoords=this._map.converter.coordinatesToMapPixels(r.getBasePoint()),i.push(r)}this._shards[t].setData(i)}},_checkBounds:function(){},_createShard:function(e,t,i){var n=new DG.Renderer.Canvas.Shard(e,t,i);this._map.getViewPortContainer().appendChild(n.getView()),this._shards.push(n)},_registerHandlers:function(){this._observers.push(this._map.addEventListener("DgZoomChange",DG.Utils.bind(this._updateShards,this))),this._observers.push(this._map.addEventListener("DgMapMove",DG.Utils.bind(this._updateShards,this)))},CLASS_NAME:"DG.Renderer.Canvas"}),DG.Renderer.Canvas.Shard=new DG.Class({_bounds:null,_id:null,_canvas:null,_ctx:null,_size:null,_data:null,_icon:null,_style:null,_iconSize:null,initialize:function(e,t,i){var n=document.createElement("canvas");if(n.width=t.width,n.height=t.height,n.style.position="absolute",n.style.zIndex=1001,this._canvas=n,this._ctx=this._canvas.getContext("2d"),this._bounds=e,i instanceof DG.Icon){var r=new Image;r.src=i.url,this._iconSize=i.size,this._icon=r}else i instanceof DG.Style&&(this._style=i)},setData:function(e){this._data=e,this.render()},getView:function(){return this._canvas},setBounds:function(e){this._bounds=e},getBounds:function(){return this._bounds},render:function(){this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),null!=this._icon&&this._renderMarkers()},setSize:function(e){this._size=e},_renderMarkers:function(){for(var e=this,t=this._ctx,i=(this._size,0);i<this._data.length;i++)e._icon.addEventListener("load",function(i){for(var n=e._data[i].pixelCoords,r=0;r<1e3;r++)t.drawImage(e._icon,n.x+10*r*Math.random(),n.y+5*r*Math.random())}(i))},CLASS_NAME:"DG.Renderer.Canvas.Shard"}),DG.Style.Geometry=DG.Class(DG.Style,{fillColor:"#ffffff",fillOpacity:.5,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",pointRadius:1,graphicZIndex:0,initialize:function(e){DG.Utils.extendOptions(this,e,["fillColor","fillOpacity","strokeColor","strokeOpacity","strokeWidth","strokeLinecap","strokeDashstyle","pointRadius","graphicZIndex"]),this._validate()},clone:function(){var e=new DG.Style.Geometry;return DG.Utils.extend(e,this)},_validate:function(){if("[object String]"!=Object.prototype.toString.call(this.fillColor))throw new TypeError("'fillColor' should be a string");if("[object String]"!=Object.prototype.toString.call(this.strokeColor))throw new TypeError("'strokeColor' should be a string");if("[object String]"!=Object.prototype.toString.call(this.strokeLinecap))throw new TypeError("'strokeLinecap' should be a string");if("[object String]"!=Object.prototype.toString.call(this.strokeDashstyle))throw new TypeError("'strokeDashstyle' should be a string");if("[object Number]"!=Object.prototype.toString.call(this.fillOpacity))throw new TypeError("'fillOpacity' should be a number");if("[object Number]"!=Object.prototype.toString.call(this.strokeOpacity))throw new TypeError("'strokeOpacity' should be a number");if("[object Number]"!=Object.prototype.toString.call(this.strokeWidth))throw new TypeError("'strokeWidth' should be a number");if("[object Number]"!=Object.prototype.toString.call(this.pointRadius))throw new TypeError("'pointRadius' should be a number")},CLASS_NAME:"DG.Style.Geometry"}),DG.fleXcroll={fleXlist:[],fleXcrollInit:function(){var e=document.head||document.getElementsByTagName("head")[0]||document.documentElement,t=document.createElement("style"),i=".flexcroll-hide-default {overflow: hidden !important;}";if(t.type="text/css",e.appendChild(t),t.styleSheet)t.styleSheet.cssText=i;else{var n=document.createTextNode(i);t.appendChild(n)}this.addTrggr(window,"load",this.globalInit)},fleXcrollMain:function(e){function t(t){t||(t=w.event);var r=t.target?t.target:!!t.srcElement&&t.srcElement;!r||r.className&&r.className.match(RegExp("\\bscrollgeneric\\b"))||(x.inMposX=t.clientX,x.inMposY=t.clientY,o(),L(e),n(),DG.fleXcroll.addTrggr(S,"mousemove",i),x.mTBox=[e.xPos+10,e.xPos+x.cntRSize[0]-10,e.yPos+10,e.yPos+x.cntRSize[1]-10])}function i(e){e||(e=w.event);var t=e.clientX,i=e.clientY,n=t+x.xScrld,r=i+x.yScrld;x.mOnXEdge=n<x.mTBox[0]||n>x.mTBox[1]?1:0,x.mOnYEdge=r<x.mTBox[2]||r>x.mTBox[3]?1:0,x.xAw=t-x.inMposX,x.yAw=i-x.inMposY,x.sXdir=x.xAw>40?1:x.xAw<-40?-1:0,x.sYdir=x.yAw>40?1:x.yAw<-40?-1:0,0==x.sXdir&&0==x.sYdir||x.tSelectFunc||(x.tSelectFunc=w.setInterval(function(){return 0==x.sXdir&&0==x.sYdir?(w.clearInterval(x.tSelectFunc),void(x.tSelectFunc=!1)):(o(),void(1!=x.mOnXEdge&&1!=x.mOnYEdge||k.setScrollPos(x.sXdir*x.mOnXEdge+"s",x.sYdir*x.mOnYEdge+"s",!0)))},45))}function n(){DG.fleXcroll.remTrggr(S,"mousemove",i),x.tSelectFunc&&w.clearInterval(x.tSelectFunc),x.tSelectFunc=!1,x.barClickRetard&&w.clearTimeout(x.barClickRetard),x.barClickScroll&&w.clearInterval(x.barClickScroll)}function r(e){x.touchFlick&&(window.clearInterval(x.touchFlick),x.touchFlick=!1),e||(N.sY.zIndex=x.tDivZ,x.moveDelta=[0,0],x.touchMoved=!1)}function o(){x.xScrld=w.pageXOffset?w.pageXOffset:S.documentElement&&S.documentElement.scrollLeft?S.documentElement.scrollLeft:0,x.yScrld=w.pageYOffset?w.pageYOffset:S.documentElement&&S.documentElement.scrollTop?S.documentElement.scrollTop:0}function s(e,t){var i=e.toString();return e=parseFloat(i),parseInt(i.match(/p$/)?e*x.cntRSize[t]*.9:i.match(/s$/)?e*x.cntRSize[t]*.1:e)}function a(e,t){return DG.fleXcroll.getStyle(e,t)}function l(e,t,i,n){for(var r=new Array,o=0;o<n.length;o++)r[o]=DG.fleXcroll.camelConv(n[o]),t.style[r[o]]=a(e,n[o],r[o]),i&&(e.style[r[o]]=i)}function h(e,t,i,n,r){var o=n?n:S.createElement("div");return n||(o.id=T+"_"+e,o.className=i?e:e+" scrollgeneric"),o.getSize=[function(){return o.offsetWidth},function(){return o.offsetHeight}],o.setSize=r?[g,g]:[function(e){o.sY.width=Math.max(e,1)+"px"},function(e){o.sY.height=Math.max(e,1)+"px"}],o.getPos=[function(){return a(o,"left")},function(){return a(o,"top")}],o.setPos=r?[g,g]:[function(e){o.sY.left=e},function(e){o.sY.top=e}],o.fHide=function(){o.sY.visibility="hidden"},o.fShow=function(e){o.sY.visibility=e?a(e,"visibility"):"visible"},o.sY=o.style,t&&(o.fleXdata=t),o}function c(e,t,i){var n=document.getElementById(T+"-flexcroll-"+t),r=null!=n;e.sFDv=h(t+"basebeg",{action:"stepBack"}),e.sSDv=h(t+"baseend",{action:"stepFwd"}),e.sMDv=h(t+"basemid"),e.sFBr=h(t+"barbeg"),e.sSBr=h(t+"barend"),e.sMBr=h(t+"barmid"),e.sFFb=h(t+"fill",{action:"pageBack"}),e.sFRb=h(t+"rest",{action:"pageFwd"}),r?(e.sDv=h(!1,{action:"pageBack"},!1,n,!0),x.externaL[i]=!0,e.sBr=h(!1,!1,!1,DG.fleXcroll.getByClassName(n,"div","flexcroll-scrollbar")[0])):(e.sDv=h(t+"base",{action:"pageBack"}),e.sBr=h(t+"bar"),N.appendChild(e.sDv),e.sDv.appendChild(e.sBr),e.sDv.appendChild(e.sFDv),e.sDv.appendChild(e.sSDv),e.sDv.appendChild(e.sMDv),e.sBr.appendChild(e.sFBr),e.sBr.appendChild(e.sMBr),e.sBr.appendChild(e.sSBr)),e.sDv.appendChild(e.sFRb),e.sDv.appendChild(e.sFFb)}function u(t,i){var r=t.sDv,o=t.sBr,s=o.indx;o.trgtScrll=0,o.minPos=t.barPadding[0],t.padLoss=t.barPadding[0]+t.barPadding[1],o.ofstParent=r,o.mDv=U,o.scrlTrgt=I,o.targetSkew=0,d(t,i,!0),o.doBarPos=function(e){e||(o.curPos=parseInt(o.trgtScrll*o.maxPos/o.mxScroll)),o.curPos=Math.min(Math.max(o.curPos,0),o.maxPos),o.setPos[s](o.curPos+o.minPos+"px"),o.targetSkew||(o.targetSkew=o.trgtScrll-parseInt(o.curPos/o.sRange*o.mxScroll)),o.targetSkew=0==o.curPos?0:o.curPos==o.maxPos?0:o.targetSkew?o.targetSkew:0,e&&(o.trgtScrll=parseInt(o.curPos/o.sRange*o.mxScroll),I.setPos[s](o.trgtScrll+o.targetSkew-1+"px"),x.scrollPosition[s]=[-o.trgtScrll-o.targetSkew,-o.mxScroll]),p(0==s?N.hrz:N.vrt,s)},o.realScrollPos=function(){o.curPos=parseInt(o.trgtScrll*o.sRange/o.mxScroll),o.curPos=Math.min(Math.max(o.curPos,0),o.maxPos),I.setPos[s](o.trgtScrll-1+"px"),x.scrollPosition[s]=[-o.trgtScrll,-o.mxScroll],o.targetSkew=!1,o.doBarPos(!1)},x.barZ=a(o,"z-index"),o.sY.zIndex="auto"==x.barZ||"0"==x.barZ||"normal"==x.barZ?2:x.barZ,U.sY.zIndex=a(o,"z-index"),o.onmousedown=function(){return o.clicked=!0,x.goScroll=o,o.scrollBoth=!1,o.moved=!1,DG.fleXcroll.addTrggr(S,"selectstart",g),DG.fleXcroll.addTrggr(S,"mousemove",m),DG.fleXcroll.addTrggr(S,"mouseup",f),!1},o.onmouseover=n,r.onmousedown=r.ondblclick=function(e){if(!e)var e=w.event;var t=e.target?e.target:!!e.srcElement&&e.srcElement;if(t){var i=[0,0];return k.mDPosFix(),L(o),i[o.indx]=t.fleXdata&&t.fleXdata.action?x.actionVal[t.fleXdata.action]:0,x.touchMoved?x.touchMoved=!1:k.setScrollPos(i[0],i[1],!0),"dblclick"!=e.type&&(n(),x.barClickRetard=w.setTimeout(function(){x.barClickScroll=w.setInterval(function(){k.setScrollPos(i[0],i[1],!0)},80)},425)),!1}},r.setVisibility=function(t){t?(r.fShow(e),x.forcedHide[s]=!("hidden"!=a(r,"visibility")&&!x.externaL[s]&&!x.tooNarrow[1-s]),x.tooNarrow[1-s]&&r.fHide(),!x.forcedHide[s]||x.externaL[s]?o.fShow(e):x.externaL[s]||o.fHide(),x.scroller[s]=!0,G(r,"","flexinactive")):(r.fHide(),o.fHide(),x.forcedBar[s]="hidden"!=a(r,"visibility"),x.scroller[s]=!1,o.curPos=0,I.setPos[s]("-1px"),x.scrollPosition[s]=[!1,!1],G(r,"flexinactive","")),U.setPos[1-s](x.forcedPos[s]&&(t||x.forcedBar[s])&&!x.forcedHide[s]?x.barSpace[1-s]-x.paddings[2*s]+"px":"-"+x.paddings[2*s]+"px")},r.onmouseclick=g}function d(e,t,i){var n=e.sDv,r=e.sBr,o=r.indx;n.setSize[o](N.getSize[o]()-t);var s=n.getSize[1-o](),a=n.getSize[o]();n.setPos[1-o](N.getSize[1-o]()-s+"px"),x.forcedPos[o]=0===parseInt(n.getPos[1-o]()),e.baseProp=Math.max(parseInt(.75*(a-e.padLoss)),5),r.aSize=Math.min(Math.max(Math.min(parseInt(x.cntRSize[o]/Math.max(x.cntSize[o],1)*a),e.baseProp),45),e.baseProp),r.setSize[o](r.aSize);var l=r.getSize[o](),h=e.sSDv.getSize[o](),c=e.sSBr.getSize[o]();x.barSize[o]=l,r.maxPos=a-l-e.padLoss,r.curPos=Math.min(Math.max(0,r.curPos),r.maxPos),r.setPos[o](r.curPos+r.minPos+"px"),r.mxScroll=U.getSize[o]()-x.cntSize[o],r.mxScroll=Math.min(r.mxScroll,-1),r.trgtScrll=Math.max(r.trgtScrll,r.mxScroll),r.sRange=r.maxPos,e.sFDv.setSize[o](a-h),e.sFBr.setSize[o](l-c);var u=e.sFBr.getSize[o]();e.sSBr.setPos[o](l-c+"px"),e.sSDv.setPos[o](a-h+"px"),e.sMBr.setSize[o](l-u-c),e.sMBr.setPos[o](u+"px"),fillPos=Math.min(r.minPos,e.sFDv.getSize[o]()),midPos=e.sFDv.getSize[o](),e.sMDv.setPos[o](midPos+"px"),e.sMDv.setSize[o](a-midPos-h),e.sMDv.setSize[1-o](s),e.sFFb.setPos[o](fillPos+"px"),e.sFRb.setPos[o](fillPos+"px"),e.sFFb.setSize[1-o](s),e.sFRb.setSize[1-o](s),e.sFRb.setSize[o](a-fillPos-Math.min(e.barPadding[1],h)),r.fillComp=r.minPos-fillPos,i||r.realScrollPos(),x.fixIEDispBug()}function p(e,t){e.sFFb.setSize[t](e.sBr.fillComp+e.sBr.curPos+parseInt(x.barSize[t]/2))}function g(){return!1}function m(t){if(!t)var t=w.event;var i,n,r=x.goScroll;if(null!=r){DG.fleXcroll.w3events||t.button||f(),n=r.scrollBoth?2:1;for(var o=0;o<n;o++)i=1==o?r.scrlTrgt.vBar:r,r.clicked?(i.moved||(k.mDPosFix(),L(i),L(i.ofstParent),i.pointerOffsetY=t.clientY-i.yPos,i.pointerOffsetX=t.clientX-i.xPos,i.inCurPos=i.curPos,i.moved=!0),i.curPos=i.vertical?t.clientY-i.pointerOffsetY-i.ofstParent.yPos-i.minPos:t.clientX-i.pointerOffsetX-i.ofstParent.xPos-i.minPos,r.scrollBoth&&(i.curPos=i.curPos+(i.curPos-i.inCurPos)),i.doBarPos(!0),e.onfleXcroll&&e.onfleXcroll()):i.moved=!1}}function f(){null!=x.goScroll&&(x.goScroll.clicked=!1,x.goScroll.trgtScrll+=x.goScroll.targetSkew),x.goScroll=null,DG.fleXcroll.remTrggr(S,"selectstart",g),DG.fleXcroll.remTrggr(S,"mousemove",m),DG.fleXcroll.remTrggr(S,"mouseup",f)}function y(t){if(t||(t=w.event),this==N&&(N.sY.zIndex=x.tDivZ),1!=t.targetTouches.length||!x.scroller[0]&&!x.scroller[1])return void v(t);!(!t.target||!(t.target.href||3==t.target.nodeType&&t.target.parentNode.href));x.touchPos=[t.targetTouches[0].clientX,t.targetTouches[0].clientY],r(),DG.fleXcroll.addChckTrggr(e,"touchmove",_),DG.fleXcroll.addChckTrggr(e,"touchend",v),x.touchBar=!!(t.target&&t.target.id&&t.target.id.match(/_[vh]scrollerba[rs]e?/))}function _(i){if(i||(i=w.event),1!=i.targetTouches.length)return void v(i);DG.fleXcroll.remTrggr(e,"mousedown",t);var n=[i.targetTouches[0].clientX,i.targetTouches[0].clientY];x.touchPrevent=!0,x.moveDelta=[x.touchPos[0]-n[0],x.touchPos[1]-n[1]],x.touchBar?(x.moveDelta[0]*=-(x.cntSize[0]/x.cntRSize[0]),x.moveDelta[1]*=-(x.cntSize[1]/x.cntRSize[1])):(x.moveDelta[0]*=x.touchMul[0],x.moveDelta[1]*=x.touchMul[1]),k.scrollContent(x.moveDelta[0],x.moveDelta[1]),x.touchMoved=!0,x.touchPos[0]=n[0],x.touchPos[1]=n[1];for(var r=0;r<2;r++)0===x.moveDelta[r]||!x.scroller[r]||0!=x.moveDelta[1-r]&&x.scroller[1-r]||(x.moveDelta[r]>0&&x.scrollPosition[r][1]==x.scrollPosition[r][0]||x.moveDelta[r]<0&&0==x.scrollPosition[r][0])&&(x.touchPrevent=!1),!x.scroller[r]&&0!==x.moveDelta[1-r]&&Math.abs(x.moveDelta[r]/x.moveDelta[1-r])>1.1&&(x.touchPrevent=!1);x.touchPrevent?(i.preventDefault(),N.sY.zIndex="9999"):N.sY.zIndex=x.tDivZ}function v(t){if(t||(t=w.event),DG.fleXcroll.remTrggr(e,"touchmove",_),DG.fleXcroll.remTrggr(e,"touchend",v),x.scroller[0]&&Math.abs(x.moveDelta[0])>6||x.scroller[1]&&Math.abs(x.moveDelta[1])>6){var i=0;r(!0),x.touchFlick=window.setInterval(function(){k.scrollContent(M(x.moveDelta[0],0,10,i,.3),M(x.moveDelta[1],0,10,i,.3)),i++,i>10&&r()},100)}}function D(e){if(e||(e=w.event),this.fleXcroll){var t=e.target?e.target:e.srcElement?e.srcElement:this;if(!(t.nodeName&&Q.indexOf("|"+t.nodeName+"|")>-1)){var i,n,r,o=!1,s=0,a=x.scrollPosition;if(k.mDPosFix(),t.id&&t.id.match(/_hscroller/)&&(o=!0),e.wheelDelta&&(s=-e.wheelDelta),e.detail&&(s=e.detail),s=s<0?-1:1,r=s<0?0:1,x.edge[1-r]=!1,0!=a[1][0]&&a[1][0]!=a[1][1]&&(x.edge[0]=x.edge[1]=!1),(!x.edge[r]||o)&&(x.scroller[0]||x.scroller[1]))return x.scroller[1]&&!o&&(a=k.setScrollPos(!1,x.wheelAct[r],!0)),i=!x.scroller[1]||o||x.scroller[1]&&(a[1][0]==a[1][1]&&s>0||0==a[1][0]&&s<0),!x.scroller[0]||x.scroller[1]&&!o||(a=k.setScrollPos(x.wheelAct[r],!1,!0)),n=!x.scroller[0]||x.scroller[0]&&x.scroller[1]&&i&&!o||x.scroller[0]&&(a[0][0]==a[0][1]&&s>0||0==a[0][0]&&s<0),i&&n&&!o?x.edge[r]=!0:x.edge[r]=!1,e.preventDefault&&e.preventDefault(),!1}}}function b(t){for(;t.parentNode;)if(t=t.parentNode,t==e)return!0;return!1}function L(e){var t=e,i=curtop=0;if(t.offsetParent)for(;t;)i+=t.offsetLeft,curtop+=t.offsetTop,t=t.offsetParent;else t.x&&(i+=t.x,curtop+=t.y);e.xPos=i,e.yPos=curtop}function C(e){var t=e;for(curleft=curtop=0;!t.offsetHeight&&t.parentNode&&t!=I&&"inline"==a(t,"display");)t=t.parentNode;if(t.offsetParent)for(;t!=I;)curleft+=t.offsetLeft,curtop+=t.offsetTop,t=t.offsetParent;return[curleft,curtop]}function G(e,t,i){DG.fleXcroll.classChange(e,t,i)}function M(e,t,i,n,r){i=Math.max(i,1);var o=t-e,s=e+Math.pow(1/i*n,r)*o;return s>0?Math.floor(s):Math.ceil(s)}var S=document,w=window,E=navigator;if(S.getElementById&&S.createElement){if("string"==typeof e&&(e=document.getElementById(e)),null==e||E.userAgent.indexOf("OmniWeb")!=-1||(E.userAgent.indexOf("AppleWebKit")!=-1||E.userAgent.indexOf("Safari")!=-1)&&("undefined"==typeof HTMLElement||!HTMLElement.prototype)||"KDE"==E.vendor||E.platform.indexOf("Mac")!=-1&&E.userAgent.indexOf("MSIE")!=-1)return null!=e&&G(e,"flexcroll-failed","flexcroll-hide-default"),void(window.onfleXcrollFail&&window.onfleXcrollFail(e));if(e.fleXcroll)return void e.fleXcroll.updateScrollBars();if(!DG.fleXcroll.checkHidden(e)){if(!e.id||""==e.id){for(var O="flex__",P=1;null!=document.getElementById(O+P);)P++;e.id=O+P}e.fleXdata={},e.fleXcroll={};var T=e.id,x=e.fleXdata,k=e.fleXcroll;x.keyAct={_37:["-1s",0],_38:[0,"-1s"],_39:["1s",0],_40:[0,"1s"],_33:[0,"-1p"],_34:[0,"1p"],_36:[0,"-100p"],_35:[0,"+100p"]},x.wheelAct=["-2s","2s"],x.actionVal={stepBack:"-1s",stepFwd:"1s",pageBack:"-1p",pageFwd:"1p"},x.touchMul=[1,1],x.scrollPosition=[[!1,!1],[!1,!1]];var I=h("contentwrapper",!1,!0),U=h("mcontentwrapper",!1,!0),N=h("scrollwrapper",!1,!0),z=h("copyholder",!1,!0),A=h("dgcontent",!1,!0),R=h("domfixdiv",!1,!0),H=h("zoomdetectdiv",!1,!0),B=!1;
z.sY.border="1px solid blue",z.fHide(),e.style.overflow="hidden",H.sY.fontSize="12px",H.sY.height="1em",H.sY.width="1em",H.sY.position="absolute",H.sY.zIndex="-999",H.fHide();var j=e.offsetHeight,F=e.offsetWidth;l(e,z,"0px",["border-left-width","border-right-width","border-top-width","border-bottom-width"]);var W=e.offsetHeight,Z=e.offsetWidth,V=F-Z,Y=j-W,X=e.scrollTop?e.scrollTop:0,q=e.scrollLeft?e.scrollLeft:0,K=document.location.href,$=/#([^#.]*)$/,J="|TEXTAREA|INPUT|SELECT|OPTION|",Q="|SELECT|OPTION|";for(x.scroller=[],x.forcedBar=[],x.containerSize=x.cntRSize=[],x.contentSize=x.cntSize=[],x.edge=[!1,!1],x.touchPrevent=!1,x.touchFlick=!1,x.barSize=[0,0],x.reqS=[],x.barSpace=[0,0],x.forcedHide=[],x.forcedPos=[],x.paddings=[],x.externaL=[!1,!1],x.touchPos=[0,0],x.moveDelta=[0,0],x.tooNarrow=[!1,!1];e.firstChild;)I.appendChild(e.firstChild);var ee=I.innerHTML;I.innerHTML="",I.appendChild(A),A.innerHTML=ee,I.appendChild(A);var te=document.createElement("div");te.style.clear="left",I.appendChild(te),I.appendChild(R),e.appendChild(U),e.appendChild(z);var ie=a(e,"position");"absolute"!=ie&&"fixed"!=ie&&(e.style.position=ie="relative"),"fixed"==ie&&(e.style.position="absolute"),e.style.outline="none";var ne=a(e,"text-align");e.style.textAlign="left",U.sY.width="100px",U.sY.height="100px",U.sY.top="0px",U.sY.left="0px",l(e,z,"0px",["padding-left","padding-top","padding-right","padding-bottom"]);var re,oe=e.offsetWidth,se=e.offsetHeight;re=U.offsetHeight,U.sY.borderBottom="2px solid black",U.offsetHeight>re&&(B=!0),U.sY.borderBottomWidth="0px",l(z,e,!1,["padding-left","padding-top","padding-right","padding-bottom"]),L(U),L(e),x.paddings[0]=U.yPos-e.yPos,x.paddings[2]=U.xPos-e.xPos,e.style.paddingTop=a(e,"padding-bottom"),e.style.paddingLeft=a(e,"padding-right"),L(U),L(e),x.paddings[1]=U.yPos-e.yPos,x.paddings[3]=U.xPos-e.xPos,e.style.paddingTop=a(z,"padding-top"),e.style.paddingLeft=a(z,"padding-left");var ae=x.paddings[2]+x.paddings[3],le=x.paddings[0]+x.paddings[1];e.style.position=ie,U.style.textAlign=ne,l(e,U,!1,["padding-left","padding-right","padding-top","padding-bottom"]),N.sY.width=e.offsetWidth+"px",N.sY.height=e.offsetHeight+"px",U.sY.width=oe+"px",U.sY.height=se+"px",N.sY.position="absolute",N.sY.top="0px",N.sY.left="0px",x.tDivZ=N.sY.zIndex,U.appendChild(I),e.appendChild(N),N.appendChild(H),I.sY.position="relative",U.sY.position="relative",I.sY.top="0",I.sY.cssFloat="left",U.sY.overflow="hidden",U.sY.left="-"+x.paddings[2]+"px",U.sY.top="-"+x.paddings[0]+"px",x.zTHeight=H.offsetHeight,x.getContentWidth=function(){for(var t=I.childNodes,i=compPad=0,n=e.offsetWidth,r=0;r<t.length;r++)t[r].offsetWidth&&(i=Math.max(t[r].offsetWidth,i));return x.tooNarrow[0]=n<=x.barSpace[0],x.cntRSize[0]=x.reqS[1]&&!x.forcedHide[1]&&!x.tooNarrow[0]||x.forcedBar[1]?n-x.barSpace[0]:n,x.cntSize[0]=i+ae,x.cntSize[0]},x.getContentHeight=function(){var t=e.offsetHeight;return x.tooNarrow[1]=t<=x.barSpace[1],x.cntRSize[1]=x.reqS[0]&&!x.forcedHide[0]&&!x.tooNarrow[1]||x.forcedBar[0]?t-x.barSpace[1]:t,x.cntSize[1]=I.offsetHeight+le-2,x.cntSize[1]},x.fixIEDispBug=function(){DG.fleXcroll.ieDisableFix||(I.sY.display="none",I.sY.display="block")},x.setWidth=function(){U.setSize[0](B?x.cntRSize[0]-ae-V:x.cntRSize[0])},x.setHeight=function(){U.setSize[1](B?x.cntRSize[1]-le-Y:x.cntRSize[1])},x.createScrollBars=function(){x.getContentWidth(),x.getContentHeight(),N.vrt=new Array;var t=N.vrt;c(t,"vscroller",1),t.barPadding=[parseInt(a(t.sBr,"padding-top")),parseInt(a(t.sBr,"padding-bottom"))],t.sBr.sY.padding="0px",t.sBr.curPos=0,t.sBr.vertical=!0,t.sBr.indx=1,I.vBar=t.sBr,u(t,0),x.barSpace[0]=x.externaL[1]?0:Math.min(t.sDv.offsetWidth,x.cntRSize[0]),x.setWidth(),N.hrz=new Array;var i=N.hrz;c(i,"hscroller",0),i.barPadding=[parseInt(a(i.sBr,"padding-left")),parseInt(a(i.sBr,"padding-right"))],i.sBr.sY.padding="0px",i.sBr.curPos=0,i.sBr.vertical=!1,i.sBr.indx=0,I.hBar=i.sBr,w.opera&&(i.sBr.sY.position="relative"),u(i,0),x.barSpace[1]=x.externaL[0]?0:Math.min(i.sDv.offsetHeight,x.cntRSize[1]),x.setHeight(),N.sY.height=e.offsetHeight+"px",i.jBox=h("scrollerjogbox"),N.appendChild(i.jBox),i.jBox.onmousedown=function(){return i.sBr.scrollBoth=!0,x.goScroll=i.sBr,i.sBr.clicked=!0,i.sBr.moved=!1,N.vrt.sBr.moved=!1,DG.fleXcroll.addTrggr(S,"selectstart",g),DG.fleXcroll.addTrggr(S,"mousemove",m),DG.fleXcroll.addTrggr(S,"mouseup",f),!1}},x.goScroll=null,x.createScrollBars(),this.putAway(R,N),this.addChckTrggr(e,"mousewheel",D)&&this.addChckTrggr(e,"DOMMouseScroll",D)||(e.onmousewheel=D),this.addChckTrggr(e,"mousewheel",D),this.addChckTrggr(e,"DOMMouseScroll",D),this.addChckTrggr(I,"touchstart",y),this.addChckTrggr(N,"touchstart",y),e.setAttribute("tabIndex","-1"),this.addTrggr(e,"keydown",function(e){if(!e)var e=w.event;var t=e.keyCode,i=e.target?e.target:!!e.srcElement&&e.srcElement;if(x.pkeY=t,!(i&&i.nodeName&&J.indexOf("|"+i.nodeName+"|")>-1))return k.mDPosFix(),x.keyAct["_"+t]&&!window.opera?(k.setScrollPos(x.keyAct["_"+t][0],x.keyAct["_"+t][1],!0),e.preventDefault&&e.preventDefault(),!1):void 0}),this.addTrggr(e,"keypress",function(e){if(!e)var e=w.event;var t=e.keyCode,i=e.target?e.target:!!e.srcElement&&e.srcElement;if(!(x.pkeY||i&&i.nodeName&&J.indexOf("|"+i.nodeName+"|")>-1))return x.keyAct["_"+x.pkeY]?(k.setScrollPos(x.keyAct["_"+t][0],x.keyAct["_"+t][1],!0),e.preventDefault&&e.preventDefault(),!1):void 0}),this.addTrggr(e,"keyup",function(){x.pkeY=!1}),this.addTrggr(S,"mouseup",n),this.addTrggr(e,"mousedown",t),e.scrollUpdate=k.updateScrollBars=function(t){if(0!==N.getSize[1]()&&0!==N.getSize[0]()){var i,n,r=x.reqS[0],o=x.reqS[1],s=N.vrt,a=N.hrz,l=[];N.sY.width=e.offsetWidth-V+"px",N.sY.height=e.offsetHeight-Y+"px",l[0]=x.cntRSize[0],l[1]=x.cntRSize[1],x.reqS[0]=x.getContentWidth()>x.cntRSize[0],x.reqS[1]=x.getContentHeight()>x.cntRSize[1];var h=r!=x.reqS[0]||o!=x.reqS[1]||l[0]!=x.cntRSize[0]||l[1]!=x.cntRSize[1];s.sDv.setVisibility(x.reqS[1]),a.sDv.setVisibility(x.reqS[0]),i=x.reqS[1]||x.forcedBar[1],n=x.reqS[0]||x.forcedBar[0],x.getContentWidth(),x.getContentHeight(),x.setHeight(),x.setWidth(),!x.reqS[0]||!x.reqS[1]||x.forcedHide[0]||x.forcedHide[1]?a.jBox.fHide():a.jBox.fShow(),i?d(s,n&&!x.forcedHide[0]?x.barSpace[1]:0):I.sY.top="-1px",n?d(a,i&&!x.forcedHide[1]?x.barSpace[0]:0):I.sY.left="-1px",h&&!t&&k.updateScrollBars(!0),x.edge[0]=x.edge[1]=!1}},e.contentScroll=k.setScrollPos=function(t,i,n,r){var o;return(t||0===t)&&x.scroller[0]&&(t=s(t,0),o=N.hrz.sBr,o.trgtScrll=n?Math.min(Math.max(o.mxScroll,o.trgtScrll-t),0):-t,o.realScrollPos()),(i||0===i)&&x.scroller[1]&&(i=s(i,1),o=N.vrt.sBr,o.trgtScrll=n?Math.min(Math.max(o.mxScroll,o.trgtScrll-i),0):-i,o.realScrollPos()),n||(x.edge[0]=x.edge[1]=!1),e.onfleXcroll&&!r&&e.onfleXcroll(),x.scrollPosition},k.scrollContent=function(e,t){return k.setScrollPos(e,t,!0)},k.scrollToElement=function(e){if(null!=e&&b(e)){var t=C(e);k.setScrollPos(t[0]+x.paddings[2],t[1]+x.paddings[0],!1),k.setScrollPos(0,0,!0)}},l(z,e,"0px",["border-left-width","border-right-width","border-top-width","border-bottom-width"]),this.putAway(z,N),e.scrollTop=0,e.scrollLeft=0,this.fleXlist[this.fleXlist.length]=e,G(e,"flexcrollactive",!1),I.sY.padding="1px",k.updateScrollBars(),k.setScrollPos(q,X,!0),K.match($)&&k.scrollToElement(S.getElementById(K.match($)[1])),x.sizeChangeDetect=w.setInterval(function(){var e=H.offsetHeight;e!=x.zTHeight&&(k.updateScrollBars(),x.zTHeight=e)},2500),k.mDPosFix=function(){U.scrollTop=0,U.scrollLeft=0,e.scrollTop=0,e.scrollLeft=0},this.addTrggr(w,"load",function(){e.fleXcroll&&k.updateScrollBars()}),this.addTrggr(w,"resize",function(){e.refreshTimeout&&w.clearTimeout(e.refreshTimeout),e.refreshTimeout=w.setTimeout(function(){e.fleXcroll&&k.updateScrollBars()},80)})}}},globalInit:function(){DG.fleXcroll.catchFastInit&&window.clearInterval(DG.fleXcroll.catchFastInit),DG.fleXcroll.initialized||DG.fleXcroll.addTrggr(document,"click",DG.fleXcroll.globalClickHandle),DG.fleXcroll.initByClass(),DG.fleXcroll.initialized=!0,window.onfleXcrollRun&&window.onfleXcrollRun()},globalClickHandle:function(e){e||(e=wD.event);var t=e.target||e.srcElement;if(3==t.nodeType&&(t=t.parentNode),t.href){var i,n=/#([^#.]*)$/,r=/(.*)#.*$/,o=/(^|\s)flexcroll-in-page-link($|\s)/,s=document.location.href;if(s.match(r)&&(s=s.match(r)[1]),i=t.className?t.className:"",t.href.match(n)&&(t.href.match(r)&&s===t.href.match(r)[1]||i.match(o))){var a=document.getElementById(t.href.match(n)[1]),l=!1;if(null==a&&(a=(a=document.getElementsByName(t.href.match(n)[1])[0])?a:null),null!=a){for(var h=a;h.parentNode;)h=h.parentNode,h.fleXcroll&&(h.fleXcroll.scrollToElement(a),l=h);if(l)return e.preventDefault&&e.preventDefault(),document.location.href=s+"#"+t.href.match(n)[1],l.fleXcroll.mDPosFix(),!1}}}},classChange:function(e,t,i){e.className||(e.className="");var n=e.className;t&&!n.match(RegExp("(^|\\s)"+t+"($|\\s)"))&&(n=n.replace(/(\S$)/,"$1 ")+t),i&&(n=n.replace(RegExp("((^|\\s)+"+i+")+($|\\s)","g"),"$2").replace(/\s$/,"")),e.className=n},initByClass:function(e){DG.fleXcroll.initialized=!0;for(var t,i=DG.fleXcroll.getByClassName(document.getElementsByTagName("body")[0],"div",e?e:"flexcroll"),n=0;t=i[n];n++)t.fleXcroll||DG.fleXcroll.fleXcrollMain(t)},scrollTo:function(e,t){if("string"==typeof e&&(e=document.getElementById(e)),null==e)return!1;for(var i=e;i.parentNode;)if(i=i.parentNode,i.fleXcroll)return t&&(document.location.href="#"+t),i.fleXcroll.scrollToElement(e),i.fleXcroll.mDPosFix(),!0;return!1},updateScrollBars:function(){for(var e,t=0;e=DG.fleXcroll.fleXlist[t];t++)e.fleXcroll.updateScrollBars()},camelConv:function(e){var t,e=e.split("-"),i=e[0];for(t=1;parT=e[t];t++)i+=parT.charAt(0).toUpperCase()+parT.substr(1);return i},getByClassName:function(e,t,i){if("string"==typeof e&&(e=document.getElementById(e)),null==e)return!1;for(var n,r=new RegExp("(^|\\s)"+i+"($|\\s)"),o=[],s=0,a=e.getElementsByTagName(t),l=0;n=a[l];l++)n.className&&n.className.match(r)&&(o[s]=n,s++);return o},checkHidden:function(e){if(null==e)return!0;for(var t;e.parentNode;){if(t=DG.fleXcroll.getStyle(e,"display"),"none"==t)return!0;e=e.parentNode}return!1},getStyle:function(e,t){return window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):!!e.currentStyle&&e.currentStyle[DG.fleXcroll.camelConv(t)]},catchFastInit:window.setInterval(function(){var e=document.getElementById("flexcroll-init");null!=e&&(DG.fleXcroll.initByClass(),window.clearInterval(DG.fleXcroll.catchFastInit))},100),putAway:function(e,t){e.parentNode.removeChild(e),e.style.display="none",t.appendChild(e)},addTrggr:function(e,t,i){!DG.fleXcroll.addChckTrggr(e,t,i)&&e.attachEvent&&e.attachEvent("on"+t,i)},addChckTrggr:function(e,t,i){return!!e.addEventListener&&(e.addEventListener(t,i,!1),DG.fleXcroll.w3events=!0,window.addEventListener("unload",function(){DG.fleXcroll.remTrggr(e,t,i)},!1),!0)},remTrggr:function(e,t,i){!DG.fleXcroll.remChckTrggr(e,t,i)&&e.detachEvent&&e.detachEvent("on"+t,i)},remChckTrggr:function(e,t,i){return!!e.removeEventListener&&(e.removeEventListener(t,i,!1),!0)}},DG.fleXcroll.fleXcrollInit(),DG.Transport.Platform=DG.Class({_id:null,_location:null,_name:null,_routeTypes:null,_routes:null,initialize:function(e){this._validateInitOptions(e),DG.Utils.extendOptionsProtected(this,e,["id","location","name"])},getId:function(){return this._id},getLocation:function(){return this._location},getName:function(){return this._name},getRoutes:function(e){var t,i,n={},r=null;return DG.Utils.extend(n,e),n.key=DG.Configs.Transport.key,n.format="jsonp",n.platform_id=this.getId(),DG.Utils.iNU(n.success)||(t=n.success,delete n.success),DG.Utils.iNU(n.failure)||(i=n.failure,delete n.failure),null!==this._routes?t.call(this,this._routes):r=DG.AjaxManager.get({url:DG.Configs.Transport.server+"/"+DG.Configs.Transport.version+DG.Configs.Transport.routeListUrl+"?callback=$[callback]",data:n,success:function(e){200!=e.meta.code||DG.Utils.empty(t)?200==e.response_code||DG.Utils.empty(i)||i.apply(this,[parseInt(e.meta.code),e.meta.error.message]):(this._routes=this._getRoutesByAjaxResult(e.result.items),t.call(this,this._routes))},failure:function(){DG.Utils.empty(i)||i.apply(this,[400,"Bad Request"])},scope:this}),r},destroy:function(){if(this._id=null,this._location=null,null!==this._routes){for(var e=0;e<this._routes.length;e++)this._routes[e].destroy();this._routes=null}},_getRoutesByAjaxResult:function(e){for(var t,i=[],n=0;n<e.length;n++)t=new DG.Transport.Route({id:e[n].id,type:e[n].subtype,name:e[n].name,to_name:e[n].to_name,from_name:e[n].from_name}),i.push(t);return i},_validateInitOptions:function(e){if("undefined"==typeof e)throw new Error('Parameter "options" is required');if(!e.id)throw new ReferenceError('Option "id" is required and should be not empty string');if(e.name&&"[object String]"!==Object.prototype.toString.call(e.name))throw new TypeError('Option "name" should be a string');if(e.location&&!(e.location instanceof DG.GeoPoint))throw new TypeError('Option "location" should be an instance of DG.GeoPoint')},_correctType:function(e){var t={bus:"bus",trolleybus:"trolleybus",tram:"tram",shuttle_bus:"minibus",metro:"metro",suburban_train:"eltrain",funicular_railway:"funicular",monorail:"monorail",river_transport:"river",cable_car:"ropeway",light_rail:"monorail",premetro:"light_metro",light_metro:"light_metro",aeroexpress:"eltrain"};return t[e]||"bus"}}),DG.Transport.Platform.cancelCallback=function(e){DG.AjaxManager.cancelCallback(e)},DG.Transport.Route=DG.Class({_id:null,_type:null,_name:null,_from_name:null,_to_name:null,_platforms:[],_directions:null,initialize:function(e){this._validateInitOptions(e),e.type=this._correctType(e.type),DG.Utils.extendOptionsProtected(this,e,["id","type","name","from_name","to_name","platforms","directions"])},getId:function(){return this._id},getType:function(){return this._type},getName:function(){return this._name},getToName:function(){return this._to_name},getFromName:function(){return this._from_name},getPlatforms:function(){return this._platforms},getDirections:function(){return this._directions},destroy:function(){this._id=null,this._type=null,this._name=null;for(var e=0;e<this._platforms.length;e++)this._platforms[e].destroy();this._platforms=null,null!==this._location&&(this._location.destroy(),this._location=null)},_validateInitOptions:function(e){if("undefined"==typeof e)throw new Error('Parameter "options" is required');if(!e.id)throw new ReferenceError('Option "id" is required and should be not empty string');if(e.type&&!DG.Utils.inArray(e.type,DG.Transport.Route.VALID_TYPES))throw new Error('Option "type" should be not empty valid string');if(e.name&&"[object String]"!==Object.prototype.toString.call(e.name))throw new Error('Option "name" should be not empty string')},_correctType:function(e){var t={bus:"bus",trolleybus:"trolleybus",tram:"tram",shuttle_bus:"minibus",metro:"metro",suburban_train:"eltrain",funicular_railway:"funicular",monorail:"monorail",river_transport:"river",cable_car:"ropeway",light_rail:"monorail",premetro:"light_metro",light_metro:"light_metro",aeroexpress:"eltrain"};return t[e]||"bus"}}),DG.Transport.Route.VALID_TYPES=["bus","trolleybus","tram","shuttle_bus","metro","suburban_train","funicular_railway","monorail","river_transport","cable_car","light_rail","premetro","light_metro","aeroexpress"],DG.Transport.RouteManager={getRouteById:function(e,t){var i,n,r,o={};return this._validateGetRouteByIdParams(e,t),DG.Utils.extend(o,t),o.key=DG.Configs.Transport.key,o.format="jsonp",o.id=e,DG.Utils.iNU(o.success)||(i=o.success,delete o.success),DG.Utils.iNU(o.failure)||(n=o.failure,delete o.failure),r=DG.AjaxManager.get({url:DG.Configs.Transport.server+"/"+DG.Configs.Transport.version+DG.Configs.Transport.routeInfoUrl+"?callback=$[callback]",data:o,success:function(e){200!=e.meta.code||DG.Utils.empty(i)?200==e.meta.code||DG.Utils.empty(n)||n.apply(this,[parseInt(e.meta.code),e.meta.error.message]):i.call(this,DG.Transport.RouteManager._getRouteByAjaxResult(e.result.items[0]))},failure:function(){DG.Utils.empty(n)||n.apply(this,[400,"Bad Request"])},scope:this})},cancelCallback:function(e){DG.AjaxManager.cancelCallback(e)},_getRouteByAjaxResult:function(e){var t,i,n,r=[];for(n=0;n<e.directions[0].platforms.length;n++)i=new DG.Transport.Platform({id:e.directions[0].platforms[n].station_id,location:DG.WKTParser.getPoint(e.directions[0].platforms[n].geometry.centroid).getPosition()}),r.push(i);for(n=0;n<e.directions[1].platforms.length;n++)i=new DG.Transport.Platform({id:e.directions[1].platforms[n].id,location:DG.WKTParser.getPoint(e.directions[1].platforms[n].geometry.centroid).getPosition()}),r.push(i);return t=new DG.Transport.Route({id:e.id,type:e.subtype,name:e.name,platforms:r,directions:[DG.WKTParser.getObject(e.directions[0].geometry.selection),DG.WKTParser.getObject(e.directions[1].geometry.selection)]})},_validateGetRouteByIdParams:function(e,t){if(!e)throw new Error('Parameter "id" is required and should be not empty');if("undefined"!=typeof t&&!DG.Utils.empty(t.success)&&"[object Function]"!==Object.prototype.toString.call(t.success))throw new TypeError('Option "success" should be a function');if("undefined"!=typeof t&&!DG.Utils.empty(t.failure)&&"[object Function]"!==Object.prototype.toString.call(t.failure))throw new TypeError('Option "failure" should be a function')}},DG.Transport.Station=DG.Class({_id:null,_type:null,_name:null,_platforms:[],initialize:function(e){this._validateInitOptions(e),DG.Utils.extendOptionsProtected(this,e,["id","type","name","platforms"])},getId:function(){return this._id},getType:function(){return this._type},getName:function(){return this._name},getPlatforms:function(){return this._platforms},destroy:function(){this._id=null,this._type=null,this._name=null;for(var e=0;e<this._platforms.length;e++)this._platforms[e].destroy();this._platforms=null},_validateInitOptions:function(e){if("undefined"==typeof e)throw new Error('Parameter "options" is required');if(!e.id)throw new ReferenceError('Option "id" is required and should be not empty string');if(e.type&&!DG.Utils.inArray(e.type,DG.Transport.Station.VALID_TYPES))throw new Error('Option "type" should be not empty valid string');if(e.name&&"[object String]"!==Object.prototype.toString.call(e.name)||!e.name)throw new Error('Option "name" should be not empty string');if(e.platforms&&"[object Array]"!==Object.prototype.toString.call(e.platforms))throw new TypeError('Option "platforms" should be an array')}}),DG.Transport.Station.VALID_TYPES=["surface_transport","metro","railway"],DG.Transport.StationManager={getStationById:function(e,t){var i={};return this._validateGetStationParams(e,t),DG.Utils.extend(i,t),i.id=e,DG.Transport.StationManager._get(i)},getStationByPlatformId:function(e,t){var i={};return this._validateGetStationParams(e,t),DG.Utils.extend(i,t),i.platform_id=e,DG.Transport.StationManager._get(i)},cancelCallback:function(e){DG.AjaxManager.cancelCallback(e)},_get:function(e){var t,i,n;return e.key=DG.Configs.Transport.key,e.format="jsonp",DG.Utils.iNU(e.success)||(t=e.success,delete e.success),DG.Utils.iNU(e.failure)||(i=e.failure,delete e.failure),n=DG.AjaxManager.get({url:DG.Configs.Transport.server+"/"+DG.Configs.Transport.version+DG.Configs.Transport.stationInfoUrl+"?callback=$[callback]",data:e,success:function(e){200!=e.meta.code||DG.Utils.empty(t)?200==e.meta.code||DG.Utils.empty(i)||i.apply(this,[parseInt(e.meta.code),e.meta.error.message]):t.call(this,DG.Transport.StationManager._getStationByAjaxResult(e.result.items[0]))},failure:function(){DG.Utils.empty(i)||i.apply(this,[400,"Bad Request"])},scope:this})},_getStationByAjaxResult:function(e){for(var t,i,n=[],r=0;r<e.platforms.length;r++)i=new DG.Transport.Platform({id:e.platforms[r].id,location:DG.WKTParser.getPoint(e.platforms[r].geometry.centroid).getPosition()}),n.push(i);return t=new DG.Transport.Station({id:e.id,type:DG.Transport.StationManager._correctType(e.type),name:e.name,platforms:n})},_correctType:function(e){var t={railway:"railway",metro:"metro",light_metro:"metro"};return t[e]||"surface_transport"},_validateGetStationParams:function(e,t){if(!e)throw new Error('Parameter "id" is required and should be not empty');if("undefined"!=typeof t&&!DG.Utils.empty(t.success)&&"[object Function]"!==Object.prototype.toString.call(t.success))throw new TypeError('Option "success" should be a function');if("undefined"!=typeof t&&!DG.Utils.empty(t.failure)&&"[object Function]"!==Object.prototype.toString.call(t.failure))throw new TypeError('Option "failure" should be a function')}},DG.UIStats=function(document,window){"use strict";function init(e){var t=getRandomNumber();for(var i in providers)if(providers.hasOwnProperty(i)&&providers[i].init){var n=!!e.hasOwnProperty(i)&&e[i];providers[i].init(n,t)}isEnable&&(setOptions(e),sendDataToProviders(),saveCacheToCookie())}function setOptions(e){sendTimeOnload=e.sendTimeOnload||15,sendInterval=e.sendInterval||300,cacheInterval=e.cacheInterval||10,cookieName=e.cookieName||"__dg_ui_stats",cookieExpire=e.cookieExpire||31}function track(e){cache||(cache={}),cache[e.expl]||(cache[e.expl]={}),cache[e.expl][e.name]?cache[e.expl][e.name]+=1:cache[e.expl][e.name]=1}function saveCacheToCookie(){setInterval(function(){cache&&(mergeCookieData(cache),cache=null)},1e3*cacheInterval)}function mergeCookieData(e){var t=parseJSON(getCookie(cookieName))||{};for(var i in e)if(e.hasOwnProperty(i))for(var n in e[i])e[i].hasOwnProperty(n)&&(t[i]||(t[i]={}),t[i][n]?t[i][n]+=e[i][n]:t[i][n]=e[i][n]);setCookie(stringifyJSON(t),cookieName,cookieExpire)}function sendDataToProviders(){setTimeout(function(){sendDataToProvidersHelper()},1e3*sendTimeOnload),setInterval(function(){sendDataToProvidersHelper()},1e3*sendInterval)}function sendDataToProvidersHelper(){var e=getCookie(cookieName);if(e){var t=parseJSON(e);for(var i in providers)providers.hasOwnProperty(i)&&providers[i].send&&providers[i].send(t);clearCookie(cookieName)}}function setCookie(e,t,i){var n,r=new Date;r.setDate(r.getDate()+i),n=e+"; expires="+r.toUTCString()+"; path=/",document.cookie=t+"="+n}function getCookie(e){var t,i,n=document.cookie,r=e+"=",o=null;return n.length>0&&(t=n.indexOf(r),t!==-1&&(t+=r.length,i=n.indexOf(";",t),i===-1&&(i=n.length),o=n.substring(t,i))),o?o:null}function clearCookie(e){setCookie("",e,0)}function getRandomNumber(){return Math.floor(100*Math.random())}function stringifyJSON(e){if(window.JSON)return JSON.stringify(e);var t=typeof e;if("object"!=t||null===e)return"string"==t&&(e='"'+e+'"'),String(e);var i,n,r=[],o=e&&e.constructor==Array;for(i in e)n=e[i],t=typeof n,"string"==t?n='"'+n+'"':"object"==t&&null!==n&&(n=stringifyJSON(n)),r.push((o?"":'"'+i+'":')+String(n));return(o?"[":"{")+String(r)+(o?"]":"}")}function parseJSON(text){if(window.JSON)return JSON.parse(text);var filtered=text.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"");return/^[\],:{}\s]*$/.test(filtered)?eval("("+text+")"):null}var providers={},cache=null,isEnable=!1,sendTimeOnload,sendInterval,cacheInterval,cookieName,cookieExpire;return providers.google={init:function(e,t){if(!e||e&&e.audience<=t)return void(this.send=function(){});isEnable=!0;var i=window._gaq=window._gaq||[];i.push(["dg_ui._setAccount",e.key]),i.push(["dg_ui._setDomainName","none"]),i.push(["dg_ui._setAllowLinker",!0]),i.push(["dg_ui._setAllowHash",!1]),i.push(["dg_ui._setVisitorCookieTimeout",0]),i.push(["dg_ui._setCampaignCookieTimeout",0]),i.push(["dg_ui._setSessionCookieTimeout",0]),i.push(["dg_ui._trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://ssl.google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()},send:function(e){var t=0;for(var i in e)if(e.hasOwnProperty(i))for(var n in e[i])e[i].hasOwnProperty(n)&&(!function(e,t,i,n){setTimeout(function(){try{window._gaq.push(["dg_ui._trackEvent",e,e,t,i])}catch(n){}},1e3*n)}(i,n,e[i][n],t),t+=1)}},providers.yandex={init:function(e,t){return!e||e&&e.audience<=t?void(this.send=function(){}):(isEnable=!0,void function(t,i,n){(i[n]=i[n]||[]).push(function(){try{i.yaUIStats=new Ya.Metrika({id:e.key})}catch(t){}});var r=t.getElementsByTagName("script")[0],o=t.createElement("script"),s=function(){r.parentNode.insertBefore(o,r)};o.type="text/javascript",o.async=!0,o.src="https://mc.yandex.ru/metrika/watch.js","[object Opera]"==i.opera?t.addEventListener("DOMContentLoaded",s,!1):s()}(document,window,"yandex_metrika_callbacks"))},send:function(e){var t=0;for(var i in e)e.hasOwnProperty(i)&&(!function(e,t,i){setTimeout(function(){try{window.yaUIStats.reachGoal(e,t)}catch(i){}},1e3*i)}(i,e[i],t),t+=1)}},{init:init,track:track}}(document,window),DG.Utils.DOM={getDocumentElement:function(){return document.documentElement||document.body},getDocumentWidth:function(){var e=DG.Utils.DOM.getDocumentElement();return"IE"==DG.Utils.detectBrowser()[0]&&"8"==DG.Utils.detectBrowser()[1]?Math.max(e.clientWidth,e.scrollWidth):Math.max(e.clientWidth,e.scrollWidth,e.offsetWidth)},getDocumentHeight:function(){var e=DG.Utils.DOM.getDocumentElement();return"IE"==DG.Utils.detectBrowser()[0]&&"8"==DG.Utils.detectBrowser()[1]?Math.max(e.clientHeight,e.scrollHeight):Math.max(e.clientHeight,e.offsetHeight)},isChildElement:function(e,t){for(var i=t;null!=i;){if(i==e)return!0;i=i.parentNode}return!1},getElementsByClassName:function(e,t){var i,n,r=-1,o=[];if(t||(t=document),document.getElementsByClassName)o=t.getElementsByClassName(e);else for(i=t.getElementsByTagName("*");n=i[++r];)(" "+(n["class"]||n.className)+" ").indexOf(" "+e+" ")>-1&&o.push(n);return o},hasClass:function(e,t){return e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(e,t){var i=new RegExp("(^|\\s)"+t+"(\\s|$)","g");if(!DG.Utils.DOM.hasClass(e,t)){if(i.test(e.className))return;e.className=(e.className+" "+t).replace(/\s+/g," ").replace(/(^ | $)/g,"")}},removeClass:function(e,t){var i=new RegExp("(^|\\s)"+t+"(\\s|$)","g");e.className=e.className.replace(i,"$1").replace(/\s+/g," ").replace(/(^ | $)/g,"")},getOffset:function(e){return e.getBoundingClientRect?this._getOffsetRect(e):this._getOffsetSum(e)},_getOffsetRect:function(e){var t=e.getBoundingClientRect(),i=document.body,n=document.documentElement,r=window.pageYOffset||n.scrollTop||i.scrollTop,o=window.pageXOffset||n.scrollLeft||i.scrollLeft,s=n.clientTop||i.clientTop||0,a=n.clientLeft||i.clientLeft||0,l=t.top+r-s,h=t.left+o-a;return{top:Math.round(l),left:Math.round(h)}},_getOffsetSum:function(e){for(var t=0,i=0;e;)t+=parseInt(e.offsetTop,10),i+=parseInt(e.offsetLeft,10),e=e.offsetParent;return{top:t,left:i}},getChildNode:function(e){var t=e.firstChild;return t&&1!==t.nodeType?t.nextSibling:t}},Array.prototype.indexOf||(Array.prototype.indexOf=function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),i=t.length>>>0;if(0===i)return-1;var n=0;if(arguments.length>1&&(n=Number(arguments[1]),n!=n?n=0:0!=n&&n!=1/0&&n!=-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=i)return-1;for(var r=n>=0?n:Math.max(i-Math.abs(n),0);r<i;r++)if(r in t&&t[r]===e)return r;return-1}),DG.Utils.Profiler.Time=function(e){this.component=e,this.timers={};for(var t in this.component)if("function"==typeof this.component[t]){var i=this;!function(e){i[e]=function(){i._startTimer(e);var t=i.component[e].apply(i.component,arguments);return i._displayTime(e,i._getElapsedTime(e)),t}}(t)}},DG.Utils.Profiler.Time.prototype={_startTimer:function(e){this.timers[e]=(new Date).getTime()},_getElapsedTime:function(e){return(new Date).getTime()-this.timers[e]},_displayTime:function(e,t){var i,n,r;i=document.getElementsByTagName("body")[0],n=document.createElement("div"),r=document.createElement("div"),n.id="methodName",r.id="time",n.innerHTML=e,r.innerHTML=t,i.appendChild(n),i.appendChild(r)}},DG.Utils.Template={_cache:{},tmplById:function(e,t,i){var n=DG.Widget.System.Template;return i?(n._cache[e]||(n._cache[e]=n.tmpl(n._getTmplById(e))),n._cache[e].call(this,t)):n.tmpl(n._getTmplById(e),t)},_getTmplById:function(e){var t=$("#"+e);return t.length?t.html():(console.log("Warning - template '"+e+"' not found."),"")},tmpl:function(e,t){var i=new Function("obj","var p=[],print=function(){p.push.apply(p,arguments)},ucfirst=function(str){str += '';var f = str.charAt(0).toUpperCase();return f + str.substr(1);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return t?i.call(this,t):i}},DG.Utils.Throttle=function(e,t){function i(){e.apply(r,o)}function n(){return s==a?void(s=null):void(s==l&&(i(),s=a,setTimeout(n,t)))}var r,o,s=null,a=1,l=2;return function(){switch(s){case null:e.apply(this,arguments),s=a,setTimeout(n,t);break;case a:case l:r=this,o=arguments,s=l}}},DG.Utils.Tracker={regBC:function(e){this._callUrl(e)},_callUrl:function(e){var t,i=this.generateUniqueId();t=document.createElement("iframe"),t.id=i,t.src=e,t.onload=function(){DG.Utils.Tracker.afterRegister(i)},t.style.display="none",document.body.appendChild(t)},afterRegister:function(e){var t=document.getElementById(e);t&&t.parentNode&&(t.onLoad=null,setTimeout(function(){t.parentNode.removeChild(t)},10))},generateUniqueId:function(){return"bcri_"+Math.floor(1e10*Math.random()+1)}},DG.Utils.WKT.SpaceCutter={deleteSpaces:function(e){return e=e.replace(/, /g,","),e=e.replace(" (","(")},CLASS_NAME:"DG.Utils.WKT.SpaceCutter"},DG.Validators.WKT.LineString={validate:function(e){return e=DG.Utils.WKT.SpaceCutter.deleteSpaces(e),/^LINESTRING\(([\d|\.]+ [\d|\.]+,)+[\d|\.]+ [\d|\.]+\)/.test(e)}},DG.Validators.WKT.MultilineString={validate:function(e){return e=DG.Utils.WKT.SpaceCutter.deleteSpaces(e),/^MULTILINESTRING\((\(([\d|\.]+ [\d|\.]+,)+[\d|\.]+ [\d|\.]+\),?)+\)/.test(e)}},DG.Validators.WKT.Multipoint={validate:function(e){return e=DG.Utils.WKT.SpaceCutter.deleteSpaces(e),/^MULTIPOINT\(([\d|\.]+ [\d|\.]+,)*([\d|\.]+ [\d|\.]+)\)$/.test(e)}},DG.Validators.WKT.Multipolygon={validate:function(e){return e=DG.Utils.WKT.SpaceCutter.deleteSpaces(e),/^MULTIPOLYGON\((\(\(([\d|\.]+ [\d|\.]+,){2,}[\d|\.]+ [\d|\.]+\)\),?)+\)/.test(e)}},DG.Validators.WKT.Point={validate:function(e){return e=DG.Utils.WKT.SpaceCutter.deleteSpaces(e),/^POINT\([\d|\.]+ [\d|\.]+\)/.test(e)}},DG.Validators.WKT.Polygon={validate:function(e){return e=DG.Utils.WKT.SpaceCutter.deleteSpaces(e),/^POLYGON\(\(([\d|\.]+ [\d|\.]+,){2,}[\d|\.]+ [\d|\.]+\)\)/.test(e)}};